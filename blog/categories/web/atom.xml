<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: web | Reading Space]]></title>
  <link href="http://hongchaozhang.github.io/blog/categories/web/atom.xml" rel="self"/>
  <link href="http://hongchaozhang.github.io/"/>
  <updated>2024-03-25T00:27:25+08:00</updated>
  <id>http://hongchaozhang.github.io/</id>
  <author>
    <name><![CDATA[Zhang Hongchao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[React Learning Note 2023]]></title>
    <link href="http://hongchaozhang.github.io/blog/2023/09/15/react-learning-note-2023/"/>
    <updated>2023-09-15T17:33:08+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2023/09/15/react-learning-note-2023</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#react-state-is-updated-in-a-batch">React state is updated in a â€œbatchâ€</a></li>
<li><a href="#update-react-state-with-a-new-object-do-not-mute-existing-one">Update react state with a new object, do not mute existing one</a></li>
<li><a href="#declarative-ui">Declarative UI</a></li>
<li><a href="#react-redux">React-redux</a></li>
<li><a href="#hooks">Hooks</a></li>
<li><a href="#react%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F">Reactä¸­çš„å˜é‡</a></li>
<li><a href="#useeffect">useEffect</a>

<ul>
<li><a href="#clean-up-function">clean up function</a></li>
</ul>
</li>
<li><a href="#usememo">useMemo</a></li>
<li><a href="#two-ways-to-store-previous-props">two ways to store previous props</a>

<ul>
<li><a href="#useref">useRef</a></li>
<li><a href="#usestate">useState</a></li>
</ul>
</li>
<li><a href="#fetch-data%E7%9A%84%E4%B8%A4%E4%B8%AA%E9%97%AE%E9%A2%98">fetch dataçš„ä¸¤ä¸ªé—®é¢˜</a>

<ul>
<li><a href="#race-condition">race condition</a></li>
<li><a href="#undo">undo</a></li>
</ul>
</li>
<li><a href="#effect-event">Effect Event</a>

<ul>
<li><a href="#what-is-reactive">what is reactive</a></li>
<li><a href="#problem">Problem</a></li>
<li><a href="#solution">Solution:</a></li>
<li><a href="#supress-react-lint-error">Supress react lint error</a></li>
</ul>
</li>
<li><a href="#how-to-review-effect-dependencies">How to review effect dependencies</a>

<ul>
<li><a href="#ways-to-review-and-fix-this">ways to review and fix this</a></li>
</ul>
</li>
<li><a href="#object-and-function-compare">Object and function compare</a></li>
<li><a href="#usememo-and-usecallback">useMemo and useCallback</a></li>
<li><a href="#forwardref">forwardRef</a>

<ul>
<li><a href="#useref-1">useRef</a></li>
<li><a href="#basic-concepts">basic concepts</a></li>
<li><a href="#expose-dom-node">expose dom node</a></li>
<li><a href="#expose-an-object">expose an object</a></li>
</ul>
</li>
<li><a href="#custom-hook">Custom Hook</a></li>
<li><a href="#strict-mode">strict mode</a></li>
<li><a href="#other-rules">Other Rules</a>

<ul>
<li><a href="#data-from-parent-to-child">data from parent to child</a></li>
<li><a href="#usesyncexternalstore">useSyncExternalStore</a></li>
<li><a href="#useeffect-dependencies">useEffect dependencies</a></li>
</ul>
</li>
</ul>


<h2>React state is updated in a â€œbatchâ€</h2>

<p>This means that you can not get the state immediately after you change it.</p>

<p>number will be 1 after one click:
<code>
export default function Counter() {
  const [number, setNumber] = useState(0);
  return (
    &lt;&gt;
      &lt;h1&gt;{number}&lt;/h1&gt;
      &lt;button onClick={() =&gt; {
        setNumber(number + 1);
        setNumber(number + 1);
        setNumber(number + 1);
      }}&gt;+3&lt;/button&gt;
    &lt;/&gt;
  )
}
</code>
To make the number to be 3, pass a update function to the setNumber function. An update function will be queued and executed later.
<code>
export default function Counter() {
  const [number, setNumber] = useState(0);
  return (
    &lt;&gt;
      &lt;h1&gt;{number}&lt;/h1&gt;
      &lt;button onClick={() =&gt; {
        setNumber(n =&gt; n + 1);
        setNumber(n =&gt; n + 1);
        setNumber(n =&gt; n + 1);
      }}&gt;+3&lt;/button&gt;
    &lt;/&gt;
  )
}
</code></p>

<h2>Update react state with a new object, do not mute existing one</h2>

<p>Use <code>â€¦</code> , the object spread operator:
<code>
setPerson({
  ...person, // Copy the old fields
  firstName: e.target.value // But override this one
});
</code>
Note that spread syntax is shallow: it only copies one level deep. To update nested object:
<code>
setPerson({
  ...person, // Copy other fields
  artwork: { // but replace the artwork
    ...person.artwork, // with the same one
    city: 'New Delhi' // but in New Delhi!
  }
});
</code>
For updating array object:
<code>
setArtists([
  { id: nextId++, name: name },
  ...artists // Put old items at the end
]);
</code>
<code>Immer</code> is a popular library that lets you write using the convenient but mutating syntax and takes care of producing the copies for you.
<code>
updatePerson(draft =&gt; {
  draft.artwork.city = 'Lagos';
});
</code>
Using <code>Immer</code> for array:
<code>
updateMyTodos(draft =&gt; {
  const artwork = draft.find(a =&gt; a.id === artworkId);
  artwork.seen = nextSeen;
});
</code></p>

<h2>Declarative UI</h2>

<ul>
<li>Declarative programming means describing the UI for each visual state rather than micromanaging the UI (imperative).</li>
<li>When developing a component, Think in declarative UI way:

<ol>
<li>Identify all its visual states.</li>
<li>Determine the human and computer triggers for state changes.</li>
<li>Model the state with useState.</li>
<li>Remove non-essential state to avoid bugs and paradoxes.</li>
<li>Connect the event handlers to set state.</li>
</ol>
</li>
</ul>


<h2>React-redux</h2>

<ul>
<li>useReducer+useContext?</li>
<li>Provider</li>
<li>Context</li>
</ul>


<h2>Hooks</h2>

<ul>
<li>useContext: è·¨å±‚ä¼ è¾“propsï¼Œä¸ç”¨ä¸€å±‚ä¸€å±‚ä¼ ä¸‹å»</li>
<li>useEffect: Use them to synchronize your component with a system outside of React.</li>
</ul>


<h2>Reactä¸­çš„å˜é‡</h2>

<ul>
<li>Propsï¼šimmutable, è§¦å‘rerenderï¼Œä¸è®°å¿†(retained by component)</li>
<li>Stateï¼šimmutable, è§¦å‘rerenderï¼Œè®°å¿†(retained by React)</li>
<li>useRefï¼šmutable, ä¸è§¦å‘rerenderï¼Œè®°å¿†(retained by React)</li>
</ul>


<h2>useEffect</h2>

<p>Effects let you specify side effects that are caused by rendering itself, rather than by a particular event.</p>

<p>Effects run at the end of a <em>commit</em> after the screen updates. That is, useEffect â€œdelaysâ€ a piece of code from running until that render is reflected on the screen.</p>

<h3>clean up function</h3>

<p>You can use a clean up function to clean up the effect. For example, if you subscribe to an external data source, you can unsubscribe it in the clean up function.
```
useEffect(() => {
  const connection = createConnection();
  connection.connect();
  return () => {
    connection.disconnect();
  };
}, []);</p>

<p>useEffect(() => {
  function handleScroll(e) {
    console.log(window.scrollX, window.scrollY);
  }
  window.addEventListener(&lsquo;scroll&rsquo;, handleScroll);
  return () => window.removeEventListener(&lsquo;scroll&rsquo;, handleScroll);
}, []);
```
<strong>React will call your cleanup function each time before the next Effect runs again, and one final time when the component unmounts (gets removed).</strong>
That is, the cleanup function runs not only during unmount, but before every re-render with changed dependencies.</p>

<h2>useMemo</h2>

<p>useMemoå’ŒuseEffectéƒ½å¯ä»¥åŠ ä¾èµ–ï¼Œä½†æ˜¯useMemoåœ¨renderè¿‡ç¨‹èµ·ä½œç”¨ï¼Œè€ŒuseEffectåœ¨commitä¹‹åèµ·ä½œç”¨ã€‚
æ‰€ä»¥ï¼Œå¦‚æœæ˜¯renderä¾èµ–çš„å˜é‡å€¼ï¼Œç”¨useMemoï¼Œä¸ç”¨useEffect+useStateã€‚</p>

<p>ä¸æ¨èï¼š
<code>
function TodoList({ todos, filter }) {
  const [newTodo, setNewTodo] = useState('');
  // ğŸ”´ Avoid: redundant state and unnecessary Effect
  const [visibleTodos, setVisibleTodos] = useState([]);
  useEffect(() =&gt; {
    setVisibleTodos(getFilteredTodos(todos, filter));
  }, [todos, filter]);
  // ...
}
</code>
æ¨èï¼š
<code>
import { useMemo, useState } from 'react';
function TodoList({ todos, filter }) {
  const [newTodo, setNewTodo] = useState('');
  const visibleTodos = useMemo(() =&gt; {
    // âœ… Does not re-run unless todos or filter change
    return getFilteredTodos(todos, filter);
  }, [todos, filter]);
  // ...
}
</code></p>

<h2>two ways to store previous props</h2>

<h3>useRef</h3>

<p><code>prevProps</code> updates after render:
<code>
  const prevProps = useRef();
  useEffect(() =&gt; {
    prevProps.current = props;
  }, [props]);
</code></p>

<h3>useState</h3>

<p><code>prevItems</code> is ready when render:
<code>
  const [prevItems, setPrevItems] = useState(items);
  if (items !== prevItems) {
    setPrevItems(items);
  }
</code></p>

<h2>fetch dataçš„ä¸¤ä¸ªé—®é¢˜</h2>

<h3>race condition</h3>

<p>è¾“å…¥ç‰¹åˆ«å¿«çš„æ—¶å€™ï¼Œå¾ˆå¤šsearchçš„requestè¿ç»­å‘å‡ºï¼Œä¸èƒ½ä¿è¯å›æ¥çš„é¡ºåºï¼Œä¼šå‡ºé—®é¢˜ã€‚
è§£å†³æ–¹æ³•ï¼šç»™useEffectæä¾›cleanupå‡½æ•°è§£å†³
```
function SearchResults({ query }) {
  const [results, setResults] = useState([]);
  const [page, setPage] = useState(1);
  useEffect(() => {
    let ignore = false;
    fetchResults(query, page).then(json => {
      if (!ignore) {
        setResults(json);
      }
    });
    return () => {
      ignore = true;
    };
  }, [query, page]);</p>

<p>  function handleNextPageClick() {
    setPage(page + 1);
  }
  // &hellip;
}
```</p>

<h3>undo</h3>

<p>æ²¡çœ‹æ‡‚ï¼š<a href="https://react.dev/learn/you-might-not-need-an-effect#fetching-data">https://react.dev/learn/you-might-not-need-an-effect#fetching-data</a></p>

<h2>Effect Event</h2>

<h3>what is reactive</h3>

<p>variables which can change due to a re-render
* Logic inside event handlers (or Effect Event) is not reactive.
* Logic inside Effects is reactive.</p>

<h3>Problem</h3>

<pre><code>function ChatRoom({ roomId, theme }) {
  useEffect(() =&gt; {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () =&gt; {
      showNotification('Connected!', theme);
    });
    connection.connect();
    return () =&gt; {
      connection.disconnect()
    };
  }, [roomId, theme]); // âœ… All dependencies declared
  // ...
</code></pre>

<p>When reconnected, a notification will be shown, and the notificaiton will consider the theme.
But when the theme changes, the notification will also be shown, which is not expected.</p>

<h3>Solution:</h3>

<p>Use Effect Event to separate this non-reactive logic from the reactive Effect around it.
```
function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification(&lsquo;Connected!&rsquo;, theme);
  });</p>

<p>  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on(&lsquo;connected&rsquo;, () => {
      onConnected();
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // âœ… All dependencies declared
  // &hellip;
```</p>

<p>You can think of Effect Events as being very similar to event handlers. The main difference is that event handlers run in response to a user interactions, whereas Effect Events are triggered by you from Effects. Effect Events let you â€œbreak the chainâ€ between the reactivity of Effects and code that should not be reactive.</p>

<h3>Supress react lint error</h3>

<p>React linter ask you to add all reactive variables into the Effect dependencies.
Effect Events let you fix many patterns where you might be tempted to suppress the dependency linter.</p>

<h2>How to review effect dependencies</h2>

<p>Every time you adjust the Effectâ€™s dependencies to reflect the code, look at the dependency list. Does it make sense for the Effect to re-run when any of these dependencies change? Sometimes, the answer is â€œnoâ€:</p>

<ul>
<li>You might want to re-execute different parts of your Effect under different conditions.</li>
<li>You might want to only read the latest value of some dependency instead of â€œreactingâ€ to its changes.</li>
<li>A dependency may change too often unintentionally because itâ€™s an object or a function.</li>
</ul>


<h3>ways to review and fix this</h3>

<ul>
<li>Should this code move to an event handler?</li>
<li>Is your Effect doing several unrelated things?

<ul>
<li>If different parts of your Effect should re-run for different reasons, split it into several Effects.</li>
</ul>
</li>
<li>Are you reading some state to calculate the next state?

<ul>
<li>Use update function. Use <code>setMessages([...messages, receivedMessage])</code> instead of <code>setMessages(msgs =&gt; [...msgs, receivedMessage])</code></li>
</ul>
</li>
<li>In JavaScript, objects and functions are considered different if they were created at different times.</li>
<li>Try to avoid object and function dependencies. Move them outside the component or inside the Effect.

<ul>
<li>Move static objects and functions outside your component
```
function createOptions() {
return {
serverUrl: &lsquo;<a href="https://localhost:1234">https://localhost:1234</a>&rsquo;,
roomId: &lsquo;music&rsquo;
};
}</li>
</ul>
</li>
</ul>


<p>function ChatRoom() {
  const [message, setMessage] = useState(&lsquo;&rsquo;);</p>

<p>  useEffect(() => {
    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, []); // âœ… All dependencies declared
  // &hellip;
<code>
    * Move dynamic objects and functions inside your Effect
</code>
const serverUrl = &lsquo;<a href="https://localhost:1234">https://localhost:1234</a>&rsquo;;</p>

<p>function ChatRoom({ roomId }) {
  const [message, setMessage] = useState(&lsquo;&rsquo;);</p>

<p>  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId
    };
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // âœ… All dependencies declared
  // &hellip;
<code>
* Read primitive values from objects
</code>
function ChatRoom({ options }) {
  const [message, setMessage] = useState(&lsquo;&rsquo;);</p>

<p>  const { roomId, serverUrl } = options;
  useEffect(() => {
    const connection = createConnection({
      roomId: roomId,
      serverUrl: serverUrl
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]); // âœ… All dependencies declared
  // &hellip;
```</p>

<h2>Object and function compare</h2>

<pre><code>import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  // Temporarily disable the linter to demonstrate the problem
  // eslint-disable-next-line react-hooks/exhaustive-deps
  const options = {
    serverUrl: serverUrl,
    roomId: roomId
  };

  useEffect(() =&gt; {
    const connection = createConnection(options);
    connection.connect();
    return () =&gt; connection.disconnect();
  }, [options]);

  return (
    &lt;&gt;
      &lt;h1&gt;Welcome to the {roomId} room!&lt;/h1&gt;
      &lt;input value={message} onChange={e =&gt; setMessage(e.target.value)} /&gt;
    &lt;/&gt;
  );
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  return (
    &lt;&gt;
      &lt;label&gt;
        Choose the chat room:{' '}
        &lt;select
          value={roomId}
          onChange={e =&gt; setRoomId(e.target.value)}
        &gt;
          &lt;option value="general"&gt;general&lt;/option&gt;
          &lt;option value="travel"&gt;travel&lt;/option&gt;
          &lt;option value="music"&gt;music&lt;/option&gt;
        &lt;/select&gt;
      &lt;/label&gt;
      &lt;hr /&gt;
      &lt;ChatRoom roomId={roomId} /&gt;
    &lt;/&gt;
  );
}
</code></pre>

<p>In the example above, the input only updates the message state variable. From the userâ€™s perspective, this should not affect the chat connection. However, every time you update the message, your component re-renders. When your component re-renders, the code inside of it runs again from scratch.</p>

<p>A new options object is created from scratch on every re-render of the ChatRoom component. React sees that the options object is a different object from the options object created during the last render. This is why it re-synchronizes your Effect (which depends on options), and the chat re-connects as you type.</p>

<p>This problem only affects objects and functions. In JavaScript, each newly created object and function is considered distinct from all the others. It doesnâ€™t matter that the contents inside of them may be the same!</p>

<p>Object and function dependencies can make your Effect re-synchronize more often than you need.</p>

<p>This is why, whenever possible, you should try to avoid objects and functions as your Effectâ€™s dependencies. Instead, try moving them outside the component, inside the Effect, or extracting primitive values out of them.</p>

<h2>useMemo and useCallback</h2>

<ul>
<li>useMemo caches the result of calling your function.</li>
<li>useCallback caches the function itself. React will not call your function.</li>
</ul>


<h2>forwardRef</h2>

<p>First, get familar with <code>useRef</code>:</p>

<h3>useRef</h3>

<p>ref.current is set during the <em>commit</em> process, not <em>render</em> process, so do not read or write ref.current during rendering. We can use ref.current in event handler or useEffect.</p>

<h3>basic concepts</h3>

<pre><code>const MyInput = forwardRef(function MyInput(props, ref) {
  return (
    &lt;label&gt;
      {props.label}
      &lt;input ref={ref} /&gt;
    &lt;/label&gt;
  );
});
</code></pre>

<p>The ref attribute passed by the parent component. The ref can be an object or a function. You should either
* pass the ref you receive to another component, or
* pass it to useImperativeHandle.</p>

<h3>expose dom node</h3>

<p>The parent <code>Form</code> component accesses the \<input\> DOM node exposed by <code>MyInput</code>.
```
import { forwardRef } from &lsquo;react&rsquo;;</p>

<p>const MyInput = forwardRef(function MyInput(props, ref) {
  const { label, &hellip;otherProps } = props;
  return (
    <label>
      {label}
      <input {...otherProps} ref={ref} />
    </label>
  );
});</p>

<p>function Form() {
  const ref = useRef(null);</p>

<p>  function handleClick() {
    ref.current.focus();
  }</p>

<p>  return (
    <form>
      <MyInput label="Enter your name:" ref={ref} />
      <button type="button" onClick={handleClick}>
        Edit
      </button>
    </form>
  );
}
```</p>

<h3>expose an object</h3>

<p>Use <code>useImperativeHandle</code> to expose an object referenced by <code>ref</code>:
```
import { forwardRef, useRef, useImperativeHandle } from &lsquo;react&rsquo;;</p>

<p>const MyInput = forwardRef(function MyInput(props, ref) {
  const inputRef = useRef(null);</p>

<p>  useImperativeHandle(ref, () => {
    return {
      focus() {
        inputRef.current.focus();
      },
      scrollIntoView() {
        inputRef.current.scrollIntoView();
      },
    };
  }, []);</p>

<p>  return <input {...props} ref={inputRef} />;
});
```</p>

<h2>Custom Hook</h2>

<p>You must follow these naming conventions:</p>

<ul>
<li>React component names must start with a capital letter, like StatusBar and SaveButton. React components also need to return something that React knows how to display, like a piece of JSX.</li>
<li>Hook names must start with use followed by a capital letter, like useState (built-in) or useOnlineStatus (custom, like earlier on the page). Hooks may return arbitrary values.</li>
</ul>


<p>This convention guarantees that you can always look at a component and know where its state, Effects, and other React features might â€œhideâ€. For example, if you see a getColor() function call inside your component, you can be sure that it canâ€™t possibly contain React state inside because its name doesnâ€™t start with use. However, a function call like useOnlineStatus() will most likely contain calls to other Hooks inside!</p>

<p>If your linter is configured for React, it will enforce this naming convention.</p>

<p>Note that custom Hooks only share stateful logic, not state itself.</p>

<h2>strict mode</h2>

<p><StrictMode> lets you find common bugs in your components early during development.</p>

<p>Strict Mode enables the following development-only behaviors:
* Your components will re-render an extra time to find bugs caused by impure rendering.
* Your components will re-run Effects an extra time to find bugs caused by missing Effect cleanup.
* Your components will be checked for usage of deprecated APIs.</p>

<h2>Other Rules</h2>

<h3>data from parent to child</h3>

<p>When child components update the state of their parent components in Effects, the data flow becomes very difficult to trace. Since both the child and the parent need the same data, let the parent component fetch that data, and pass it down to the child.
This is simpler and keeps the data flow predictable: the data flows down from the parent to the child.</p>

<h3>useSyncExternalStore</h3>

<h3>useEffect dependencies</h3>

<p>All variables from the component body used by the Effect should be in the Effect dependency list. However, you could instead â€œproveâ€ to the linter that these values arenâ€™t reactive values, i.e. that they canâ€™t change as a result of a re-render. For example, if serverUrl and roomId donâ€™t depend on rendering and always have the same values, you can move them outside the component. Now they donâ€™t need to be dependencies:
```
const serverUrl = &lsquo;<a href="https://localhost:1234">https://localhost:1234</a>&rsquo;; // serverUrl is not reactive
const roomId = &lsquo;general&rsquo;; // roomId is not reactive</p>

<p>function ChatRoom() {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, []); // âœ… All dependencies declared
  // &hellip;
}
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é‡å­¦å‰ç«¯-é€šè¿‡windowå±æ€§äº†è§£åè®®API]]></title>
    <link href="http://hongchaozhang.github.io/blog/2022/10/08/chongxueqianduan-tongguo-window-liaojie-protocol-api/"/>
    <updated>2022-10-08T17:18:04+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2022/10/08/chongxueqianduan-tongguo-window-liaojie-protocol-api</id>
    <content type="html"><![CDATA[<!-- more -->


<p>æµè§ˆå™¨çš„APIæ•°ç›®ç¹å¤šï¼Œè¿™ä¸€èŠ‚è¯¾ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ªå®éªŒï¼Œæˆ‘ä»¬ä¸€èµ·æ¥ç»™APIåˆ†åˆ†ç±»ã€‚</p>

<p>æˆ‘ä»¬æŒ‰ç…§æ¯ä¸ªAPIæ‰€åœ¨çš„æ ‡å‡†æ¥åˆ†ç±»ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ç”¨ä»£ç æ¥åå°„æµè§ˆå™¨ç¯å¢ƒä¸­å…¨å±€å¯¹è±¡çš„å±æ€§ï¼Œç„¶åæˆ‘ä»¬ç”¨JavaScriptçš„filteræ–¹æ³•æ¥é€æ­¥è¿‡æ»¤æ‰å·²çŸ¥çš„å±æ€§ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ•´ç†APIçš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<ol>
<li>ä»Windowçš„å±æ€§ä¸­ï¼Œæ‰¾åˆ°APIåç§°ï¼›</li>
<li>æŸ¥é˜…MDNæˆ–è€…Googleï¼Œæ‰¾åˆ°APIæ‰€åœ¨çš„æ ‡å‡†ï¼›</li>
<li>é˜…è¯»æ ‡å‡†ï¼Œæ‰‹å·¥æˆ–è€…ç”¨ä»£ç æ•´ç†å‡ºæ ‡å‡†ä¸­åŒ…å«çš„APIï¼›</li>
<li>ç”¨ä»£ç åœ¨Windowçš„å±æ€§ä¸­è¿‡æ»¤æ‰æ ‡å‡†ä¸­æ¶‰åŠçš„APIã€‚</li>
<li>é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„APIå¯¹åº”çš„æ ‡å‡†ã€‚</li>
</ol>


<p>åŸæ–‡ç‚¹å‡»<a href="/assets/resources/37%E4%B8%A8%E6%B5%8F%E8%A7%88%E5%99%A8API%EF%BC%88%E5%B0%8F%E5%AE%9E%E9%AA%8C%EF%BC%89%EF%BC%9A%E5%8A%A8%E6%89%8B%E6%95%B4%E7%90%86%E5%85%A8%E9%83%A8API.html">è¿™é‡Œ</a>è·å–ã€‚</p>

<p>ä»åŸæ–‡æ•´ç†å‡ºæ¥çš„htmlæ–‡ä»¶ç‚¹å‡»<a href="/assets/resources/traverseWindows.html">è¿™é‡Œ</a>è·å–ã€‚</p>

<p>å…³é”®jsä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>function filterOut(names, props) {
    let set = new Set();
    props.forEach(o =&gt; set.add(o));
    return names.filter(e =&gt; !set.has(e));
}

let names = Object.getOwnPropertyNames(window)
console.log(names)

// è¿‡æ»¤JavaScript æ ‡å‡†è§„å®šçš„å±æ€§
let js = new Set();
let objects = ["BigInt", "BigInt64Array", "BigUint64Array", "Infinity", "NaN", "undefined", "eval", "isFinite", "isNaN", "parseFloat", "parseInt", "decodeURI", "decodeURIComponent", "encodeURI", "encodeURIComponent", "Array", "Date", "RegExp", "Promise", "Proxy", "Map", "WeakMap", "Set", "WeakSet", "Function", "Boolean", "String", "Number", "Symbol", "Object", "Error", "EvalError", "RangeError", "ReferenceError", "SyntaxError", "TypeError", "URIError", "ArrayBuffer", "SharedArrayBuffer", "DataView", "Float32Array", "Float64Array", "Int8Array", "Int16Array", "Int32Array", "Uint8Array", "Uint16Array", "Uint32Array", "Uint8ClampedArray", "Atomics", "JSON", "Math", "Reflect", "escape", "unescape"];
objects.forEach(o =&gt; js.add(o));
names = names.filter(e =&gt; !js.has(e));
console.log('\nnames after filtering JS Standard:')
console.log(names)

// æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å·²ç»è®²è¿‡çš„ DOM éƒ¨åˆ†ï¼ŒDOM éƒ¨åˆ†åŒ…å«äº† document å±æ€§å’Œä¸€ç³»åˆ—çš„æ„é€ å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ JavaScript çš„ prototype æ¥è¿‡æ»¤æ„é€ å™¨ã€‚
names = names.filter( e =&gt; {
    try { 
        return !(window[e].prototype instanceof Node)
    } catch(err) {
        return true;
    }
}).filter( e =&gt; e != "Node")
console.log('\nnames after filtering DOM:')
console.log(names)

// æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ‰¾åˆ° Window å¯¹è±¡çš„å®šä¹‰ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢é“¾æ¥ä¸­å¯ä»¥æ‰¾åˆ°ã€‚https://html.spec.whatwg.org/#window è¿™é‡Œæœ‰ä¸€ä¸ª Window æ¥å£ï¼Œæ˜¯ä½¿ç”¨ WebIDL å®šä¹‰çš„ï¼Œæˆ‘ä»¬æ‰‹å·¥æŠŠå…¶ä¸­çš„å‡½æ•°å’Œå±æ€§æ•´ç†å‡ºæ¥
let windowprops = new Set();
objects = ["window", "self", "document", "name", "location", "history", "customElements", "locationbar", "menubar", " personalbar", "scrollbars", "statusbar", "toolbar", "status", "close", "closed", "stop", "focus", " blur", "frames", "length", "top", "opener", "parent", "frameElement", "open", "navigator", "applicationCache", "alert", "confirm", "prompt", "print", "postMessage", "console"];
objects.forEach(o =&gt; windowprops.add(o));
names = names.filter(e =&gt; !windowprops.has(e));
console.log('\nnames after filtering WebIDL:')
console.log(names)

// æˆ‘ä»¬è¿˜è¦è¿‡æ»¤æ‰æ‰€æœ‰çš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯ on å¼€å¤´çš„å±æ€§ã€‚
names = names.filter( e =&gt; !e.match(/^on/))
// webkit å‰ç¼€çš„ç§æœ‰å±æ€§æˆ‘ä»¬ä¹Ÿè¿‡æ»¤æ‰ï¼š
names = names.filter( e =&gt; !e.match(/^webkit/))
// é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨ HTML æ ‡å‡†ä¸­è¿˜èƒ½æ‰¾åˆ°æ‰€æœ‰çš„æ¥å£ï¼Œè¿™äº›æˆ‘ä»¬ä¹Ÿè¿‡æ»¤æ‰ï¼š
let interfaces = new Set();
objects = ["ApplicationCache", "AudioTrack", "AudioTrackList", "BarProp", "BeforeUnloadEvent", "BroadcastChannel", "CanvasGradient", "CanvasPattern", "CanvasRenderingContext2D", "CloseEvent", "CustomElementRegistry", "DOMStringList", "DOMStringMap", "DataTransfer", "DataTransferItem", "DataTransferItemList", "DedicatedWorkerGlobalScope", "Document", "DragEvent", "ErrorEvent", "EventSource", "External", "FormDataEvent", "HTMLAllCollection", "HashChangeEvent", "History", "ImageBitmap", "ImageBitmapRenderingContext", "ImageData", "Location", "MediaError", "MessageChannel", "MessageEvent", "MessagePort", "MimeType", "MimeTypeArray", "Navigator", "OffscreenCanvas", "OffscreenCanvasRenderingContext2D", "PageTransitionEvent", "Path2D", "Plugin", "PluginArray", "PopStateEvent", "PromiseRejectionEvent", "RadioNodeList", "SharedWorker", "SharedWorkerGlobalScope", "Storage", "StorageEvent", "TextMetrics", "TextTrack", "TextTrackCue", "TextTrackCueList", "TextTrackList", "TimeRanges", "TrackEvent", "ValidityState", "VideoTrack", "VideoTrackList", "WebSocket", "Window", "Worker", "WorkerGlobalScope", "WorkerLocation", "WorkerNavigator"];
objects.forEach(o =&gt; interfaces.add(o));
names = names.filter(e =&gt; !interfaces.has(e));
console.log('\nnames after filtering HTML:')
console.log(names)

// è¿‡æ»¤i18n api
names = names.filter(e =&gt; e != "Intl")
console.log(names)

/* Streams æ ‡å‡†
    æ¥ä¸‹æ¥æˆ‘çœ‹åˆ°çš„å±æ€§æ˜¯ï¼š ByteLengthQueuingStrategyã€‚
    åŒæ ·ç»è¿‡æŸ¥é˜…ï¼Œå®ƒæ¥è‡ª WHATWG çš„ Streams æ ‡å‡†ï¼š
    https://streams.spec.whatwg.org/#blqs-class
*/
names = filterOut(names, ["ReadableStream", "ReadableStreamDefaultReader", "ReadableStreamBYOBReader", "ReadableStreamDefaultController", "ReadableByteStreamController", "ReadableStreamBYOBRequest", "WritableStream", "WritableStreamDefaultWriter", "WritableStreamDefaultController", "TransformStream", "TransformStreamDefaultController", "ByteLengthQueuingStrategy", "CountQueuingStrategy"]);
console.log(names)

/*
    æ¥ä¸‹æ¥æˆ‘çœ‹åˆ°çš„å±æ€§æ˜¯ï¼šWebGLContextâ€‹Eventã€‚
    æ˜¾ç„¶ï¼Œè¿™ä¸ªå±æ€§æ¥è‡ª WebGL æ ‡å‡†ï¼š
    https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15
*/
names = filterOut(names, ["WebGLContextEvent","WebGLObject", "WebGLBuffer", "WebGLFramebuffer", "WebGLProgram", "WebGLRenderbuffer", "WebGLShader", "WebGLTexture", "WebGLUniformLocation", "WebGLActiveInfo", "WebGLShaderPrecisionFormat", "WebGLRenderingContext"]);
console.log(names)

/*
    Web Audio API
    ä¸‹ä¸€ä¸ªå±æ€§æ˜¯ WaveShaperNodeã€‚è¿™ä¸ªå±æ€§åå¬èµ·æ¥å°±è·Ÿå£°éŸ³æœ‰å…³ï¼Œè¿™ä¸ªå±æ€§æ¥è‡ª W3C çš„ Web Audio API æ ‡å‡†ã€‚
    æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ ‡å‡†ï¼š
    https://www.w3.org/TR/webaudio/
*/
names = filterOut(names, ["AudioContext", "AudioNode", "AnalyserNode", "AudioBuffer", "AudioBufferSourceNode", "AudioDestinationNode", "AudioParam", "AudioListener", "AudioWorklet", "AudioWorkletGlobalScope", "AudioWorkletNode", "AudioWorkletProcessor", "BiquadFilterNode", "ChannelMergerNode", "ChannelSplitterNode", "ConstantSourceNode", "ConvolverNode", "DelayNode", "DynamicsCompressorNode", "GainNode", "IIRFilterNode", "MediaElementAudioSourceNode", "MediaStreamAudioSourceNode", "MediaStreamTrackAudioSourceNode", "MediaStreamAudioDestinationNode", "PannerNode", "PeriodicWave", "OscillatorNode", "StereoPannerNode", "WaveShaperNode", "ScriptProcessorNode", "AudioProcessingEvent"]);
console.log(names)

/*
    Encoding æ ‡å‡†
    åœ¨æˆ‘çš„ç¯å¢ƒä¸­ï¼Œä¸‹ä¸€ä¸ªå±æ€§æ˜¯ TextDecoderï¼Œç»è¿‡æŸ¥é˜…å¾—çŸ¥ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿæ¥è‡ªä¸€ä»½ WHATWG çš„æ ‡å‡†ï¼ŒEncodingï¼š
    https://encoding.spec.whatwg.org/#dom-textencoder
*/
names = filterOut(names, ["TextDecoder", "TextEncoder", "TextDecoderStream", "TextEncoderStream"]);
console.log(names)

/*
    Web Cryptography API
    æˆ‘ä»¬ç»§ç»­çœ‹ä¸‹å»ï¼Œä¸‹ä¸€ä¸ªå±æ€§æ˜¯ SubtleCryptoï¼Œè¿™ä¸ªå±æ€§æ¥è‡ª Web Cryptography APIï¼Œä¹Ÿæ˜¯ W3C çš„æ ‡å‡†ã€‚
    https://www.w3.org/TR/WebCryptoAPI/
    è¿™ä»½æ ‡å‡†ä¸­è§„å®šäº†ä¸‰ä¸ª Class å’Œä¸€ä¸ª Window å¯¹è±¡çš„æ‰©å±•ï¼Œç»™ Window å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªå±æ€§ cryptoã€‚
*/
names = filterOut(names, ["CryptoKey", "SubtleCrypto", "Crypto", "crypto"]);
console.log(names)

/*
    Media Source Extensions
    ä¸‹ä¸€ä¸ªå±æ€§æ˜¯ SourceBufferListï¼Œå®ƒæ¥è‡ªäºï¼š
    https://www.w3.org/TR/media-source/
    è¿™ä»½æ ‡å‡†ä¸­åŒ…å«äº†ä¸‰ä¸ªæ¥å£ï¼Œè¿™ä»½æ ‡å‡†è¿˜æ‰©å±•äº†ä¸€äº›æ¥å£ï¼Œä½†æ˜¯æ²¡æœ‰æ‰©å±• windowã€‚
*/
names = filterOut(names, ["MediaSource", "SourceBuffer", "SourceBufferList"]);
console.log(names)
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[webæ€§èƒ½ä¼˜åŒ–]]></title>
    <link href="http://hongchaozhang.github.io/blog/2022/03/21/web-xingneng-youhua/"/>
    <updated>2022-03-21T23:30:53+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2022/03/21/web-xingneng-youhua</id>
    <content type="html"><![CDATA[<!-- more -->


<p>ä»webæ¸²æŸ“å…¨è¿‡ç¨‹åˆ†æï¼Œä»ä¸‹é¢å‡ ä¸ªæ–¹é¢è¿›è¡Œæ€§èƒ½ä¼˜åŒ–è€ƒè™‘ï¼š</p>

<ol>
<li>HTTPè¯·æ±‚æ€§èƒ½ä¼˜åŒ–</li>
<li>æµè§ˆå™¨å†…æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</li>
</ol>


<h2>HTTP(s)è¯·æ±‚æ€§èƒ½ä¼˜åŒ–</h2>

<ul>
<li>å‚è€ƒæå®¢æ—¶é—´è¯¾ç¨‹ã€Šé€è§†HTTPåè®®ã€‹çš„39å’Œ40ä¸¤èŠ‚è¯¾ã€‚</li>
<li>å¦å¤–ï¼Œ<a href="/blog/2021/05/26/toushi-http-xieyi/">æå®¢æ—¶é—´-ç½—å‰‘é”‹-ã€Šé€è§†HTTPåè®®ã€‹æ€»ç»“</a>ä¸­çš„ç« èŠ‚<a href="/blog/2021/05/26/toushi-http-xieyi/#http%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">httpæ€§èƒ½ä¼˜åŒ–</a>ï¼Œæœ‰ä¸€ä¸ªæ¦‚æ‹¬æ€§çš„æè¿°ã€‚</li>
<li>ç›¸å…³å†…å®¹ä¸ªäººæ€»ç»“å‚è€ƒ<a href="/blog/2022/03/08/http-xingneng-youhua/">HTTP(s)è¯·æ±‚æ€§èƒ½ä¼˜åŒ–</a>ã€‚</li>
</ul>


<h2>æµè§ˆå™¨å†…æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</h2>

<ul>
<li>å‚è€ƒæå®¢æ—¶é—´è¯¾ç¨‹ã€Šè®©ä½ é¡µé¢é€Ÿåº¦é£èµ·æ¥ Webå‰ç«¯æ€§èƒ½ä¼˜åŒ–ã€‹</li>
<li>ç›¸å…³å†…å®¹ä¸ªäººæ€»ç»“å‚è€ƒ<a href="/blog/2022/01/04/web-qianduan-xingneng-youhua/">æå®¢æ—¶é—´-Webå‰ç«¯æ€§èƒ½ä¼˜åŒ–</a>ã€‚</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HTTP(s)è¯·æ±‚æ€§èƒ½ä¼˜åŒ–]]></title>
    <link href="http://hongchaozhang.github.io/blog/2022/03/08/http-xingneng-youhua/"/>
    <updated>2022-03-08T16:44:40+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2022/03/08/http-xingneng-youhua</id>
    <content type="html"><![CDATA[<!-- more -->




<!-- TOC -->


<ul>
<li><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7">æ€§èƒ½æµ‹è¯•å·¥å…·</a></li>
<li><a href="#http%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">HTTPæ€§èƒ½ä¼˜åŒ–</a>

<ul>
<li><a href="#%E5%BC%80%E6%BA%90">å¼€æº</a></li>
<li><a href="#%E8%8A%82%E6%B5%81">èŠ‚æµ</a></li>
<li><a href="#%E7%BC%93%E5%AD%98">ç¼“å­˜</a></li>
<li><a href="#%E5%8D%87%E7%BA%A7%E5%88%B0http2">å‡çº§åˆ°HTTP/2</a></li>
<li><a href="#%E5%85%B3%E4%BA%8E%E8%B5%84%E6%BA%90%E5%90%88%E5%B9%B6">å…³äºèµ„æºåˆå¹¶</a></li>
</ul>
</li>
<li><a href="#https%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">HTTPsæ€§èƒ½ä¼˜åŒ–</a>

<ul>
<li><a href="#1-%E7%A1%AC%E4%BB%B6%E4%BC%98%E5%8C%96cpussl%E5%8A%A0%E9%80%9F%E5%8D%A1ssl%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1%E5%99%A8">1. ç¡¬ä»¶ä¼˜åŒ–ï¼šCPUï¼ŒSSLåŠ é€Ÿå¡ï¼ŒSSLåŠ é€ŸæœåŠ¡å™¨</a></li>
<li><a href="#2-%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96">2. è½¯ä»¶ä¼˜åŒ–ï¼š</a></li>
</ul>
</li>
</ul>


<!-- /TOC -->


<p><a id="markdown-æ€§èƒ½æµ‹è¯•å·¥å…·" name="æ€§èƒ½æµ‹è¯•å·¥å…·"></a></p>

<h2>æ€§èƒ½æµ‹è¯•å·¥å…·</h2>

<ol>
<li><p>åœ¨ Linux ä¸Šï¼Œæœ€å¸¸ç”¨çš„æ€§èƒ½æµ‹è¯•å·¥å…·å¯èƒ½å°±æ˜¯ abï¼ˆApache Benchï¼‰äº†ï¼Œæ¯”å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤æŒ‡å®šäº†å¹¶å‘æ•° 100ï¼Œæ€»å…±å‘é€ 10000 ä¸ªè¯·æ±‚ï¼š</p>

<pre><code class="`"> ab -c 100 -n 10000 'http://www.xxx.com'
</code></pre></li>
<li><p>ç³»ç»Ÿèµ„æºç›‘æ§æ–¹é¢ï¼ŒLinux è‡ªå¸¦çš„å·¥å…·ä¹Ÿéå¸¸å¤šï¼Œå¸¸ç”¨çš„æœ‰ uptimeã€topã€vmstatã€netstatã€sar ç­‰ç­‰ï¼Œå¯èƒ½ä½ æ¯”æˆ‘è¿˜è¦ç†Ÿæ‚‰ï¼Œæˆ‘å°±åˆ—å‡ ä¸ªç®€å•çš„ä¾‹å­å§ï¼š</p>

<pre><code class="`"> top             # æŸ¥çœ‹ CPU å’Œå†…å­˜å ç”¨æƒ…å†µ
 vmstat  2       # æ¯ 2 ç§’æ£€æŸ¥ä¸€æ¬¡ç³»ç»ŸçŠ¶æ€
 sar -n DEV 2    # çœ‹æ‰€æœ‰ç½‘å¡çš„æµé‡ï¼Œå®šæ—¶ 2 ç§’æ£€æŸ¥
</code></pre></li>
<li>ä¹‹å‰è®² HTTPS æ—¶ä»‹ç»è¿‡ä¸€ä¸ªä¸“é—¨çš„ç½‘ç«™<a href="https://www.ssllabs.com/">SSLLabs</a>ï¼Œè€Œå¯¹äº HTTP æ€§èƒ½ä¼˜åŒ–ï¼Œä¹Ÿæœ‰ä¸€ä¸ªä¸“é—¨çš„æµ‹è¯•ç½‘ç«™<a href="https://www.webpagetest.org/">WebPageTest</a>ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨ä¸–ç•Œå„åœ°å»ºç«‹äº†å¾ˆå¤šçš„æµ‹è¯•ç‚¹ï¼Œå¯ä»¥ä»»æ„é€‰æ‹©åœ°ç†ä½ç½®ã€æœºå‹ã€æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨å‘èµ·æµ‹è¯•ï¼Œéå¸¸æ–¹ä¾¿ï¼Œç”¨æ³•ä¹Ÿå¾ˆç®€å•ã€‚ç½‘ç«™æµ‹è¯•çš„æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªç›´è§‚çš„â€œç€‘å¸ƒå›¾â€ï¼ˆWaterfall Chartï¼‰ï¼Œæ¸…æ™°åœ°åˆ—å‡ºäº†é¡µé¢ä¸­æ‰€æœ‰èµ„æºåŠ è½½çš„å…ˆåé¡ºåºå’Œæ—¶é—´æ¶ˆè€—ã€‚</li>
<li>Chrome ç­‰æµè§ˆå™¨è‡ªå¸¦çš„å¼€å‘è€…å·¥å…·ä¹Ÿå¯ä»¥å¾ˆå¥½åœ°è§‚å¯Ÿå®¢æˆ·ç«¯å»¶è¿ŸæŒ‡æ ‡ï¼Œé¢æ¿å·¦è¾¹æœ‰æ¯ä¸ª URI å…·ä½“æ¶ˆè€—çš„æ—¶é—´ï¼Œé¢æ¿çš„å³è¾¹ä¹Ÿæœ‰ç€‘å¸ƒå›¾ã€‚</li>
</ol>


<p><a id="markdown-httpæ€§èƒ½ä¼˜åŒ–" name="httpæ€§èƒ½ä¼˜åŒ–"></a></p>

<h2>HTTPæ€§èƒ½ä¼˜åŒ–</h2>

<p><a id="markdown-å¼€æº" name="å¼€æº"></a></p>

<h3>å¼€æº</h3>

<ul>
<li>NginxåŠç›¸å…³é…ç½®</li>
<li>HTTPå¯ç”¨é•¿è¿æ¥
<a id="markdown-èŠ‚æµ" name="èŠ‚æµ"></a></li>
</ul>


<h3>èŠ‚æµ</h3>

<ul>
<li>æ•°æ®å‹ç¼©ï¼šå›¾ç‰‡ï¼Œjsonç­‰</li>
<li>html/css/jsçš„minify</li>
<li>å»é™¤ä¸å¿…è¦çš„Headerå±æ€§</li>
<li>å‡å°‘åŸŸåæ•°é‡å’Œé‡å®šå‘æ¬¡æ•°
<a id="markdown-ç¼“å­˜" name="ç¼“å­˜"></a></li>
</ul>


<h3>ç¼“å­˜</h3>

<ul>
<li>æœåŠ¡å™¨ç¼“å­˜ï¼šRedis</li>
<li>CDNç¼“å­˜
<a id="markdown-å‡çº§åˆ°http2" name="å‡çº§åˆ°http2"></a></li>
</ul>


<h3>å‡çº§åˆ°HTTP/2</h3>

<ul>
<li>æ¶ˆé™¤äº†åº”ç”¨å±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œæ‹¥æœ‰å¤´éƒ¨å‹ç¼©ã€äºŒè¿›åˆ¶å¸§ã€å¤šè·¯å¤ç”¨ã€æµé‡æ§åˆ¶ã€æœåŠ¡å™¨æ¨é€ç­‰è®¸å¤šæ–°ç‰¹æ€§ï¼Œå¤§å¹…åº¦æå‡äº† HTTP çš„ä¼ è¾“æ•ˆç‡ã€‚
<a id="markdown-å…³äºèµ„æºåˆå¹¶" name="å…³äºèµ„æºåˆå¹¶"></a></li>
</ul>


<h3>å…³äºèµ„æºåˆå¹¶</h3>

<ul>
<li>â€œèµ„æºåˆå¹¶â€åœ¨ HTTP/1 é‡Œå‡å°‘äº†å¤šæ¬¡è¯·æ±‚çš„æˆæœ¬ï¼Œä½†åœ¨ HTTP/2 é‡Œå› ä¸ºæœ‰å¤´éƒ¨å‹ç¼©å’Œå¤šè·¯å¤ç”¨ï¼Œä¼ è¾“å°æ–‡ä»¶çš„æˆæœ¬å¾ˆä½ï¼Œæ‰€ä»¥åˆå¹¶å°±å¤±å»äº†æ„ä¹‰ã€‚è€Œä¸”â€œèµ„æºåˆå¹¶â€è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯é™ä½äº†ç¼“å­˜çš„å¯ç”¨æ€§ï¼Œåªè¦ä¸€ä¸ªå°æ–‡ä»¶æ›´æ–°ï¼Œæ•´ä¸ªç¼“å­˜å°±å®Œå…¨å¤±æ•ˆï¼Œå¿…é¡»é‡æ–°ä¸‹è½½ã€‚</li>
<li>æ‰€ä»¥åœ¨ç°åœ¨çš„å¤§å¸¦å®½å’Œ CDN åº”ç”¨åœºæ™¯ä¸‹ï¼Œåº”å½“å°½é‡å°‘ç”¨èµ„æºåˆå¹¶ï¼ˆJSã€CSS å›¾ç‰‡åˆå¹¶ï¼Œæ•°æ®å†…åµŒï¼‰ï¼Œè®©èµ„æºçš„ç²’åº¦å°½å¯èƒ½åœ°å°ï¼Œæ‰èƒ½æ›´å¥½åœ°å‘æŒ¥ç¼“å­˜çš„ä½œç”¨ã€‚</li>
</ul>


<p><a id="markdown-httpsæ€§èƒ½ä¼˜åŒ–" name="httpsæ€§èƒ½ä¼˜åŒ–"></a></p>

<h2>HTTPsæ€§èƒ½ä¼˜åŒ–</h2>

<p><a id="markdown-1-ç¡¬ä»¶ä¼˜åŒ–cpusslåŠ é€Ÿå¡sslåŠ é€ŸæœåŠ¡å™¨" name="1-ç¡¬ä»¶ä¼˜åŒ–cpusslåŠ é€Ÿå¡sslåŠ é€ŸæœåŠ¡å™¨"></a></p>

<h3>1. ç¡¬ä»¶ä¼˜åŒ–ï¼šCPUï¼ŒSSLåŠ é€Ÿå¡ï¼ŒSSLåŠ é€ŸæœåŠ¡å™¨</h3>

<p><a id="markdown-2-è½¯ä»¶ä¼˜åŒ–" name="2-è½¯ä»¶ä¼˜åŒ–"></a></p>

<h3>2. è½¯ä»¶ä¼˜åŒ–ï¼š</h3>

<ol>
<li>è½¯ä»¶å‡çº§ï¼šLinuxå†…æ ¸ï¼ŒNginxï¼ŒOpenSSL</li>
<li>åè®®ä¼˜åŒ–ï¼š

<ul>
<li>TLS1.3</li>
<li>å¯†é’¥äº¤æ¢åè®®å°½é‡é€‰ç”¨æ¤­åœ†æ›²çº¿ECDHEç®—æ³•ï¼Œèƒ½å¤ŸæŠŠæ¡æ‰‹çš„æ¶ˆæ¯å¾€è¿”ç”± 2-RTT å‡å°‘åˆ° 1-RTTï¼Œè¾¾åˆ°ä¸ TLS1.3 ç±»ä¼¼çš„æ•ˆæœã€‚</li>
<li>Nginxé…ç½®å¯†ç å¥—ä»¶å’Œæ¤­åœ†æ›²çº¿ï¼Œå°†ä¼˜å…ˆä½¿ç”¨çš„æ”¾åœ¨å‰é¢ã€‚</li>
</ul>
</li>
<li>è¯ä¹¦ä¼˜åŒ–ï¼š

<ul>
<li>CRLï¼ˆCertificate revocation listï¼Œè¯ä¹¦åŠé”€åˆ—è¡¨ï¼‰ç”± CA å®šæœŸå‘å¸ƒï¼Œé‡Œé¢æ˜¯æ‰€æœ‰è¢«æ’¤é”€ä¿¡ä»»çš„è¯ä¹¦åºå·ï¼ŒæŸ¥è¯¢è¿™ä¸ªåˆ—è¡¨å°±å¯ä»¥çŸ¥é“è¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€‚</li>
<li>ç°åœ¨ CRL åŸºæœ¬ä¸Šä¸ç”¨äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ OCSPï¼ˆåœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ŒOnline Certificate Status Protocolï¼‰ï¼Œå‘ CA å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè®© CA è¿”å›è¯ä¹¦çš„æœ‰æ•ˆçŠ¶æ€ã€‚</li>
<li>â€œOCSP Staplingâ€ï¼ˆOCSP è£…è®¢ï¼‰ï¼Œå®ƒå¯ä»¥è®©æœåŠ¡å™¨é¢„å…ˆè®¿é—® CA è·å– OCSP å“åº”ï¼Œç„¶ååœ¨æ¡æ‰‹æ—¶éšç€è¯ä¹¦ä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ï¼Œå…å»äº†å®¢æˆ·ç«¯è¿æ¥ CA æœåŠ¡å™¨æŸ¥è¯¢çš„æ—¶é—´ã€‚</li>
</ul>
</li>
<li>ä¼šè¯å¤ç”¨ï¼š

<ul>
<li>æˆ‘ä»¬å†å›æƒ³ä¸€ä¸‹ HTTPS å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼šå…ˆæ˜¯ TCP ä¸‰æ¬¡æ¡æ‰‹ï¼Œç„¶åæ˜¯ TLS ä¸€æ¬¡æ¡æ‰‹ã€‚è¿™åä¸€æ¬¡æ¡æ‰‹çš„é‡ç‚¹æ˜¯ç®—å‡ºä¸»å¯†é’¥â€œMaster Secretâ€ï¼Œè€Œä¸»å¯†é’¥æ¯æ¬¡è¿æ¥éƒ½è¦é‡æ–°è®¡ç®—ï¼Œæœªå…æœ‰ç‚¹å¤ªæµªè´¹äº†ï¼Œå¦‚æœèƒ½å¤ŸæŠŠâ€œè¾›è¾›è‹¦è‹¦â€ç®—å‡ºæ¥çš„ä¸»å¯†é’¥ç¼“å­˜ä¸€ä¸‹â€œé‡ç”¨â€ï¼Œä¸å°±å¯ä»¥å…å»äº†æ¡æ‰‹å’Œè®¡ç®—çš„æˆæœ¬äº†å—ï¼Ÿ</li>
<li>è¿™ç§åšæ³•å°±å«â€œä¼šè¯å¤ç”¨â€ï¼ˆTLS session resumptionï¼‰ï¼Œå’Œ HTTP Cache ä¸€æ ·ï¼Œä¹Ÿæ˜¯æé«˜ HTTPS æ€§èƒ½çš„â€œå¤§æ€å™¨â€ï¼Œè¢«æµè§ˆå™¨å’ŒæœåŠ¡å™¨å¹¿æ³›åº”ç”¨ã€‚</li>
<li>ä¼šè¯å¤ç”¨åˆ†ä¸¤ç§

<ul>
<li>ç¬¬ä¸€ç§å«â€œSession IDâ€ï¼šâ€œSession IDâ€æ˜¯æœ€æ—©å‡ºç°çš„ä¼šè¯å¤ç”¨æŠ€æœ¯ï¼Œä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿çš„ï¼Œä½†å®ƒä¹Ÿæœ‰ç¼ºç‚¹ï¼ŒæœåŠ¡å™¨å¿…é¡»ä¿å­˜æ¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„ä¼šè¯æ•°æ®ï¼Œå¯¹äºæ‹¥æœ‰ç™¾ä¸‡ã€åƒä¸‡çº§åˆ«ç”¨æˆ·çš„ç½‘ç«™æ¥è¯´å­˜å‚¨é‡å°±æˆäº†å¤§é—®é¢˜ï¼ŒåŠ é‡äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚</li>
<li>ç¬¬äºŒç§å«â€œSession Ticketâ€ï¼šå®ƒæœ‰ç‚¹ç±»ä¼¼ HTTP çš„ Cookieï¼Œå­˜å‚¨çš„è´£ä»»ç”±æœåŠ¡å™¨è½¬ç§»åˆ°äº†å®¢æˆ·ç«¯</li>
</ul>
</li>
<li>é¢„å…±äº«å¯†é’¥ï¼š

<ul>
<li>åœ¨å‘é€ Ticket çš„åŒæ—¶ä¼šå¸¦ä¸Šåº”ç”¨æ•°æ®ï¼ˆEarly Dataï¼‰ï¼Œå…å»äº† 1.2 é‡Œçš„æœåŠ¡å™¨ç¡®è®¤æ­¥éª¤ï¼Œè¿™ç§æ–¹å¼å«â€œPre-shared Keyâ€ï¼Œç®€ç§°ä¸ºâ€œPSKâ€ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>


<p>ä¸Šé¢çš„å†…å®¹æ¥è‡ªæå®¢æ—¶é—´çš„ã€Šé€è§†HTTPåè®®ã€‹è¯¾ç¨‹çš„39å’Œ40ä¸¤èŠ‚è¯¾ã€‚
å¦å¤–ï¼Œ<a href="/blog/2021/05/26/toushi-http-xieyi/">æå®¢æ—¶é—´-ç½—å‰‘é”‹-ã€Šé€è§†HTTPåè®®ã€‹æ€»ç»“</a>ä¸­çš„ç« èŠ‚<a href="/blog/2021/05/26/toushi-http-xieyi/#http%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">httpæ€§èƒ½ä¼˜åŒ–</a>ï¼Œæœ‰ä¸€ä¸ªæ¦‚æ‹¬æ€§çš„æè¿°ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æå®¢æ—¶é—´-Webå‰ç«¯æ€§èƒ½ä¼˜åŒ–]]></title>
    <link href="http://hongchaozhang.github.io/blog/2022/01/04/web-qianduan-xingneng-youhua/"/>
    <updated>2022-01-04T18:06:29+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2022/01/04/web-qianduan-xingneng-youhua</id>
    <content type="html"><![CDATA[<!-- more -->




<!-- TOC -->


<ul>
<li><a href="#%E8%B5%84%E6%BA%90%E5%8E%8B%E7%BC%A9%E4%B8%8E%E5%90%88%E5%B9%B6">èµ„æºå‹ç¼©ä¸åˆå¹¶</a>

<ul>
<li><a href="#%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96">å›¾ç‰‡ä¼˜åŒ–</a></li>
</ul>
</li>
<li><a href="#%E5%9B%BE%E7%89%87%E7%9A%84%E6%87%92%E5%8A%A0%E8%BD%BD%E9%A2%84%E5%8A%A0%E8%BD%BD">å›¾ç‰‡çš„æ‡’åŠ è½½é¢„åŠ è½½</a>

<ul>
<li><a href="#%E6%87%92%E5%8A%A0%E8%BD%BD">æ‡’åŠ è½½ï¼š</a></li>
<li><a href="#%E9%A2%84%E5%8A%A0%E8%BD%BD">é¢„åŠ è½½ï¼š</a></li>
</ul>
</li>
<li><a href="#html%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B">HTMLæ¸²æŸ“è¿‡ç¨‹</a></li>
<li><a href="#%E9%87%8D%E7%BB%98%E5%A4%96%E8%A7%82%E4%B8%8E%E5%9B%9E%E6%B5%81%E5%B8%83%E5%B1%80redrawreflow">é‡ç»˜ï¼ˆå¤–è§‚ï¼‰ä¸å›æµï¼ˆå¸ƒå±€ï¼‰redraw/reflow</a>

<ul>
<li><a href="#top-and-translate">top and translate</a></li>
<li><a href="#opacity%E6%9B%BF%E6%8D%A2visibility"><code>opacity</code>æ›¿æ¢<code>visibility</code></a></li>
<li><a href="#css%E7%9A%84class%E6%9B%BF%E4%BB%A3style">cssçš„classæ›¿ä»£style</a></li>
<li><a href="#displaynone"><code>display:none</code></a></li>
<li><a href="#%E6%85%8E%E7%94%A8clientwidth">æ…ç”¨<code>clientWidth</code></a></li>
<li><a href="#%E5%B0%91%E7%94%A8table%E5%B8%83%E5%B1%80">å°‘ç”¨tableå¸ƒå±€ã€‚</a></li>
<li><a href="#%E5%8A%A8%E7%94%BB%E7%9A%84%E5%88%B7%E6%96%B0%E7%8E%87%E5%92%8C%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD%E5%B9%B3%E8%A1%A1">åŠ¨ç”»çš„åˆ·æ–°ç‡å’Œé¡µé¢æ€§èƒ½å¹³è¡¡</a></li>
<li><a href="#%E5%B0%86gif%E5%9B%BE%E5%8D%95%E7%8B%AC%E6%88%90%E4%B8%80%E4%B8%AA%E5%9B%BE%E5%B1%82">å°†gifå›¾å•ç‹¬æˆä¸€ä¸ªå›¾å±‚</a></li>
<li><a href="#%E5%90%AF%E7%94%A8gpu%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F">å¯ç”¨GPUç¡¬ä»¶åŠ é€Ÿ</a></li>
</ul>
</li>
<li><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AD%98%E5%82%A8">æµè§ˆå™¨å­˜å‚¨</a></li>
<li><a href="#%E7%BC%93%E5%AD%98">ç¼“å­˜</a></li>
<li><a href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93">æœåŠ¡å™¨ç«¯æ¸²æŸ“</a></li>
</ul>


<!-- /TOC -->


<p>æ€»ç»“æå®¢æ—¶é—´è¯¾ç¨‹ã€Šè®©ä½ é¡µé¢é€Ÿåº¦é£èµ·æ¥ Webå‰ç«¯æ€§èƒ½ä¼˜åŒ–ã€‹</p>

<p><a id="markdown-èµ„æºå‹ç¼©ä¸åˆå¹¶" name="èµ„æºå‹ç¼©ä¸åˆå¹¶"></a></p>

<h2>èµ„æºå‹ç¼©ä¸åˆå¹¶</h2>

<p>èµ„æºåˆå¹¶ä¼šå‡å°‘è¯·æ±‚æ¬¡æ•°ï¼Œæ€»ä½“ä¸Šé™ä½è¯·æ±‚æ—¶é—´ã€‚ä½†æ˜¯ï¼Œä¹Ÿä¸èƒ½ä¸åŠ è€ƒè™‘åœ°éƒ½åˆå¹¶åˆ°ä¸€èµ·ï¼Œè¿™æ ·ä¼šå½±å“é¦–é¡µæ¸²æŸ“é€Ÿåº¦ã€‚</p>

<p><a id="markdown-å›¾ç‰‡ä¼˜åŒ–" name="å›¾ç‰‡ä¼˜åŒ–"></a></p>

<h3>å›¾ç‰‡ä¼˜åŒ–</h3>

<ol>
<li>å›¾ç‰‡<strong>é›ªç¢§å›¾</strong>ï¼Œä¸èƒ½å¤ªå¤§ï¼Œå¤ªå¤§å½±å“é¦–å±æ¸²æŸ“æ€§èƒ½ã€‚ä¸€ä¸ªé¡µé¢çš„å°å›¾æ”¾åœ¨ä¸€èµ·ï¼Œç”Ÿæˆä¸€å¼ é›ªç¢§å›¾å³å¯ã€‚</li>
<li><strong>inline image</strong>ï¼Œinline imageå†…åµŒåœ¨htmlé‡Œé¢ï¼Œä½œä¸ºhtmlçš„ä¸€éƒ¨åˆ†å’Œhtmlä¸€èµ·åŠ è½½ã€‚å½“å›¾ç‰‡å¤§å°å°äº8KBæ—¶ï¼Œè€ƒè™‘ä½¿ç”¨inline imageã€‚</li>
<li><strong>ä½¿ç”¨webpæ ¼å¼å›¾ç‰‡</strong>ï¼Œwebpæ ¼å¼å›¾ç‰‡ç”±googleæ¨å‡ºï¼Œandroidå¹³å°æ”¯æŒå¥½ï¼Œapple safariæµè§ˆå™¨æœ‰å…¼å®¹æ€§é—®é¢˜ï¼ˆ2020å¹´Mac OS Big Surä¸­çš„Safari 14å·²ç»æ”¯æŒWebPæ ¼å¼ã€‚ï¼‰</li>
<li><strong>jpg</strong>ã€<strong>png</strong>ã€<strong>svg</strong>ç­‰å›¾ç‰‡æ ¼å¼å„æœ‰å…¶ç‰¹ç‚¹å’Œåº”ç”¨åœºåˆã€‚</li>
</ol>


<p>å¦é™„ä¸Šä¸¤ä¸ªå·¥å…·è½¯ä»¶ï¼š</p>

<ol>
<li><a href="https://tinypng.com">å›¾ç‰‡å‹ç¼©ç½‘ç«™</a></li>
<li><a href="www.spritecow.com">é›ªç¢§å›¾ç”Ÿæˆç½‘ç«™</a></li>
</ol>


<p><a id="markdown-å›¾ç‰‡çš„æ‡’åŠ è½½é¢„åŠ è½½" name="å›¾ç‰‡çš„æ‡’åŠ è½½é¢„åŠ è½½"></a></p>

<h2>å›¾ç‰‡çš„æ‡’åŠ è½½é¢„åŠ è½½</h2>

<p><a id="markdown-æ‡’åŠ è½½" name="æ‡’åŠ è½½"></a></p>

<h3>æ‡’åŠ è½½ï¼š</h3>

<p>é€šè¿‡å›¾ç‰‡è¿›å…¥å¯è§†åŒºåŸŸçš„æ—¶å€™å†è®¾ç½®imgçš„srcå±æ€§ï¼Œè¿›è¡Œè¯·æ±‚ã€‚æˆ–è€…é€šè¿‡åº“å®ç°ã€‚</p>

<p><a id="markdown-é¢„åŠ è½½" name="é¢„åŠ è½½"></a></p>

<h3>é¢„åŠ è½½ï¼š</h3>

<ol>
<li>ä½¿ç”¨<code>image</code>æ ‡ç­¾å¼•å…¥ï¼Œå…ˆè®¾ç½®<code>display:none</code>ã€‚éœ€è¦æ˜¾ç¤ºçš„æ—¶å€™å†é€šè¿‡è®¾ç½®<code>display</code>å±æ€§å°†å…¶æ˜¾ç¤ºå‡ºæ¥ã€‚</li>
<li>åœ¨jsä¸­<code>new image</code>ï¼Œå¹¶ä¸”è®¾ç½®<code>image</code>çš„<code>src</code>ï¼Œè¿›è¡Œå›¾ç‰‡ä¸‹è½½ï¼Œä¿å­˜åœ¨jsçš„å˜é‡ä¸­ï¼Œä½†æ˜¯ä¸æ˜¾ç¤ºï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥æ‹¿è¿‡æ¥æ˜¾ç¤ºå³å¯ã€‚</li>
<li>ä½¿ç”¨<code>XMLHttpRequest</code>ï¼Œå¯ä»¥æ¸…æ¥šçŸ¥é“è¯·æ±‚çš„è¿‡ç¨‹ï¼Œä½†æ˜¯å­˜åœ¨è·¨åŸŸçš„é—®é¢˜ã€‚</li>
<li>æˆ–è€…é€šè¿‡åº“å®ç°ï¼špreloader.js</li>
</ol>


<p><a id="markdown-htmlæ¸²æŸ“è¿‡ç¨‹" name="htmlæ¸²æŸ“è¿‡ç¨‹"></a></p>

<h2>HTMLæ¸²æŸ“è¿‡ç¨‹</h2>

<ol>
<li>é¡ºåºæ‰§è¡Œï¼Œå¹¶å‘åŠ è½½ï¼šä¸ºäº†è®©èµ„æºå¹¶å‘åŠ è½½ï¼Œå¯ä»¥éƒ¨ç½²å¤šä¸ªCDNï¼Œä»¥çªç ´æµè§ˆå™¨å¯¹å•ä¸ªåŸŸåå¹¶å‘åŠ è½½æ•°é‡çš„é™åˆ¶ï¼ˆ4-6ä¸ªï¼‰ã€‚

<ol>
<li><a href="https://juejin.cn/post/6844904035628089357">çªç ´æµè§ˆå™¨åŸŸåå¹¶å‘é™åˆ¶çš„è§£å†³æ–¹æ¡ˆ</a></li>
<li>æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªé™åˆ¶ï¼Œé’ˆå¯¹è¿™ä¸ªé™åˆ¶æˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™æ€ä¹ˆä¼˜åŒ–ï¼Ÿå‚è€ƒ<a href="https://segmentfault.com/a/1190000039157302">å‰ç«¯æ€§èƒ½ä¼˜åŒ–ç¯‡â€”â€”æµè§ˆå™¨åŒåŸŸåå¹¶å‘è¯·æ±‚å¯¹é™åˆ¶</a></li>
</ol>
</li>
<li>cssåŠ è½½å»¶è¿Ÿï¼Œé¡µé¢å…ˆæ˜¾ç¤ºå‡ºæ²¡æœ‰æ ·å¼çš„å†…å®¹ï¼ŒåŸå› æ˜¯ï¼šcssæ²¡æœ‰åœ¨headerä¸­å¼•å…¥ï¼Œè€Œæ˜¯é€šè¿‡å…¶ä»–æ–¹å¼åŠ è½½ï¼Œæ¯”å¦‚åœ¨jsä¸­åŠ è½½cssã€‚ä½†æ˜¯åœ¨headerä¸­é€šè¿‡linkåŠ è½½cssä¹Ÿæœ‰ç¼ºç‚¹ï¼šé˜»å¡é¡µé¢æ¸²æŸ“å’Œjsæ‰§è¡Œï¼Œä½†æ˜¯ä¸é˜»å¡å¤–éƒ¨è„šæœ¬çš„åŠ è½½ï¼ˆå¾—ç›Šäºwebkitçš„é¢„æ‰«æåŠŸèƒ½ï¼‰ï¼Œä½†æ˜¯é˜»å¡æ‰§è¡Œã€‚</li>
<li><code>script</code>å’Œ<code>import</code>å¼•å…¥æ–¹å¼ï¼š<code>script</code>å¼•å…¥jsæ˜¯åŒæ­¥çš„ï¼Œé˜»å¡é¡µé¢æ¸²æŸ“ã€‚ç»“åˆ<code>differ</code>å’Œ<code>sync</code>æ ‡ç­¾å½±å“jså¼•å…¥è¿‡ç¨‹ã€‚ä¸é˜»å¡èµ„æºçš„åŠ è½½ï¼ˆå¾—ç›Šäºwebkitçš„é¢„æ‰«æåŠŸèƒ½ï¼‰ã€‚</li>
<li>SPAï¼šå•é¡µåº”ç”¨ï¼ŒåŠ¨æ€åŠ è½½ï¼Œè·¯ç”±åˆ°ç›¸å…³é¡µé¢å†åŠ è½½ç›¸å…³çš„èµ„æºã€‚</li>
</ol>


<p><a id="markdown-é‡ç»˜å¤–è§‚ä¸å›æµå¸ƒå±€redrawreflow" name="é‡ç»˜å¤–è§‚ä¸å›æµå¸ƒå±€redrawreflow"></a></p>

<h2>é‡ç»˜ï¼ˆå¤–è§‚ï¼‰ä¸å›æµï¼ˆå¸ƒå±€ï¼‰redraw/reflow</h2>

<p>cssæ€§èƒ½è®©jså˜æ…¢ï¼šcsså½±å“layoutï¼Œè¿›è€Œäº§ç”Ÿé‡ç»˜ä¸å›æµã€‚å¤šæ¬¡çš„é‡ç»˜ä¸å›æµä½¿å¾—UIçº¿ç¨‹å¤šæ¬¡å·¥ä½œï¼Œè€ŒUIçº¿ç¨‹çš„å¯åŠ¨ä¼šé˜»å¡jsçº¿ç¨‹çš„æ‰§è¡Œã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸€äº›æœ‰å…³<strong>å›æµä¸é‡ç»˜</strong>å®æˆ˜æ¼”ç»ƒã€‚é€šè¿‡è§‚å¯ŸChromeçš„Performanceè°ƒè¯•å·¥å…·åˆ†ææ¸²æŸ“è¿‡ç¨‹å’Œæ€§èƒ½ç“¶é¢ˆã€‚æˆªå›¾å¦‚ä¸‹ï¼š</p>

<p><img src="/images/chrome_performance_demo.jpg" alt="chrome_performance_demo.jpg" /></p>

<p><a id="markdown-top-and-translate" name="top-and-translate"></a></p>

<h3>top and translate</h3>

<p>ç›¸æ¯”äº<code>top</code>ï¼Œ<code>translate</code>æ²¡æœ‰å›æµçš„è¿‡ç¨‹ï¼Œå¯¹äºdomç»“æ„å¤æ‚çš„é¡µé¢ï¼Œæ€§èƒ½æå‡æ¯”è¾ƒæ˜æ˜¾ã€‚</p>

<p><details>
  <summary>Code using <code>top</code></summary></p>

<pre><code>&lt;html&gt;
&lt;head&gt;
    &lt;style&gt;
        #rect {
            position: relative;
            top: 0;
            width: 100px;
            height: 100px;
            background: blue;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="rect"&gt;&lt;/div&gt;
    &lt;script&gt;
        setTimeout(() =&gt; {
            document.getElementById("rect").style.top = "100px";
        }, 2000);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p></details></p>

<p><details>
  <summary>Code using <code>transform</code></summary></p>

<pre><code>&lt;html&gt;
&lt;head&gt;
    &lt;style&gt;
        #rect {
            position: relative;
            transform: translateY(0);
            width: 100px;
            height: 100px;

            background: blue;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="rect"&gt;&lt;/div&gt;
    &lt;script&gt;
        setTimeout(() =&gt; {
            document.getElementById("rect").style.transform = "translateY(100px)";
        }, 2000);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p></details></p>

<p><a id="markdown-opacityæ›¿æ¢visibility" name="opacityæ›¿æ¢visibility"></a></p>

<h3><code>opacity</code>æ›¿æ¢<code>visibility</code></h3>

<p><code>opaciy</code>ï¼šå¦‚æœè¢«ä¿®æ”¹çš„domå…ƒç´ è‡ªå·±æ˜¯ä¸€ä¸ªå›¾å±‚ï¼Œä¸è§¦å‘å›æµå’Œé‡ç»˜ï¼ˆè¯•éªŒç»“æœï¼šæ²¡æœ‰å›æµï¼Œä½†æ˜¯æœ‰é‡ç»˜ï¼‰ï¼›å¦åˆ™ï¼Œè§¦å‘å›æµå’Œé‡ç»˜ã€‚
<code>visibility</code>ï¼šä¸è§¦å‘å›æµï¼Œåªè§¦å‘é‡ç»˜ã€‚</p>

<p><a id="markdown-cssçš„classæ›¿ä»£style" name="cssçš„classæ›¿ä»£style"></a></p>

<h3>cssçš„classæ›¿ä»£style</h3>

<p>å¤šä¸ªdomæ ·å¼é€šè¿‡classä¸€æ¬¡æ”¹åŠ¨å¤šæ¡styleå±æ€§ï¼Œå‡å°‘å›æµå’Œé‡ç»˜çš„æ¬¡æ•°</p>

<p><a id="markdown-displaynone" name="displaynone"></a></p>

<h3><code>display:none</code></h3>

<p>å…ˆè®¾ç½®<code>display</code>ä¸º<code>none</code>ï¼Œå†ä¿®æ”¹å„ç§å±æ€§ï¼Œå†å°†<code>display</code>è®¾å›æ¥ã€‚</p>

<p><a id="markdown-æ…ç”¨clientwidth" name="æ…ç”¨clientwidth"></a></p>

<h3>æ…ç”¨<code>clientWidth</code></h3>

<p>ä¸è¦åœ¨å¾ªç¯ä¸­è·å–domçš„<code>clientWidth</code>ï¼Œå¦åˆ™ä¼šflashæ‰æµè§ˆå™¨çš„ç¼“å†²åŒºï¼Œä½¿æµè§ˆå™¨æ€§èƒ½ä¸‹é™ã€‚</p>

<p>ç¼“å†²åŒºæ˜¯æµè§ˆå™¨çš„ä¼˜åŒ–æœºåˆ¶ï¼Œå°†å¤šä¸ªæ”¹åŠ¨åˆå¹¶æˆä¸€æ¬¡æ”¹åŠ¨ï¼Œä»¥ä¾¿æé«˜æ•ˆç‡ã€‚</p>

<p><a id="markdown-å°‘ç”¨tableå¸ƒå±€" name="å°‘ç”¨tableå¸ƒå±€"></a></p>

<h3>å°‘ç”¨tableå¸ƒå±€ã€‚</h3>

<p>ä¿®æ”¹æŸä¸€<code>td</code>çš„å®½åº¦ï¼Œä¼šä½¿å¾—æ‰€æœ‰<code>td</code>è¿›è¡Œå›æµã€‚</p>

<p><a id="markdown-åŠ¨ç”»çš„åˆ·æ–°ç‡å’Œé¡µé¢æ€§èƒ½å¹³è¡¡" name="åŠ¨ç”»çš„åˆ·æ–°ç‡å’Œé¡µé¢æ€§èƒ½å¹³è¡¡"></a></p>

<h3>åŠ¨ç”»çš„åˆ·æ–°ç‡å’Œé¡µé¢æ€§èƒ½å¹³è¡¡</h3>

<p><a id="markdown-å°†gifå›¾å•ç‹¬æˆä¸€ä¸ªå›¾å±‚" name="å°†gifå›¾å•ç‹¬æˆä¸€ä¸ªå›¾å±‚"></a></p>

<h3>å°†gifå›¾å•ç‹¬æˆä¸€ä¸ªå›¾å±‚</h3>

<p>é€šè¿‡è®¾ç½®æŸäº›csså±æ€§ï¼Œå°†æŸä¸ªdomåšæˆä¸€ä¸ªå›¾å±‚ï¼š</p>

<ol>
<li><code>will-change</code></li>
<li><code>transform: translateZ(0)</code></li>
<li><code>translate3d(0,0,0)</code></li>
</ol>


<p><a id="markdown-å¯ç”¨gpuç¡¬ä»¶åŠ é€Ÿ" name="å¯ç”¨gpuç¡¬ä»¶åŠ é€Ÿ"></a></p>

<h3>å¯ç”¨GPUç¡¬ä»¶åŠ é€Ÿ</h3>

<p>å¯ç”¨GPUåŠ é€Ÿï¼Œä¼šå‡å°‘é‡ç»˜çš„æ—¶é—´ï¼Œä½†æ˜¯å›¾å±‚å¢å¤šï¼Œå›¾å±‚åˆå¹¶çš„æ—¶é—´ä¼šå¢åŠ ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸ªå¹³è¡¡éœ€è¦æŠŠæ¡ã€‚</p>

<p>ç»†èŠ‚å‚è€ƒ<a href="https://lz5z.com/Web%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-CSS3%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/">Web æ€§èƒ½ä¼˜åŒ–-CSS3 ç¡¬ä»¶åŠ é€Ÿ(GPU åŠ é€Ÿ)</a></p>

<p><a id="markdown-æµè§ˆå™¨å­˜å‚¨" name="æµè§ˆå™¨å­˜å‚¨"></a></p>

<h2>æµè§ˆå™¨å­˜å‚¨</h2>

<ol>
<li>cdnåŸŸåå’Œä¸»ç«™åŸŸååŒºåˆ†å¼€ï¼Œé˜²æ­¢è·å–é™æ€èµ„æºæºå¸¦cookieï¼Œæµªè´¹å¸¦å®½ã€‚</li>
<li>é€šè¿‡service workerå¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå’Œä¸»é¡µé€šè¿‡<code>postMessage</code>äº’ç›¸é€šä¿¡ã€‚</li>
<li>é€šè¿‡æµè§ˆå™¨performance profileæŸ¥çœ‹æ€§èƒ½ç“¶é¢ˆå’Œæ”¹è¿›æ•ˆæœã€‚</li>
<li>å¢åŠ å›¾å±‚æ˜¯å‡å°‘çš„é‡ç»˜ä¸å›æµçš„æ—¶é—´ä¸å¢åŠ çš„å›¾å±‚åˆå¹¶æ—¶é—´çš„å¢åŠ ä¹‹é—´çš„å¹³è¡¡ã€‚æ¯”å¦‚é€šè¿‡è®¾ç½®translate3då¼€å¯GPUåŠ é€Ÿã€‚</li>
<li>è·å–offsetHeightä¸ºä»€ä¹ˆä¼šé™ä½æ•ˆç‡ï¼Ÿä½¿ç¼“å†²åŒºåŸŸå¤±æ•ˆï¼Œå› ä¸ºè¦å¾—åˆ°ä¸€ä¸ªçœŸå®çš„å°ºå¯¸ã€‚ç¼“å†²åŒºåŸŸæ˜¯æµè§ˆå™¨çš„ä¸€ä¸ªä¼˜åŒ–æœºåˆ¶ï¼Œé€šè¿‡å°†å¤šæ¬¡æ›´æ”¹domç»¼åˆèµ·æ¥ä¸€æ¬¡æ›´æ–°ï¼Œæé«˜æ•ˆç‡ã€‚</li>
</ol>


<p><a id="markdown-ç¼“å­˜" name="ç¼“å­˜"></a></p>

<h2>ç¼“å­˜</h2>

<p><strong>å¼ºç¼“å­˜</strong>
å¦‚æœå‘½ä¸­ï¼Œä¸éœ€è¦å‘è¯·æ±‚åˆ°æœåŠ¡å™¨ã€‚</p>

<ol>
<li>cache-control: max-age, s-max-age</li>
<li>expires:</li>
</ol>


<p><strong>åå•†ç¼“å­˜ï¼ˆå¼±ç¼“å­˜ï¼‰</strong>
éœ€è¦å‘è¯·æ±‚åˆ°æœåŠ¡å™¨è¯¢é—®æœ¬åœ°ç¼“å­˜æ˜¯å¦å¯ç”¨ã€‚å¦‚æœå¯ç”¨ï¼ŒæœåŠ¡å™¨è¿”å›304ï¼Œä¸æºå¸¦å…·ä½“å†…å®¹ï¼Œå…·ä½“å†…å®¹ä»æœ¬åœ°ç¼“å­˜ä¸­è¯»å–ã€‚å¦‚æœä¸å¯ç”¨ï¼ŒæœåŠ¡å™¨ç›´æ¥è¿”å›å†…å®¹ã€‚</p>

<ol>
<li>last-modified:</li>
<li>if-modified-since: 304</li>
<li>e-tag:</li>
<li>if-none-match:</li>
</ol>


<p>æµè§ˆå™¨ç¼“å­˜æµç¨‹å¦‚ä¸‹ï¼š</p>

<p><img src="/images/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="æµè§ˆå™¨ç¼“å­˜æµç¨‹å›¾.png" /></p>

<p>å…³äºç¼“å­˜ï¼Œä¸‹é¢ä¸¤ç¯‡æ–‡ç« ä»‹ç»çš„å¾ˆæ¸…æ¥šï¼š</p>

<ol>
<li><a href="https://www.jiqizhixin.com/articles/2020-07-24-12">Web ç¼“å­˜ä»‹ç»</a></li>
<li><a href="https://segmentfault.com/a/1190000010787023">HTTP ç¼“å­˜ä¹‹æµè§ˆå™¨åˆ·æ–°è¡Œä¸º</a>: disable cache setting in the developper tool</li>
</ol>


<p><a id="markdown-æœåŠ¡å™¨ç«¯æ¸²æŸ“" name="æœåŠ¡å™¨ç«¯æ¸²æŸ“"></a></p>

<h2>æœåŠ¡å™¨ç«¯æ¸²æŸ“</h2>

<ol>
<li>vue-ssr (server-side-rendering)</li>
<li>react-ssr</li>
<li>ä»£ä»·ï¼šéœ€è¦ä¸€ä¸ªuniversalçš„code baseï¼Œä¿è¯å…¶åœ¨æœåŠ¡å™¨ç«¯å’Œæµè§ˆå™¨ç«¯éƒ½èƒ½è¿è¡Œã€‚</li>
</ol>

]]></content>
  </entry>
  
</feed>
