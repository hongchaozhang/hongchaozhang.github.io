
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>android unit test with junit - Reading Space</title>
	<meta name="author" content="Zhang Hongchao">

	
	<meta name="description" content="Android Unit Test With Junit Create Android unit tests using junit4. Test Types When using Android Studio to write any of your tests, your test code &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Reading Space" type="application/atom+xml">
	
	<link rel="canonical" href="http://hongchaozhang.github.io/blog/2016/08/25/android-unit-test-with-junit/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-62806905-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
    <li><a href="#">About</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
		
			<a class="github" href="https://github.com/hongchaozhang" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>



<section class="categories">
          <ul id="category_cloud" class="nav nav-list"><a href='/blog/categories/algorithm' style='font-size: 102.5%'>algorithm(2)</a> <a href='/blog/categories/android' style='font-size: 107.5%'>android(6)</a> <a href='/blog/categories/android-studio' style='font-size: 101.25%'>android studio(1)</a> <a href='/blog/categories/augmented-reality' style='font-size: 105.0%'>augmented reality(4)</a> <a href='/blog/categories/cs' style='font-size: 101.25%'>cs(1)</a> <a href='/blog/categories/css' style='font-size: 103.75%'>css(3)</a> <a href='/blog/categories/design-pattern' style='font-size: 103.75%'>design pattern(3)</a> <a href='/blog/categories/html' style='font-size: 105.0%'>html(4)</a> <a href='/blog/categories/http' style='font-size: 103.75%'>http(3)</a> <a href='/blog/categories/ios' style='font-size: 156.25%'>ios(45)</a> <a href='/blog/categories/java' style='font-size: 102.5%'>java(2)</a> <a href='/blog/categories/javascript' style='font-size: 108.75%'>javascript(7)</a> <a href='/blog/categories/llm' style='font-size: 101.25%'>llm(1)</a> <a href='/blog/categories/machine-learning' style='font-size: 112.5%'>machine learning(10)</a> <a href='/blog/categories/map-tech' style='font-size: 103.75%'>map tech(3)</a> <a href='/blog/categories/mobile' style='font-size: 101.25%'>mobile(1)</a> <a href='/blog/categories/mongodb' style='font-size: 101.25%'>mongodb(1)</a> <a href='/blog/categories/music' style='font-size: 108.75%'>music(7)</a> <a href='/blog/categories/nlp' style='font-size: 102.5%'>nlp(2)</a> <a href='/blog/categories/nlu' style='font-size: 102.5%'>nlu(2)</a> <a href='/blog/categories/nodejs' style='font-size: 108.75%'>nodejs(7)</a> <a href='/blog/categories/objective-c' style='font-size: 127.5%'>objective-c(22)</a> <a href='/blog/categories/philosophy' style='font-size: 102.5%'>philosophy(2)</a> <a href='/blog/categories/productivity' style='font-size: 130.0%'>productivity(24)</a> <a href='/blog/categories/python' style='font-size: 108.75%'>python(7)</a> <a href='/blog/categories/react' style='font-size: 101.25%'>react(1)</a> <a href='/blog/categories/reading' style='font-size: 160.0%'>reading(48)</a> <a href='/blog/categories/server' style='font-size: 101.25%'>server(1)</a> <a href='/blog/categories/swift' style='font-size: 108.75%'>swift(7)</a> <a href='/blog/categories/web' style='font-size: 117.5%'>web(14)</a> <a href='/blog/categories/wwdc' style='font-size: 102.5%'>wwdc(2)</a> <a href='/blog/categories/xcode' style='font-size: 110.0%'>xcode(8)</a> </ul>
      </section>


</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Android Unit Test With Junit</h1>
	<div class="entry-content" itemprop="articleBody"><p>Create Android unit tests using junit4.</p>

<!-- more -->


<h2>Test Types</h2>

<p>When using Android Studio to write any of your tests, your test code must go into one of two different code directories (source sets). For each module in your project, Android Studio includes both source sets, corresponding to the following test types:</p>

<h3>Local unit tests</h3>

<p>Located at <em>module-name/src/test/java/</em>.
These tests run on the local JVM and do not have access to functional Android framework APIs.</p>

<h3>Instrumented tests</h3>

<p>Located at <em>module-name/src/androidTest/java/</em>.
These are all tests that must run on an Android hardware device or an Android emulator.</p>

<p>In the following, we will only focus on local unit test.</p>

<h2>Set Up Your Testing Environment</h2>

<p>In your app&rsquo;s top-level build.gradle file, you need to specify these libraries as dependencies:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dependencies {
</span><span class='line'>    // Required -- JUnit 4 framework
</span><span class='line'>    testCompile 'junit:junit:4.12'
</span><span class='line'>    // Optional -- Mockito framework
</span><span class='line'>    testCompile 'org.mockito:mockito-core:1.10.19'
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>Create a Local Unit Test Class</h2>

<h3>Manualy create junit4 unit test</h3>

<p>Your local unit test class should be written as a JUnit 4 test class. <a href="http://junit.org/junit4/">JUnit</a> is the most popular and widely-used unit testing framework for Java. The latest version of this framework, JUnit 4, allows you to write tests in a cleaner and more flexible way than its predecessor versions. Unlike the previous approach to Android unit testing based on JUnit 3, with JUnit 4, you do not need to extend the junit.framework.TestCase class. You also do not need to prefix your test method name with the ‘test’ keyword, or use any classes in the junit.framework or junit.extensions package.</p>

<p>To create a basic JUnit 4 test class, create a Java class that contains one or more test methods. A test method begins with the @Test annotation and contains the code to exercise and verify a single functionality in the component that you want to test.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import org.junit.Test;
</span><span class='line'>import java.util.regex.Pattern;
</span><span class='line'>import static org.junit.Assert.assertFalse;
</span><span class='line'>import static org.junit.Assert.assertTrue;
</span><span class='line'>
</span><span class='line'>public class EmailValidatorTest {
</span><span class='line'>
</span><span class='line'>    @Test
</span><span class='line'>    public void emailValidator_CorrectEmailSimple_ReturnsTrue() {
</span><span class='line'>        assertThat(EmailValidator.isValidEmail("name@email.com"), is(true));
</span><span class='line'>    }
</span><span class='line'>    ...
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Auto create junit4 unit test with the help of Android Studio</h3>

<p>Right click inside the class you are to test, and select <em>Go to -> Test</em> (Shift + Command + T), then select <em>create new test&hellip;</em>. You will see:</p>

<p><img src="/images/auto_create_junit4_unit_test.png" alt="auto_create_junit4_unit_test.png" /></p>

<p>In the above window, select the test class name, the methods you want to test, and some other helper methods like <code>setUp</code> and <code>tearDown</code>.</p>

<p>Then fill out all the test cases.</p>

<h3>Some annotations</h3>

<table>
<thead>
<tr>
<th>Annotation </th>
<th> Meaning </th>
<th> Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Test </td>
<td> for test cases </td>
<td></td>
</tr>
<tr>
<td>@Before </td>
<td> excute before every test case </td>
<td></td>
</tr>
<tr>
<td>@After </td>
<td> excute after every test case </td>
<td></td>
</tr>
<tr>
<td>@BeforeClass </td>
<td> static, excute only once, before the first test case begin </td>
<td></td>
</tr>
<tr>
<td>@AfterClass </td>
<td> see @BeforeClass </td>
<td></td>
</tr>
<tr>
<td>@Rule </td>
<td></td>
<td></td>
</tr>
</tbody>
</table>


<h2><code>Mock</code> and <code>Spy</code></h2>

<h4>Difference between mock and spy</h4>

<p><strong>Mock</strong>: Mock will wrap the Class of an Type, not from an actual instance. The mock simply creates a bare-bones shell instance of the Class. In that case, each method implementation is mocked, unless specify <code>thenCallRealMethod()</code> in the <code>when(..)</code> clause.</p>

<p><strong>Spy</strong>: Spy will wrap an existing instance. In this case, all method implementation are the real one, expect if you have defined a mocked behaviour with <code>when(..)</code>.</p>

<p>For <code>mock</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Stock stock = mock(Stock.class);
</span><span class='line'>when(stock.getPrice()).thenReturn(100.00);    // Mock implementation
</span><span class='line'>when(stock.getQuantity()).thenReturn(200);    // Mock implementation
</span><span class='line'>when(stock.getValue()).thenCallRealMethod();  // Real implementation</span></code></pre></td></tr></table></div></figure>


<p>In that case, each method implementation is mocked, unless specify <code>thenCallRealMethod()</code> in the <code>when(..)</code> clause.</p>

<p>For <code>spy</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Stock stock = spy(new Stock());
</span><span class='line'>when(stock.getPrice()).thenReturn(100.00);    // Mock implementation
</span><span class='line'>when(stock.getQuantity()).thenReturn(200);    // Mock implementation
</span><span class='line'>// All other method call will use the real implementations</span></code></pre></td></tr></table></div></figure>


<p>In that case, all method implementation are the real one, expect if you have defined a mocked behaviour with <code>when(..)</code>.</p>

<p>There is one important pitfall when you use <code>when(Object)</code> with spy like in the previous example. The real method will be called (because <code>stock.getPrice()</code> is evaluated before <code>when(..)</code> at runtime). This can be a problem if your method contains logic that should not be called. You can write the previous example like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Stock stock = spy(new Stock());
</span><span class='line'>doReturn(100.00).when(stock).getPrice();    // Mock implementation
</span><span class='line'>doReturn(200).when(stock).getQuantity();    // Mock implementation
</span><span class='line'>// All other method call will use the real implementations</span></code></pre></td></tr></table></div></figure>


<h2>Mock Android Dependencies</h2>

<p>To do.</p>

<h2>Use Hamcrest for Assertion</h2>

<p>Use <a href="https://github.com/hamcrest/hamcrest-junit">hamcrest</a> to make the code more readable.</p>

<p>Instead of using:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>assertEquals(expected, "the two values should be the same");
</span><span class='line'>assertNotNull(object);</span></code></pre></td></tr></table></div></figure>


<p>we can use:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>assertThat(expected, equalTo("the two values should be the same"));
</span><span class='line'>assertThat(object, is(NotNullValue()));</span></code></pre></td></tr></table></div></figure>


<h2>References</h2>

<p><a href="https://developer.android.com/training/testing/start/index.html">Getting Started with Testing</a>: official site from Google.</p>

<p><a href="http://stackoverflow.com/questions/14970516/use-mockito-to-mock-some-methods-but-not-others">Use Mockito to mock some methods but not others</a>讲解Mock和Spy的用法，简单易懂。</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2024

    Zhang Hongchao


<!--Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>--></footer>
		</div>
	</div>
	










</body>
</html>
