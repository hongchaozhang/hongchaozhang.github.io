---
layout: post
title: "室内定位技术现状"
date: 2017-02-21 13:37:02 +0800
comments: true
categories: [map tech]
---


## 室内定位技术简介

室内定位的应用场景，参见[室内定位应用场合](https://senion.com/indoor-positioning-for-retail/)。

### 室内地图

要进行室内定位，首先需要有室内地图。

<!-- more -->

### 室内定位技术

| --- | 工作原理  | 应用场合  |
| --- | --- | --- |
| GPS | 接收多个卫星信号计算位置，信号中包含卫星信息和时间戳，根据时间差计算距离。 | 室外定位跟踪，农业和军事应用 |
| 基站定位 | 接收多个基站信号，信号中包含基站信息，根据信号强度计算距离。| --- |
| Wi-Fi    | 接收多个Wi-Fi信号，根据强度计算距离。   | 室内定位 |
| 蓝牙| 接收低功耗蓝牙beacon发射的信号获取beacon信息，通过信号强度计算距离。  | 室内定位 |
| RFID| ---  | 存货跟踪，厘米级精度定位要求 |
| 地磁| 在地磁指纹采集的基础上，通过磁感应器和网络请求获取位置信息。| --- |
| NFC | ---  | 支付／票务|
| 陀螺| 在初始状态已知的情况下，通过积分计算未来状态。    | 和其它定位方式结合使用，在保证一定精度的基础上，降低功耗。 |

| ---   | GPS| 基站定位| Wi-Fi| 蓝牙| RFID   | 地磁 | NFC    | 陀螺  |
| --------------- | ------- | ------------ | --------- | -------- | ----------- | ---- | ----------- | --------------- |
| 配置密度   | 全球    | 200米-2000米 | 20米-50米 | 1米-50米 | 1厘米-100米 | 全球 | ---    | 不限  |
| 可接入（1-5）   | 4  | 4  | 3    | 4   | 2 | 2    | 3 | 4|
| 精度（1-5）| 1(10米) | 0.5(100米)   | 3(3-5米)  | 4(1-3米) | 5(厘米级别) | ---  | 5(厘米级别) | 0.5(10米／100米) |
| 隐私安全（1-5） | 3  | 3  | 2    | 3   | 4 | 5    | 4.5    | 5|
| 代价（1-5）| 5  | 5  | 3    | 4   | 2 | 1.5  | 3 | 1|
 
 参考：[Indoor location technologies compared](http://lighthouse.io/indoor-location-technologies-compared/)
 
 **指纹技术**
 
 直接根据Wi-Fi或者蓝牙的信号强度计算距离会有比较大的误差，因为每个接入点的信号强度衰减模型不统一，并且受所在环境（遮挡等）的影响比较大。所以，就实地采集每个位置处每个接入点的信号强度，并存入服务器供后续定位请求使用。
 
 其它定位原理参考[室内定位技术原理揭秘](http://bbs.lbsyun.baidu.com/forum.php?mod=viewthread&tid=116547&extra=page%3D1)。

## 各厂商实现的室内定位技术

### 苹果

苹果在2014年的WWDC上（Taking Core Location Indoors）推出了iBeacon技术和协议，以及对应的SDK，实现室内定位。

关于iBeacon的几个问题。

* 我部署的iBeacon节点是否会被别的商家使用？

    回答是Yes！由于iBeacon协议开放，而且易于伪造，你部署的节点完全可以被竞争企业使用。甚至是伪造一个跟你的ID完全相同的Beacon。防止冒用蹭用是一个课题。

    设备商应该会给出一个解决方案，但截止目前还是可以被冒用。由于现在还没大规模部署，还有时间去解决这个问题。

* iBeacon的耗电量如何？

    现在市售方案除Estimote比较特殊外，基本上都是采用的TI2540或2541方案。Beacon作为蓝牙基站发射时间特别短只有4mS左右。

    Beacon的发射周期可调，比如苹果规定100mS发射一次，也就是说100mS里只发射4ms。不同的使用场景可以根据实际需要调整发射周期、发射频率，功耗也会有差别，短的半年，长的3-4年。
    
**参考**

* [iBeacon能否精确室内定位等10个技术问题](http://www.voidcn.com/blog/u012716788/article/p-4590383.html)

### 高德

高德地图支持Wi-Fi和蓝牙iBeacon室内定位。如果是iOS系统，只能用iBeacon定位，因为iOS系统不提供Wi-Fi底层数据接口。

| 设备 | 精度  | 支持系统   | 部署密度  | 设备单价 | 支持标准  |
| ---- | ---- | ---- | ---- | ---- | ---- |
| WIFI | 3~8米 | Android 4.0及以上    | 间隔30米部署，700平米1个 | 上百元   | 标准2.4G/5G频段|
| 蓝牙 | 1~5米 | Android 4.3及以上，iOS 8及以上 | 间隔 8米部署，50平1个    | 数十元   | 标准蓝牙4.0广播协议 |

应用高德进行室内定位的步骤：

1. 准备室内地图（使用高德已有的或者自己制作）。
2. 铺设Wi-Fi或iBeacon接入点。
3. 使用高德提供的定位数据采集工具进行数据采集。
4. 数据采集完毕编译后，上传至服务器。
5. 使用高德提供的定位数据检测工具现场体验定位效果。
6. 开发应用，使用高德室内定位SDK获取位置，包括经纬度和楼层信息。

关于室内地图：

1. 高德已覆盖数据

    高德已有室内地图数据，可免费申请使用。
    
2. 高德未覆盖数据
    
    若为高德未覆盖室内地图数据，提供如下两种数据生产方案：
    * 委托与高德合作的第三方生产。
    * 申请自主生产。

**参考**

* [高德室外定位技术](https://lbs.amap.com/getting-started/locate)
* [高德室内定位方案](https://lbs.amap.com/getting-started/indoorlocation/)
* [高德室内地图数据](https://lbs.amap.com/getting-started/indoorintro)

### 百度

大型商超内寻找店铺、停车场内反向寻车等业务的发展基础都是室内高精度定位。利用三角定位技术、增强WiFi指纹模型技术、地磁技术、蓝牙技术等， 提供精度1-3m的室内高精度定位服务。结合百度室内图服务，更好帮助开发者解决室内定位难题。

### 识途

特色：地磁定位技术。

[定位和采集工具：识途 Creator](http://www.ubirouting.com/creator.php)

仅通过上面的视频很难理解其采集原理，但是，识途提出了采集过程中以下几点注意事项：

1. 在按下采集按钮开始采集的时候，请**即刻**开始行走；在到达终点停止行走后，请**即刻**按下采集按钮结束采集。
2. 在采集过程中请保持**统一、稳定、自然**的行走速度, 尽可能保持在道路的中央行走，并且采集过程中尽可能避免晃动手机。
3. 如果在某段路径受到了外界的严重干扰，无法保持一致的行走速度或预定的行走方向，务必针对这段路径进行重新采集。

从上面的注意事项，可以大致猜测他是如何做到测量的地磁信号和地理位置的对应。

**参考**

* [识途室内定位技术综述](http://www.ubirouting.com/%E8%AF%86%E9%80%94%E5%AE%A4%E5%86%85%E5%AE%9A%E4%BD%8D%E6%8A%80%E6%9C%AF%E7%BB%BC%E8%BF%B0.pdf)
* [识途室内地磁环境数据采集方法及注意事项](http://ubirouting.com/%E8%AF%86%E9%80%94%E5%AE%A4%E5%86%85%E5%9C%B0%E7%A3%81%E7%8E%AF%E5%A2%83%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E6%96%B9%E6%B3%95%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9.pdf)

## 闲谈

* GPS不是泛指，是特指。

    我们一提到定位，大家印象中最熟悉的技术可能就是GPS定位。其实更为准确的说法是GNSS(Global Navigation Satellite System)定位，中文含义就是全球卫星定位系统。GPS只是GNSS中的一种实现方法，该系统是由美国部署的。另外，还有其他类型的定位系统，例如，俄罗斯的格洛纳斯（GLONASS），欧洲的伽利略和中国的北斗。关系如下：

    * GNSS
        * GPS（美国）
        * GLONASS（俄罗斯）
        * 北斗（中国）

## 参考







