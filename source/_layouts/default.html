{% capture root_url %}{{ site.root | strip_slash }}{% endcapture %}
{% include head.html %}

<body {% if page.single == true %}class="single"{% endif %}>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner">{% include header.html %}</header>				
			</div>
		</div>	
		<div class="mid-col">
			{% unless page.banner == false %}
				{% include banner.html %}
			{% endunless %}
			<div class="mid-col-container">
				<div id="content" class="inner">{{ content | expand_urls: root_url }}</div>
			</div>
			<footer id="footer" class="inner">{% include footer.html %}</footer>
		</div>
		{% if page.single == true %}
		<div class="right-col">
			<div class="toc-container">
				<h3>文章目录</h3>
				<div id="toc"></div>
			</div>
			<script>
			document.addEventListener('DOMContentLoaded', function() {
				const content = document.querySelector('.entry-content');
				if (!content) return;
				
				const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
				const toc = document.getElementById('toc');
				
				if (headings.length > 0) {
					let currentLevel = 0;
					let tocHTML = '<ul>';
					
					headings.forEach((heading, index) => {
						const level = parseInt(heading.tagName[1]);
						const id = `heading-${index}`;
						heading.id = id;
						
						if (level > currentLevel) {
							tocHTML += '<ul>'.repeat(level - currentLevel);
						} else if (level < currentLevel) {
							tocHTML += '</ul>'.repeat(currentLevel - level);
						}
						
						tocHTML += `<li><a href="#${id}">${heading.textContent}</a></li>`;
						currentLevel = level;
					});
					
					tocHTML += '</ul>'.repeat(currentLevel);
					toc.innerHTML = tocHTML;
				} else {
					toc.innerHTML = '<p>本文没有目录</p>';
				}
			});
			</script>
		</div>
		{% endif %}
	</div>
	{% include after_footer.html %}
</body>
</html>
