<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Reading Space]]></title>
  <link href="http://hongchaozhang.github.io/atom.xml" rel="self"/>
  <link href="http://hongchaozhang.github.io/"/>
  <updated>2019-10-19T13:40:00+08:00</updated>
  <id>http://hongchaozhang.github.io/</id>
  <author>
    <name><![CDATA[Zhang Hongchao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[博世宁的医学通识50讲]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/09/18/boshining-yixuetongshi/"/>
    <updated>2019-09-18T10:53:11+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/09/18/boshining-yixuetongshi</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">参考文献</a></li>
<li><a href="#%E7%8E%B0%E4%BB%A3%E5%8C%BB%E5%AD%A6%E7%9A%84%E5%87%A0%E4%B8%AA%E5%85%B1%E8%AF%86">现代医学的几个共识</a></li>
<li><a href="#%E7%97%85%E4%B8%8E%E7%97%87">”病“与”症“</a>

<ul>
<li><a href="#%E7%97%85%E5%92%8C%E7%97%87%E5%8C%BA%E5%88%AB%E5%AF%B9%E5%BE%85">病和症区别对待</a></li>
<li><a href="#%E7%96%BE%E7%97%85%E7%9A%84%E6%9C%AC%E6%BA%90%E6%98%AF%E8%BF%9B%E5%8C%96%E7%9A%84%E4%B8%8D%E5%AE%8C%E7%BE%8E">疾病的本源是进化的不完美</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A3%E5%81%BF">代偿</a></li>
<li><a href="#%E5%86%85%E5%85%B1%E7%94%9F">内共生</a></li>
<li><a href="#%E4%BA%BA%E4%BD%93%E5%85%8D%E7%96%AB">人体免疫</a>

<ul>
<li><a href="#%E9%9B%B6%E5%85%8D%E7%96%AB%E6%84%8F%E5%91%B3%E7%9D%80%E7%96%BE%E7%97%85%E5%92%8C%E6%AD%BB%E4%BA%A1">零免疫意味着疾病和死亡</a></li>
<li><a href="#%E4%BA%BA%E4%BD%93%E5%92%8C%E5%85%8D%E7%96%AB%E7%B3%BB%E7%BB%9F%E6%9C%89%E5%85%B3%E7%9A%84%E7%96%BE%E7%97%85%E7%9A%84%E7%97%85%E5%9B%A0%E4%B8%BB%E8%A6%81%E6%9C%89%E4%B8%89%E4%B8%AA%E6%96%B9%E9%9D%A2">人体和免疫系统有关的疾病的病因主要有三个方面：</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E6%89%93%E7%96%AB%E8%8B%97%E4%BF%9D%E6%8A%A4%E5%86%85%E5%85%B1%E7%94%9F%E5%BE%97%E5%B0%8F%E7%97%85%E5%8F%AF%E4%BB%A5%E6%8F%90%E9%AB%98%E5%85%8D%E7%96%AB%E5%8A%9B">通过打疫苗，保护内共生，得小病，可以提高免疫力</a></li>
</ul>
</li>
<li><a href="#%E7%99%8C%E7%9A%84%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6%E5%90%8C%E5%BD%92%E4%BA%8E%E5%B0%BD%E7%9A%84%E7%96%AF%E7%8B%82%E8%B7%91%E8%BD%A6">癌的生成机制：同归于尽的疯狂跑车</a>

<ul>
<li><a href="#%E7%99%8C%E7%97%87%E5%B0%B1%E5%83%8F%E4%B8%80%E8%BE%86%E7%96%AF%E7%8B%82%E8%B7%91%E8%BD%A6%E5%AE%83%E6%9C%89%E5%85%AD%E4%B8%AA%E7%8E%AF%E8%8A%82">癌症就像一辆“疯狂跑车”，它有六个环节：</a></li>
<li><a href="#%E7%99%8C%E7%97%87%E7%9A%84%E6%89%80%E6%9C%89%E6%B2%BB%E7%96%97%E9%83%BD%E6%98%AF%E9%92%88%E5%AF%B9%E8%BF%996%E4%B8%AA%E7%8E%AF%E8%8A%82">癌症的所有治疗，都是针对这6个环节。</a></li>
</ul>
</li>
<li><a href="#%E7%99%8C%E7%97%87%E6%97%B6%E9%97%B4%E7%9A%84%E8%80%81%E6%9C%8B%E5%8F%8B">癌症：时间的老朋友</a>

<ul>
<li><a href="#%E5%BC%95%E8%B5%B7%E7%99%8C%E7%97%87%E6%9C%80%E5%A4%A7%E7%9A%84%E5%8D%B1%E9%99%A9%E5%9B%A0%E7%B4%A0%E6%98%AF%E5%B9%B4%E9%BE%84%E5%B9%B4%E9%BE%84%E8%B6%8A%E5%A4%A7%E6%82%A3%E7%99%8C%E9%A3%8E%E9%99%A9%E8%B6%8A%E5%A4%A7">引起癌症最大的危险因素是年龄，年龄越大，患癌风险越大</a></li>
<li><a href="#%E7%BB%86%E8%83%9E%E5%88%86%E8%A3%82%E4%BC%9A%E5%B8%A6%E6%9D%A5%E5%9F%BA%E5%9B%A0%E7%AA%81%E5%8F%98%E7%94%9F%E5%91%BD%E5%B0%B1%E6%98%AF%E4%B8%80%E7%A7%8D%E7%99%8C%E5%89%8D%E7%8A%B6%E6%80%81">细胞分裂会带来基因突变，生命就是一种癌前状态</a></li>
<li><a href="#%E6%97%A2%E7%84%B6%E5%B9%B4%E9%BE%84%E5%9B%A0%E7%B4%A0%E6%97%A0%E6%B3%95%E6%94%B9%E5%8F%98%E9%80%9A%E8%BF%87%E9%81%BF%E5%85%8D%E5%85%B6%E4%BB%96%E5%8D%B1%E9%99%A9%E5%9B%A0%E7%B4%A0%E4%BB%8D%E7%84%B6%E5%8F%AF%E4%BB%A5%E5%87%8F%E5%B0%91%E7%9B%B8%E5%BD%93%E6%AF%94%E4%BE%8B%E7%9A%84%E7%99%8C%E7%97%87%E5%8F%91%E7%97%85">既然年龄因素无法改变，通过避免其他危险因素，仍然可以减少相当比例的癌症发病</a></li>
</ul>
</li>
<li><a href="#%E4%B8%8D%E5%90%8C%E6%80%A7%E6%A0%BC%E7%9A%84%E4%BA%BA%E7%94%9F%E7%97%85%E7%9A%84%E9%A3%8E%E9%99%A9%E4%B9%9F%E4%B8%8D%E5%90%8C">不同性格的人生病的风险也不同</a></li>
<li><a href="#%E7%96%AB%E8%8B%97%E5%AF%B9%E6%8A%97%E7%96%BE%E7%97%85%E7%9A%84%E6%96%B0%E9%80%BB%E8%BE%91">疫苗：对抗疾病的新逻辑</a></li>
<li><a href="#%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%94%9F%E5%91%BD%E7%BB%88%E7%82%B9">重新定义生命终点</a></li>
<li><a href="#%E9%81%BF%E5%AD%95%E8%8D%AF%E6%8A%8A%E5%A5%B3%E4%BA%BA%E7%9A%84%E8%BA%AB%E4%BD%93%E8%BF%98%E7%BB%99%E5%A5%B3%E4%BA%BA">避孕药：把女人的身体还给女人</a></li>
<li><a href="#%E5%9C%A8%E4%BF%A1%E6%81%AF%E4%B8%8D%E5%AE%8C%E5%A4%87%E4%B8%8B%E5%BF%AB%E9%80%9F%E5%86%B3%E7%AD%96">在信息不完备下快速决策</a></li>
</ul>


<p><a id="markdown-参考文献" name="参考文献"></a></p>

<h2>参考文献</h2>

<ol>
<li><a href="https://mubu.com/doc/explore/20724">薄世宁·医学通识50讲</a>比较全面。</li>
<li>来自豆瓣的<a href="https://www.douban.com/note/715205529/">医学通识50讲 薄世宁</a>讲的也比较详细。</li>
<li>来自搜狐的<a href="http://www.sohu.com/a/310071793_370913">《薄世宁·医学通识50讲》——教你如何与医生进行有效的沟通</a>也可以了解一下。</li>
</ol>


<p>现在将自己收听之后印象比较深的总结摘抄一下。</p>

<p><a id="markdown-现代医学的几个共识" name="现代医学的几个共识"></a></p>

<h2>现代医学的几个共识</h2>

<ol>
<li>生命第一。</li>
<li>疾病与人终生相伴，原因是人类进化的速度赶不上环境变化的速度。</li>
<li>医疗的本质是支持生命自身修复，医疗在这个过程中只能起到辅助的作用，是为自我修复提供时间，创造条件。</li>
<li>医学具有科学与人文的双重性格。</li>
</ol>


<p><a id="markdown-病与症" name="病与症"></a></p>

<h2>”病“与”症“</h2>

<p><a id="markdown-病和症区别对待" name="病和症区别对待"></a></p>

<h3>病和症区别对待</h3>

<p>发烧，大出血之后的低血压，原发性高血压等都是“症”，是结果，是人体的适应性反应。只有当“症”超过一定限度才需要治。如果一开始就针对“症”进行压制，往往适得其反。</p>

<p><a id="markdown-疾病的本源是进化的不完美" name="疾病的本源是进化的不完美"></a></p>

<h3>疾病的本源是进化的不完美</h3>

<ol>
<li>我们的基因是不完美的，人体的设计也是不完美的。我们与环境之间的适应也是不完美的。</li>
<li>疾病是人的身体和环境不适应的表现。环境在不断变化，人就需要不断进化。但是进化速度赶不上环境的变化速度，就产生了疾病。</li>
<li>疾病也有价值，疾病可以刺激人体免疫，可以成为进化的动力，推动整个物种进化。</li>
</ol>


<p><a id="markdown-代偿" name="代偿"></a></p>

<h2>代偿</h2>

<ol>
<li>慢性病平时发现不了，往往一旦发现就是晚期，原因是身体的代偿作用。比如，幽门螺杆菌破坏胃的内壁细胞，干细胞就会更多地分化为胃内壁细胞进行补充，使胃“凑活”着用。一旦干细胞分化都解决不了这个问题，就会表现出来“症”，就已经非常严重啦。</li>
<li>代偿让器官满足基本功能，却掩盖了症状。</li>
<li>疾病都不是突然发生，而是突然发现的</li>
</ol>


<p><a id="markdown-内共生" name="内共生"></a></p>

<h2>内共生</h2>

<p>身体每个部位都含有微生物，和人体是一个共生的作用，没必要去破坏这个平衡。因为人体已经适应了这些细菌，如果这些细菌被杀死，其它种类的细菌就回去了占领原来细菌的地盘，而人类和新的细菌还不能和谐相处，带来更严重的后果。所以，
1. 不要太干净：没有什么症状的情况下，最好不要过分杀菌消毒，比如用具有杀菌作用的漱口水等。
2. 抗生素当然是能不用就不用：用抗生素把常驻部队都杀了，那“土匪”就该捣乱了。我们应该善于利用体内的竞争关系：真菌和细菌本身就有竞争关系，抗生素杀菌可能让真菌大量繁殖，引起真菌感染。真菌感染更难危险。</p>

<p><a id="markdown-人体免疫" name="人体免疫"></a></p>

<h2>人体免疫</h2>

<p><a id="markdown-零免疫意味着疾病和死亡" name="零免疫意味着疾病和死亡"></a></p>

<h3>零免疫意味着疾病和死亡</h3>

<p><a id="markdown-人体和免疫系统有关的疾病的病因主要有三个方面" name="人体和免疫系统有关的疾病的病因主要有三个方面"></a></p>

<h3>人体和免疫系统有关的疾病的病因主要有三个方面：</h3>

<ol>
<li>人体免疫认不出“坏人”

<ol>
<li>流感病毒，不断地变换病毒表面的H蛋白&mdash;-辨别物质，人体免疫也就认不出来。</li>
<li>水痘-带状疱疹病毒，藏在神经节里。很多病毒可以藏在细胞里，让免疫细胞找不到。</li>
<li>癌细胞伪造一张“身份证”，骗过“警察”的检查。</li>
</ol>
</li>
<li>把“好人”当“坏人”

<ol>
<li>红斑狼疮</li>
<li>过敏是免疫系统把本来无害的物质辨别为“敌人”，产生过度的反应。比如过敏性鼻炎、荨麻疹、湿疹、哮喘。</li>
</ol>
</li>
<li>认出来但是打不过“坏人”

<ol>
<li>艾滋病、白血病、糖尿病、尿毒症</li>
<li>癌细胞释放物质，麻痹免疫细胞，让免疫细胞的能力降低。</li>
</ol>
</li>
</ol>


<p><a id="markdown-通过打疫苗保护内共生得小病可以提高免疫力" name="通过打疫苗保护内共生得小病可以提高免疫力"></a></p>

<h3>通过打疫苗，保护内共生，得小病，可以提高免疫力</h3>

<p>正确看待感染性疾病，尤其是不严重的感染性疾病。</p>

<p><a id="markdown-癌的生成机制同归于尽的疯狂跑车" name="癌的生成机制同归于尽的疯狂跑车"></a></p>

<h2>癌的生成机制：同归于尽的疯狂跑车</h2>

<p><a id="markdown-癌症就像一辆疯狂跑车它有六个环节" name="癌症就像一辆疯狂跑车它有六个环节"></a></p>

<h3>癌症就像一辆“疯狂跑车”，它有六个环节：</h3>

<ol>
<li>图纸错误。癌基因造出了癌细胞；

<ul>
<li>癌细胞最大的特点就是生长信号多，对抑制信号不敏感。长得快，不停长。</li>
</ul>
</li>
<li>自检体系失效。癌细胞赖着不死；

<ul>
<li>抑癌基因发生突变如基因P53</li>
</ul>
</li>
<li>癌细胞有丰富的血管和独特的能量利用系统；

<ul>
<li>正常情况下，一个细胞和最近的毛细血管距离不能超过100微米，癌细胞特别灵活，促进血管形成的信号增多，而抑制血管形成的信号减少。持续的新生血管形成，源源不断地给肿瘤组织供血。所以在临床上，多数恶性肿瘤通常都是血流丰富。医生们甚至用这个特点区分良性和恶性。</li>
</ul>
</li>
<li>免疫逃逸，癌细胞躲过了警察；</li>
<li>篡改里程，拒绝报废；

<ul>
<li>2009年，诺贝尔医学奖，发现染色体末端都有端粒。每次细胞分裂，端粒就缩短一部分。正常细胞分裂50次左右，端粒也就消耗光了。没有了端粒，细胞只能死。但是，“癌症跑车”会不断地篡改里程，不断地延长端粒长度。</li>
</ul>
</li>
<li>导航错乱，同归于尽。

<ul>
<li>癌细胞能在组织内部和组织间灵活移动，癌症容易发生侵袭和转移。</li>
</ul>
</li>
</ol>


<p><a id="markdown-癌症的所有治疗都是针对这6个环节" name="癌症的所有治疗都是针对这6个环节"></a></p>

<h3>癌症的所有治疗，都是针对这6个环节。</h3>

<ol>
<li>外科手术就好比端掉了汽车加工厂。</li>
<li>癌症的靶向药多数都是针对错误的图纸，根据基因突变类型，选择靶向治疗药物。</li>
<li>癌症的免疫治疗药物PD-1抑制剂，就是恢复警察的敏感性和战斗力，让警察擦亮眼睛，认出癌症跑车。</li>
<li>血管内皮生长因子抑制剂，就是针对癌症组织血管丰富的特点，抑制血管生长，也就抑制了肿瘤的生长。</li>
</ol>


<p><a id="markdown-癌症时间的老朋友" name="癌症时间的老朋友"></a></p>

<h2>癌症：时间的老朋友</h2>

<p><a id="markdown-引起癌症最大的危险因素是年龄年龄越大患癌风险越大" name="引起癌症最大的危险因素是年龄年龄越大患癌风险越大"></a></p>

<h3>引起癌症最大的危险因素是年龄，年龄越大，患癌风险越大</h3>

<p><strong>癌症基因突变最大的危险因素不是环境也不是遗传，而是随机错误。</strong></p>

<ol>
<li>染色体复制过程中发生的随机错误，占到66%。而环境因素和遗传因素，加一起也只占34%。</li>
<li>骨癌的基因突变：随机错误占了99.5%，遗传占0.5%，与环境因素完全无关。</li>
<li>甲状腺癌，随机错误占98%，遗传占1.5%，环境因素仅占微不足道的0.5%。</li>
<li>非何杰金氏淋巴瘤、脑部肿瘤、前列腺癌、睾丸癌，这些癌症的基因突变中，随机因素都占到了95%以上。</li>
</ol>


<p><a id="markdown-细胞分裂会带来基因突变生命就是一种癌前状态" name="细胞分裂会带来基因突变生命就是一种癌前状态"></a></p>

<h3>细胞分裂会带来基因突变，生命就是一种癌前状态</h3>

<p>细胞分裂需要染色体先进行复制。由于基因数量巨大，复制难免出错，错误出现在致癌基因上，就会出现癌症。</p>

<p><a id="markdown-既然年龄因素无法改变通过避免其他危险因素仍然可以减少相当比例的癌症发病" name="既然年龄因素无法改变通过避免其他危险因素仍然可以减少相当比例的癌症发病"></a></p>

<h3>既然年龄因素无法改变，通过避免其他危险因素，仍然可以减少相当比例的癌症发病</h3>

<ol>
<li>去除致癌因素，改变生活方式，可以很大程度上降低患癌风险

<ul>
<li>戒烟、戒酒、减肥、多运动、多吃全谷物食品、蔬菜、水果、豆类，少吃糖、少吃红肉（比如猪肉、牛肉、羊肉），这是改变生活方式。</li>
<li>避免乙肝病毒、丙肝病毒、幽门螺旋杆菌、HPV病毒感染。已经感染了，要治疗或者定期复查。</li>
</ul>
</li>
<li>定期进行疾病筛查。早期发现，早期治疗，具有很大的价值和意义

<ul>
<li>美国明尼苏达大学癌症检查中心，对45岁以上无症状的普通人每年做一次乙状结肠镜检查，见到腺瘤就切除。结肠癌、直肠癌发病率比预期的减少了85%</li>
</ul>
</li>
<li>咱们越来越长寿，那就应该接纳癌症，和它共存。</li>
</ol>


<p><a id="markdown-不同性格的人生病的风险也不同" name="不同性格的人生病的风险也不同"></a></p>

<h2>不同性格的人生病的风险也不同</h2>

<ol>
<li>A型性格的人：有雄心壮志，喜欢竞争，苛求自己，渴望出人头地；以事业成败作为人生评价的唯一标准；性情急躁，缺乏耐心，容易激动；有时间紧迫感，行动匆忙；下楼梯就一直抱怨电梯慢，恨不得自己跑下去；好斗，对人有敌意，看谁都是敌人。容易患高血压、冠心病等心身疾病。</li>
<li>B型性格的人更少患心脏病，并且更长寿：谦逊谨慎，不自以为是；做事有条理，游刃有余；足够自信，但不在别人面前自夸，也不迫切需求别人的肯定和赞赏；不轻易反对和敌视他人；心态平和，不为外界事物所扰乱；主动调节心态，不偏执，不自虐。</li>
<li>C型性格，这类人容易发生肿瘤，所以也被称为“肿瘤性格”：内向；喜欢谁不喜欢谁，自己心里知道就是不说；压抑自己的情绪，过分忍让，回避矛盾；遇到不公，怒而不发；憋着，爱生闷气。</li>
</ol>


<p><a id="markdown-疫苗对抗疾病的新逻辑" name="疫苗对抗疾病的新逻辑"></a></p>

<h2>疫苗：对抗疾病的新逻辑</h2>

<ol>
<li>疫苗的工作原理：用生小病来预防大病；不得病也能防病；疫苗在未来还可以治病。</li>
<li>疫苗安全源于原理，安全源于设计，安全源于覆盖。</li>
<li>虽然疫苗永远做不到100%安全，但是可以越来越安全。</li>
</ol>


<p><a id="markdown-重新定义生命终点" name="重新定义生命终点"></a></p>

<h2>重新定义生命终点</h2>

<p>重新定义生命终点：脑死亡是医学上认为的生命终点，而呼吸、心跳、血压等则不是，因为脑死亡是无法逆转的，而其它生命体征都是可以医学干预的，甚至脑之外的器官很多都可以更换，而大脑不可以（即是技术上可以了，换了大脑的一个人还是这个人吗？）。</p>

<ol>
<li>脑死亡作为死亡的诊断标准更科学。</li>
<li>脑死亡与植物人的区别，是生与死的区别。</li>
<li>脑死亡诊断标准具有一定的价值和意义，比如器官移植。</li>
</ol>


<p><a id="markdown-避孕药把女人的身体还给女人" name="避孕药把女人的身体还给女人"></a></p>

<h2>避孕药：把女人的身体还给女人</h2>

<ol>
<li>口服避孕药，让生育和性爱分割。</li>
<li>专业助产技术，让生育和死亡分割。</li>
<li>冻卵技术，让生育和年龄分割。</li>
</ol>


<p><a id="markdown-在信息不完备下快速决策" name="在信息不完备下快速决策"></a></p>

<h2>在信息不完备下快速决策</h2>

<p>信息不完备下的快速决策，由4条原则组成：</p>

<ol>
<li>唐僧原则，先保命，把紧急事件转化为常规事件。</li>
<li>第一张骨牌原则，找到复杂问题的关键点。</li>
<li>马蹄声原则（如果你听到马蹄声，先想马，不要猜斑马），按照概率大小考虑问题。</li>
<li>高尔夫原则（想要球最终进洞，都会不断调整自己的挥杆角度和站立的位置），不断校正，避免主观错误。</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[吴军《信息论40讲》小结]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/08/26/infomation-theory/"/>
    <updated>2019-08-26T13:16:15+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/08/26/infomation-theory</id>
    <content type="html"><![CDATA[<p>对得道App上面吴军对信息论40讲的个人小结。</p>

<!-- more -->


<ul>
<li><a href="#%E4%BF%A1%E6%81%AF%E7%86%B5">信息熵</a>

<ul>
<li><a href="#%E6%AF%94%E7%89%B9">比特</a></li>
</ul>
</li>
<li><a href="#%E4%BF%A1%E9%81%93%E5%AE%B9%E9%87%8F">信道容量</a></li>
<li><a href="#%E5%93%88%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81">哈夫曼编码</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%AD%A3%E4%BA%A4">信息正交</a></li>
<li><a href="#%E4%BA%92%E4%BF%A1%E6%81%AF">互信息</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF%E5%A2%9E%E7%9B%8A">信息增益</a></li>
<li><a href="#%E9%A6%99%E5%86%9C%E7%AC%AC%E4%BA%8C%E5%AE%9A%E5%BE%8B">香农第二定律</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF%E7%BC%96%E7%A0%81%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF">信息编码中的错误</a>

<ul>
<li><a href="#%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C">奇偶校验</a>

<ul>
<li><a href="#%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F">工作方式</a></li>
<li><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9">优缺点</a></li>
</ul>
</li>
<li><a href="#%E6%B5%B7%E6%98%8E%E7%A0%81%E6%A0%A1%E9%AA%8C">海明码校验</a>

<ul>
<li><a href="#%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F-1">工作方式</a></li>
<li><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9-1">优缺点</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%B9%B8%E5%AD%98%E8%80%85%E5%81%8F%E5%B7%AE%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E8%A2%AB%E5%B7%B2%E7%9F%A5%E4%BF%A1%E6%81%AF%E8%AF%AF%E5%AF%BC">幸存者偏差：如何避免被已知信息误导？</a>

<ul>
<li><a href="#%E8%AF%BB%E4%B9%A6%E6%97%A0%E7%94%A8%E8%AE%BA">读书无用论</a></li>
<li><a href="#%E9%A3%9E%E6%9C%BA%E9%97%AE%E9%A2%98">飞机问题</a></li>
</ul>
</li>
<li><a href="#%E5%A5%A5%E5%8D%A1%E5%A7%86%E5%89%83%E5%88%80%E6%B3%95%E5%88%99%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E5%BE%80%E5%BE%80%E6%98%AF%E6%9C%80%E6%9C%89%E6%95%88%E7%9A%84">奥卡姆剃刀法则：最简单的往往是最有效的</a>

<ul>
<li><a href="#%E6%89%98%E5%8B%92%E5%AF%86%E5%9C%B0%E5%BF%83%E8%AF%B4">托勒密地心说</a></li>
<li><a href="#%E6%97%A5%E5%BF%83%E8%AF%B4%E5%92%8C%E7%89%9B%E9%A1%BF%E4%B8%87%E6%9C%89%E5%BC%95%E5%8A%9B%E5%AE%9A%E5%BE%8B">日心说和牛顿万有引力定律</a></li>
</ul>
</li>
<li><a href="#%E7%86%B5%E5%A2%9E%E5%8E%9F%E7%90%86-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BF%9D%E6%8C%81%E7%B3%BB%E7%BB%9F%E5%BC%80%E6%94%BE%E6%80%A7">熵增原理 为什么要保持系统开放性</a></li>
<li><a href="#%E6%8E%A7%E5%88%B6%E8%AE%BA%E8%BD%BB%E9%A2%84%E6%B5%8B%E9%87%8D%E5%8F%8D%E5%BA%94%E7%A7%B0%E4%B8%BA%E5%8F%98%E8%89%B2%E9%BE%99">控制论，轻预测重反应，称为变色龙</a>

<ul>
<li><a href="#%E5%8F%8D%E9%A6%88%E8%AE%BA">反馈论</a>

<ul>
<li><a href="#%E6%AD%A3%E5%8F%8D%E9%A6%88">正反馈</a></li>
<li><a href="#%E8%B4%9F%E5%8F%8D%E9%A6%88">负反馈</a></li>
</ul>
</li>
<li><a href="#%E5%9C%A8%E7%AE%A1%E7%90%86%E4%B8%8A%E7%9A%84%E5%BA%94%E7%94%A8">在管理上的应用</a></li>
</ul>
</li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E8%AE%BA">系统论</a></li>
</ul>


<p><a id="markdown-信息熵" name="信息熵"></a></p>

<h2>信息熵</h2>

<p>信息熵是香农提出的用来度量信息量的物理量，其满足以下三个特性：</p>

<ol>
<li>单调性：发生的概率越大，信息量越小</li>
<li>非负性</li>
<li>可加性</li>
</ol>


<p>香农在1948年的《通信的数学理论》中给出了信息熵的一种形式，并且<strong>证明这是唯一的一种形式</strong>。
信息熵为信息编码提供了理论的最优值，是实用编码的平均码长的理论下限，也就是无损压缩的最小值。</p>

<p>下面是信息熵的数学定义：</p>

<p><img src="http://hongchaozhang.github.io/images/xinxishang.jpg" alt="信息熵" /></p>

<p><a id="markdown-比特" name="比特"></a></p>

<h3>比特</h3>

<p>1比特信息：描述一个发生概率50%的事情发生或者不发生的信息的信息量。</p>

<p><a id="markdown-信道容量" name="信道容量"></a></p>

<h2>信道容量</h2>

<p>香农在《通信的数学理论》中从理论上证明，只要通信速率小于信道容量，总可以找到一种编码方式，使得错误率接近于零。信道容量由带宽和信噪比确定。
信道容量就是信道的临界通信速率值。</p>

<p>下面是香农给出的信道容量的数学公式：</p>

<p><img src="http://hongchaozhang.github.io/images/xindaorongliang.jpg" alt="信道容量" /></p>

<p><a id="markdown-哈夫曼编码" name="哈夫曼编码"></a></p>

<h2>哈夫曼编码</h2>

<p>最短编码：哈夫曼编码及其在平时做事时的原则</p>

<p>哈夫曼编码：将最优质的资源（短码）分配给最高概率出现的信息。</p>

<p>哈夫曼编码对我们做事的指导原则：将有限的资源分配给最可能出现的情况，比如投资。</p>

<p><a id="markdown-信息正交" name="信息正交"></a></p>

<h2>信息正交</h2>

<p>信息正交性：在信息很多的情况下如何作决策？</p>

<p><a id="markdown-互信息" name="互信息"></a></p>

<h2>互信息</h2>

<p>互信息：相关不是因果，那相关是什么？</p>

<p><a id="markdown-信息增益" name="信息增益"></a></p>

<h2>信息增益</h2>

<p>条件熵和信息增益：你提供的信息到底值多少钱？第一个提出某个观点的人最受人瞩目，附和的人很少被关注到。</p>

<p><a id="markdown-香农第二定律" name="香农第二定律"></a></p>

<h2>香农第二定律</h2>

<p>香农第二定律（一）：为什么你的网页总是打不开？
香农第二定律（二）：到底要不要扁平化管理？信道带宽和人际沟通</p>

<p><a id="markdown-信息编码中的错误" name="信息编码中的错误"></a></p>

<h2>信息编码中的错误</h2>

<p>纠错码：对待错误的正确态度是什么？</p>

<p>冗余在信息中的作用
如果一段文字没有冗余（文字大小严格等于信息熵），即所谓的“字字珠玑”，那么将非常难以理解。如果能从不同侧面加以说明（比如说，也就是说），将易于理解，但势必带来大量信息冗余。</p>

<p>在信息编码和通信领域，信息冗余可以用来较验信息或者对错误信息进行纠错。</p>

<p><a id="markdown-奇偶校验" name="奇偶校验"></a></p>

<h3>奇偶校验</h3>

<p><a id="markdown-工作方式" name="工作方式"></a></p>

<h4>工作方式</h4>

<p>用额外的一位（bit）信息记录一串二进制信息中1的个数是奇数还是偶数，接收方可以根据这一位信息对数据进行验证。</p>

<p><a id="markdown-优缺点" name="优缺点"></a></p>

<h4>优缺点</h4>

<p><strong>缺点</strong></p>

<ul>
<li>奇偶校验并不总是有效，如果数据中有偶数个位发生变化，则奇偶位仍将是正确的，因此不能检测出错误。</li>
<li>奇偶校验位是最简单的错误检测码，但是由于没有办法确定哪一位出错，所以它不能进行错误校正。发生错误时必须扔掉全部的数据，然后从头开始传输数据。在噪声很多的媒介上成功传输数据可能要花费很长的时间，甚至根本无法实现。</li>
</ul>


<p><strong>优点</strong></p>

<p>但是奇偶校验位也有它的优点，它是使用一位数据能够达到的最好的校验码，并且它仅仅需要一些异或门就能够生成。奇偶校验被广泛应用</p>

<p><a id="markdown-海明码校验" name="海明码校验"></a></p>

<h3>海明码校验</h3>

<p><a id="markdown-工作方式-1" name="工作方式-1"></a></p>

<h4>工作方式</h4>

<p>如果一条信息中包含更多用于纠错的位，且通过妥善安排这些纠错位使得不同的出错位产生不同的错误结果，那么我们就可以找出出错位了。在一个7位的信息中，单个位出错有7种可能，因此3个错误控制位就足以确定是否出错及哪一位出错了。</p>

<p><a id="markdown-优缺点-1" name="优缺点-1"></a></p>

<h4>优缺点</h4>

<p>相比于奇偶校验，优缺点很明显：可以进行自动纠错，但是需要更大的信息冗余。</p>

<p><a id="markdown-幸存者偏差如何避免被已知信息误导" name="幸存者偏差如何避免被已知信息误导"></a></p>

<h2>幸存者偏差：如何避免被已知信息误导？</h2>

<p>幸存者偏差意思是指，当取得资讯的渠道，仅来自于幸存者时（因为死人不会说话），此资讯可能会存在与实际情况不同的偏差。只能看到经过某种筛选而产生的结果，而没有意识到筛选的过程，因此忽略了被筛选掉的关键信息。在“沉默的数据”、“死人不会说话”等等日常表达中，涉及幸存者偏差。</p>

<p>此规律也适用于金融和商业领域。存活下来的企业往往被视为“传奇”，它们的做法被争相效仿。而其实有些也许只是因为偶然原因幸存下来了而已。</p>

<p><a id="markdown-读书无用论" name="读书无用论"></a></p>

<h3>读书无用论</h3>

<p>如今很多人在说，谁谁谁当初没好好上学如今照样挣大钱，而好多用功读书的人，毕业后反而不如那些没好好学习的人混得好。并且因为这样的例子有很多，所以很多人得出“上学没有用处”，“读书无用”的结论。</p>

<p>这些其实只是个例，因为基数太大，所以看起来有很多。2010年第六次全国人口普查的官方口径，可以算出来大专以上文化程度的人口仅占总人口的8.7%左右。可以看出学历低的人数远高于学历高的人数，所以即便低学历者成功率远低于高学历者，也照样会导致低学历者出现大批成功人士。</p>

<p>对于高学历者，普通人既会关注成功的人，也会关注那些没成功的人，并且高学历却落魄的人尤其受关注，容易被当做新闻报道；而对于低学历者，普通人往往只关注成功者，忽视了广大学历低又没成功的人。正是因为忽视了这些“沉默的数据”，才产生“读书无用”这种错误结论。</p>

<p><a id="markdown-飞机问题" name="飞机问题"></a></p>

<h3>飞机问题</h3>

<p>在二战期间，人们发现幸存的轰炸机中，机翼中弹的数量很多，而机身中弹的却很少。因此人们认为我们应该加固飞机的机翼。其实不然，就是因为机翼中弹多还能飞回来，所以机翼中弹并没有影响飞机返航；而机身中弹的少则说明了子弹打中机身对飞机的影响更大，导致飞机不能返航。</p>

<p>举一个与之相同的例子，经过枪击案而活下来的人当中，手部和腿部中弹的居多，而击中头部和心脏的少之又少，正说明了人的头部和心脏对死亡率的影响更大而不是手和腿。</p>

<p><a id="markdown-奥卡姆剃刀法则最简单的往往是最有效的" name="奥卡姆剃刀法则最简单的往往是最有效的"></a></p>

<h2>奥卡姆剃刀法则：最简单的往往是最有效的</h2>

<p>这个原理称为“如无必要，勿增实体”，即“简单有效原理”。正如奥卡姆在《箴言书注》2卷15题说“切勿浪费较多东西去做，用较少的东西，同样可以做好的事情。”</p>

<p>地心说和日心说的发展过程清洗地展示了奥卡姆剃刀法则。</p>

<p><a id="markdown-托勒密地心说" name="托勒密地心说"></a></p>

<h3>托勒密地心说</h3>

<p>在托勒密之前，很多人就对宇宙模型进行了建模，但是过于复杂。托勒密力求以最简单的假设对各种现象作出统一的解释，这就是“简单性原则”。这也许就是奥卡姆剃刀的雏形。托勒密基于这种原则和当时人们所接受的动力学原理，提出了自己的地心说模型。后来，天主教教会接纳此为世界观的“正统理论”。</p>

<p><a id="markdown-日心说和牛顿万有引力定律" name="日心说和牛顿万有引力定律"></a></p>

<h3>日心说和牛顿万有引力定律</h3>

<p>虽然托勒密的地心说相比于之前的情形已经简化了很多，但是仍然不能很好滴解释很多新的天文观测数据。</p>

<p>尽管如此，信奉地心说的人们并没有认识到这是由于地心说本身的错误造成的，却用增加本轮的方法来补救地心说。起初这种办法还能勉强应付，后来小本轮增加到80多个，但仍不能满意地计算出行星的准确位置，这就不能不使人怀疑地心说的正确性了。</p>

<p>而牛顿的万有引力定律是那么简单完美地解释了一切天文观测数据，因此，日心说才替代地心说，称为主流观点。</p>

<p><a id="markdown-熵增原理-为什么要保持系统开放性" name="熵增原理-为什么要保持系统开放性"></a></p>

<h2>熵增原理 为什么要保持系统开放性</h2>

<p>熵增原理，即热力学第二定律，指的是孤立热力学系统的熵不减少，总是增大或者不变。熵增原理用来给出一个孤立系统的演化方向。说明一个孤立系统不可能朝低熵的状态发展即不会变得有序。</p>

<p>如果一个人严格封闭了自己，那么也不会进步（熵减少，更有序）。只有通过和他人沟通学习（吸取负熵），才能进步。一个公司，一个国家也是如此。</p>

<p><a id="markdown-控制论轻预测重反应称为变色龙" name="控制论轻预测重反应称为变色龙"></a></p>

<h2>控制论，轻预测重反应，称为变色龙</h2>

<p>主要是反馈论，包括从功能的观点对机器和物体中（神经系统、内分泌及其他系统）的调节和控制的一般规律的研究。</p>

<p><a id="markdown-反馈论" name="反馈论"></a></p>

<h3>反馈论</h3>

<p>反馈论主要包括正反馈和负反馈。</p>

<p><a id="markdown-正反馈" name="正反馈"></a></p>

<h4>正反馈</h4>

<p>正反馈是指反馈信息影响系统再输出的结果，更加增大了受控量的实际值和期望值的偏差，从而使系统趋向于不稳定状态。</p>

<p>两个话筒离得很近的时候，“尖叫声”会越来越大，即是正反馈所致。</p>

<p>一般所谓的“恶性循环”即包含正反馈的概念在里面。比如，一旦一个人别贴上了某种标签，他就会更加快地越来越像这种标签描述的人。</p>

<p>生理中，正反馈的意义在于使生理过程不断加强，直至最终完成生理功能，在正反馈情况下，反馈控制系统处于再生状态。体内常见的正反馈现象：排便，排尿，分娩，凝血，射精等。</p>

<p>蜂后的形成过程也是一个正反馈的过程：起初两个蜂是一样的，都会分泌一些抑制对方成为蜂后的化学物质，但是由于起初两只蜂分泌的数量有了一点点差别，导致一只会向蜂后方向发展的快一点，由于快了一点点，分泌出的抑制对方的物质就回更多一点，反过来促使其向蜂后发展的更快&hellip;（记不太清楚这是不是蜂后的演化过程了，也可能是某种细胞的分化过程。）</p>

<p><a id="markdown-负反馈" name="负反馈"></a></p>

<h4>负反馈</h4>

<p>负反馈是指反馈信息影响系统再输出的结果，减小了受控量的实际值和期望值的偏差，从而使系统趋向于稳定状态。</p>

<p>工业系统中的PID控制即是典型的负反馈应用。</p>

<p>汽车的巡航定速系统可以作为负反馈的另一个例子，它会使得车速符合一个预先设定的速度上限。汽车的控制系统的输入包括引擎的扭力和路面的坡度（扰动），而速度计可以测量车速。速度计得到的车速和目标速度（预先设定）之间的差距就是误差信号。控制器接收到这个信号之后会改变加速度，控制流入引擎（效应器）的燃料增多。于是，引擎扭力发生改变，和路面坡度相关的扭力输出的反馈减少了速度的误差，缩小了路面造成的扰动。</p>

<p><a id="markdown-在管理上的应用" name="在管理上的应用"></a></p>

<h3>在管理上的应用</h3>

<p>从控制系统的主要特征出发来考察管理系统，可以得出这样的论：管理系统是一种典型的控制系统。管理系统中的控制过程在本质上与工程的、生物的系统是一样的，都是通过信息反馈来揭示成效与标准之间的差，并采取纠正措施，使系统稳定在预定的目标状态上的。因此，从理论说：适合于工程的、生物的控制论的理论与方法，也适合于分析和说明管理控制问题。</p>

<p><a id="markdown-系统论" name="系统论"></a></p>

<h2>系统论</h2>

<p>找准系统瓶颈，使部分之和大于整体，而不是相反。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[互联网和移动通信简史]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/08/25/mobile-comunication-and-internet/"/>
    <updated>2019-08-25T15:32:34+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/08/25/mobile-comunication-and-internet</id>
    <content type="html"><![CDATA[<p>得到App里面吴军关于5G、物联网和移动通信发展史的一些看法。</p>

<!-- more -->


<ul>
<li><a href="#iot%E6%98%AF%E7%AC%AC%E4%B8%89%E4%BB%A3%E4%BA%92%E8%81%94%E7%BD%91">IoT是第三代互联网</a>

<ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E4%BB%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%92%8C%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%81%94%E7%BD%91">第一代：计算机和计算机联网</a></li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E4%BB%A3%E4%BA%BA%E5%92%8C%E4%BA%BA%E8%81%94%E7%BD%91%E7%A7%BB%E5%8A%A8%E4%BA%92%E8%81%94%E7%BD%91">第二代：人和人联网（移动互联网）</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E4%BB%A3%E4%B8%87%E7%89%A9%E4%B9%8B%E9%97%B4%E7%9A%84%E8%81%94%E7%BD%91%E5%8C%85%E6%8B%AC%E4%BA%92%E8%81%94%E7%BD%91%E5%92%8C%E4%BA%BA">第三代：万物之间的联网，包括互联网和人</a></li>
</ul>
</li>
<li><a href="#%E7%A7%BB%E5%8A%A8%E9%80%9A%E4%BF%A1%E7%AE%80%E5%8F%B2">移动通信简史</a>

<ul>
<li><a href="#%E6%80%BB%E4%BD%93%E7%89%B9%E7%82%B9">总体特点</a></li>
<li><a href="#1g">1G</a></li>
<li><a href="#2g">2G</a></li>
<li><a href="#3g">3G</a></li>
<li><a href="#4g">4G</a></li>
<li><a href="#5g">5G</a>

<ul>
<li><a href="#%E5%9F%BA%E7%AB%99%E6%95%B0%E9%87%8F%E5%A2%9E%E5%8A%A02%E4%B8%AA%E6%95%B0%E9%87%8F%E7%BA%A7">基站数量增加2个数量级</a></li>
<li><a href="#%E6%80%BB%E4%BD%93%E7%9A%84%E8%83%BD%E8%80%97%E4%B8%8D%E5%A2%9E%E5%8A%A0">总体的能耗不增加</a></li>
<li><a href="#%E7%94%B5%E4%BF%A1%E7%BD%91%E7%BB%9C%E5%92%8C%E7%A7%BB%E5%8A%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E9%AB%98%E5%BA%A6%E8%9E%8D%E5%90%88">电信网络和移动网络的高度融合</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%9C%AA%E6%9D%A5%E8%B0%81%E6%98%AF%E5%8F%97%E7%9B%8A%E8%80%85">未来谁是受益者</a></li>
</ul>


<p><a id="markdown-iot是第三代互联网" name="iot是第三代互联网"></a></p>

<h2>IoT是第三代互联网</h2>

<p>第一代：计算机和计算机联网
第二代：人和人联网（移动互联网）
第三代：万物之间的联网，包括互联网和人</p>

<p><a id="markdown-第一代计算机和计算机联网" name="第一代计算机和计算机联网"></a></p>

<h3>第一代：计算机和计算机联网</h3>

<p>Windows和英特尔是这一代互联网的龙头老大。计算机可以有不同的品牌，但是操作系统一定是Windows，各种芯片一定是英特尔。</p>

<p><a id="markdown-第二代人和人联网移动互联网" name="第二代人和人联网移动互联网"></a></p>

<h3>第二代：人和人联网（移动互联网）</h3>

<p>谷歌的安卓系统和ARM的处理器是这一代互联网设备（主要是手机）绕不过去的。这一代的格局和第一代一样。</p>

<p><a id="markdown-第三代万物之间的联网包括互联网和人" name="第三代万物之间的联网包括互联网和人"></a></p>

<h3>第三代：万物之间的联网，包括互联网和人</h3>

<p>万物互联时代，各种东西都要联网，数量级相比第二代互联网至少增加1.5个数量级。4G网络已经容纳不下这么多设备了。</p>

<p>这就是5G的必要性。</p>

<p><a id="markdown-移动通信简史" name="移动通信简史"></a></p>

<h2>移动通信简史</h2>

<p>1G：摩托罗拉，模拟电路，大哥大
2G：诺基亚，GMS，数字电路，翻盖手机
3G：高通，CDMA，移动互联网，相比2G，网速提高一个数量级。
4G：LTE，网速进一步提高，开始和互联网融合。
5G：移动通信和互联网高度融合。</p>

<p><a id="markdown-总体特点" name="总体特点"></a></p>

<h3>总体特点</h3>

<ul>
<li>基站之间是有线连接，带宽高，而且不浪费空中资源。</li>
<li>网络不断融合。</li>
<li>频率越来越高。</li>
</ul>


<p><a id="markdown-1g" name="1g"></a></p>

<h3>1G</h3>

<p>在这个时代，移动通信（大哥大）和传统电信（固定电话）是分家的。今天我们看来，感觉很蠢，当时是利益使然。</p>

<p><a id="markdown-2g" name="2g"></a></p>

<h3>2G</h3>

<p>移动通信从模拟电路转到了数字电路，得益于数字芯片的体积小这一优点，有了小巧的翻盖手机。</p>

<p>第二代移动通信除了打电话，还能发短信。不过，也只能如此了，因为其通信带宽还很小。</p>

<p><a id="markdown-3g" name="3g"></a></p>

<h3>3G</h3>

<p>CDMA标准使得网速有了一个数量级的提高，使得能够正常浏览网页，但是看视频还是不行。智能手机开始出现。</p>

<p>这时候，移动网络（手机）和电信网络（Wifi）的主干网基本融合，但是末端还是分离的。下面一段话没怎么理解：</p>

<blockquote><p>从第三代到第四代，还有一个让你感觉荒唐的地方，咱们说固定电话和移动电话的分离，到第三代固定电话和移动电话，你可以认为是和合二为一了，基本上主干网合二为一了，而且移动互联网智能手机起来的时候，很多人家里没有固定电话了。以前家里两个电话，一个固定电话、一个手机，留电话都是留两个。</p></blockquote>

<p><a id="markdown-4g" name="4g"></a></p>

<h3>4G</h3>

<p>相比于第三代，第四代基本没有特殊需求的基站，还是利用原来的基站（建基站只是为了提高覆盖率，从技术上讲不是必需的。）。</p>

<p>此时移动网络和Wifi还是分离的。</p>

<p><a id="markdown-5g" name="5g"></a></p>

<h3>5G</h3>

<p><a id="markdown-基站数量增加2个数量级" name="基站数量增加2个数量级"></a></p>

<h4>基站数量增加2个数量级</h4>

<p>基站距离从4G时代的2-3千米缩小到200-300米，缩小一个数量级，基站数量就要增加两个数量级。</p>

<p><a id="markdown-总体的能耗不增加" name="总体的能耗不增加"></a></p>

<h4>总体的能耗不增加</h4>

<p>由于每个基站只用照顾原来面积的1%，所以理论上来说，每个基站需要发射的能量是原来的1%，总能量和原来持平。</p>

<p><a id="markdown-电信网络和移动网络的高度融合" name="电信网络和移动网络的高度融合"></a></p>

<h4>电信网络和移动网络的高度融合</h4>

<p>这个时候，家里面就不需要Wifi了：Wifi会像当初固定电话一样从家庭环境中消失。</p>

<p><a id="markdown-未来谁是受益者" name="未来谁是受益者"></a></p>

<h2>未来谁是受益者</h2>

<ul>
<li>适用于Iot设备的低功耗处理器厂商</li>
<li>适用于Iot设备的操作系统</li>
<li>设备制造商

<ul>
<li>第一代互联网：Dell，HP，联想，宏基</li>
<li>第二代互联网：小米，华为，Vivo/OPPO</li>
<li>Iot时代：？？</li>
</ul>
</li>
<li>应用开发商</li>
<li>通信标准

<ul>
<li>摩托罗拉，诺基亚，高通，华为</li>
</ul>
</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[吴军的硅谷来信]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/07/09/wujunguigulaixin/"/>
    <updated>2019-07-09T10:13:06+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/07/09/wujunguigulaixin</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#%E7%AC%AC9%E5%B0%81%E4%BF%A1vr%E6%8A%80%E6%9C%AF%E4%B8%8E%E7%AC%AC%E4%B8%89%E7%9C%BC%E7%BE%8E%E5%A5%B3">第9封信，VR技术与“第三眼美女”</a></li>
<li><a href="#%E7%AC%AC18%E5%B0%81%E4%BF%A1%E6%9C%9F%E6%9C%9B%E5%80%BC%E6%9C%80%E5%A4%A7%E5%8C%96%E5%8E%9F%E5%88%99%E5%92%8C%E5%AE%83%E5%9C%A8%E7%94%9F%E6%B4%BB%E4%B8%8A%E7%9A%84%E5%BA%94%E7%94%A8">第18封信，期望值最大化原则和它在生活上的应用</a></li>
<li><a href="#%E7%AC%AC19%E5%B0%81%E4%BF%A1%E6%9C%89%E5%B0%8F%E8%81%AA%E6%98%8E%E6%B2%A1%E6%9C%89%E6%99%BA%E6%85%A7%E7%9A%84%E4%BA%BA">第19封信，有小聪明没有智慧的人</a></li>
<li><a href="#%E7%AC%AC20%E5%B0%81%E4%BF%A1%E5%86%8D%E8%B0%88%E8%B0%882%E5%92%8C98%E7%9A%84%E9%97%AE%E9%A2%98">第20封信，再谈谈2%和98%的问题</a></li>
<li><a href="#%E7%AC%AC21%E5%B0%81%E4%BF%A1%E8%A5%BF%E7%93%9C%E4%B8%8E%E8%8A%9D%E9%BA%BB">第21封信，西瓜与芝麻</a></li>
<li><a href="#%E7%AC%AC26%E5%B0%81%E4%BF%A1%E4%BE%BF%E5%AE%9C%E7%9A%84%E7%9C%BC%E6%B3%AA">第26封信，便宜的眼泪</a></li>
<li><a href="#%E7%AC%AC28%E5%B0%81%E4%BF%A1%E5%9C%A8%E7%BE%8E%E5%9B%BD%E6%9C%80%E6%9C%89%E9%92%B1%E7%9A%84%E4%BA%BA%E6%AF%94%E4%BB%80%E4%B9%88%E5%85%BC%E8%B0%88%E7%BE%8E%E5%9B%BD%E7%9A%84%E6%85%88%E5%96%84%E6%96%87%E5%8C%96">第28封信，在美国最有钱的人比什么，兼谈美国的慈善文化</a></li>
<li><a href="#%E7%AC%AC29%E5%B0%81%E4%BF%A1%E8%AE%A9%E4%BD%A0%E7%9A%84%E7%88%B6%E6%AF%8D%E6%88%90%E7%86%9F%E8%B5%B7%E6%9D%A5">第29封信，让你的父母成熟起来</a></li>
<li><a href="#%E7%AC%AC30%E5%B0%81%E4%BF%A1%E5%86%8D%E8%AE%AE%E6%9E%97%E9%BB%9B%E7%8E%89">第30封信，再议林黛玉</a></li>
<li><a href="#%E7%AC%AC31%E5%B0%81%E4%BF%A1%E7%BE%8E%E5%9B%BD%E7%A7%81%E7%AB%8B%E4%B8%AD%E5%AD%A6%E5%A6%82%E4%BD%95%E6%95%99%E8%AF%AD%E6%96%87%E5%92%8C%E5%8E%86%E5%8F%B2">第31封信，美国私立中学如何教语文和历史</a></li>
<li><a href="#%E7%AC%AC35%E5%B0%81%E4%BF%A1%E7%A1%85%E8%B0%B7%E9%AB%98%E5%88%9B%E4%BC%9A">第35封信，硅谷高创会</a></li>
<li><a href="#%E7%AC%AC50%E5%B0%81%E4%BF%A1%E8%BF%99%E4%B8%AA%E4%B8%96%E7%95%8C%E6%B2%A1%E6%9C%89%E6%AC%A0%E4%BD%A0%E4%BB%80%E4%B9%88">第50封信，这个世界没有欠你什么</a></li>
<li><a href="#%E7%AC%AC58%E5%B0%81%E4%BF%A1%E6%99%BA%E8%83%BD%E6%97%B6%E4%BB%A3%E7%9A%84%E4%BA%A7%E4%B8%9A%E7%89%B9%E7%82%B9">第58封信，智能时代的产业特点</a></li>
<li><a href="#%E7%AC%AC67%E5%B0%81%E4%BF%A1%E9%98%BF%E6%8B%89%E6%96%AF%E5%8A%A0%E6%97%A5%E8%AE%B02%E5%90%AC%E4%B9%A6%E5%88%86%E4%BA%AB%E5%81%9A%E6%9D%A1%E7%8B%97">第67封信，阿拉斯加日记2：听书分享《做条狗》</a></li>
<li><a href="#%E7%AC%AC104%E5%B0%81%E4%BF%A1%E8%B5%B5%E5%B0%8F%E5%85%B0%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E5%BD%93%E4%B8%8A%E9%83%A8%E9%95%BF%E8%B0%88%E8%B0%88%E8%AE%B2%E7%90%86%E7%9A%84%E6%96%B9%E6%B3%95">第104封信，赵小兰为什么能当上部长——谈谈讲理的方法</a></li>
<li><a href="#%E7%AC%AC105%E5%B0%81%E4%BF%A1%E6%88%91%E4%BB%AC%E9%9D%A0%E4%BB%80%E4%B9%88%E6%9C%8D%E4%BA%BA1%E4%BB%8E%E6%97%A5%E5%BF%83%E8%AF%B4%E7%9A%84%E5%85%AC%E6%A1%88%E8%AF%B4%E8%B5%B7">第105封信，我们靠什么服人1：从日心说的公案说起</a></li>
<li><a href="#%E7%AC%AC118%E5%B0%81%E4%BF%A1%E5%81%9A%E7%94%9F%E6%84%8F%E5%92%8C%E7%AE%A1%E7%90%86%E7%9A%84%E7%A7%98%E8%AF%80%E4%B8%8D%E7%BB%99%E9%80%89%E6%8B%A9">第118封信，做生意和管理的秘诀：不给选择</a></li>
<li><a href="#%E7%AC%AC126%E5%B0%81%E4%BF%A1%E6%8B%89%E9%87%8C%E4%BD%A9%E5%A5%87%E7%9A%84%E6%99%BA%E6%85%A73%E8%B0%B7%E6%AD%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%8B%86%E5%88%86">第126封信，拉里佩奇的智慧3：谷歌为什么要拆分</a></li>
<li><a href="#140%E5%B8%B8%E8%AF%86%E7%A7%91%E6%8A%80%E5%92%8C%E8%89%BA%E6%9C%AF">140.常识、科技和艺术</a></li>
<li><a href="#156%E6%9C%B4%E7%B4%A0%E6%98%AF%E5%AF%8C%E8%B1%AA%E7%9A%84%E4%B8%93%E5%88%A9">156.朴素是富豪的专利</a></li>
<li><a href="#160%E5%93%88%E4%BD%9B%E5%92%8C%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%95%86%E5%AD%A6%E9%99%A2%E4%BC%A0%E6%8E%88%E7%9A%84%E7%B2%BE%E9%AB%93">160.哈佛和斯坦福商学院传授的精髓</a></li>
<li><a href="#163%E8%BF%90%E6%B0%94%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7">163.运气的重要性</a></li>
<li><a href="#168%E5%AF%B9%E8%AF%9D%E5%BA%84%E5%AD%902%E6%88%91%E4%BB%AC%E6%98%AF%E5%90%A6%E6%9C%89%E8%87%AA%E7%94%B1%E6%84%8F%E5%BF%97">168.对话庄子2：我们是否有自由意志？</a></li>
<li><a href="#173%E6%89%BE%E4%B8%80%E4%B8%AA%E9%95%BF%E6%9C%9F%E5%AF%B9%E4%BD%A0%E5%A5%BD%E7%9A%84%E4%BA%BA%E4%BB%8E%E5%B7%B4%E8%8F%B2%E7%89%B9%E8%B4%AD%E4%B9%B0%E8%8B%B9%E6%9E%9C%E8%82%A1%E7%A5%A8%E8%AF%B4%E8%B5%B7">173.找一个长期对你好的人，从巴菲特购买苹果股票说起</a></li>
<li><a href="#174%E4%BA%BA%E7%94%9F%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E6%8A%95%E8%B5%84%E4%B8%8A">174.人生最重要的投资（上）</a></li>
<li><a href="#180%E6%9C%AA%E6%9D%A5%E5%95%86%E4%B8%9A%E7%9A%84%E7%89%B9%E7%82%B91%E5%85%B1%E4%BA%AB%E7%BB%8F%E6%B5%8E">180.未来商业的特点（1）：共享经济</a></li>
<li><a href="#183%E6%9C%AA%E6%9D%A5%E5%95%86%E4%B8%9A%E7%9A%84%E7%89%B9%E7%82%B94%E5%90%88%E4%BD%9C%E7%BB%8F%E6%B5%8E">183.未来商业的特点（4）：合作经济</a></li>
<li><a href="#189%E5%AD%90%E5%A5%B3%E6%95%99%E8%82%B22%E8%BE%9B%E8%8B%A6%E5%92%8C%E7%97%9B%E8%8B%A6">189.子女教育（2）：辛苦和痛苦</a></li>
<li><a href="#190%E5%AD%90%E5%A5%B3%E6%95%99%E8%82%B23%E5%85%B4%E8%B6%A3%E7%9A%84%E5%9F%B9%E5%85%BB">190.子女教育（3）：兴趣的培养</a></li>
<li><a href="#192%E5%B0%8F%E9%B2%9C%E8%82%89%E5%92%8C%E6%88%8F%E9%AA%A8%E6%A9%98%E5%AD%90%E5%92%8C%E8%8B%B9%E6%9E%9C%E7%9A%84%E5%AF%B9%E6%AF%94">192.小鲜肉和戏骨：橘子和苹果的对比</a></li>
<li><a href="#195%E4%B8%AD%E5%9B%BD%E4%BE%9D%E7%84%B6%E6%98%AF%E4%B8%80%E4%B8%AA%E5%A4%A7%E8%B4%BE%E5%BA%9C%E8%87%AA%E7%BB%99%E8%87%AA%E8%B6%B3%E6%96%87%E5%8C%96%E6%A0%B9%E6%B7%B1%E8%92%82%E5%9B%BA">195.中国依然是一个大贾府，自给自足文化根深蒂固。</a></li>
<li><a href="#197%E6%99%B4%E9%9B%AF%E7%9A%84%E6%82%B2%E5%89%A7">197.晴雯的悲剧</a></li>
<li><a href="#201%E8%B0%B7%E6%AD%8C%E5%B0%8F%E6%97%B6%E5%80%99%E7%9A%84%E6%95%85%E4%BA%8B%E7%BB%99%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8%E5%88%9B%E5%A7%8B%E4%BA%BA%E7%9A%84%E5%BB%BA%E8%AE%AE">201.谷歌小时候的故事：给初创公司创始人的建议</a></li>
<li><a href="#204%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8B%E5%8D%8A%E5%9C%BA">204.没有什么下半场</a></li>
<li><a href="#205%E9%A6%99%E5%86%9C%E7%AC%AC%E4%BA%8C%E5%AE%9A%E7%90%86%E5%B8%A6%E5%AE%BD%E5%86%B3%E5%AE%9A%E7%94%9F%E6%84%8F%E5%A4%A7%E5%B0%8F">205.香农第二定理：带宽决定生意大小</a></li>
<li><a href="#208%E8%81%8C%E5%9C%BA%E4%B8%8A%E7%9A%84%E5%9B%9B%E4%B8%AA%E8%AF%AF%E5%8C%BA%E5%92%8C%E5%9B%9B%E4%B8%AA%E5%81%9A%E6%B3%95">208.职场上的四个误区和四个做法</a></li>
<li><a href="#209%E8%81%8C%E4%B8%9A%E5%91%98%E5%B7%A5%E5%92%8C%E7%AE%A1%E7%90%86%E8%80%85%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E4%B8%A4%E4%BB%B6%E4%BA%8B">209.职业员工和管理者要注意的两件事</a></li>
<li><a href="#211%E9%9D%A2%E8%AF%95%E7%9A%84%E6%8A%80%E5%B7%A7%E4%B8%8B%E8%AE%A9%E5%AF%B9%E6%96%B9%E4%BA%86%E8%A7%A3%E4%BD%A0%E7%9A%84%E4%BB%B7%E5%80%BC">211.面试的技巧（下）：让对方了解你的价值</a></li>
<li><a href="#2142017%E5%B9%B4%E5%8D%81%E5%A4%A7%E7%A7%91%E6%8A%80%E7%AA%81%E7%A0%B4%E7%82%B9%E8%AF%84">214.2017年十大科技突破点评</a></li>
<li><a href="#215%E6%9C%80%E5%A5%BD%E6%98%AF%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%95%8C%E4%BA%BA">215.最好是更好的敌人</a></li>
<li><a href="#216%E6%9C%89%E6%B2%A1%E6%9C%89%E6%9B%B4%E5%A5%BD%E7%9A%84%E5%8A%9E%E6%B3%95">216.有没有更好的办法？</a></li>
<li><a href="#218%E7%94%9F%E5%91%BD%E7%9A%84%E6%97%A0%E5%A5%88">218.生命的无奈</a></li>
<li><a href="#219%E9%98%85%E8%AF%BB%E7%9A%84%E6%84%8F%E4%B9%89">219.阅读的意义</a></li>
<li><a href="#222%E6%9B%BC%E6%96%BD%E5%9D%A6%E5%9B%A0%E5%92%8C%E4%B8%93%E5%88%A9">222.曼施坦因和专利</a></li>
<li><a href="#225%E6%B2%A1%E6%9C%89%E6%82%AC%E5%BF%B5%E7%9A%84%E6%AF%94%E8%B5%9B%E6%9F%AF%E6%B4%81%E5%AF%B9%E9%98%B5alphago">225.没有悬念的比赛——柯洁对阵AlphaGo</a></li>
<li><a href="#232%E9%AB%98%E8%80%83%E5%89%8D%E7%BB%99%E5%AD%A6%E7%94%9F%E5%92%8C%E5%AE%B6%E9%95%BF%E4%BB%AC%E7%9A%84%E5%BB%BA%E8%AE%AE">232.高考前给学生和家长们的建议</a></li>
<li><a href="#233%E5%A4%A7%E5%AD%A6%E8%80%83%E8%AF%95%E7%A7%98%E7%B1%8D">233.大学考试秘籍</a></li>
<li><a href="#236%E6%88%91%E7%9A%84%E6%8A%95%E8%B5%84%E5%8E%9F%E5%88%99">236.我的投资原则</a></li>
<li><a href="#240%E6%80%8E%E6%A0%B7%E7%9C%8B%E5%BE%85%E5%AF%8C%E4%BA%BA%E7%9A%84%E8%B4%A2%E5%AF%8C%E8%81%8A%E8%81%8A%E7%A4%BE%E4%BC%9A%E7%9A%84%E5%85%AC%E5%B9%B3%E6%80%A7">240.怎样看待富人的财富——聊聊社会的公平性</a></li>
<li><a href="#244%E5%87%A1%E4%BA%8B%E9%83%BD%E8%A6%81%E4%B8%93%E6%B3%A8alphago%E7%9A%84%E6%A0%B8%E5%BF%83%E8%8A%AF%E7%89%87tpu%E8%A7%A3%E6%9E%90">244.凡事都要专注——AlphaGo的核心芯片TPU解析</a></li>
<li><a href="#247%E5%81%9A%E4%BA%8B%E5%89%8D%E4%B8%8D%E8%A6%81%E8%BF%87%E5%88%86%E7%AE%97%E6%A6%82%E7%8E%87">247.做事前不要过分算概率</a></li>
<li><a href="#248%E9%AB%98%E4%B8%AD%E6%AF%95%E4%B8%9A%E7%94%9F%E6%9A%91%E6%9C%9F%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%80%E4%B9%88">248.高中毕业生暑期可以做什么？</a></li>
<li><a href="#%E5%9B%BE%E4%B9%A6%E6%8E%A8%E8%8D%90">图书推荐</a>

<ul>
<li><a href="#249%E6%88%91%E7%BB%99%E4%B8%AD%E5%AD%A6%E7%94%9F%E7%9A%84%E4%B9%A6%E5%8D%95">249.我给中学生的书单</a></li>
<li><a href="#290%E7%BB%99%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%9A%84%E4%B9%A6%E5%8D%95%E4%B8%AD%E4%B8%8B">290.给大学生的书单（中、下）</a></li>
</ul>
</li>
<li><a href="#255%E5%A1%AB%E6%8A%A5%E9%AB%98%E8%80%83%E5%BF%97%E6%84%BF%E7%9A%84%E5%BB%BA%E8%AE%AE%E4%B8%8A%E8%80%83%E8%99%91%E7%9A%84%E5%9B%A0%E7%B4%A0">255.填报高考志愿的建议（上）：考虑的因素</a></li>
<li><a href="#256%E5%A1%AB%E6%8A%A5%E9%AB%98%E8%80%83%E5%BF%97%E6%84%BF%E7%9A%84%E5%BB%BA%E8%AE%AE%E4%B8%8B%E9%80%89%E6%8B%A9%E4%B8%93%E4%B8%9A%E7%9A%84%E5%8E%9F%E5%88%99">256.填报高考志愿的建议（下）：选择专业的原则</a></li>
<li><a href="#258%E8%AE%AD%E7%BB%83%E5%A5%BD%E7%9A%84%E6%80%9D%E7%BB%B4%E6%96%B9%E5%BC%8F%E8%AF%81%E4%BC%AA%E6%AF%94%E8%AF%81%E5%AE%9E%E6%9B%B4%E9%87%8D%E8%A6%81">258.训练好的<strong>思维方式</strong>——证伪比证实更重要</a></li>
<li><a href="#259-261-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%BF%A1%E6%81%AF%E7%9A%84%E7%9C%9F%E4%BC%AA">259-261 如何判断信息的真伪</a>

<ul>
<li><a href="#259%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E4%BA%BA%E7%9A%84%E8%A7%82%E7%82%B9%E5%88%A4%E5%AE%9A%E5%88%A9%E7%9B%8A%E5%86%B2%E7%AA%81">259.如何判断一个人的观点——判定利益冲突</a></li>
<li><a href="#260%E4%BD%BF%E7%94%A8%E9%80%BB%E8%BE%91%E8%BF%87%E6%BB%A4%E4%BF%A1%E6%81%AF%E5%92%8C%E7%BB%93%E8%AE%BA">260.使用逻辑过滤信息和结论</a></li>
<li><a href="#261%E5%88%A9%E7%94%A8%E6%88%90%E6%9C%AC%E6%80%9D%E7%BB%B4%E8%BF%9B%E8%A1%8C%E5%88%A4%E6%96%AD">261.利用成本思维进行判断</a></li>
</ul>
</li>
<li><a href="#264%E4%B8%80%E4%BD%8D%E8%BE%93%E5%9C%A8%E8%B5%B7%E8%B7%91%E7%BA%BF%E4%B8%8A%E7%9A%84%E7%B2%BE%E7%A5%9E%E5%AF%BC%E5%B8%88">264.一位输在起跑线上的精神导师</a></li>
<li><a href="#265%E6%88%91%E7%9A%84%E7%B2%BE%E7%A5%9E%E5%AF%BC%E5%B8%88%E5%AF%8C%E5%85%B0%E5%85%8B%E6%9E%97">265.我的精神导师富兰克林</a></li>
<li><a href="#267%E6%88%91%E7%9A%84%E7%B2%BE%E7%A5%9E%E5%AF%BC%E5%B8%88%E5%AF%8C%E5%85%B0%E5%85%8B%E6%9E%973%E6%88%90%E5%8A%9F%E4%B9%8B%E9%81%93">267.我的精神导师富兰克林（3）——成功之道</a></li>
<li><a href="#268%E6%88%91%E7%9A%84%E5%87%A0%E4%BD%8D%E6%81%A9%E5%B8%88">268.我的几位恩师</a></li>
<li><a href="#272%E5%9B%BD%E6%B0%91%E7%89%B9%E6%80%A71%E6%97%A5%E6%9C%AC%E4%BA%BA%E4%B8%8A">272.国民特性（1）——日本人（上）</a></li>
<li><a href="#273%E5%9B%BD%E6%B0%91%E7%89%B9%E6%80%A73%E6%97%A5%E6%9C%AC%E4%BA%BA%E4%B8%8B">273.国民特性（3）——日本人（下）</a></li>
<li><a href="#%E7%89%B9%E5%88%AB%E6%9D%A5%E4%BF%A1%E9%87%8D%E9%A2%84%E6%B5%8B%E4%B8%8E%E9%87%8D%E5%8F%8D%E5%BA%94">特别来信——重预测与重反应</a></li>
<li><a href="#279%E8%B7%A8%E7%95%8C%E6%B5%85%E6%9E%90%E4%B8%8B">279.跨界浅析（下）</a></li>
<li><a href="#280%E4%B8%93%E4%B8%9A%E5%92%8C%E4%B8%9A%E4%BD%99%E7%9A%84%E5%8C%BA%E5%88%AB">280.专业和业余的区别</a></li>
<li><a href="#281%E7%BE%8E%E5%9B%BD%E7%9A%84%E6%A0%A1%E5%9B%AD%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%E5%92%8C%E4%B8%AA%E4%BA%BA%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83">281.美国的校园安全问题和个人安全防范</a></li>
<li><a href="#285%E5%AF%B9%E8%AF%9D%E7%8F%AD%E8%B6%85%E5%8B%87%E6%B0%94%E5%92%8C%E6%99%BA%E6%85%A7">285.对话班超：勇气和智慧</a></li>
<li><a href="#294google%E7%BD%91%E9%A1%B5%E6%8E%92%E5%90%8D%E7%AE%97%E6%B3%95%E5%92%8C%E4%BC%A0%E6%92%AD%E6%95%88%E6%9E%9C">294.Google网页排名算法和传播效果</a></li>
<li><a href="#295%E5%A6%82%E4%BD%95%E5%9C%A8%E5%8D%95%E4%BD%8D%E9%87%8C%E8%BF%9B%E8%A1%8C%E6%9C%89%E6%95%88%E7%9A%84%E6%B2%9F%E9%80%9A">295.如何在单位里进行有效的沟通</a></li>
<li><a href="#300%E7%8B%97%E7%9A%84%E4%BC%9A%E8%AE%A1%E9%97%AE%E9%A2%98%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E4%BA%9B%E5%85%AC%E5%8F%B8%E5%81%9A%E4%B8%8D%E6%88%90%E4%BA%8B">300.狗的会计问题：为什么有些公司做不成事</a></li>
<li><a href="#305%E5%A8%B1%E4%B9%90%E8%87%B3%E6%AD%BB%E7%9A%84%E6%97%B6%E4%BB%A3">305.娱乐至死的时代</a></li>
<li><a href="#310%E5%A5%A2%E4%BE%88%E5%93%81%E7%9A%84%E5%85%89%E6%B3%BD6%E4%BC%A0%E5%A5%87%E6%95%85%E4%BA%8B">310奢侈品的光泽（6）：传奇故事</a></li>
<li><a href="#315%E6%AF%94%E7%A9%B7%E6%9B%B4%E5%8F%AF%E6%80%95%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88">315.比穷更可怕的是什么？</a></li>
<li><a href="#320%E7%8A%B9%E5%A4%AA%E4%BA%BA%E7%9A%84%E6%95%99%E8%82%B2%E6%96%B9%E5%BC%8Fchavrusa%E5%92%8C%E8%8B%8F%E6%A0%BC%E6%8B%89%E5%BA%95%E5%AF%B9%E5%8B%87%E6%B0%94%E7%9A%84%E7%9C%8B%E6%B3%95">320.犹太人的教育方式Chavrusa和苏格拉底对勇气的看法</a></li>
<li><a href="#321%E5%92%8C%E4%B8%89%E4%BD%8D%E7%BE%8E%E5%9B%BD%E5%A4%A7%E5%AD%A6%E6%95%99%E6%8E%88%E8%81%8A%E5%A4%A7%E5%AD%A6%E6%95%99%E8%82%B2">321.和三位美国大学教授聊大学教育</a></li>
<li><a href="#327%E5%85%B1%E8%B5%A2%E5%92%8C%E6%AD%A4%E6%B6%88%E5%BD%BC%E9%95%BF%E4%B8%8B%E8%BF%B7%E5%A4%B1%E5%9C%A8%E5%85%A8%E7%90%83%E5%8C%96%E4%B8%AD%E7%9A%84%E8%A5%BF%E6%96%B9%E4%B8%96%E7%95%8C">327.共赢和此消彼长（下）：迷失在全球化中的西方世界</a></li>
<li><a href="#329%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BE%88%E5%A4%9A%E4%BA%BA%E4%BC%9A%E7%9B%B8%E4%BF%A1%E6%B0%B4%E5%8F%98%E6%B2%B9">329.为什么很多人会相信水变油</a></li>
<li><a href="#341%E8%85%90%E8%9A%80%E8%80%85%E7%9A%84%E4%BD%9C%E7%94%A8">341.腐蚀者的作用</a></li>
<li><a href="#342%E5%9C%A8%E5%8D%95%E4%BD%8D%E9%87%8C%E4%BA%94%E7%A7%8D%E5%AE%B9%E6%98%93%E8%A2%AB%E8%85%90%E8%9A%80%E8%80%85%E7%9B%AF%E4%B8%8A%E7%9A%84%E4%BA%BA">342.在单位里五种容易被腐蚀者盯上的人</a></li>
</ul>


<h2>第9封信，VR技术与“第三眼美女”</h2>

<p>第三眼美女。她们可能没有光鲜的外表，但必定有某种美德或者价值。</p>

<p>说道技术，通常都需要到第三代才能够普及，被大众广泛接受，并且较长时间地存在下去。</p>

<ul>
<li>第一阶段 虽然有一个革命性的发明，产品很性感，但是毛病很多</li>
<li>第二阶段 解决了第一阶段大部分问题，但是价格昂贵</li>
<li>第三阶段 解决了价格问题，才能普及到大众</li>
</ul>


<h2>第18封信，期望值最大化原则和它在生活上的应用</h2>

<ol>
<li>高考中足球或百米成绩，就是前面说的收益函数，只要这个函数一确定，整个社会就变成了一个机器学习的系统，期望值最大化方法会自动优化全社会，让足球成绩达到最大值。</li>
<li>与其教育员工，不如设置一个好的收益函数</li>
<li>各物质之间的四种基本作用力：

<ul>
<li>质子和中子通过强核力形成原子核</li>
<li>弱核力保证原子核不要太大</li>
<li>电磁力保证原子核和电子能够形成原子，以及原子可以结合形成各种分子乃至万物</li>
<li>万有引力保证物质能够形成星球</li>
</ul>
</li>
</ol>


<h2>第19封信，有小聪明没有智慧的人</h2>

<p>即便耍小聪明不伤害到公司的利益，也是不要做为好，因为这让一个人变得胸无大志，鼠目寸光。</p>

<h2>第20封信，再谈谈2%和98%的问题</h2>

<ol>
<li>未来的智能时代，受益者可能只有2%的人。

<ul>
<li>很多人没有踏上新技术革命的大潮，落伍了</li>
<li>不同人的思维方式不同，这对个人最终的影响要远远高于智力、学历和家庭因素</li>
</ul>
</li>
<li>公司对干部的培训

<ul>
<li>所有的功劳要给下面的员工</li>
<li><strong>每一个人都要帮助你的老板成功</strong></li>
</ul>
</li>
</ol>


<h2>第21封信，西瓜与芝麻</h2>

<ol>
<li>生活中捡芝麻的行为：

<ol>
<li>为了拿免费的东西打破头</li>
<li>为了省一块钱的出租车钱，在路上多走10分钟</li>
<li>为了抢几块钱的红包，三五分钟就看看微信</li>
<li>为了挣几百块钱的外快，上班偷偷干私活</li>
<li>为了双十一抢货不睡觉</li>
<li>为了一点折扣在网上泡上两小时，或者跑五家店</li>
</ol>
</li>
<li>问题不仅在于时间利用得非常没有效率，还在于他们渐渐习惯于非常低的追求，人一旦心态变得非常低，就很难提升自己、让自己走到越来越高的层次上。</li>
<li>捡西瓜就不能为那些蝇头小利动心，他们需要目光放得长远。</li>
</ol>


<h2>第26封信，便宜的眼泪</h2>

<ol>
<li>松下幸之助：任何好的商业都必须是挣钱的，否则就是对人类的犯罪，因为有限的资源可以用于其它地方。因此，即便是良好的动机，也不能为负作用开脱，更何况动机的好坏是很难判定的</li>
<li>美国在建国之初，那一代国父们都非常担心没有判断力的底层民众的盲从会破坏了民主制度。</li>
</ol>


<h2>第28封信，在美国最有钱的人比什么，兼谈美国的慈善文化</h2>

<p>钱是为了让孩子做所喜欢的事情，而不是炫富和无所事事。</p>

<h2>第29封信，让你的父母成熟起来</h2>

<p>孩子需要和父母主动沟通，将新的思维方式和理念不断传递给父母。</p>

<h2>第30封信，再议林黛玉</h2>

<ol>
<li><p>人有两个天赋，是机器无法取代的。</p>

<ul>
<li>一个是艺术的创造力和想象力</li>
<li>一个是梦想和浪漫的情怀</li>
</ul>
</li>
<li><p>人生不仅要做人（薛宝钗），也要作诗（林黛玉）。</p></li>
</ol>


<h2>第31封信，美国私立中学如何教语文和历史</h2>

<ol>
<li>美国越有社会地位的家庭在孩子身上花的时间越多。</li>
<li>单比数理化，美国孩子是比不过中国的。但是如果看谁学的内容多，中国最好中学的学生就比不过美国同档次的中学生。 我的大女儿在高中不算是最好的学生，但是高中毕业时不仅学完了大学的微积分，而且连线性代数、复变函数和概率论都学了，在生物方面，她学完了大学的神经科学等课程。</li>
<li><strong>中美教育最大的差距在于语言、写作和人文科学上，美国孩子阅读、写作和表达能力要比中国好很多。</strong></li>
<li>历史课。孩子的历史老师强调的是学生必须掌握四个技能，历史问题研究、资料的理解和分析、论文写作，以及最后在台上的表述。美国的历史题常常没有标准答案，只有好的和不好的，符合逻辑的和不符合逻辑的。所谓好的答案，就是从事实出发、符合逻辑的结论。从这个教学方法来看，你会发现它很像自然科学的教学。</li>
<li>英语课。作文题目实际上向孩子们传递了一种价值观。在现代文明社会，需要以理服人，而这个本领，需要从小学起。</li>
<li>一种好的教育是能力和素质的教育。通过每一天的课程（和课外活动），不知不觉地把好的、适合我们当下社会的价值传递给孩子。同时，让孩子在学习每一门课程的时候，通过知识的学习掌握分析问题、独立思考、表达自己观点的能力。</li>
<li>MIT的学生有一个普遍的观点——学什么不重要，关键是跟谁学，因为学的东西早晚会过时，而分析问题，解决问题的本来却可以终身受用。这个类似于刘未鹏讲的重视思维过程，而非结果。</li>
</ol>


<h2>第35封信，硅谷高创会</h2>

<ol>
<li>大部分活动都是靠一些组织者的热情和志愿者无偿的服务举办的，因此一旦热情减退或者志愿者有更重要的事情要做，就很难持续下去
而这家的活动从一开始就。是本着盈利的目的，雇专职的工作人员全职工作，因此能够持久。</li>
<li>免费的事情常常搞不长，也很难保证质量。（这跟李笑来的观点一模一样）</li>
<li>在一个领域中，一个二流的人一辈子再努力，即便在自己的领域里可能也进不了一流的行列。相反，很多一流的人进入另一个领域常常还是一流。这里的差距不在于智力和努力程度，而在于做事情的思想方法。（例子——物理学家兼投资人张首晟）</li>
</ol>


<h2>第50封信，这个世界没有欠你什么</h2>

<ol>
<li>任何社会都是分层的。</li>
<li>对于那些试图在金字塔上爬几个台阶的人来讲，最需要具有的不是抱怨社会的不公平，而是需要付出足够的努力，同时把注意力放到最该关注的事情上去。</li>
<li>这个世界不欠我们任何东西。放弃掉不切实际的幻想，脚踏实地地做点事情，我们的生活才会更好。</li>
</ol>


<h2>第58封信，智能时代的产业特点</h2>

<p>未来时代商业的八字诀——分享、跟踪、合作、众筹</p>

<ul>
<li> 分享经济——滴滴、Uber、Airbnb。在未来分享经济时代，连接比拥有更重要。为什么洗脚不算是分享经济，因为市场规模固定。</li>
<li> 跟踪——IOT、大数据、机器智能以及区块链的广泛使用，未来能够做到跟踪每一次交易，每一个人每一时刻的活动，这会带来无限的商机</li>
<li> 合作——现有产业+新技术=新产业</li>
<li> 众筹经济——通过顾客参与的方式，改变了产品好服务设计、生产和销售的全过程。特斯拉的商业模式就是一个例子。而提前收点钱，到期给商品，不算真正意义上的众筹经济。</li>
</ul>


<h2>第67封信，阿拉斯加日记2：听书分享《做条狗》</h2>

<p><strong>很多时候，不是能力最强的人做成了事情，而是最善于和每一个人处好关系的人把事情办成了。</strong></p>

<h2>第104封信，赵小兰为什么能当上部长——谈谈讲理的方法</h2>

<ol>
<li>她的观点非常旗帜鲜明，没有那种“既要&hellip;&hellip;，又要&hellip;&hellip;”和稀泥的废话逻辑，在批判一些人和大学时毫不避讳。</li>
<li>其次，她一直在肯定和认同对方的观点，但是用事实说明你们的作为违背了你们的观点。</li>
<li>第三，批评别人总是非常委婉，从来没有用“不公”这个词，或者其他表示愤怒的词</li>
<li>第四，她在赞扬亚裔的贡献和所应得的利益时，却一直理直气壮。</li>
</ol>


<p>很多人讲话时的一个毛病：<strong>夸自己时不好意思，批评别人说得很难听而且缺乏根据。</strong></p>

<h2>第105封信，我们靠什么服人1：从日心说的公案说起</h2>

<p>我们的世界需要的不是像布鲁诺那样自认为掌握了真理，然后喋喋不休的批判者，而是需要像伽利略那样拿出证据的建设者。</p>

<h2>第118封信，做生意和管理的秘诀：不给选择</h2>

<ol>
<li>不给选择的一个直接的负面结果可能是永远得不到某些客户，或者在公司无法让100%的员工满意。但这其实没有太大的关系，因为我们都不是神，没有能力让所有人满意。对于那些在心里完全排斥你产品的人来说，他们从来不曾是潜在的客户。</li>
<li>如果一个产品设计者只会非常辛苦地迎合每一个顾客，他的顾客恐怕不会很忠诚。一个管理者如果试图通过给予员工更多的选择取悦于每一个人，效果可能适得其反。</li>
</ol>


<h2>第126封信，拉里佩奇的智慧3：谷歌为什么要拆分</h2>

<ol>
<li>世界上凡事有开始就有终结，有生就有死，生物如此，一个组织也是如此。硅谷公司特点之一就是，不介意公司的死亡，不会刻意去拯救一个衰老的公司，而是把目光往前看，努力寻找下一次机会。</li>
<li>公司真正能够传承的其实也只是基因而已。佩奇比很多企业家聪明的地方在，他首先认同公司最终死掉这件事是常态，在这个前提下，再去考虑如何传承公司的基因和文化，而不是试图维持一个不死的公司。</li>
</ol>


<h2>140.常识、科技和艺术</h2>

<p>什么事情做到50分靠常识，从50分做到90分靠技术，从90分做到100分靠艺术。每一个阶段是不能跳跃的。</p>

<h2>156.朴素是富豪的专利</h2>

<ol>
<li>朴素的穿着或者使用廉价的物品或许仅是富豪们的专利，而我们普通人反而要更在意一点自己的形象。</li>
<li>这些颇有涵养的超级富豪，虽然穿着很朴素，但是没有人会小瞧他们。甚至即便不知道他们是谁，那种难以言表的自信常常让人感到不简单。</li>
</ol>


<h2>160.哈佛和斯坦福商学院传授的精髓</h2>

<ol>
<li>说穿了就是两个词——“玩”和“骗钱”</li>
<li>哈佛要培养的是精英，精英和普通人的差别不完全在于知识的多少，而在于智慧和人脉。智慧需要要和大师们，和高水平的人在一起切磋才能获得。人脉更是需要一个好的同学圈子获得，这样将来你们可以互相提携。因此，来上课是成为精英的必由之路。至于考试，反而倒在其次。</li>
<li>如果在哈佛商学院不会玩，恐怕三分之二的学费是白交了。最好从小培养孩子的特长，否则挤不进那个圈子。</li>
<li>哈佛商学院教给大家的第二个精髓思想就是“用别人的钱挣钱”。老师们总是讲，你自己的钱是留给你安身立命的，你如果想做事情，那么就让别人来掏钱。当然，为了做到这一点，你需要会销售，会把你的产品、你的想法，卖给别人，让别人乐意掏钱。</li>
<li>说得更好听点，可以称为获取资源的能力。“好风凭借力，送我上青天”。</li>
</ol>


<h2>163.运气的重要性</h2>

<ol>
<li>人总是有运气好的时候和不好的时候。人在运气不好的时候，最需要的不是盲目的努力，而是耐心。时间是你的朋友，而时机不是，也就是说耐心是成功的第一要素。</li>
<li>如果一个人能反过来想，在成功时感谢帮助过自己的人，感谢上天安排的命运，在厄运中，坦然自若，认同自己原本的富运不旺，或许容易等到时来运转的时候。在我接触到的真正成功者中，绝大部分都会认同自己不过是运气好而已，而不是过分强调自己的能力和努力。有了对运气的认同，人就会少一些怨气，就能更平和地做事，也就更接近于成功。</li>
<li>既然我们认同了运气的重要性，就不必对自己太苛刻。如果我们有足够的耐心，有好的方法，有持之以恒的努力，或许运气会降临到我们头上。当然你会问，如果这样，运气依然没有来我们怎么办？我在这种情况下总是用约翰.肯尼迪的话安慰自己——“问心无愧是我们唯一稳得的报酬”。</li>
</ol>


<h2>168.对话庄子2：我们是否有自由意志？</h2>

<p>对于反主流观点的书籍，在阅读它们之前，一定要了解主流的观点，否则会误入歧途(走火入魔)。</p>

<h2>173.找一个长期对你好的人，从巴菲特购买苹果股票说起</h2>

<p>在人和人的关系上，本杰明.富兰克林讲过一句非常精辟而富有哲理的话：一个帮助过你的人，比一个你帮助过的人，更愿意帮助你。</p>

<h2>174.人生最重要的投资（上）</h2>

<ol>
<li>容貌靠遗传，而魅力则靠培养 4.永远离不开妈妈或者自己家庭的女生，将来会有问题。</li>
<li>在一个完美的婚姻中，双方都要明白关系的亲密程度和重要性依次是：夫妻>子女>双方父母。</li>
<li>对方的可塑性很重要。能够有一定的柔性，彼此妥协解决问题，相互适应，决定了一个关系能走多远。</li>
</ol>


<h2>180.未来商业的特点（1）：共享经济</h2>

<ol>
<li>商业的本质是为了让人多花钱，而不是省钱。</li>
<li>如果共享经济带来的结果是大家都不去买东西，那么经济一定是萎缩的，这样的生意就发展不起来了。</li>
<li>共享经济的本质是让更多的资源加入到经济活动中，利用新技术提高效率，带来方便，最终让大家多花钱，只有按照这个思路从事共享经济才能成功。</li>
</ol>


<h2>183.未来商业的特点（4）：合作经济</h2>

<ol>
<li>第一次工业革命：原有产业+蒸汽机=新产业</li>
<li>第二次工业革命：原有产业+电=新产业</li>
<li>信息革命：原有产业+计算机（半导体）=新产业</li>
<li>互联网时代：原有产业+互联网=新产业</li>
<li>大数据和机器智能时代：原有产业+机器智能=新产业</li>
</ol>


<h2>189.子女教育（2）：辛苦和痛苦</h2>

<ol>
<li>美国上层社会的父母，在孩子身上花的时间是一点都不少的，孩子读书和参加课外活动可能也会很辛苦，但是他们并不会让孩子很痛苦。辛苦和痛苦是两回事，一定要区分开。</li>
<li>我经常对她(二女儿)讲，不论在学校得了什么坏成绩，都没有关系，只要你告诉爸爸，就是好孩子。</li>
<li>每一个孩子都有好奇的天性，他们有强烈的求知欲望。教育的目的是激发他们的好奇心，引导他们内在欲望，让他们自己自觉地去学习进步。</li>
</ol>


<h2>190.子女教育（3）：兴趣的培养</h2>

<ol>
<li>做课外活动有两个目的：一个是让他们做一些自己喜欢的事情，将来能够热爱生活。另一个是在一些竞技中培养他们的勇气，获得名次，让他们能够有一些在竞争中成功的经验。</li>
<li>家长的任务，就是帮助孩子找到自己的特长。</li>
</ol>


<h2>192.小鲜肉和戏骨：橘子和苹果的对比</h2>

<p>我们相比我们的父辈已经很幸福了，即使有人比我们过得更好，我也不嫉妒，每次想到这里，我都会对生活充满感激，然后去做好自己的事情</p>

<h2>195.中国依然是一个大贾府，自给自足文化根深蒂固。</h2>

<ol>
<li>守诺、妥协、重利，这是商业文明的特点</li>
<li>世界文明有两条主线。一条是以古埃及、古印度和古代中国为轴线的农业文明，后来的法国、德国和前苏联都是沿袭这根主线。另一条是以美索不达米亚、古希腊为代表的商业文明，后来的意大利、荷兰、英国、美国和后来的日本则延续了这条线。</li>
<li>农业文明中，商品交换从来不是文明的主线，自给自足才是。</li>
<li>中国公司之间鲜有诚心诚意的合作，如果不得不合作，大家都希望是独家合作，因为这样就觉得自己有了控制权，有了控制权，就又有了自给自足的安全感。这不是谁好不好合作的问题，而是自给自足文化的结果。</li>
</ol>


<h2>197.晴雯的悲剧</h2>

<ol>
<li>几年前，马化腾和刘炽平有一次当面请教柳传志如何避免事业上的“坑”，柳老只讲了两个要注意的地方，一个是不要和政府作对，另一个是要善待下面的人</li>
<li>人要为自己的不懂事承担后果。年轻人要在大学里尽快成熟起来，成为一个社会人。</li>
</ol>


<h2>201.谷歌小时候的故事：给初创公司创始人的建议</h2>

<p>小公司的创始人应该做什么？</p>

<ol>
<li>第一件事就是招人。小公司招人的一个重要的原则，就是对方除了能力和品行能够胜任工作之外，还必须具有非常强的<strong>主动性</strong>。</li>
<li>第二件事是起到刹车的作用，而不是引擎的作用 一个管理有序的公司，动力应该来自于底层，刹车来自于高层。</li>
<li>第三件事情是确立公司的价值观和企业文化。</li>
</ol>


<h2>204.没有什么下半场</h2>

<p>当大家投资都不理性时，你的机会就来了，当大家都在做表明文章时，你晋升的机会就到了。同样，当大家都在炒作概念时，就给予你使用新思维改变一个现有产业的机会。</p>

<h2>205.香农第二定理：带宽决定生意大小</h2>

<ol>
<li>香农用熵的概念将信息量化后，也从理论上给出了无线电两个频率之间能够传输的信息速率上限，这个上限被称为带宽。香农指出，如果传输信息的速率不超过这个带宽，你总能找到一个方法，让这些信息都传出去而且不出错，但是如果传输的速率达到或者超过带宽，不论你用什么样的编码方法，信息传输的错误率一定是100%。这就是香农第二定理。</li>
<li>有多少人脉做多大生意，这个人脉其实就是带宽。</li>
<li>互联网思维，其本质就是控制带宽和利用带宽。</li>
<li>我们今天做任何事情，都要努力扩展带宽，因为根据香农的理论，带宽永远是通信量的瓶颈。</li>
</ol>


<h2>208.职场上的四个误区和四个做法</h2>

<ol>
<li>四个误区

<ol>
<li>把自己当做一个单位的过客，而不是主人。 人一旦觉得自己是过客，常常就对很多工作视而不见，也懒得维护与同事的关系。</li>
<li>被语言暴力所激怒，然后乱了章法。 语言暴力：总有一些同事包括上级，没缘由地责备你、批评你的工作，但却不给出具体的问题和由建设性的建议，更不是真心帮助你。 一旦判断清楚对方是语言暴力，我们不为所动，一方面继续我们的工作，另一方面要让施暴者有个交代（明确指出，要让他们知道自己做错了事）。对于老手，不要轻易反击，要化解，等事情过后，通过正常渠道让他们知道你已识破，让他今后做事有所顾忌。</li>
<li>疏于沟通。 大部分时候，提前打招呼总是一个好的、职业的做事方式。</li>
</ol>
</li>
<li>四个做法

<ol>
<li>首先，任何时候人都要谦卑 只有谦卑的时候自己才能更有效地沟通，也只有这样，当别人表达意见时，才能集中注意力在事情上，从各种角度去理解 不能因为态度谦卑就不发表意见和看法，<strong>一个谦卑却又能把事情分析得入木三分的人，最让人钦佩</strong>。</li>
<li>第二，要用正确的方法对待语言暴力和其它的不公平，这里我是指那些故意伤害你的人。在沟通中保持对别人的尊重，但是态度要坚决明确。 你要坚守住自己的正确的立场，不带个人色彩，聚焦事情本身来解决问题。</li>
<li>第三，永远要明确工作不是为了公司或者他人，而是<strong>为了自己职业发展这个大方向</strong>。</li>
</ol>
</li>
</ol>


<h2>209.职业员工和管理者要注意的两件事</h2>

<ol>
<li>作为开发（视频）这个产品的工程师，虽然老板没有要求他了解变现和广告的情况，但是作为这个行业的从业者，多少有一点销售上的知识是必须的。</li>
<li>最有效的沟通是在第一时间直接给出答案，然后补充解释。</li>
<li>基层的员工要抬头看，管理者要弯下腰。</li>
</ol>


<h2>211.面试的技巧（下）：让对方了解你的价值</h2>

<ol>
<li>谈薪酬: 对于有经验的求职者，要把重点放在谈判职级上，不要放在谈判薪酬上。</li>
<li>用市场的价格，而不是用人单位里锚定的价格作为谈判一句。</li>
</ol>


<h2>214.2017年十大科技突破点评</h2>

<p>个人比较看好:</p>

<ol>
<li>刷脸支付</li>
<li>基因疗法</li>
<li>强化学习</li>
<li>治疗瘫痪</li>
<li>细胞图谱</li>
<li>自动驾驶汽车</li>
</ol>


<p>不仅因为它们的技术相对成熟，更因为对世界的影响力巨大。</p>

<h2>215.最好是更好的敌人</h2>

<ol>
<li>虽然我们一直在说要追求卓越，要实现最后的10%，但是这并不意味着我们不可以接受部分的改进。很多时候，一个完美的结果需要很多的改进才能实现，而不是一步到位。</li>
<li>在信息时代，最有效的工作方式是<strong>保证每一次比先前更好，且能做到持续不断的进步，而不是为了追求最好，把工作的周期拖得无限长</strong>。</li>
<li><strong>这个世界本身就不是完美的</strong>，认识到这一点，我们在生活和工作就不会为了最后的一点点工作而永远无法将它们做完。</li>
<li>做事情不怕慢，就怕停。</li>
</ol>


<h2>216.有没有更好的办法？</h2>

<ol>
<li>著名的机器翻译和人工智能专家弗朗茨奥科博士。人类长寿公司、Grail（杰夫胡贝尔Jeff Huber）</li>
<li>2016，胡贝尔在母校伊利诺伊大学香槟分校毕业典礼上做了主题讲话。胡贝尔告诉所有的毕业生，不论遇到什么不尽人意的事情，不要抱怨，要主动去想是否有更好的方法，然后行动起来。</li>
<li>Grail公司的核心：大数据+机器智能+基因测序和分析</li>
<li>投资就是投人，一个公司的成败在很大程度上取决于里面的人做事情有多么地积极主动。</li>
</ol>


<h2>218.生命的无奈</h2>

<ol>
<li><p>很多时候，我们逃不出命运的安排。随着年龄的增长，我基本上从两个方面接受了命运的这种安排。</p>

<ul>
<li>首先，人生总是有不如意的事情。当我们能够坦然接受很多结果时，我们的心态就会变得平和，而不是焦虑。</li>
<li>其次，我们所能做的，就是把握当下，把今天的事情赶快完成。其实很多时候没有下一次，甚至明天也是靠不住的。</li>
</ul>
</li>
<li><p>我常常建议身边的朋友在繁忙的工作之余，偶尔停下脚步，看看风景。</p></li>
<li>为了尽可能少一些这样的烦恼，我才会专门放下手上的工作，花很多钱，跑到很远的地方去听一场音乐会，吃一顿饭，看一幅绘画，或者拍几张照片。我一直告诉自己，要过一种从容而优雅的生活。</li>
<li>工作总是没有终止的时候，很难静下心来看风景。其实这是一个心态，也是一个选择的问题，我们可能要选择放弃掉一些事情。</li>
</ol>


<h2>219.阅读的意义</h2>

<ol>
<li>一种恐惧：生怕自己错过什么。</li>
<li>阅读不仅仅是为了让我们在冷酷无情的科技时代获得喘息，让我们重启大脑<strong>深入思考</strong>的功能，也是抵抗狭隘、思想控制和舆论支配的方式。</li>
<li>牛津大学圣埃德蒙（13世纪的坎特伯雷大主教）的一句话：“Study as if you were to live forever, live as if you were to die tomorrow”</li>
</ol>


<h2>222.曼施坦因和专利</h2>

<ol>
<li>曼施坦因提出了一个新的战术思想，他认为只要进攻足够快，就不需要防御侧翼和后方，因为<strong>进攻是最好的防守</strong>，这就是闪电战的理论根据。</li>
<li>专利真正的作用：它其实不是进攻的工具，而是防守的工具。</li>
<li>当一个公司能够靠创造力快速发展时，它会比竞争对手更快地将技术变成产品，别人就算抄它的技术，也只能跟在屁股后面，这时它会懒得申请专利，甚至也顾不上申请专利。 当一个公司的业务发展开始出现停滞时，它就需要用专利保护它的侧翼和后翼了。</li>
<li>对于小公司，进攻是最好的防守，创造力和执行力才是最重要的。对于人，不要纠结于过去的得失，提高执行力，不断开拓新的事业才是正道。</li>
</ol>


<h2>225.没有悬念的比赛——柯洁对阵AlphaGo</h2>

<p>要用发展以及寻找机会的眼光来看待科技进步。当一个行业出现巨大的技术飞跃时，原来的平衡必将被打破，虽然我们很多人不愿意，但是比较明智的选择时<strong>接受这个现实，然后在新的常态下找到自己的位置</strong>。</p>

<h2>232.高考前给学生和家长们的建议</h2>

<ol>
<li>首先是“认命”。目前还有一周的时间，如果你高中三年都没有学会的东西，不要指望这一周能学会。最后这一周，不是你复习功课的时间。 这种抓紧搞懂一些不会内容的贪欲，会让自己产生不切实际的希望，以至于本来该得到的反而得不到了。</li>
<li>要保持热度。比赛和考试这类的事情是需要一些兴奋程度的。因此，最后几天该怎么过还怎么过，可以看书，但是心里要明白看书的目的不是长知识，而是维持一种自己习惯的生活方式。参加运动比赛应该也是一样的道理。</li>
</ol>


<h2>233.大学考试秘籍</h2>

<ol>
<li>平时的期末考试，特别是大学的考试，最后一周必须努力，非常重要。这是它们和高考最大的不同。</li>
<li>学会总结一门课程的支撑知识点和主线。

<ol>
<li>微积分：建立在无穷小、（函数的）连续性、极限等基础上的，没有它们整个微积分的大厦就坍塌了。 接下来，就是它的主线，基本上是导数、微分和积分三部分，当然，它们派生出一大堆东西。</li>
<li>计算机系统结构，它的基础是“3+1”。所谓3，不过是计算机的指令集和相应的实现方法，存储、中断和设备管理，1则是量化的性能评估。 主线就是所谓的处理器里面的流水线，今天又加了三个，即多线程的并行处理，以GPU为代表的矢量计算，以及云计算级别的并行计算。</li>
</ol>
</li>
<li>稍微聪明一点的老板都懂得，<strong>能够做到100分的人，和做到95分的人，水平差的可不是一点两点，而是很多</strong>。因为做到100分和考100分，是靠硬实力，而做到95分，是有很多技巧的，而且能够投机取巧。</li>
</ol>


<h2>236.我的投资原则</h2>

<ol>
<li>投资原则：

<ol>
<li>凡是靠政府补贴才能维持的行业我是不会投资的</li>
<li>挣钱效率低的不投资</li>
<li>参与者不能几方共赢的不投，因为这种事情不能持久。</li>
</ol>
</li>
<li>稍微变通一下，这些投资原则就是做事的原则了：

<ol>
<li>没有好处的事情不做</li>
<li>效率不高的事情不做</li>
<li>损人利己的事情不做。</li>
</ol>
</li>
</ol>


<h2>240.怎样看待富人的财富——聊聊社会的公平性</h2>

<ol>
<li>把富人的钱拿出一部分（甚至大部分）分给穷人，如果穷人没有发展的机会，他们的生活依然是没有前途的，是灰暗的。</li>
<li>富人钱哪里去了？除了少数给他和他的家人花掉了，大部分都是投入到了再生产。也就是<strong>富人钱，实际上是一种社会财富</strong>。总体来讲他们的投资效率更高。</li>
<li><strong>维护社会的公平性，关键在于给人平等的机会，而不是同样的收入。</strong>怎样给人平等机会呢？这个问题非常复杂，但是有一件事必须做，就是限制超级权力。</li>
<li>垄断最大的危害，是妨碍了社会的公平性，让大多数人没有了机会。 今天中国的一些大型的民营企业，其实已经扮演当年洛克菲勒的角色了，而大部分人对此浑然不知。</li>
<li>总结一下美国的经验就是，做到<strong>社会公平在于限制超级权力，而不是平分社会财富</strong>。 中国也在朝这份方向努力。</li>
</ol>


<h2>244.凡事都要专注——AlphaGo的核心芯片TPU解析</h2>

<ol>
<li>CPU的计算速度之所以不够快，是因为它被设计成能够适应所有的计算，里面很多晶体管都用来搭建控制电路。</li>
<li>GPU：有一种计算相对单一，就是控制显示器的图形计算，于是英伟达就为这一类计算专门设计了一种处理器，即GPU。</li>
<li>TPU：机器学习中的向量计算和通用的向量计算还是有所不同，能否让计算的内核功能再专一点，只做和一种特定的机器学习算法（即Google的人工神经网络算法）相关的向量计算。 Google提出了一种张量（Tensor）计算的概念。Google在英伟达等公司GPU的基础上，进一步让计算变得专注，设计了一种仅仅针对张量计算的处理器，即TPU（T就是张量Tensor）。</li>
<li>人在社会中，什么技能用的最多，要用的时间最长？

<ol>
<li>一个是和人打交道的技能，这个值得花时间练习好</li>
<li>一个好的思维方式，这个要用一辈子而且在各种场合都很重要，也值得好好培养</li>
</ol>
</li>
</ol>


<h2>247.做事前不要过分算概率</h2>

<ol>
<li>在丁肇中教授眼里，只有毫无希望和存在期望的事情，而不能以希望的概率去决定某件事情做还是不做。</li>
<li>世界上什么事情做到最好的前5%的人，都是兴趣使然，因为他们做事的时候能够不在乎失败，即使是很小的成功概率，也会去追求。做到前20%-%5的人，常常是利益驱动，因为他们会知难而退。</li>
<li><strong>人太精明了，就不聪明了</strong>。对于年轻人，千万不要过早地太精明</li>
</ol>


<h2>248.高中毕业生暑期可以做什么？</h2>

<p>高中这个阶段过去了，时光不会再回来。在这个时间点，要做的第一件事就是去对一些人表达感恩。在过去十七八年的时间里，很多人帮助过我们，没有他们，我们可能过得不如今天好，在离开过去的生活之前，先要及时明确地感谢他们，特别是对老师们。</p>

<p>现实生活中，“有机会”的真实含义是“没有机会”，“以后”这一天直到死可能也不会到来。 一个不知道感恩的人，上帝是不会垂青两次的。</p>

<h2>图书推荐</h2>

<h3>249.我给中学生的书单</h3>

<ol>
<li><p>文学类（18本）</p>

<ul>
<li>金庸和琼瑶各一本，长篇比短篇的好</li>
<li>鲁迅的《呐喊》</li>
<li>《红楼梦》</li>
<li>雨果《悲惨世界》</li>
<li>罗曼罗兰《贝多芬传》</li>
<li>乔治奥威尔《1984》</li>
<li>歌德《少年维特的烦恼》</li>
<li>贾平凹的小说。《秦腔》和《古炉》</li>
<li>夏洛蒂勃朗特《简爱》</li>
<li>司汤达《红与黑》</li>
<li>简奥斯丁《傲慢与偏见》</li>
<li>莎士比亚《哈姆雷特》</li>
<li>富兰克林《富兰克林自传》</li>
<li>木心《文学回忆录》</li>
<li>《古文观止》和《唐诗三百首》</li>
<li>菲茨杰拉德《伟大的盖茨比》，读英文原文</li>
<li>钱钟书《围城》</li>
</ul>
</li>
<li><p>历史类（4本）</p>

<ul>
<li>傅高义《邓小平时代》</li>
<li>基辛格《论中国》</li>
<li>房龙，任何书均可，比如《人类的故事》</li>
<li>茨威格《人类的群星闪耀时》</li>
</ul>
</li>
<li><p>哲学类（3本）</p>

<ul>
<li>培根《培根随笔》</li>
<li>罗素《西方哲学史》</li>
<li>叔本华《人生智慧录》</li>
</ul>
</li>
<li><p>思维类（1本）</p>

<ul>
<li>万维钢《万万没想到》</li>
</ul>
</li>
<li><p>科学类（3本）</p>

<ul>
<li>霍金《时间简史》</li>
<li>伽莫夫《从一到无穷大》</li>
<li>温伯格《给世界的答案》</li>
</ul>
</li>
<li><p>经济类（1本）</p>

<ul>
<li>戈登《伟大的博弈：华尔街金融帝国的崛起》</li>
</ul>
</li>
</ol>


<p>其实还有很多好书，甚至更好的书，它们或者不急于在上大学前读完，或者需要一些背景知识，比如《史记》、《神曲》、《领袖们》、《漫步华尔街》等，因此都没有列入。</p>

<h3>290.给大学生的书单（中、下）</h3>

<p>第三类、西方文学</p>

<ol>
<li>《莎士比亚悲剧四种》 《哈姆雷特》 《李尔王》——听信谗言的糊涂老爸的悲剧 《奥赛罗》——嫉妒心强的丈夫导致的夫妻悲剧 《麦克白》——贪图权利的邪恶女人犯罪直到自己疯狂</li>
<li>《浮士德》——德意志民族的史诗</li>
<li>《呼啸山庄》——用对比的手法揭示了美与丑，善与恶，爱情与复仇，生命与死亡的对立。</li>
<li>《远大前程》——报恩与阴谋的故事 狄更斯是批评现实主义的作家，他的很多小说都值得阅读，包括《大卫科波菲尔》、《双城记》、《雾都孤儿》</li>
<li>《名利场》——萨克雷讲述了原本出生经历相同的两个女子所选择的不同道路，不同的人生，和不同的结果。</li>
<li>《福尔摩斯探案集》</li>
<li>《巴黎圣母院》</li>
<li>《战争与和平》——俄罗斯民族的史诗</li>
<li>《永别了，武器》、《丧钟为谁而鸣》、《老人与海》 硬汉海明威的这三本书都应该读</li>
</ol>


<p>第四类、传记</p>

<ol>
<li>《领袖们》——尼克松所接触到的领袖们从丘吉尔开始，一直到李光耀、毛泽东等人。</li>
<li>《巨人三传》——罗曼罗兰</li>
<li>《昨日的世界》——茨威格</li>
<li>《西行漫记》——美国记者斯诺将长征之后到了陕北的那群革命者介绍给了世界</li>
<li>《梵高传》——欧文斯通的成名作</li>
</ol>


<p>第五类、经济</p>

<ol>
<li>《国富论》——经济学鼻祖亚当斯密告诉我们什么是资本主义，什么是市场经济。</li>
<li>《漫步华尔街》——应该作为投资的科普读物。，任何人进入股市之前都应该读。作者马尔基儿的观点是，股市的总体走势是向上的，而短期的走势却是难以预测的。因此，最好的投资方式就是选定好的指数基金定投。</li>
<li>《通往奴役之路》——自由派经济学家哈耶克。经济学上的奥地利经济学派和芝加哥经济学派，哈耶克是奥地利经济学派的代表人物。哈耶克认为计划经济，其无意识的后果必然是极权主义，必将带领人类通往奴役。<strong>哈耶克从理论上再次论证了尊重市场规律的必要性，而所谓的福利社会不过是一个伟大的乌托邦而已。</strong></li>
</ol>


<p>第六类、科普读物</p>

<ol>
<li>《自私的基因》——新达尔文主义者道金斯的代表作。作者认为，进化的本质是基因的进化，而物种的进化只是表象而已。生物的本能是维护基因的繁衍，因此我们其实都是基因的奴隶。</li>
<li>《人类基因的历史地图》</li>
<li>《数学之美》</li>
<li>《生命是什么》——物理学大师埃尔文薛定谔。既介绍了生命的物理学基础（作者对当时最新的物理学和生物学的理解），也介绍了生物系统和世界任何系统之间的贡献。</li>
</ol>


<p>第七类、思维</p>

<ol>
<li>《异类》——成功靠的不是智商，而是10000小时的努力，<strong>见识对孩子成长很重要</strong>。</li>
</ol>


<h2>255.填报高考志愿的建议（上）：考虑的因素</h2>

<ol>
<li>将要考虑的因素按照城市、学校和专业归类。而这三类因素中，城市 > 大学 > 专业。当然这个前提是考生无法兼顾这三者。</li>
<li>身处底层的人要完成到中产阶级的进阶，需要先掌握技能，就是这个道理。而中产阶级到精英阶层的进阶，则需要很多博雅教育。</li>
</ol>


<h2>256.填报高考志愿的建议（下）：选择专业的原则</h2>

<ol>
<li><p>选择专业要考虑的几个因素应该是：</p>

<ul>
<li>国家层面的大机会</li>
<li>个人的特长和兴趣</li>
<li>专业的变迁和未来行业的机会</li>
</ul>
</li>
<li><p>今天中国最大的机会在哪里？我认为是国际化。 资本输出，也就是说帮助其他国家富裕起来，让人家买得起我们的东西。 中国在这个时期提出“一带一路”，要搞亚投行，核心就是资本的输出和帮助全世界。这是当年英国、美国和日本都走通了的道路。 在这样的大背景下，中国需要什么人才呢？不再是只能在国内窝里横的人了，而是具有国际视野，能够为国家开拓海外市场的人。</p></li>
<li><p>专业选择原则</p>

<ul>
<li>要优先考虑高势能的专业。就是指那些相对难学，而又相对是其他专业的基础的专业。比如数学专业相对计算机专业和商学就是高势能。</li>
<li>不要一窝蜂地挤进那些过热的新兴专业，尤其是学校为了跟风刚刚开设的。</li>
<li>如果将来从事数学和物理学研究，是需要极高的天赋的。选这两个专业，打好基础后，将来是一定要转行的。在麻省理工，这些专业的毕业生大部分是进入医学院和法学院，而直接参加工作的毕业生，大部分去了华尔街，真正搞数学和物理的很少。 选择专业时，还要考虑未来产业的变迁，那些会不断萎缩的行业最好避免。今天人类已经到了智能时代，这是一个大趋势。</li>
</ul>
</li>
</ol>


<p>257.过度解读：英国靠老处女称霸世界
1.一个好的思维方式绝对可以有很多的帮助，而坏的思维方式总是会让人们陷入一种难以自拔的困境。 2.今天互联网时代，很多哗众取宠的人都本着一个语不惊人死不休的原则，一定要把毫不相干的东西，通过非常弱的联系，甚至再编造点事实联系起来，这样好让大家留下深刻印象。 3.好的思维方式都有一个共同点，就是“以正合，以奇胜”。 意思是排兵要以堂堂正正之师正规地交战，最后靠多余的军队取胜。 也即大部分时候要抓住根本，不要热衷于旁门左道。 比如对于一件事情，我们先要了解主流的观点，这样我们就有了做事情的根本，然后可以通过积累一步步前进。不要为了一开始就为了求新，求奇去接受那些非主流的看法，那样我们做事会有非常大的随意性，最后的结果就是狗熊掰棒子——掰一个扔一个。 4.《孙子兵法》，孙子是一个非常讲规矩的人，并不是贪巧求速的人。事实上，从《孙子兵法》诞生至今，那些靠所谓奇袭得胜的战例其实是很少的，就那么几例。</p>

<h2>258.训练好的<strong>思维方式</strong>——证伪比证实更重要</h2>

<ol>
<li>为什么在科学和现实生活里，证伪的思维总是比证实更重要呢？因为对于一个现象，我们总可以找到一个能自洽的理论解释它，然后找到几个例子证明我们的解释。</li>
<li>在生活和工作中，如果我们把错误的原因当成了真正的原因，我们就会走错路，倒霉的是我们自己。</li>
<li><strong>不能拿一个无法证伪的事情当做真理。</strong> 导致一件事情成功的原因非常多，可以有很多解释，不是任何一个能够自洽的解释我们都要相信。很多哗众取宠的人，故意找出很多与众不同，又能自洽的解释，以博得大家的关注，但是，它们未必是真正的原因。</li>
<li>常识很重要，因为它经过了很长时间被证实和证伪。 科学和技术很重要，因为它们有可重复性。 <strong>我在思维上，宁可相信常识和经过无数次检验的正统理论，也不轻易接受看似能够自洽的与众不同的解释。</strong>——“以正合，以奇胜”。</li>
</ol>


<h2>259-261 如何判断信息的真伪</h2>

<h3>259.如何判断一个人的观点——判定利益冲突</h3>

<p>从<strong>利益冲突</strong>的角度，很容易判断一些话的准确性。</p>

<h3>260.使用逻辑过滤信息和结论</h3>

<p>使用逻辑，就很容易判断一种说法是否靠谱。</p>

<h3>261.利用成本思维进行判断</h3>

<p><strong>成本</strong>是我们在做几乎任何事情时都难以避免的一个重要因素，因此，那它作为一把尺子考量人们想法和做法的初衷，是非常有效的。</p>

<h2>264.一位输在起跑线上的精神导师</h2>

<ol>
<li>如果说人工智能的成就都是在数据驱动这个方法的指导下取得的，而贾里尼克（Frederek Jelinek）就是提出这个方法的祖师爷。</li>
<li><p>几个观点</p>

<ul>
<li>小学生和中学生其实没有必要花那么多时间读书，而他们的社会经验、生活能力以及在那时树立起的志向将帮助他们一生。</li>
<li>中学阶段花很多时间比同班多读的课程，在大学以后用非常短的时间就可以读完，因为在大学阶段，人的理解能力要强得多。</li>
<li>学习（和教育）是一个人一辈子的过程，很多中学成绩好的亚裔学生进入名校后表现不如那些因为兴趣而读书的美国同学，因为前者不断读书的动力不足。</li>
<li>书本的内容可以早学，也可以晚学，但是错过了成长阶段却是无法弥补回来的。</li>
</ul>
</li>
</ol>


<h2>265.我的精神导师富兰克林</h2>

<p>富兰克林为自己指定的13条美德：</p>

<ol>
<li>节制：食不过饱，酒不过量</li>
<li>慎言：只讲对人对己有益之言，不说无聊琐碎的话</li>
<li>条理：让拥有的每件东西各有其位，让要做的每件事情都各有其时</li>
<li>坚毅：一旦决定做一件事，就马上义无反顾地去做</li>
<li>节俭：将钱用在于人于己有益的事情上，杜绝浪费</li>
<li>勤奋：不耽误任何事情，总是干有用的事情，终止不必要的行为</li>
<li>真诚：不采用任何有害的欺骗行为，想问题和说话都要公平公正</li>
<li>正直：绝对不做损人利己之事</li>
<li>适度：避免极端，避免别人对你产生怨恨</li>
<li>清洁：决不允许身体、服装和居所不洁</li>
<li>心静：不为琐碎之事、寻常之事，和不可避免之事萦绕</li>
<li>贞洁：不过度行房事，也不因男女关系损害和他人的关系</li>
<li>谦卑：以耶稣和苏格拉底为楷模。 富兰克林发现，那些抢功劳的人，虽然看上去抢到了一些功劳，但是他人常常自有看法，甚至他人的嫉妒也会让这些人倒霉。而他不抢功劳，反而成为受益者。</li>
</ol>


<p>把节制放在第一位，是因为节制有助于保持头脑清醒，这样可以帮助获得其他美德。</p>

<h2>267.我的精神导师富兰克林（3）——成功之道</h2>

<ol>
<li>巴菲特讲，<strong>钱是为了让人做想做的事情，而不是无所事事。</strong></li>
<li>保守主义者更关心我们周围的事情，而不是世界大事，同时保守主义者会用行动改变周围的环境，富兰克林就是这样的人。</li>
</ol>


<h2>268.我的几位恩师</h2>

<p>给年轻人的几个建议：</p>

<ol>
<li>选择一个好的学习和工作环境很重要，看看那个组织里的每一个人能够教给你什么。</li>
<li>除了专业，还有很多能力需要锻炼，如果能得到前辈在这些方面的指导，将受益终身。</li>
<li>大部分时候不会一帆风顺。有些时候，很多偶然性事件可以改变我们的命运，但是无论遇到什么事情，都不要抱怨。</li>
<li>很多努力，如果方向是对的，最终会得到补偿。在任何领域，如果没有最精深的了解和过人之处，就难以做到一流。做不到一流，最终是辛苦一辈子。</li>
</ol>


<h2>272.国民特性（1）——日本人（上）</h2>

<p><strong>今天会英语就如同会开车，只是一种简单的生活技能，而不是职业特长。</strong></p>

<h2>273.国民特性（3）——日本人（下）</h2>

<ol>
<li>日本国民特性：

<ol>
<li>极好面子。日本人虽然比较诚实，但是做错的事情也喜欢遮遮掩掩，这要是他们把面子看得极重。</li>
<li>“残忍”天性。 日本文化对弱者缺乏同情。</li>
<li>并不幸福的日本男人。日本女人结婚后通常不工作，就在家相夫教子。掌握家里一项大权，就是财权。</li>
<li>享受衰退。有了衰退，物价、房价不再上涨，生活压力小了。因为有了衰退，工作不再忙碌，大家可以比较悠闲地享受生活。因为有了衰退，外来人口减少，环境变得更好，社会比较安定。</li>
</ol>
</li>
<li>在很多方面，中国人其实和美国人比较相似，和日本人反而差别很大。</li>
</ol>


<h2>特别来信——重预测与重反应</h2>

<p>世界上很多事情其实是没法预测的，把希望寄托在正确预测上是缘木求鱼。因此，真正善于投资和办公司的人都是善于做出正确反应的人，而不是预言家。</p>

<h2>279.跨界浅析（下）</h2>

<ol>
<li>跨界是结果，并不是最初的目的。</li>
<li>跨界是有必要性的，特别是对于突破性的创新。这里面的原因有很多，但是最重要的有两条。

<ol>
<li>一个领域内的人常常囿于过去的思维定式，很难突破成功。</li>
<li>重大的突破常常需要引入外来的技术，因此只有跨界的人有这些优势。</li>
</ol>
</li>
<li>什么样的人适合跨界，或者说容易跨界成功？当然，这个人需要已经在某个领域甚至几个领域比较成功，而且比较有适应性等等，不过根据我自己的体会，还有四个不能忽略的细节常常被忽略掉。

<ol>
<li>跨界的人通常在原有的专业或行业已经获得了成功。</li>
<li>过硬的专业知识。</li>
<li>跨界成功的这些人常常有一些天赋，只是他们过去没有发现自己这方面的天赋而已。</li>
<li>跨界者的思想都是非常开放的，他们愿意接受新东西，新思维。</li>
</ol>
</li>
<li>除了上述主观因素，跨界成功还需要一些特定的条件。

<ol>
<li>贵人相助</li>
<li>契机</li>
</ol>
</li>
<li>怎么做比较容易跨界？

<ol>
<li>通常比较成功的跨界是<strong>艺术和技术的结合</strong></li>
<li><strong>高势能到低势能</strong>的跨界比较容易</li>
<li>想要跨界，最简单的办法就是<strong>系统地</strong>去学习新知识，不能像民间科学家那样自己摸索。</li>
</ol>
</li>
</ol>


<h2>280.专业和业余的区别</h2>

<ol>
<li>职业选手能很好地控制自己的情绪，不会因为打了一个坏球而输掉整场比赛，也不会因为打出一个好球而得意，而业余选手打坏一个球会怨天尤人，接连几个球都打不好。而打出一个好球，会得意忘形，接下来可能会放松，并失去领先的优势。</li>
<li>专业素养：

<ol>
<li>好的专业人士要在任何情况下为工作本身着想，他们不会因为看到患者是个瘾君子，态度就和对待一个社会名士有所不同，也不会因为最近自己的一些家庭变故影响自己的工作</li>
<li>专业素养意味着遵守流程和行业规范</li>
</ol>
</li>
<li>是否有专业素养体现在是否愿意花功夫寻找更好的答案，而不是交差了事。</li>
<li>专业人士常常有完整的领域知识，或者说掌握了成体系的知识，而业余人士只掌握了一些知识点。前者因此具有分析问题，解决未知问题的能力，后者常常只能应用所知的一些知识。</li>
<li>具有专业素养的人都是在动态中进步的。无论是工程师、医生还是会计师，一流的从业者都是不断学习和进步的。</li>
<li>跨界：首先在自己熟悉的领域培养好专业素养，有了好的习惯，就容易有好的结果；接下来，要在新的领域获得专业的知识和技能，并遵循专业的步骤去做事情。</li>
</ol>


<h2>281.美国的校园安全问题和个人安全防范</h2>

<ol>
<li>任何时候都要有防范心理。最大的危险是不知道危险的存在，而意识到危险，出事的可能性就已经小了很多。</li>
<li>关于安全防范的战术 遇到罪犯怎么办？

<ol>
<li>在美国的大学里，校警<strong>不建议反抗，建议逃跑</strong>，而且要蛇形逃跑，以防止对方开枪。</li>
<li><strong>能给钱消灾就给钱，不要舍不得东西</strong>。</li>
<li>遇到有车跟随，要将车开到警察局或者人多的购物中心，不要有侥幸心理，以为他会自己离开，更不要回家。</li>
</ol>
</li>
</ol>


<h2>285.对话班超：勇气和智慧</h2>

<p>一些人谈到勇敢，把它理解为爱冒险，甚至爱使用暴力，这和真正的勇敢其实是两回事。 “匹夫见辱，拔剑而起，挺身而斗，此不足为勇也。<strong>天下有大勇者，卒然临之而不惊，无故加之而不怒</strong>”。 所谓勇敢应该是不怕危险和困难，果敢行动，办成别人不能干也不敢干的事情。</p>

<h2>294.Google网页排名算法和传播效果</h2>

<ol>
<li><strong>在单位里，如果想让你的意见被重视，不仅要找很多人替你宣传，而且还要找在单位里有人望的人来做这件事，而不是简单找一大堆人。</strong></li>
<li>好的人缘是让那些在单位里最有影响力，以及最有信誉的人对你有一个高度的评价。根据网页排名的理论，这样做效果最好。当然，这个影响力和信誉未必和职位有关。</li>
<li>自己一定要成为一个被公认的有影响力和客观公正的人，也就是说，你给谁投票，你这一票都很起作用。 而这件事事要办好，需要一个比较长时间的努力，但最关键的是，要有意识地提高自己在单位里意见的重要性排名。这时，很多有损我们长期信誉的事情一定不要做。</li>
<li>要成为一个公认的，有主见的，以前的看法得到证实的人。要成为这样的人，就需要少说话，多观察周围同事和上下级做事情，看看他们的得失，自己把单位里的问题看得清清楚楚，而且相应的专业知识也是必须的。</li>
</ol>


<h2>295.如何在单位里进行有效的沟通</h2>

<ol>
<li>面对面的口头信息传递对人决策的影响力最大。</li>
<li>在一个跨国公司里，比较专业的人会遵守下面六个基本的沟通原则：

<ol>
<li>好消息要当面通知对方。</li>
<li>对于坏消息，视情况而定。如果自己有责任，需要解释的，依然不能用邮件通知，比如解雇一个下属。如果不是很重要的事，用邮件通知即可。</li>
<li>主观的事情要尽可能面对面沟通，客观的则可以用邮件。在单位里凡是涉及说服别人的事情，都属于主观这一类。</li>
<li>涉及到法律问题的事情，或者讲竞争对手坏话的言论，一定不能有文字记录，以免将来到了法庭上成为不利的证据。</li>
<li>公事和私事使用的邮箱不能混用。</li>
<li>约人说话的时间也很有讲究，作为下属，不妨约老板比较晚一点的时间，即使快下班也没有关系，因为老板通常会走得很晚，他也会觉得你工作得很晚。反过来，则不行。</li>
</ol>
</li>
</ol>


<h2>300.狗的会计问题：为什么有些公司做不成事</h2>

<ol>
<li>我们很多现有的大型企业，坐拥很多资源，却错失了很多机会，原因就在于自己用现在的规矩将自己锁死了。</li>
<li><strong>规矩是为了方便做成一件事情的，如果因为有了规矩不能做事了，需要修改的是规矩。</strong></li>
<li>当然，我并不是让你成为规矩的破坏者，而是希望你在做事情的时候能够不受规矩的约束，不忘初心。 就像前面讲到的养狗看护粮仓的故事，既然狗的存在具有合理性，就应该为它制定相应的财务制度，而不是拒绝这种好方法。</li>
</ol>


<h2>305.娱乐至死的时代</h2>

<ol>
<li>尼尔波兹曼在《娱乐至死》书中指出，今天美国的现实社会，一切观点都渐渐要通过娱乐的方式出现和传播才有效果，这不仅仅是一种技术手段，它已经成为一种文化，甚至是时代的精神产物。</li>
<li>乔治奥威尔的《1984》和阿道司赫胥黎的《美丽新世界》的区别：波兹曼认为奥威尔害怕真理被隐瞒，而赫胥黎则担心真理被淹没在无聊琐碎的世事中；奥威尔害怕人们无法获得信息，而赫胥黎则担心人们在庞大的信息中日益被动而丧失了判断力，甚至变得自私；<strong>奥威尔担心我们憎恨的东西会毁掉我们，而赫胥黎则担心我们所热爱的东西（新技术）毁掉我们。</strong></li>
<li>造成娱乐至死现象的根本原因有两个，一个是物质过剩，另一个是信息过剩。

<ol>
<li>当人类不需要工作就可以养活自己时，其实问题也就来了，因为人毕竟是有思想的动物，不会满足于吃饱饭就完事，因此，就必须想办法让他们把多余的精力和时间都消耗掉。娱乐至死就是一个很好的解决方案。</li>
<li>有了物质之后，接下来就是用大量的信息给每一个人的精神上自足的享受了。</li>
</ol>
</li>
<li>如何破除娱乐至死的局呢？其实也很简单，既然原因来自于太多低品质的物质和混杂的信息，我们不妨抛弃掉那些东西，追求一些高品质的物质和有用的信息。</li>
</ol>


<h2>310奢侈品的光泽（6）：传奇故事</h2>

<ol>
<li>研究奢侈品对我最大的帮助是如何做好一款产品，并且让人愿意付费购买。一款好的产品需要有其他人提供不了的独特的用途。因此，我告诉自己宁可不做事，这辈子也不做“Me too”（我也行）的事情。</li>
<li>第二个启示是永远不要为了多卖一份东西而降价，因为这对出高价的顾客不公平。一个好的商品应该配得上一个高价，让拥有它的人具有荣誉感，这是奢侈品行业销售的精髓所在。</li>
<li>第三个启示是，随着时代的变化，要永远能讲出新的故事。</li>
</ol>


<h2>315.比穷更可怕的是什么？</h2>

<p>比贫穷更可怕的是缺乏规矩。 缺乏规矩会踩到别人的脚趾而不自知，其结果是，轻则没有人愿意帮助他们，重则大家会和他们作对，而这个世界上没有人帮助是不行的。</p>

<h2>320.犹太人的教育方式Chavrusa和苏格拉底对勇气的看法</h2>

<ol>
<li>犹太民族是最善于教育的民族，虽然他们只占世界人口的0.2%，却出了很多思想家、科学家和商业巨子。</li>
<li><strong>犹太人的教育方式和中国式两个极端。中国比较强调知识的直接传授，也就是我们常说的灌输，这样成效快，而且考试成绩比较好。我们的教育总是教我们如何找到标准答案，或者正确答案。 犹太人则强调提问和辩论，强调知识内在的逻辑性，他们最典型的方法就是所谓的Chavrusa。</strong></li>
<li>Chavrusa原意是伙伴，后来指犹太教学习经典的特定方法。使用这种方法时，两个人一起研读经典，然后开始辩论，看谁能够辩论赢。在辩论中，观点不重要，重要的是逻辑。</li>
<li>Chavrusa中最关键的两点是提问和逻辑。

<ol>
<li>每个人都可以不断质疑对方的观点，这是通过提问完成。 能提出问题不仅说明自己对主题有所了解，而且能帮助自己养成一种对这种现象和观点保持独立思考的能力。</li>
<li>逻辑——在治学（做科研）中非常强调一点，就是不要带有太多的主观假设，一切从前提（前人现有的工作）出发，使用逻辑或者实验，得到什么结果都要尊重。 如果结果和想象的不同，可能是我们的想象错了，也可能是前提错了，也可能是实验没做好，但是逻辑是不会错的。找到任何一个错误的原因，就是进步。</li>
</ol>
</li>
<li>培养提问题的能力，一方面要鼓励孩子从小就不要怕问傻问题，另一方面靠有意识地引导。</li>
</ol>


<h2>321.和三位美国大学教授聊大学教育</h2>

<ol>
<li>在学校要学习校外很难获得的技能

<ul>
<li>例如那些很难自学的基础课和专业知识——数学、统计、法律、会计、工程理论等。</li>
</ul>
</li>
<li>学会写作也是三位教授强调必须完成的事

<ul>
<li>能够将复杂而头绪非常多的想法用简单、平实、生动的语言表达出来，这是非常有用的。</li>
</ul>
</li>
<li>尽可能晚地作硬性抉择

<ul>
<li>从信息论的角度讲，任何硬性的抉择都会失去信息，也就意味着失去机会。大多数大学生都不知道长大后想要什么，成为什么样的人。在这样的情况下，尽量不要断绝选择的可能性。</li>
</ul>
</li>
<li>注重授课老师而不是课程名字

<ul>
<li>从好的老师那里，你可以学到很多东西，它们不仅来自于课程本身，而且是一整套合乎逻辑的解决问题的思路，这些可以让你今后举一反三学习新东西。</li>
</ul>
</li>
<li>至少掌握好一门外语。</li>
<li>尽可能多地去旅行

<ol>
<li>了解不同的人和文化</li>
<li>到各个不同的单位去实习，了解自己将来想做什么，需要学习什么</li>
<li>走出舒适区</li>
</ol>
</li>
<li>尽可能上小班课，以便和教授沟通</li>
<li>多交流你的思想。

<ol>
<li>通过交流不断更新自己的想法</li>
<li>在校的年轻人有犯错的权利；走出校园后，可能就不会被别人原谅，甚至惹来大麻烦</li>
</ol>
</li>
</ol>


<h2>327.共赢和此消彼长（下）：迷失在全球化中的西方世界</h2>

<ol>
<li>欧洲衰落的原因有很多，其中最重要的有两条，一条是全球化和信息化，另一条则是左翼运动。</li>
<li>欧美国家过分讲究个人利益、不切实际的福利，以及非常短的工作时间，结果高端的竞争力也越来越弱。</li>
<li>在冷战结束后不到20年的时间，很多最初倡导全球化的发达国家和地区（包括绝大部分欧洲国家和美国部分地区），反而成为了全球化的牺牲品——它们原以为自己可以像当年英国和美国那样是受益者，但是忽略了力量的对比是此消彼长的。</li>
<li>个人发展：Google和微软的中层管理人员和高职级的专业人员，很容易养成欧洲国家的心态，他们不再会愿意去做那些看似低端的一线工作。然后他们通过分工将琐碎的脏活累活交给新的下属，然后自己享受工作和生活的平衡去了。<strong>开始的时候他们还因为有自己的专长可以指导下属，时间稍微一长，他们过去的专长就变得没有用处了。</strong></li>
<li>启发：

<ol>
<li>新人在单位里不要介意做脏活、累活，没有这个起点，就没有今后的发展；但是不能满足于一辈子做脏活累活。</li>
<li>改变自己的地位常常需要很长的时间，多思考欧洲的商人和亚洲国家是如何改变自己地位的</li>
<li><strong>如果你的老板不是一个能一直往上走的人，你只有两个选择，适当的时候换老板，或者找到机会取而代之。</strong></li>
<li>任何人的老本都吃不了太长时间，一旦开始工作，能力就比光环重要了。不断地进步才是最重要的。</li>
<li>欧洲衰落的一个原因在于今天工作不工作，干活多与少，结果都差不多，这种公平要不得。如果你在这样一个单位，不要觉得工作轻松是好事情，要趁早离开，因为这条船是要沉的。</li>
</ol>
</li>
</ol>


<h2>329.为什么很多人会相信水变油</h2>

<p>总结一下识破水变油的几个要点：</p>

<ol>
<li>对于不熟悉的、新的事物，切断脑子里的快捷方式。这是我们本身进化的弱点。</li>
<li>对于故意把简单问题复杂化的做法要格外小心。</li>
<li>对于那些别人似乎都懂了，就我不懂的新事物（或者新瓶装旧酒的事物），不要觉得因为我比别人聪明，不懂是件可耻的事情，因此装作懂。实际上，别人可能也是出于面子在不懂装懂。买乐视股票的人就属于这一种。</li>
<li>如果我们已经识破了骗术，千万不要觉得别人比我们更傻，会做接盘侠。</li>
</ol>


<h2>341.腐蚀者的作用</h2>

<ol>
<li>腐蚀者有三大特征

<ol>
<li>嗅觉特别灵敏</li>
<li>很少攻击健康的动物</li>
<li>他们的胃液酸性很大，不管吞下什么动物的肉都很快就消化了，这是它们不得病的原因</li>
</ol>
</li>
<li>现实生活中，如果没有腐蚀者，这个社会会充满不健康的东西。浑水和香橼这种空头机构的最终目的是盈利，但是它们的做法却在一定程度上对这类问题企业得到了揭露和威慑的作用，对股市的健康发展利大于弊。</li>
<li>美国不仅允许直接做空股票，甚至允许裸空股票，也就是说做空股票的数量甚至可以超过公司发行股票的总股数。被裸空的公司基本上只有一个结局，破产退市了事。相比之下，中国的股市一直在保护本该死掉的上市公司，以至于在股市上各种公司鱼龙混杂，最后倒霉的是投资者。</li>
<li>淘汰掉落伍的机构和个体，可以将社会的资源释放，有利于健康的机构和个体过得更好。</li>
</ol>


<h2>342.在单位里五种容易被腐蚀者盯上的人</h2>

<ol>
<li>老板的地位常常取决于他的团队规模。因此，除非万不得已，没有上面的命令，老板一般不会解雇自己手下的人。</li>
<li>今天在任何单位里，尤其是在公司里，几乎100%的业绩来自于极少数的人。</li>
<li>五类人

<ol>
<li>在老板心中本来就会被淘汰的人。</li>
<li>因为各种原因被照顾进来的人，他们的能力远达不到单位的要求。</li>
<li>一些职级和承担的责任不相称的资深人士</li>
<li>不能为老板带来价值的人，或者说既不能帮助老板成功，也不能给同事带来帮助的人</li>
<li>还没有证明自己价值的新人，这既包括刚入职的员工，也包括刚刚从其他部门换过来的人。</li>
</ol>
</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift Closure]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/06/04/on-swift-closure/"/>
    <updated>2019-06-04T17:24:47+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/06/04/on-swift-closure</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#function%E4%B8%8Eclosure%E7%9A%84%E5%85%B3%E7%B3%BB">Function与Closure的关系：</a></li>
<li><a href="#%E7%94%A8closure%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F">用Closure初始化一个变量</a></li>
<li><a href="#closure%E7%9A%84%E8%AF%AD%E6%B3%95%E7%B3%96">Closure的语法糖：</a></li>
<li><a href="#closure%E4%B8%8E%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F">Closure与内存管理、内存泄漏</a>

<ul>
<li><a href="#capture-list%E7%9A%84%E5%AE%9A%E4%B9%89">Capture List的定义</a></li>
<li><a href="#weak-and-unowned-references">Weak and Unowned References</a></li>
</ul>
</li>
<li><a href="#closure%E6%8D%95%E8%8E%B7%E5%8F%98%E9%87%8F">Closure捕获变量</a></li>
</ul>


<p><a href="https://medium.com/@abhimuralidharan/functional-swift-all-about-closures-310bc8af31dd">Functional swift: All about Closures</a></p>

<p>这篇全面详细易懂地介绍了Swift的Closure，包括</p>

<ul>
<li>Closure的语法，包括一些简化写法，如Trailing Closures</li>
<li>Closure与Function的区别</li>
<li>Closure与内存管理、内存泄漏，如capture list的使用，weak与unowned的区别</li>
<li>Functions和closures都是引用类型，不是值类型</li>
</ul>


<p>也可以看<a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html">官方文档Closures</a>，但是官方文档没有上面的文章详细。</p>

<p>下面有选择地记录一下。</p>

<p><a id="markdown-function与closure的关系" name="function与closure的关系"></a></p>

<h2>Function与Closure的关系：</h2>

<p>参考<a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html">官方文档Closures</a>里面的三句话理解一下：</p>

<blockquote><ul>
<li>Global functions are closures that have a name and do not capture any values.</li>
<li>Nested functions are closures that have a name and can capture values from their enclosing function.</li>
<li>Closure expressions are unnamed closures written in a lightweight syntax that can capture values from their surrounding context.</li>
</ul>
</blockquote>

<p>还有一点很重要：<strong>Closures and functions are first class types in swift</strong>。</p>

<blockquote><p>Functions and closures are first-class citizens in Swift because you can treat then like a normal value. For example, you can：</p>

<ul>
<li>assign a function/closure to a local variable .</li>
<li>pass a function/closure as an argument .</li>
<li>return a function/closure .</li>
</ul>
</blockquote>

<p><a id="markdown-用closure初始化一个变量" name="用closure初始化一个变量"></a></p>

<h2>用Closure初始化一个变量</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="nl">setupViewUsingClosure</span><span class="p">:</span> <span class="bp">UIView</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">view</span> <span class="o">=</span> <span class="bp">UIView</span><span class="p">()</span>
</span><span class='line'>    <span class="n">view</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">.</span><span class="n">green</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">view</span>
</span><span class='line'><span class="p">}()</span> <span class="c1">//IMPORTANT!!! I have added () at the end.</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-closure的语法糖" name="closure的语法糖"></a></p>

<h2>Closure的语法糖：</h2>

<p><a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html">官方文档Closures</a>有个总的说明：</p>

<blockquote><p>Swift’s closure expressions have a clean, clear style, with optimizations that encourage brief, clutter-free syntax in common scenarios. These optimizations include:</p>

<ul>
<li>Inferring parameter and return value types from context</li>
<li>Implicit returns from single-expression closures</li>
<li>Shorthand argument names</li>
<li>Trailing closure syntax</li>
</ul>
</blockquote>

<p>当你第一次看到这个写法的时候肯定很疑惑：参数、类型、函数调用时的括号都跑哪去了？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">rreversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span> <span class="p">{</span> <span class="err">$</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="err">$</span><span class="mi">1</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>理解了上面几点，就可以明白为什么可以这么写，下面让我们一步步看清楚。</p>

<p>Closure的定义如下：</p>

<blockquote><p>Closure expressions are unnamed closures written in a lightweight syntax that can capture values from their surrounding context.</p>

<pre><code class="swift">{ (params) -&gt; returnType in
    statements
}
</code></pre></blockquote>

<p>举个具体的例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">reversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span><span class="p">(</span><span class="nl">by</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nl">s1</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="nl">s2</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="k">in</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">s1</span> <span class="o">&gt;</span> <span class="n">s2</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>因为：</p>

<blockquote><ul>
<li><strong>Inferring parameter and return value types from context</strong></li>
</ul>


<p>Because the sorting closure is passed as an argument to a method, Swift can infer the types of its parameters and the type of the value it returns.</p></blockquote>

<p>所以，上面的代码可以写为：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">reversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span><span class="p">(</span><span class="nl">by</span><span class="p">:</span> <span class="p">{</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="k">in</span> <span class="k">return</span> <span class="n">s1</span> <span class="o">&gt;</span> <span class="n">s2</span> <span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>再因为：</p>

<blockquote><ul>
<li><strong>Implicit returns from single-expression closures</strong></li>
</ul>


<p>Single-expression closures can implicitly return the result of their single expression by omitting the return keyword from their declaration.</p></blockquote>

<p>所以，代码继续改为：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">reversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span><span class="p">(</span><span class="nl">by</span><span class="p">:</span> <span class="p">{</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="k">in</span> <span class="n">s1</span> <span class="o">&gt;</span> <span class="n">s2</span> <span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>再因为：</p>

<blockquote><ul>
<li><strong>Shorthand argument names</strong></li>
</ul>


<p>Swift automatically provides shorthand argument names to inline closures, which can be used to refer to the values of the closure’s arguments by the names $0, $1, $2, and so on.</p></blockquote>

<p>代码继续改为：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">rreversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span><span class="p">(</span><span class="nl">by</span><span class="p">:</span> <span class="p">{</span> <span class="err">$</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="err">$</span><span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>再因为：</p>

<blockquote><ul>
<li><strong>Trailing closure syntax</strong></li>
</ul>


<p>If you need to pass a closure expression to a function as the function’s final argument and the closure expression is long, it can be useful to write it as a trailing closure instead. A trailing closure is written after the function call’s parentheses, even though it is still an argument to the function. When you use the trailing closure syntax, you don’t write the argument label for the closure as part of the function call.</p></blockquote>

<p>代码就可以写成：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">rreversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span> <span class="p">{</span> <span class="err">$</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="err">$</span><span class="mi">1</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-closure与内存管理内存泄漏" name="closure与内存管理内存泄漏"></a></p>

<h2>Closure与内存管理、内存泄漏</h2>

<p>Closure带来的循环引用和内存泄漏，主要通过Capture List来解决：</p>

<blockquote><p>You resolve a strong reference cycle between a closure and a class instance by defining a capture list as part of the closure’s definition. A capture list defines the rules to use when capturing one or more reference types within the closure’s body.</p></blockquote>

<p>详细内容参考<a href="https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html#ID56">Resolving Strong Reference Cycles for Closures</a>。下面摘要一下。</p>

<p><a id="markdown-capture-list的定义" name="capture-list的定义"></a></p>

<h3>Capture List的定义</h3>

<blockquote><p>Each item in a capture list is a pairing of the weak or unowned keyword with a reference to a class instance (such as self) or a variable initialized with some value (such as delegate = self.delegate!). These pairings are written within a pair of square braces, separated by commas.</p></blockquote>

<p>Place the capture list before a closure’s parameter list and return type if they are provided:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">lazy</span> <span class="k">var</span> <span class="nl">someClosure</span><span class="p">:</span> <span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="kr">unowned</span> <span class="nb">self</span><span class="p">,</span> <span class="k">weak</span> <span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">delegate</span><span class="o">!</span><span class="p">]</span> <span class="p">(</span><span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="nl">stringToProcess</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="k">in</span>
</span><span class='line'>    <span class="c1">// closure body goes here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-weak-and-unowned-references" name="weak-and-unowned-references"></a></p>

<h3>Weak and Unowned References</h3>

<blockquote><p>Define a capture in a closure as an unowned reference when the closure and the instance it captures will always refer to each other, and will always be deallocated at the same time.</p>

<p>Conversely, define a capture as a weak reference when the captured reference may become nil at some point in the future. Weak references are always of an optional type, and automatically become nil when the instance they reference is deallocated. This enables you to check for their existence within the closure’s body.</p>

<p>NOTE: If the captured reference will never become nil, it should always be captured as an unowned reference, rather than a weak reference.</p></blockquote>

<p>关于unowned的另一个解释更清楚：</p>

<blockquote><p>Like a weak reference, an unowned reference does not keep a strong hold on the instance it refers to. Unlike a weak reference, however, an unowned reference is used when the other instance has the same lifetime or a longer lifetime.</p></blockquote>

<p><a id="markdown-closure捕获变量" name="closure捕获变量"></a></p>

<h2>Closure捕获变量</h2>

<blockquote><p>Closures can capture and store references to any constants and variables from the context in which they are defined. This is known as closing over those constants and variables.</p></blockquote>

<p>比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// capturing values</span>
</span><span class='line'><span class="k">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">var</span> <span class="n">closureArray</span> <span class="o">=</span> <span class="p">[()</span><span class="o">-&gt;</span><span class="p">()]()</span>
</span><span class='line'><span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mf">1.</span><span class="p">.</span><span class="mf">.5</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">closureArray</span><span class="p">.</span><span class="n">append</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// here i will be 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">4</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span></code></pre></td></tr></table></div></figure>


<p>The closure captures the current address of <code>i</code> and every time we access <code>i</code> , it . returns the current value.</p>

<p>If we want to prevent this behavior (capturing values) and print the value of i even if the properties change after their capturing inside the closure, we can explicitly capture the variable with a capture list like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">var</span> <span class="n">closureArray2</span> <span class="o">=</span> <span class="p">[()</span><span class="o">-&gt;</span><span class="p">()]()</span>
</span><span class='line'><span class="k">var</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mf">1.</span><span class="p">.</span><span class="mf">.5</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">closureArray2</span><span class="p">.</span><span class="n">append</span> <span class="p">{</span> <span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">in</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// here i will be 5</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">0</span><span class="p">]()</span> <span class="c1">// prints 0</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="c1">// prints 1</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">2</span><span class="p">]()</span> <span class="c1">// prints 2</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">3</span><span class="p">]()</span> <span class="c1">// prints 3</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">4</span><span class="p">]()</span> <span class="c1">// prints 4</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this way, we keep an immutable copy of the variable <code>j</code>. Thanks to this copy, further changes to <code>j</code>, outside the closure, will not affect the closure. <code>j</code> is a let constant here. It is not mutable.</p>

<p>We can add multiple values to the capture list :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">closure</span><span class="p">.</span><span class="n">append</span> <span class="p">{</span> <span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="k">in</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;\(j) \(k) \(l)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>also, you can have alias names for the values captured.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">closure</span><span class="p">.</span><span class="n">append</span> <span class="p">{</span> <span class="p">[</span><span class="n">a</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">]</span> <span class="k">in</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;\(a) \(b) \(c)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sequece and Collection in Swift]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/06/03/sequece-and-collection-in-swift/"/>
    <updated>2019-06-03T16:22:33+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/06/03/sequece-and-collection-in-swift</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#array-out-of-range-crash"><code>Array</code> out of Range Crash</a></li>
<li><a href="#homemade-collection">Homemade collection</a></li>
<li><a href="#sequences">Sequences</a>

<ul>
<li><a href="#how-to-conform-to-sequence-protocol">How to Conform to <code>Sequence</code> Protocol</a></li>
<li><a href="#make-our-section-conform-to-sequence-protocol">Make our <code>Section</code> Conform to <code>Sequence</code> Protocol</a></li>
<li><a href="#gifts">Gifts</a></li>
</ul>
</li>
<li><a href="#collections">Collections</a>

<ul>
<li><a href="#how-to-conform-to-collection-protocol">How to Conform to <code>Collection</code> Protocol</a></li>
<li><a href="#make-our-section-conform-to-collection-protocol">Make our <code>Section</code> Conform to <code>Collection</code> Protocol</a></li>
</ul>
</li>
<li><a href="#difference-between-array-and-collection">Difference between <code>Array</code> and <code>Collection</code></a></li>
<li><a href="#reference">Reference</a></li>
</ul>


<p>The content comes from the following posts:</p>

<ol>
<li><a href="https://medium.com/swift-programming/swift-sequences-ce22d76f120c">Swift Sequences</a></li>
<li><a href="https://medium.com/swift-programming/swift-collections-e5fff3cd6759">Swift Collections</a></li>
</ol>


<p>But some of the code inside is old and can&rsquo;t be compiled with swift 5.0. So rewritten the code using swift 5.0.</p>

<p><a id="markdown-array-out-of-range-crash" name="array-out-of-range-crash"></a></p>

<h2><code>Array</code> out of Range Crash</h2>

<p>Before diving into Swift Sequences, let’s see a strange behavior.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class='line'><span class="n">array</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="err">😭</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">dic</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'><span class="n">dic</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="err">😎</span>
</span><span class='line'>
</span><span class='line'><span class="err">🤔</span>
</span></code></pre></td></tr></table></div></figure>


<p>In other words, when requesting an element that doesn’t exist, why arrays crash whereas dictionaries don’t?</p>

<p>Arrays and dictionaries are two base collections provided by the Swift standard library. We can access those collections elements through the [] notation, also known as subscript. Let’s see how those subscripts are defined.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">Dictionary</span><span class="o">&lt;</span><span class="nl">Key</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">Value</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="nl">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Value</span><span class="o">?</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>What’s interesting is that arrays have a non optional return type. Subscript can’t throw errors so there are no alternatives other than a fatalError if we request an index that doesn’t exist.</p>

<p>For dictionaries, on the other hand, an optional Value is returned, which allows to gracefully return nil if the index doesn’t exist.</p>

<p>We can adopt dictionaries safer approach by overloading the arrays subscript — we can’t override them. Adding an external name to the parameter is enough.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">extension</span> <span class="n">Array</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="n">safe</span> <span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">count</span> <span class="o">?</span> <span class="nb">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">:</span> <span class="nb">nil</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We saw how we can create a new accessor to the elements of an array, but can we do the same with a homemade collection?</p>

<p><a id="markdown-homemade-collection" name="homemade-collection"></a></p>

<h2>Homemade collection</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">title</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">elements</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Internally, this ‘collection’ is based on an array. This is an implementation detail for the simplicity of the example. We could have used a linked list as in this <a href="http://austinzheng.com/2015/01/24/swift-seq/">excellent article</a> by <a href="https://twitter.com/austinzheng">Austin Zheng</a>.</p>

<p>Creating a subscript on our collection is very easy, we can even reuse the array’s extension we made earlier.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">title</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">elements</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="n">safe</span> <span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">index</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>An example in practice :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">cars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;911&quot;</span><span class="p">,</span> <span class="s">&quot;Cayman&quot;</span><span class="p">,</span> <span class="s">&quot;Cayenne&quot;</span><span class="p">]</span>
</span><span class='line'><span class="k">let</span> <span class="n">section</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="nl">title</span><span class="p">:</span> <span class="s">&quot;Porsche&quot;</span><span class="p">,</span> <span class="nl">elements</span><span class="p">:</span> <span class="n">cars</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">section</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'><span class="c1">// Optional(&quot;Cayman&quot;)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Great! But does that make our type a collection, as Swift defines it?</p>

<p><a id="markdown-sequences" name="sequences"></a></p>

<h2>Sequences</h2>

<p>When it comes to manipulating sets, the most abstract notion given by the standard library is the Sequence, defined as</p>

<blockquote><p>A type that can be iterated with a <code>for…in</code> loop.</p></blockquote>

<p><a id="markdown-how-to-conform-to-sequence-protocol" name="how-to-conform-to-sequence-protocol"></a></p>

<h3>How to Conform to <code>Sequence</code> Protocol</h3>

<p>This section is from <a href="https://developer.apple.com/documentation/swift/sequence">Sequece official site</a>.</p>

<p>Making your own custom types conform to Sequence enables many useful operations, like for-in looping and the contains method, without much effort. To add Sequence conformance to your own custom type, add a makeIterator() method that returns an iterator.</p>

<p>Alternatively, if your type can act as its own iterator, implementing the requirements of the IteratorProtocol protocol and declaring conformance to both Sequence and IteratorProtocol are sufficient.</p>

<p>Here’s a definition of a Countdown sequence that serves as its own iterator. The makeIterator() method is provided as a default implementation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="nl">Countdown</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">IteratorProtocol</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">count</span><span class="p">:</span> <span class="n">Int</span>
</span><span class='line'>
</span><span class='line'>    <span class="kr">mutating</span> <span class="k">func</span> <span class="n">next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Int</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">defer</span> <span class="p">{</span> <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span> <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">count</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">threeToGo</span> <span class="o">=</span> <span class="n">Countdown</span><span class="p">(</span><span class="nl">count</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">threeToGo</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// Prints &quot;3&quot;</span>
</span><span class='line'><span class="c1">// Prints &quot;2&quot;</span>
</span><span class='line'><span class="c1">// Prints &quot;1&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-make-our-section-conform-to-sequence-protocol" name="make-our-section-conform-to-sequence-protocol"></a></p>

<h3>Make our <code>Section</code> Conform to <code>Sequence</code> Protocol</h3>

<p>The <code>Section</code> struct can&rsquo;t act as its own iterator, we need to define an iterator for it, and then return an instance of the defined iterator inside <code>func makeIterator() -&gt; Section&lt;T&gt;.Iterator</code> method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;:</span> <span class="n">Sequence</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">title</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">elements</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="n">safe</span> <span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">index</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">struct</span> <span class="nl">Iterator</span><span class="p">:</span> <span class="n">IteratorProtocol</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="nl">array</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>        <span class="k">var</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">init</span> <span class="p">(</span><span class="n">_</span> <span class="nl">array</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="nb">self</span><span class="p">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kr">mutating</span> <span class="k">func</span> <span class="n">next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">tempIndex</span> <span class="o">=</span> <span class="n">currentIndex</span>
</span><span class='line'>            <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">tempIndex</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">makeIterator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Iterator</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Iterator</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-gifts" name="gifts"></a></p>

<h3>Gifts</h3>

<p>Is that all? No! By conforming to SequenceType we also get methods for free, here is some of them.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">min</span><span class="p">()</span>
</span><span class='line'><span class="c1">// 911</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">max</span><span class="p">()</span>
</span><span class='line'><span class="c1">// Cayman</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">sorted</span><span class="p">()</span>
</span><span class='line'><span class="c1">// [&quot;911&quot;, &quot;Cayenne&quot;, &quot;Cayman&quot;]</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;911&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">// true</span>
</span></code></pre></td></tr></table></div></figure>


<p>We get the min, max &amp; sort methods because the elements of our sequence, String in our case, are Comparable. Contains is available thanks to our elements being Equatable.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span> <span class="err">$</span><span class="mf">0.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">}</span>
</span><span class='line'><span class="c1">// [&quot;Cayman&quot;, &quot;Cayenne&quot;]</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="err">$</span><span class="mf">0.</span><span class="n">count</span> <span class="p">}</span>
</span><span class='line'><span class="c1">// [3, 6, 7]</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">reduce</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="err">$</span><span class="mi">0</span> <span class="o">+</span> <span class="err">$</span><span class="mf">1.</span><span class="n">count</span> <span class="p">}</span>
</span><span class='line'><span class="c1">// 16</span>
</span></code></pre></td></tr></table></div></figure>


<p>And for functional programming fans, filter, map and reduce are also given.</p>

<p><a id="markdown-collections" name="collections"></a></p>

<h2>Collections</h2>

<p>Sequence is the most basic set notion given by the Swift standard library. There is a more evolved one.</p>

<p>A collection is defined as follow :</p>

<blockquote><p>A multi-pass <em>sequence</em> with addressable positions</p></blockquote>

<p>As we saw previously, a sequence is a type that can be iterated with a <code>for…in</code> loop. It doesn’t need that the elements might be iterated over several times. And it doesn’t need that we give a way to access directly an element.</p>

<p>Collections require those last two points. As a side effect, it no longer allows us to have an infinite number of elements.</p>

<p>To be a collection, a type must conform to the <code>Collection</code> protocol.</p>

<p><a id="markdown-how-to-conform-to-collection-protocol" name="how-to-conform-to-collection-protocol"></a></p>

<h3>How to Conform to <code>Collection</code> Protocol</h3>

<p>This section comes from <a href="https://developer.apple.com/documentation/swift/collection">Collection official site</a>.</p>

<p>If you create a custom sequence that can provide repeated access to its elements, make sure that its type conforms to the Collection protocol in order to give a more useful and more efficient interface for sequence and collection operations. To add Collection conformance to your type, you must declare at least the following requirements:</p>

<ol>
<li>The <code>startIndex</code> and <code>endIndex</code> properties</li>
<li>A subscript that provides at least read-only access to your type’s elements</li>
<li>The <code>index(after:)</code> method for advancing an index into your collection</li>
<li>Conform to <code>Sequece</code> Protocol, as <code>Collection</code> is inherited from <code>Sequence</code></li>
</ol>


<p><a id="markdown-make-our-section-conform-to-collection-protocol" name="make-our-section-conform-to-collection-protocol"></a></p>

<h3>Make our <code>Section</code> Conform to <code>Collection</code> Protocol</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;:</span> <span class="n">Collection</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">title</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">elements</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// begin: required for Collection</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">startIndex</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">endIndex</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">elements</span><span class="p">.</span><span class="n">count</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">index</span><span class="p">(</span><span class="n">after</span> <span class="nl">i</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// end: required for Collection</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="n">safe</span> <span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">index</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// begin: required for Sequence</span>
</span><span class='line'>    <span class="k">struct</span> <span class="nl">Iterator</span><span class="p">:</span> <span class="n">IteratorProtocol</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="nl">array</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>        <span class="k">var</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">init</span> <span class="p">(</span><span class="n">_</span> <span class="nl">array</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="nb">self</span><span class="p">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kr">mutating</span> <span class="k">func</span> <span class="n">next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">tempIndex</span> <span class="o">=</span> <span class="n">currentIndex</span>
</span><span class='line'>            <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">tempIndex</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">makeIterator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Iterator</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Iterator</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// end: required for Sequence</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>endIndex</code> has to be after the last element. It allows to define an empty collection with <code>startIndex</code> = <code>endIndex</code>.</p>

<p>Like conforming to <code>Sequence</code>, we get some methods / properties for free:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">count</span>
</span><span class='line'><span class="c1">// 3</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">first</span>
</span><span class='line'><span class="c1">// 911</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">isEmpty</span>
</span><span class='line'><span class="c1">// false</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nl">of</span><span class="p">:</span> <span class="s">&quot;911&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">// 0</span>
</span></code></pre></td></tr></table></div></figure>


<p>We get indexOf thanks to our Elements being Equatable.</p>

<p><a id="markdown-difference-between-array-and-collection" name="difference-between-array-and-collection"></a></p>

<h2>Difference between <code>Array</code> and <code>Collection</code></h2>

<p>We created our own collection, which is great, but what about that difference of behavior between Arrays and Dictionaries we talked about at the beginning of the post? We saw that Array’s dangerous subscript was coming from the Indexable protocol, but what about Dictionaries?</p>

<p>Dictionaries, like Arrays, are a collection, as Swift defines it. They both conform to CollectionType. So Dictionaries are also required to provide an ‘unsafe’ subscript that takes an Index and returns a non optional Element. The one we’re used to is just a convenience subscript.</p>

<p>A simple example shows that it is also really easy to get a crash with Dictionaries.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">dic</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="o">:</span> <span class="s">&quot;bmw&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="o">:</span> <span class="s">&quot;audi&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="o">:</span> <span class="s">&quot;citroen&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">var</span> <span class="n">index</span> <span class="o">=</span> <span class="n">dic</span><span class="p">.</span><span class="n">startIndex</span>
</span><span class='line'><span class="n">dic</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span class='line'><span class="c1">// (key: &quot;c&quot;, value: &quot;citroen&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="n">index</span> <span class="o">=</span> <span class="n">dic</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nl">after</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
</span><span class='line'><span class="n">print</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span class='line'><span class="c1">// (key: &quot;b&quot;, value: &quot;audi&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="n">index</span> <span class="o">=</span> <span class="n">dic</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nl">after</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
</span><span class='line'><span class="n">index</span> <span class="o">=</span> <span class="n">dic</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nl">after</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
</span><span class='line'><span class="n">dic</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span class='line'><span class="c1">// Fatal error</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>The last question that remains is why <code>Collection</code> requires a subscript that may crash? Simply for performance reason, it costs too much to check the validity of the given index. Crashing is faster :)</strong></p>

<p><a id="markdown-reference" name="reference"></a></p>

<h2>Reference</h2>

<ol>
<li><a href="https://medium.com/swift-programming/swift-sequences-ce22d76f120c">Swift Sequences</a></li>
<li><a href="https://medium.com/swift-programming/swift-collections-e5fff3cd6759">Swift Collections</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[自然语言理解（NLU）综述]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/05/29/overview-of-nlp-and-nlu/"/>
    <updated>2019-05-29T17:27:58+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/05/29/overview-of-nlp-and-nlu</id>
    <content type="html"><![CDATA[<!-- more -->


<p>这篇总结有点乱，权当留作自己看。</p>

<ul>
<li><a href="#%E4%BA%BA%E6%9C%BA%E5%AF%B9%E8%AF%9D%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%9E%8B">人机对话的两种模型</a></li>
<li><a href="#nlu%E4%B8%8Enlp">NLU与NLP</a>

<ul>
<li><a href="#stanford-corenlp">Stanford CoreNLP</a></li>
<li><a href="#ios-naturallanguage-framework">iOS <em>NaturalLanguage</em> framework</a>

<ul>
<li><a href="#custom-machine-learning-models">Custom Machine Learning Models</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E7%90%86%E8%A7%A3%E5%B9%B3%E5%8F%B0">自然语言理解平台</a></li>
<li><a href="#google%E7%9A%84dialogflow">Google的Dialogflow</a>

<ul>
<li><a href="#dialogflow%E7%9A%84%E5%8E%86%E5%8F%B2">Dialogflow的历史</a></li>
<li><a href="#dialogflow%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5">Dialogflow的一些概念</a></li>
<li><a href="#%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0intents%E4%B9%8B%E9%97%B4%E7%9A%84entities%E5%85%B1%E4%BA%AB">两种方法实现intents之间的entities共享</a></li>
<li><a href="#training-tab-in-dialogflow-platform">“Training” tab in Dialogflow platform</a></li>
<li><a href="#integrations-analytics-and-fulfillment">“Integrations”, “Analytics” and “Fulfillment”</a></li>
<li><a href="#prebuild-agent-and-small-talk">“Prebuild Agent” and “Small Talk”</a></li>
<li><a href="#%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8dialogflow%E7%9A%84%E4%BE%8B%E5%AD%90">一些使用Dialogflow的例子</a></li>
</ul>
</li>
<li><a href="#alexa-and-lex">Alexa and Lex</a></li>
<li><a href="#microsoft-luis-text-analytics-api">Microsoft LUIS Text Analytics API</a></li>
<li><a href="#facebook%E7%9A%84witai">Facebook的wit.ai</a></li>
<li><a href="#snips">Snips</a>

<ul>
<li><a href="#duckling">Duckling</a></li>
</ul>
</li>
<li><a href="#ibm%E7%9A%84watson">IBM的Watson</a></li>
<li><a href="#swiftnlc">SwiftNLC</a>

<ul>
<li><a href="#xunfei-command-recognition">Xunfei Command Recognition</a></li>
</ul>
</li>
<li><a href="#siri-and-sirikit">Siri and SiriKit</a>

<ul>
<li><a href="#sirikit-build-in-domain">SiriKit build-in domain</a></li>
<li><a href="#sirikit-custom-intent">SiriKit custom intent</a></li>
</ul>
</li>
</ul>


<p><a id="markdown-人机对话的两种模型" name="人机对话的两种模型"></a></p>

<h2>人机对话的两种模型</h2>

<p>自然语言理解（NLU）的最终目的是让计算机能够理解人类的语言，实现人机对话。目前，人机对话模型基本上有两种：</p>

<ol>
<li>基于意图(Intent-based)的对话：这是当NLP算法使用intents和entities进行对话时，通过识别用户声明中的名词和动词，然后与它的dictionary交叉引用，让bot可以执行有效的操作。目前，大部分平台都是基于这种模式进行训练的，包括谷歌的Dialogflow。</li>
<li>基于流程(Flow-based)的对话：基于流程的对话是智能通信的下一个级别。在这里，我们会给予两个人之间对话的许多不同样本的RNN（循环神经网络），创建的机器人将根据你训练的ML模型进行响应。 wit.ai是在这个领域取得巨大进展的少数网站之一。但这个太超前，不是我们考虑使用的对象，接下来也不会讨论。</li>
</ol>


<p>详细讨论参考：<a href="https://chatbotsmagazine.com/bot-talks-intent-based-vs-flow-base-conversations-798788dc9cf6">Bot Talks: Intent-Based vs. Flow-Base Conversations</a>。</p>

<p><a id="markdown-nlu与nlp" name="nlu与nlp"></a></p>

<h2>NLU与NLP</h2>

<p>NLP（Natural Language Processing）是NLU（Natural Language Understanding）的一个前期步骤：NLP用于对文本或者语音进行机器学习训练和识别时的特征提取阶段。</p>

<p><a id="markdown-stanford-corenlp" name="stanford-corenlp"></a></p>

<h3>Stanford CoreNLP</h3>

<p>可以去<a href="http://nlp.stanford.edu:8080/corenlp/process">Stanford CoreNLP</a>试一下效果。使用界面可以看一下：</p>

<p><img src="http://hongchaozhang.github.io/images/NLU_Stanford_CoreNLP.png" alt="stanford CoreNLP" /></p>

<p><a id="markdown-ios-naturallanguage-framework" name="ios-naturallanguage-framework"></a></p>

<h3>iOS <em>NaturalLanguage</em> framework</h3>

<p>iOS的<em>NaturalLanguage</em>框架可以做的事情如下：</p>

<p><img src="http://hongchaozhang.github.io/images/NLU_AppleNLP.png" alt="Apple nlp framework" /></p>

<p><a id="markdown-custom-machine-learning-models" name="custom-machine-learning-models"></a></p>

<h4>Custom Machine Learning Models</h4>

<p>用户可以自己训练模型，用于下列事情：</p>

<p>NSLinguisticTagger:</p>

<ul>
<li>Language identification</li>
<li>Tokenization in Word/Sentence/Paragraph</li>
<li>Part of speech</li>
<li>Lemmatization</li>
<li>Named entity recognition</li>
</ul>


<p>With custom models:</p>

<ol>
<li>Text classification

<ul>
<li>Sentiment classification</li>
<li>Topic classification</li>
<li>Domain classification</li>
</ul>
</li>
<li>Word tagging

<ul>
<li>Part of speech</li>
<li>Named entity</li>
<li>Slot parsing

<ul>
<li>Chunking</li>
</ul>
</li>
<li></li>
</ul>
</li>
</ol>


<p><a id="markdown-自然语言理解平台" name="自然语言理解平台"></a></p>

<h2>自然语言理解平台</h2>

<p>一些比较有名气的自然语言理解平台：</p>

<ul>
<li>Facebook’s Wit.ai,</li>
<li>IBM Watson’s Conversation Service,</li>
<li>Microsoft’s Language Understanding and Intelligence Service or</li>
<li>Google NLP API</li>
</ul>


<p>Wit.ai joined Facebook on 2015.1.5</p>

<p>一些常见产品及其背后的支撑技术：</p>

<ul>
<li>Amazon: Echo &lt;- Alexa &lt;- Lex</li>
<li>Apple: iPhone &lt;- Siri &lt;- SiriKit</li>
<li>Google: Android phone &lt;- Google Asistant &lt;- Dialogflow</li>
<li>Microsoft: Windows phone &lt;- Cortana &lt;- Luis</li>
</ul>


<p>下面选择一些平台做简单介绍。</p>

<p><a id="markdown-google的dialogflow" name="google的dialogflow"></a></p>

<h2>Google的Dialogflow</h2>

<blockquote><p><a href="https://dialogflow.com/">Google的Dialogflow</a>Give users new ways to interact with your product by building engaging voice and text-based conversational interfaces, such as voice apps and chatbots, powered by AI. Connect with users on your website, mobile app, the Google Assistant, Amazon Alexa, Facebook Messenger, and other popular platforms and devices.</p></blockquote>

<p><a id="markdown-dialogflow的历史" name="dialogflow的历史"></a></p>

<h3>Dialogflow的历史</h3>

<p>Dialogflow就是Speaktoit公司的api.ai。</p>

<ul>
<li>2011: Speaktoit developed an intelligent personal assistant for mobile phones</li>
<li>2014: Speaktoit released api.ai</li>
<li>2016: Google buys Speaktoit to power Google Assistant</li>
<li>2017: api.ai is renamed to Dialogflow</li>
</ul>


<p><a id="markdown-dialogflow的一些概念" name="dialogflow的一些概念"></a></p>

<h3>Dialogflow的一些概念</h3>

<ul>
<li>Agents: 一套module包含dialogflow及自然語言理解使用者的語義後，執行整個動作 action. Ex:如上圖 TestAgent</li>
<li>Intents: 使用者的意圖。意圖由開發人員配置。</li>
<li>Entities:重要的關鍵字眼(我真的不知道怎麼翻好，Google說這個字叫做實體?) 從用戶口中所提到的重要的關鍵字眼轉換成重要的資訊，籍此提供給Intent。例如：“訂飛機” ：這句話中還需要 城市 日期 等資訊，來能完成訂飛機這個動作，所以 城市 和 日期 就是Entities.</li>
<li>Fulfilment: 程式撰寫的地方。例如 訂飛機 還得串飛機公司的API才有可能完成訂購，所以程式邏緝就是寫在這裡。</li>
<li>Integrations: LINE, Google home etc..</li>
<li>Prebuilt Agents: dialogflow幫你預先訓練好的Agent，你可以拿來用。</li>
<li>Smalltalk: 也是dialogflow幫你預先訓練好的Agent，幫助你的chatbot對話更友善.</li>
</ul>


<p><a id="markdown-两种方法实现intents之间的entities共享" name="两种方法实现intents之间的entities共享"></a></p>

<h3>两种方法实现intents之间的entities共享</h3>

<ul>
<li>Context: 在线性对话中，完成讯息在Intent中的传送。</li>
<li>Followup Intent</li>
</ul>


<blockquote><p>对话生命周期，就是这个参数可以存多久。</p></blockquote>

<p><a id="markdown-training-tab-in-dialogflow-platform" name="training-tab-in-dialogflow-platform"></a></p>

<h3>“Training” tab in Dialogflow platform</h3>

<blockquote><p><a href="https://console.dialogflow.com/api-client/#/agent/dea6f73c-7c22-44b6-a1a8-45cdcd160bfc/training">官方关于Training的说明</a>：你将收到所有发送给agent的回覆讯息以及agent回覆的内容，如果你告诉你的agent一些回应文本，但它回应你不喜欢的输出，这就非常有用，若你稍后意识到忘记了某个关键字的同义词，并且用户正在使用这个关键字，那么也可能会有所帮助，可以去告诉你的代理在这种情况下应该做什么。</p></blockquote>

<p><a id="markdown-integrations-analytics-and-fulfillment" name="integrations-analytics-and-fulfillment"></a></p>

<h3>“Integrations”, “Analytics” and “Fulfillment”</h3>

<blockquote><p>在Training下方，你可以看到Integrations。在这里，可以管理你的agent去串接不同的服务，例如Google Assistant，Twitter，Slack，Messenger，Cortana，Alexa等等。 Integrations之后，还有Analytics，基本上用来显示建议名称，之后还有Fulfillment，如果你要调用一个API并实现一个webhook，这就是你会需要来的地方。</p></blockquote>

<p><a id="markdown-prebuild-agent-and-small-talk" name="prebuild-agent-and-small-talk"></a></p>

<h3>“Prebuild Agent” and “Small Talk”</h3>

<p>最后两个选项功能非常简单，但很有用。第一个是Prebuilt Agents，在这里，你可以import一个预先存在的代理框架，有很多例子，如食物传递机器人，音乐机器人，甚至（抱歉，但你真的需要知道这个）hotel预订机器人！最后一个选项是Small Talk，如果你将代理设计为像Siri或Google Assistant这样的每日伙伴(daily companion)，这个选项非常有用，Small Talk允许你添加常见问题的答案，我们都喜欢问我们的机器人，如”你几岁？”或”你住哪里？”，以及更热门的问题”你愿意嫁给我吗？”</p>

<p><a id="markdown-一些使用dialogflow的例子" name="一些使用dialogflow的例子"></a></p>

<h3>一些使用Dialogflow的例子</h3>

<ol>
<li>林建宏的7篇文章：如何使用Dialogflow建立Chatbot #1-#7</li>
<li><a href="https://medium.com/@wolkesau/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8dialogflow%E5%BB%BA%E7%AB%8Bchatbot-1-%E4%BB%8B%E7%B4%B9-62736bcdad95">用Dialogflow建立LINE Chatbot #1 介紹</a></li>
<li><a href="https://github.com/appcoda/ChatbotHotel">A Demo for booking hotel based on Dialogflow</a></li>
<li><a href="https://www.appcoda.com.tw/chatbot-dialogflow-ios/">聊天機器人教學：使用Dialogflow (API.AI)開發 iOS Chatbot App</a></li>
</ol>


<p><a id="markdown-alexa-and-lex" name="alexa-and-lex"></a></p>

<h2>Alexa and Lex</h2>

<blockquote><p>Echo to Alexa as iPhone to Siri
Lex is whats inside Alexa
Lex is part of AWS, but Alexa isn&rsquo;t</p>

<p>Alexa is more focusing on communication using voice. Hence it has some special requirements for utterances. For example, the number is not supported in the utterances. You need to use &lsquo;Show me three elements&rsquo; instead of &lsquo;Show me 3 elements&rsquo;. For acronym, we need to use &lsquo;n.b.a&rsquo; instead of &lsquo;NBA&rsquo;.</p>

<p>Lex is a platform which can power bot who accept text input.</p>

<p>Amazon Lex 让您可以将语音和文本聊天访问集成到现有应用程序中。Amazon Alexa 允许您使用 Amazon Echo 或任何启用 Alexa Voice Service 的设备为家庭或工作场所的用户提供免提语音接口。</p></blockquote>

<p><a id="markdown-microsoft-luis-text-analytics-api" name="microsoft-luis-text-analytics-api"></a></p>

<h2>Microsoft LUIS Text Analytics API</h2>

<ol>
<li>Detect language</li>
<li>Analyze sentiment</li>
<li>Extract key phrases

<ul>
<li>使用方法参考<a href="https://docs.microsoft.com/en-us/azure/cognitive-services/text-analytics/quickstarts/python">Python demo</a>。</li>
</ul>
</li>
<li>Identify entities

<ul>
<li>使用方法参考<a href="https://docs.microsoft.com/en-us/azure/cognitive-services/text-analytics/quickstarts/python">Python demo</a>。</li>
</ul>
</li>
</ol>


<p><a id="markdown-facebook的witai" name="facebook的witai"></a></p>

<h2>Facebook的wit.ai</h2>

<p>参见<a href="https://wit.ai/">官方文档</a>。</p>

<p><a id="markdown-snips" name="snips"></a></p>

<h2>Snips</h2>

<p>Snips的设计流程还是非常好的 ，包含基于正则表达式的确定性识别和基于机器学习的可能性识别。一些资料：</p>

<ul>
<li><a href="https://medium.com/snips-ai/an-introduction-to-snips-nlu-the-open-source-library-behind-snips-embedded-voice-platform-b12b1a60a41a">Post</a></li>
<li><a href="https://snips-nlu.readthedocs.io/en/latest/index.html">Document</a></li>
<li><a href="https://github.com/snipsco/snips-platform-swift">GitHub for iOS app demo</a></li>
<li><a href="https://console.snips.ai/assistants/proj_ageaw4b4d83">Snips assistent generation</a></li>
</ul>


<p><a id="markdown-duckling" name="duckling"></a></p>

<h3>Duckling</h3>

<p>Snips使用<a href="https://github.com/facebook/duckling">Duckling</a>进行下面的理解：</p>

<p>输入："the first Tuesday of October"
输出：{&ldquo;value&rdquo;:&ldquo;2017-10-03T00:00:00.000-07:00&rdquo;,&ldquo;grain&rdquo;:&ldquo;day&rdquo;}</p>

<blockquote><p>Note:
* Spin your own Duckling server or using wit.ai’s build entities.
* <a href="https://medium.com/wit-ai/open-sourcing-duckling-our-probabilistic-date-parser-4351ee66c4ba">Open Sourcing Duckling, our probabilistic (date) parser</a></p></blockquote>

<p><a id="markdown-ibm的watson" name="ibm的watson"></a></p>

<h2>IBM的Watson</h2>

<p>参看<a href="https://www.ibm.com/watson/services/natural-language-classifier/">官方文档</a>。</p>

<p><a id="markdown-swiftnlc" name="swiftnlc"></a></p>

<h2>SwiftNLC</h2>

<ul>
<li><a href="https://chatbotsmagazine.com/coreml-nlc-with-keras-tensorflow-and-apple-nslinguistictagger-1659021ea8e5">Offline Intent Understanding: CoreML NLC with Keras/TensorFlow and Apple NSLinguisticTagger</a></li>
<li><a href="https://heartbeat.fritz.ai/implementing-a-natural-language-classifier-in-ios-with-keras-core-ml-358f114c0b51">Implementing a Natural Language Classifier in iOS with Keras + Core ML</a></li>
</ul>


<p><a id="markdown-xunfei-command-recognition" name="xunfei-command-recognition"></a></p>

<h3>Xunfei Command Recognition</h3>

<p>例如，开发一个简单的语音拨号应用，可定义如下语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;commands&gt;:(找一下|打电话给) &lt;name&gt;;
</span><span class='line'>&lt;name&gt;: 张三|李四;</span></code></pre></td></tr></table></div></figure>


<p>该语法使识别引擎可以支持以下说法：找一下张三 、打电话给张三 、找一下李四 、打电话给李四。
凡是用户说出这个范围中的任意一句话，均可以被识别系统识别。如果用户说的话不在上述范围中，识别系统可能拒绝识别。</p>

<p><a id="markdown-siri-and-sirikit" name="siri-and-sirikit"></a></p>

<h2>Siri and SiriKit</h2>

<p><a id="markdown-sirikit-build-in-domain" name="sirikit-build-in-domain"></a></p>

<h3>SiriKit build-in domain</h3>

<p>SiriKit支持的build-in的domain包括：</p>

<ul>
<li>Messaging</li>
<li>Lists and Notes</li>
<li>Workouts</li>
<li>Payments</li>
<li>VoIP Calling</li>
<li>Visual Codes</li>
<li>Photos</li>
<li>Ride Booking</li>
<li>Car Commands</li>
<li>CarPlay</li>
<li>Restaurant Reservations</li>
</ul>


<p>基于build-in的domain，可以不经过任何机器模型训练达到下面的效果：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>“Hey Siri, send a UnicornChat message”
</span><span class='line'>“To whom?”
</span><span class='line'>“Celestra”
</span><span class='line'>“What do you want to say to Celestra?”
</span><span class='line'>“Let’s add more sparkle transitions” </span></code></pre></td></tr></table></div></figure>


<p>当然也可以用机器学习模型做一些事情。</p>

<blockquote><p>Domain model can be trained and used through NLP framework.</p></blockquote>

<p>我们也可以帮助Siri识别自定义的词典（WWDC2017 228_making_great_sirikit_experiences)。可以支持两种自定义的词典：</p>

<ul>
<li>App vocabulary: known to all your users and unique to your app, supplied in the plist file.</li>
<li>User vocabulary: known only to some specific users, supplied at the runtime.</li>
</ul>


<p>但是，注意：</p>

<ul>
<li>Need to update the user vocabulary if some info changes.</li>
<li>Need to reset the user vocabulary if the user reset the app, or log out.</li>
</ul>


<p><a id="markdown-sirikit-custom-intent" name="sirikit-custom-intent"></a></p>

<h3>SiriKit custom intent</h3>

<p>SiriKit的custom intent只是用来实现Siri Shortcut的，不能携带参数。</p>

<blockquote><p>Custom intent can only be used as shortcut and NO parameters will be extracted from the voice command.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Offline Natural Language Understanding Engine on iOS]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/05/22/offline-natural-language-understanding-engine-on-ios/"/>
    <updated>2019-05-22T16:04:28+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/05/22/offline-natural-language-understanding-engine-on-ios</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#objective">Objective</a>

<ul>
<li><a href="#what-is-a-good-nlu-engine">What is a good NLU engine</a>

<ul>
<li><a href="#deterministic-behavior">Deterministic behavior</a></li>
<li><a href="#generalization-power">Generalization power</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#design-and-workflow">Design and Workflow</a></li>
<li><a href="#deterministic-intent-parser">Deterministic Intent Parser</a></li>
<li><a href="#probabilistic-intent-parser">Probabilistic Intent Parser</a>

<ul>
<li><a href="#intent-classification">Intent Classification</a>

<ul>
<li><a href="#model-training">Model Training</a></li>
<li><a href="#model-usage">Model Usage</a></li>
</ul>
</li>
<li><a href="#slot-filling">Slot Filling</a>

<ul>
<li><a href="#model-training-1">Model Training</a></li>
<li><a href="#model-usage-1">Model Usage</a></li>
</ul>
</li>
<li><a href="#model-size">Model Size</a></li>
<li><a href="#problems-to-be-solved">Problems to Be Solved</a>

<ul>
<li><a href="#intent-classification-model-has-no-probability-output">Intent Classification Model Has No Probability Output</a></li>
<li><a href="#slot-filling-model-tagges-the-label-by-words-not-phrase">Slot Filling Model Tagges the Label by Words, not Phrase</a></li>
</ul>
</li>
</ul>
</li>
</ul>


<p><a id="markdown-objective" name="objective"></a></p>

<h2>Objective</h2>

<p><img src="http://hongchaozhang.github.io/images/NLUObjective.png" alt="nlu objective" /></p>

<p>We want an NLU Engine to understand the normal text command on Mobile. We hope the engine can know the command&rsquo;s intent and the info the command needs to execute.</p>

<p>Currently, there are many NLU related tools, like Google Dialogflow, Amazon Lex, Facebook Wit.ai, Microsoft Luis. However, they are all online tools. Considering the privacy problem, we are trying to build our own offline NLU Engine.</p>

<p><a id="markdown-what-is-a-good-nlu-engine" name="what-is-a-good-nlu-engine"></a></p>

<h3>What is a good NLU engine</h3>

<p>Let’s start by looking at a simple example, and see what you would expect from a good NLU engine.</p>

<p>First, we need some examples to train the NLU engine. Consider the following dataset, used to train a simple weather assistant with a few query examples:</p>

<ul>
<li>Give me the weather for [tomorrow](date)</li>
<li>Show me the [Paris](location) weather for [Sunday](date)</li>
</ul>


<p><a id="markdown-deterministic-behavior" name="deterministic-behavior"></a></p>

<h4>Deterministic behavior</h4>

<p>The first thing you want is that all the examples you give to train the model are correctly supported by the engine. This makes the system predictable and easy to use: if a query is not correctly parsed, then add it to the dataset and it will work right away.</p>

<p><a id="markdown-generalization-power" name="generalization-power"></a></p>

<h4>Generalization power</h4>

<p>Having this deterministic behavior is great for robustness and predictability, but a powerful NLU engine also needs to have some generalization power. You want the system not only to recognize patterns provided in the training set, but also all the possible variations that come from speaking naturally. If we go back to the previous dataset, it is reasonable to expect the NLU engine to parse a query like: “What’s the weather in Beijing right now?” even though it is not one of the training examples.</p>

<p><a id="markdown-design-and-workflow" name="design-and-workflow"></a></p>

<h2>Design and Workflow</h2>

<p><img src="http://hongchaozhang.github.io/images/NLUDesign.png" alt="nlu design" /></p>

<p>In order to satisfy these objectives: deterministic behavior and generalization power, we built the processing pipeline described in the figure above. It receives a text as input, and outputs a structured response containing the intent and the list of slots. The main processing unit of the pipeline is the NLU engine. It contains two intent parsers which are called successively: a deterministic intent parser and a probabilistic one.</p>

<p>The deterministic parser relies on regular expressions to match intent and slots, which results in perfect behavior on training examples but doesn’t generalize. This parser is the first to be used because of its strictness.</p>

<p>The probabilistic parser is used whenever the first parser fails to find a match. It uses machine learning to generalize beyond the set of sentences seen at train time, thus making our NLU engine be able to cope with examples which are not in the scope of the training data set. This parser involves two successive steps: intent classification and slot filling. These two steps rely on trained machine learning models to classify intent and extract slots.</p>

<p><a id="markdown-deterministic-intent-parser" name="deterministic-intent-parser"></a></p>

<h2>Deterministic Intent Parser</h2>

<p>The Deterministic Intent Parse is the first step to be used. This parser relies on some regular expressions to match the intent and slots. If the new input has the same structure with one of the training examples, we will find its intent and slots by comparing the input with the matched regular expression.</p>

<p>The regular expressions are built based on the training examples. For a training case:</p>

<ul>
<li>What is the weather in [Alaska](location)</li>
</ul>


<p>We will build a regular expression:</p>

<ul>
<li>(what is the weather in)(?&lt;location1&gt;.+)</li>
</ul>


<p><a id="markdown-probabilistic-intent-parser" name="probabilistic-intent-parser"></a></p>

<h2>Probabilistic Intent Parser</h2>

<p>If the Deterministic Intent Parser fails to find the intent and slots, the Probabilistic Intent Parser will be used.</p>

<p>The Probabilistic Intent Parser has two steps:</p>

<ul>
<li>Intent Classification</li>
<li>Slot Filling</li>
</ul>


<p>The Intent Classification is to find the intent of the input command text, and the Slot Filling is to extract all the slots needed by the intent. These two steps are both based on trained machine models.</p>

<p>Apple has released CreateML for training natural language models, which also integrates the powerful NatrualLanguage framework functions, like Tokenization, Part of Speech, Lemmatization, Name Entity Recognition, etc. This will make the training process very simple, and the trained model will be more accurate and smaller.</p>

<p><a id="markdown-intent-classification" name="intent-classification"></a></p>

<h3>Intent Classification</h3>

<p><a id="markdown-model-training" name="model-training"></a></p>

<h4>Model Training</h4>

<p>For Intent Classification model training, we prepare the data set as follows (The size of the training data is 3282 falling into four intents.):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;I would like the forecast in cupertino california  tomorrow&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;searchWeatherForecast&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Forecast in Maine USA next week&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;searchWeatherForecast&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Will I be able to wear open-toed shoes twenty three hours and seven minutes from now in Severn?&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;searchWeatherForecastItem&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Should I bring a raincoat to the Belgrade and Loreto areas of Oman at midnight?&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;searchWeatherForecastItem&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Apple has release CreateML framework for training machine learning models easily inside Swift playground and the trained model can be saved as mlmodel type. And the MLTextClassifier class from CreateML will benefit from Apple&rsquo;s NatrualLanguage framework for Tokenization, Part of Speech, Lemmatization, etc.</p>

<p>The training script is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">trainingDataPath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;intentClassificationFile&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="nl">inDirectory</span><span class="p">:</span> <span class="s">&quot;Data/text/train&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLDataTable</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span>  <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="n">trainingDataPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initializing the classifier with a training data.</span>
</span><span class='line'><span class="k">let</span> <span class="n">classifier</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLTextClassifier</span><span class="p">(</span><span class="nl">trainingData</span><span class="p">:</span> <span class="n">trainingData</span><span class="p">,</span> <span class="nl">textColumn</span><span class="p">:</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="nl">labelColumn</span><span class="p">:</span> <span class="s">&quot;label&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Evaluating training &amp; validation accuracies.</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">classifier</span><span class="p">.</span><span class="n">trainingMetrics</span><span class="p">.</span><span class="n">classificationError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'><span class="k">let</span> <span class="n">validationAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">classifier</span><span class="p">.</span><span class="n">validationMetrics</span><span class="p">.</span><span class="n">classificationError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initializing the properly labeled testing data from Resources folder.</span>
</span><span class='line'><span class="k">let</span> <span class="n">testingDataPath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;intentClassificationFile&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="nl">inDirectory</span><span class="p">:</span> <span class="s">&quot;Data/text/test&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">testingData</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLDataTable</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span><span class="n">testingDataPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Counting the testing evaluation.</span>
</span><span class='line'><span class="k">let</span> <span class="n">evaluationMetrics</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">.</span><span class="n">evaluation</span><span class="p">(</span><span class="nl">on</span><span class="p">:</span> <span class="n">testingData</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">evaluationAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">evaluationMetrics</span><span class="p">.</span><span class="n">classificationError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Confusion matrix in order to see which labels were classified wrongly.</span>
</span><span class='line'><span class="k">let</span> <span class="n">confusionMatrix</span> <span class="o">=</span> <span class="n">evaluationMetrics</span><span class="p">.</span><span class="n">confusion</span>
</span><span class='line'><span class="n">print</span><span class="p">(</span><span class="s">&quot;Confusion matrix: \(confusionMatrix)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Metadata for saving the model.</span>
</span><span class='line'><span class="k">let</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">MLModelMetadata</span><span class="p">(</span><span class="nl">author</span><span class="p">:</span> <span class="s">&quot;Hongchao Zhang&quot;</span><span class="p">,</span>
</span><span class='line'>                            <span class="nl">shortDescription</span><span class="p">:</span> <span class="s">&quot;A model trained to classify weather related commands.&quot;</span><span class="p">,</span>
</span><span class='line'>                            <span class="nl">version</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Saving the model. Remember to update the path.</span>
</span><span class='line'><span class="n">try</span><span class="o">!</span> <span class="n">classifier</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="s">&quot;/Users/hozhang/Downloads/textClassifier.mlmodel&quot;</span><span class="p">),</span>
</span><span class='line'>                    <span class="nl">metadata</span><span class="p">:</span> <span class="n">metadata</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can get 99.23% training accuracy and 98.87% validation accuracy.</p>

<p><a id="markdown-model-usage" name="model-usage"></a></p>

<h4>Model Usage</h4>

<p>For the trained model of mlmodel type, we can use it in our iOS app through NLModel (from NatrualLanguage framework). The demo swift code may be like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">modelUrl</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;Data/text/textClassifier&quot;</span><span class="p">,</span> <span class="nl">withExtension</span><span class="p">:</span> <span class="s">&quot;mlmodel&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">compiledModelUrl</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLModel</span><span class="p">.</span><span class="n">compileModel</span><span class="p">(</span><span class="nl">at</span><span class="p">:</span> <span class="n">modelUrl</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">classifier</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">NLModel</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span> <span class="n">compiledModelUrl</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="n">requestText</span>
</span><span class='line'><span class="k">let</span> <span class="n">label</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">.</span><span class="n">predictedLabel</span><span class="p">(</span><span class="k">for</span><span class="o">:</span> <span class="n">text</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">print</span><span class="p">(</span><span class="s">&quot;text: \(text)</span><span class="se">\n</span><span class="s">label:\(label ?? &quot;</span><span class="n">Not</span> <span class="n">detected</span><span class="o">!</span><span class="s">&quot;)&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><strong>How to use .mlmodel file?</strong></p>

<p>.mlmodel file needs to be compiled before using. There are two ways to do this: offline and online:</p>

<ol>
<li>offline: drag the mlmodel into your project, xcode will compile the .mlmodel for you before you build you app.</li>
<li>online: use <code>MLModel.compileModel</code> to compile your .mlmodel file at runtime. This is especially useful when your are at swift playground, where you cannot get xcode&rsquo;s help for comipling.</li>
</ol>
</blockquote>

<p><a id="markdown-slot-filling" name="slot-filling"></a></p>

<h3>Slot Filling</h3>

<p><a id="markdown-model-training-1" name="model-training-1"></a></p>

<h4>Model Training</h4>

<p>For Slot Filling model training, we prepare the data set as follows (The size of the training data is: 3282.):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;would&quot;</span><span class="p">,</span> <span class="s2">&quot;like&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;forecast&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;california&quot;</span><span class="p">,</span> <span class="s2">&quot;tomorrow&quot;</span><span class="p">],</span>
</span><span class='line'>    <span class="nt">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">]</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;Maine&quot;</span><span class="p">,</span> <span class="s2">&quot;next week&quot;</span><span class="p">],</span>
</span><span class='line'>    <span class="nt">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">]</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Like Intent Classification model training, CreateML framework also makes it easy. Like MLTextClassifier, the MLWordTagger class from CreateML will also benefit from NatrualLanguage framework for Part of Speech, Lemmatization, Name Entity Recognition, etc.</p>

<p>The training script is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// Initializing the training data from Resources folder.</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingDataPath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;slotParsingFile&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="nl">inDirectory</span><span class="p">:</span> <span class="s">&quot;Data/text/train&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLDataTable</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span>  <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="n">trainingDataPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initializing the classifier with a training data.</span>
</span><span class='line'><span class="k">let</span> <span class="n">classifier</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLWordTagger</span><span class="p">(</span><span class="nl">trainingData</span><span class="p">:</span> <span class="n">trainingData</span><span class="p">,</span> <span class="nl">tokenColumn</span><span class="p">:</span> <span class="s">&quot;tokens&quot;</span><span class="p">,</span> <span class="nl">labelColumn</span><span class="p">:</span> <span class="s">&quot;labels&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Evaluating training &amp; validation accuracies.</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">classifier</span><span class="p">.</span><span class="n">trainingMetrics</span><span class="p">.</span><span class="n">taggingError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'><span class="k">let</span> <span class="n">validationAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">classifier</span><span class="p">.</span><span class="n">validationMetrics</span><span class="p">.</span><span class="n">taggingError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initializing the properly labeled testing data from Resources folder.</span>
</span><span class='line'><span class="k">let</span> <span class="n">testingDataPath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;slotParsingFile&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="nl">inDirectory</span><span class="p">:</span> <span class="s">&quot;Data/text/test&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">testingData</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLDataTable</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span><span class="n">testingDataPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Counting the testing evaluation.</span>
</span><span class='line'><span class="k">let</span> <span class="n">evaluationMetrics</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">.</span><span class="n">evaluation</span><span class="p">(</span><span class="nl">on</span><span class="p">:</span> <span class="n">testingData</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">evaluationAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">evaluationMetrics</span><span class="p">.</span><span class="n">taggingError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Confusion matrix in order to see which labels were classified wrongly.</span>
</span><span class='line'><span class="k">let</span> <span class="n">confusionMatrix</span> <span class="o">=</span> <span class="n">evaluationMetrics</span><span class="p">.</span><span class="n">confusion</span>
</span><span class='line'><span class="n">print</span><span class="p">(</span><span class="s">&quot;Confusion matrix: \(confusionMatrix)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Metadata for saving the model.</span>
</span><span class='line'><span class="k">let</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">MLModelMetadata</span><span class="p">(</span><span class="nl">author</span><span class="p">:</span> <span class="s">&quot;Hongchao Zhang&quot;</span><span class="p">,</span>
</span><span class='line'>                                <span class="nl">shortDescription</span><span class="p">:</span> <span class="s">&quot;A model trained to parse slots from weather related commands.&quot;</span><span class="p">,</span>
</span><span class='line'>                                <span class="nl">version</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Saving the model. Remember to update the path.</span>
</span><span class='line'><span class="n">try</span><span class="o">!</span> <span class="n">classifier</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="s">&quot;/Users/hozhang/Downloads/slotParsing.mlmodel&quot;</span><span class="p">),</span>
</span><span class='line'>                        <span class="nl">metadata</span><span class="p">:</span> <span class="n">metadata</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can get 99.64% training accuracy and 98.38% validation accuracy.</p>

<p><a id="markdown-model-usage-1" name="model-usage-1"></a></p>

<h4>Model Usage</h4>

<p>We can load the mlmodel into an NLTagger (from NatrualLanguage framework), and use the NLTagger to tag labels for each word of the input command text. The demo swift script is like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">weatherTagSchema</span> <span class="o">=</span> <span class="n">NLTagScheme</span><span class="p">(</span><span class="s">&quot;Weather&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">modelUrl</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;Data/text/slotParsing&quot;</span><span class="p">,</span> <span class="nl">withExtension</span><span class="p">:</span> <span class="s">&quot;mlmodel&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">compiledModelUrl</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLModel</span><span class="p">.</span><span class="n">compileModel</span><span class="p">(</span><span class="nl">at</span><span class="p">:</span> <span class="n">modelUrl</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">taggerModel</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">NLModel</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span> <span class="n">compiledModelUrl</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">weatherTagger</span> <span class="o">=</span> <span class="n">NLTagger</span><span class="p">(</span><span class="nl">tagSchemes</span><span class="p">:</span> <span class="p">[</span><span class="n">weatherTagSchema</span><span class="p">])</span>
</span><span class='line'><span class="n">weatherTagger</span><span class="p">.</span><span class="n">setModels</span><span class="p">([</span><span class="n">taggerModel</span><span class="p">],</span> <span class="nl">forTagScheme</span><span class="p">:</span> <span class="n">weatherTagSchema</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="n">requestText</span>
</span><span class='line'><span class="n">weatherTagger</span><span class="p">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">text</span>
</span><span class='line'><span class="n">weatherTagger</span><span class="p">.</span><span class="n">enumerateTags</span><span class="p">(</span><span class="k">in</span><span class="o">:</span> <span class="n">text</span><span class="p">.</span><span class="n">startIndex</span><span class="p">..</span><span class="o">&lt;</span><span class="n">text</span><span class="p">.</span><span class="n">endIndex</span><span class="p">,</span> <span class="nl">unit</span><span class="p">:</span> <span class="p">.</span><span class="n">word</span><span class="p">,</span> <span class="nl">scheme</span><span class="p">:</span> <span class="n">weatherTagSchema</span><span class="p">,</span> <span class="nl">options</span><span class="p">:</span> <span class="p">[])</span> <span class="p">{</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">tokenRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="k">in</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">.</span><span class="n">rawValue</span> <span class="o">!=</span> <span class="s">&quot;Whitespace&quot;</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;\(text[tokenRange]): \(tag.rawValue)&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">true</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong> Reference </strong></p>

<ol>
<li><a href="https://developer.apple.com/documentation/createml/creating_a_text_classifier_model">Creating a Text Classifier Model</a>: Apple offical site for training and using machine learning models through CreateML framework.</li>
<li>WWDC video <a href="https://developer.apple.com/videos/play/wwdc2018/713/">Introducing Natural Language Framework</a>: This session introduces NLP framework and its relation with CreateML framework.</li>
</ol>


<p><a id="markdown-model-size" name="model-size"></a></p>

<h3>Model Size</h3>

<p>For the iOS app, we hope the machine learning model size is small enough. Apple&rsquo;s NatrualLanguage framework has done many optimizations on machine learning model size. The following data is from WWDC 2018 (session 713: Introducing NatrualLanguage Framework):</p>

<table>
<thead>
<tr>
<th>&ndash; </th>
<th> Open Source CRFSuite </th>
<th> Natural Language Framework</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name Entity Recognition </td>
<td> 70MB  </td>
<td> 1.4MB</td>
</tr>
<tr>
<td>Chunking </td>
<td> 30MB </td>
<td> 1.8MB</td>
</tr>
</tbody>
</table>


<p>We can see that the model will be much smaller than that trained from an open source platform.</p>

<p>The size of the two models we trained is (The training data size is: 3282):</p>

<table>
<thead>
<tr>
<th>Model </th>
<th> Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intent Classification </td>
<td> 41K</td>
</tr>
<tr>
<td>Slot Filling </td>
<td> 609K</td>
</tr>
</tbody>
</table>


<p>If your model is a neural network, you can reduce the size of your model by the following way:
<a href="https://developer.apple.com/documentation/coreml/reducing_the_size_of_your_core_ml_app">Reducing the Size of Your Core ML App</a>. You can control the precision of the neural network parameters, and thus the size of the trained model.</p>

<p>If still your model is large, you can
<a href="https://developer.apple.com/documentation/coreml/core_ml_api/downloading_and_compiling_a_model_on_the_user_s_device">Downloading and Compiling a Model on the User&rsquo;s Device</a> at runtime.</p>

<p><a id="markdown-problems-to-be-solved" name="problems-to-be-solved"></a></p>

<h3>Problems to Be Solved</h3>

<p>For Probabilistic Intent Parser, we still have some problems.</p>

<p><a id="markdown-intent-classification-model-has-no-probability-output" name="intent-classification-model-has-no-probability-output"></a></p>

<h4>Intent Classification Model Has No Probability Output</h4>

<p>We may need the probability to define the reliability of the estimated intent of an input command text.</p>

<p>However, the model trained through <code>MLTextClassifier</code> has no probability output API. If we really need the probability output, we can use other platforms to train the model, like tensorflow. That way, we will not benefit from NatrualLanguage framework and we need to consider these things by ourselves, like Tokenization, Part of Speech, Lemmatization, etc.</p>

<blockquote><p>Try other tools for training models with probability output, like Turi.</p></blockquote>

<p><a id="markdown-slot-filling-model-tagges-the-label-by-words-not-phrase" name="slot-filling-model-tagges-the-label-by-words-not-phrase"></a></p>

<h4>Slot Filling Model Tagges the Label by Words, not Phrase</h4>

<p>The NLTagger class only supply the following four tag level: word, sentence, paragraph, and document. There is no &ldquo;phrase&rdquo; tag level. For example, &ldquo;New York&rdquo; will be treated as &ldquo;New&rdquo; and &ldquo;York&rdquo;, and the tagged label will both be &ldquo;location&rdquo;. We need to compose them together manually.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何控制iOS应用的屏幕方向]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/05/21/understand-ios-app-orientations/"/>
    <updated>2019-05-21T18:24:35+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/05/21/understand-ios-app-orientations</id>
    <content type="html"><![CDATA[<!-- more -->


<h2>背景</h2>

<p>一个iOS应用默认都会支持所有的是个方向，当用户旋转屏幕的时候，应用会自动旋转。</p>

<p>有些时候，这可能不是我们想要的。比如你设计了一个只支持竖屏方向的应用，但是又想在某些时候支持Landscape模式，比如播放视频的时候。iOS应用有很多地方的设置会影响屏幕方向，iOS9之后，iPad又支持了split view，使得这个控制更加复杂。</p>

<h2>总起</h2>

<p>iPhone比较简单，因为其没有spit view的功能，iPad因为有了spilt view功能，在屏幕方向的控制上更复杂一些。</p>

<p>首先，需要明确：有哪些因素会影响到App的屏幕方向？</p>

<p><strong>1. Project设置（info.plist）</strong></p>

<p>有两个地方可以进行该项设置：</p>

<ul>
<li><p>Project->Target->General->Device Orientation</p>

<p><img src="http://hongchaozhang.github.io/images/ScreenOrientationProjectSetting.png" alt="screen orientation project setting" /></p></li>
<li><p>Project的info.plist配置文件</p>

<p><img src="http://hongchaozhang.github.io/images/ScreenOrientationInfoPlist.png" alt="screen orientation info plist" /></p></li>
</ul>


<p>这两个地方的设置是一致的：在一个地方改动，另一个地方会同步修改。其中：info.plist中的“Supported interface orientations (iPad)”属性对应于iPad的设置（Device选择iPad），info.plist中的“Supported interface orientations”属性对应于iPhone和Universal的设置（Device选择iPhone或者Universal，这两项的设置始终保持一致）。</p>

<p><strong>2. 在代码中设置应用支持的屏幕方向</strong></p>

<p>有两种方法可以在代码中设置应用支持的屏幕方向：</p>

<ul>
<li><code>UIApplicationDelegate</code>中的<code>supportedInterfaceOrientationsForWindow:</code>方法</li>
<li>每个<code>UIViewController</code>还可以通过<code>supportedInterfaceOrientations</code>方法设置自己支持的屏幕方向</li>
</ul>


<p>系统会自动将两种方法中支持的屏幕方向取交集，作为最终该view controller支持的屏幕方向。如果交集为空，那么应用将会Crash。</p>

<p><strong>3. <code>UIViewController</code>中的<code>shouldAutorotate</code>属性</strong></p>

<p>该属性是只读属性，用来控制该view controller可不可以旋转。可以在自己的view controller中将其override，返回自己的逻辑，甚至将其override为读写属性，可以在其它地方进行设置。比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="n">public</span> <span class="k">var</span> <span class="nl">shouldAutorotate</span><span class="p">:</span> <span class="n">Bool</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">get</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">shouldAutorotateVariable</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="kr">set</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">shouldAutorotateVariable</span> <span class="o">=</span> <span class="n">newValue</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中<code>shouldAutorotateVariable</code>为view controller中自定义的一私有变量。</p>

<h2>iPhone</h2>

<p>如果某个view controller中的<code>shouldAutorotate</code>被设置为<code>false</code>，那么系统将忽略下面的设置：</p>

<ul>
<li><code>UIApplicationDelegate</code>中的<code>supportedInterfaceOrientationsForWindow:</code>方法</li>
<li>该<code>UIViewController</code>通过<code>supportedInterfaceOrientations</code>方法设置的自己支持的屏幕方向</li>
</ul>


<p>系统只考虑用户在“Project设置（info.plist）”中的设置。</p>

<p>如果某个view controller中的<code>shouldAutorotate</code>未被重写（或者被重写为<code>true</code>），那么系统将优先考虑使用下面两个设置的交集：</p>

<ul>
<li><code>UIApplicationDelegate</code>中的<code>supportedInterfaceOrientationsForWindow:</code>方法</li>
<li>该<code>UIViewController</code>通过<code>supportedInterfaceOrientations</code>方法设置的自己支持的屏幕方向</li>
</ul>


<p>如果没有以上两个设置，再使用“Project设置（info.plist）”中的设置。</p>

<h2>iPad</h2>

<p>从iOS9开始，iPad开始支持split view功能。关于这个功能的设置说明，可以参考苹果官方文档：<a href="https://developer.apple.com/library/archive/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/QuickStartForSlideOverAndSplitView.html#//apple_ref/doc/uid/TP40015145-CH13-SW1">Slide Over and Split View Quick Start</a>。简单的说，就是：如果info.plist中的“Supported interface orientations (iPad)”属性对应的值包含了四个方向，同时<code>UIRequiresFullScreen</code>对应的值为<code>NO</code>，那么系统默认该应用支持split view属性，同时系统将忽略下面两处代码：</p>

<ul>
<li><code>UIApplicationDelegate</code>中的<code>supportedInterfaceOrientationsForWindow:</code>方法</li>
<li><code>UIViewController</code>通过<code>supportedInterfaceOrientations</code>方法设置的自己支持的屏幕方向</li>
</ul>


<p>以及<code>UIViewController</code>中<code>shouldAutorotate</code>的值。</p>

<p>也就是说：支持split view的应用将不能被禁止旋转，至少不能通过本文中的方法进行禁止旋转。</p>

<p>如果info.plist中的“Supported interface orientations (iPad)”属性对应的值未包含四个方向，或者“UIRequiresFullScreen”对应的值为<code>NO</code>，那么该应用不支持split view功能，其屏幕方向控制方法同iPhone相同。</p>

<blockquote><p>注意：对于“Project设置（info.plist）”设置，建议在info.plist中进行，直接设置一下三个属性的值：
* Supported interface orientations (iPad)
* Supported interface orientations
* UIRequiresFullScreen</p>

<p>在Project->Target->General->Device Orientation中进行设置，有点迷惑性：因为即使“Device”选的是“Universal”，“iPad”下面的设置也会起作用。</p></blockquote>

<h2>参考</h2>

<ol>
<li><a href="https://mobiarch.wordpress.com/2017/04/22/controlling-screen-orientation-of-ios-apps/">Controlling Screen Orientation of iOS Apps</a></li>
<li><a href="https://stackoverflow.com/questions/32782044/ios-9-supportedinterfaceorientations-not-working/32782517#32782517">iOS 9 supportedInterfaceOrientations not working</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/QuickStartForSlideOverAndSplitView.html#//apple_ref/doc/uid/TP40015145-CH13-SW1">Slide Over and Split View Quick Start</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[架构整洁之道总结（The Clean Architecture）]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/02/12/reading-the-clean-architecture/"/>
    <updated>2019-02-12T17:55:48+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/02/12/reading-the-clean-architecture</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#%E6%80%BB%E4%BD%93%E6%84%9F%E6%83%B3">总体感想</a></li>
<li><a href="#%E7%AB%A0%E8%8A%82%E5%B0%8F%E7%BB%93">章节小结</a>

<ul>
<li><a href="#%E7%AC%AC2%E7%AB%A0-%E4%B8%A4%E4%B8%AA%E4%BB%B7%E5%80%BC%E7%BB%B4%E5%BA%A6">第2章 两个价值维度</a></li>
<li><a href="#%E7%AC%AC14%E7%AB%A0-%E7%BB%84%E4%BB%B6%E8%80%A6%E5%90%88">第14章 组件耦合</a></li>
<li><a href="#%E7%AC%AC15%E7%AB%A0-%E4%BB%80%E4%B9%88%E6%98%AF%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84">第15章 什么是软件架构</a></li>
<li><a href="#%E7%AC%AC17%E7%AB%A0-%E5%88%92%E5%88%86%E8%BE%B9%E7%95%8C">第17章 划分边界</a></li>
<li><a href="#%E7%AC%AC21%E7%AB%A0-%E5%B0%96%E5%8F%AB%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84">第21章 尖叫的软件架构</a></li>
<li><a href="#%E7%AC%AC22%E7%AB%A0-%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84">第22章 整洁架构</a></li>
<li><a href="#%E7%AC%AC23%E7%AB%A0-%E5%B1%95%E7%A4%BA%E5%99%A8%E5%92%8C%E8%B0%A6%E5%8D%91%E5%AF%B9%E8%B1%A1">第23章 展示器和谦卑对象</a></li>
<li><a href="#%E7%AC%AC24%E7%AB%A0-%E4%B8%8D%E5%AE%8C%E5%85%A8%E8%BE%B9%E7%95%8C">第24章 不完全边界</a></li>
<li><a href="#%E7%AC%AC25%E7%AB%A0-%E5%B1%82%E6%AC%A1%E4%B8%8E%E8%BE%B9%E7%95%8C">第25章 层次与边界</a></li>
<li><a href="#%E7%AC%AC28%E7%AB%A0-%E6%B5%8B%E8%AF%95%E8%BE%B9%E7%95%8C">第28章 测试边界</a></li>
<li><a href="#%E7%AC%AC34%E7%AB%A0-%E6%8B%BE%E9%81%97">第34章 拾遗</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E5%AE%83%E4%BA%BA%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%BB%E5%90%8E%E6%80%BB%E7%BB%93">其它人的一些读后总结</a>

<ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AF%B4%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%9B%BE">为什么说我们需要软件架构图？</a></li>
<li><a href="#%E6%8E%A8%E8%8D%90%E6%9E%B6%E6%9E%84%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93">推荐《架构整洁之道》</a></li>
</ul>
</li>
</ul>


<p><a id="markdown-总体感想" name="总体感想"></a></p>

<h2>总体感想</h2>

<p>全书下来，印象最深、且最具有操作性的，就是：</p>

<p><strong>依赖反转</strong></p>

<p>源代码依赖方向永远是控制流方向的反转。
依赖关系必须要指向更稳定的方向：低层组件依赖高层组件，其中低层组件不稳定，高层组件稳定。
依赖关系应该指向更稳定的方向。</p>

<p>稳定抽象原则：一个组件的抽象程度应该与其稳定性保持一致。</p>

<p>系统的抽象程度和稳定性都可以量化，进而用来评测系统的质量。</p>

<p>系统在运行时的依赖关系与编译时的依赖关系是相反的：当高层组件的客户端需要调用低层组件中的服务时，我们就需要运用动态形式的多态来反转依赖关系。（第18章）</p>

<p>我们希望源码中的依赖关系与其数据流向脱钩，而与组件所在的层次挂钩。高层组件变更的原因具有“稀少而重大”的特点，低层组件变更的原因具有“频繁而不重大”的特点。（第19章）</p>

<p><a id="markdown-章节小结" name="章节小结"></a>
<a id="markdown-章节小结" name="章节小结"></a></p>

<h2>章节小结</h2>

<p><a id="markdown-第2章-两个价值维度" name="第2章-两个价值维度"></a></p>

<h3>第2章 两个价值维度</h3>

<p>系统行为，是紧急的。</p>

<p>系统架构，是重要的。</p>

<p>平衡系统架构的重要性与功能的紧急程度这件事，是软件研发人员自己的职责。因为业务部门本来就没有能力评估架构设计的重要程度。</p>

<p>请记住：如果忽视软件架构的价值，系统将会变得越来越难以维护，最终再也无法修改。如果系统变成了这个样子，那么说明软件开发团队没有和需求方做足够的抗争，没有完成自己应尽的职责。</p>

<p><a id="markdown-第14章-组件耦合" name="第14章-组件耦合"></a></p>

<h3>第14章 组件耦合</h3>

<p>组件依赖关系图不是系统功能单元关系图，而是应用程序在构建性和维护性方面的一张地图。所以组件依赖关系图不能像系统功能单元关系图一样在设计之初就确定下来，而是随着开发进程中出现的维护性和构建性的需求而产生的。</p>

<p><a id="markdown-第15章-什么是软件架构" name="第15章-什么是软件架构"></a></p>

<h3>第15章 什么是软件架构</h3>

<p>如果想设计一个便于推进各项工作的系统，其策略就是要在设计中尽可能长时间地保留尽可能多的选项。</p>

<p>如果在开发高层策略时有意识地让自己摆脱具体细节的纠缠，我们就可以将与具体实现相关的细节决策推迟或延后，因为越到项目的后期，我们就拥有越多的信息来做出合理的决策。
另外，我们保留这些可选项的时间越长，实验的机会越多，我们做决策的时候就能拥有越充分的信息。</p>

<p><strong>一个优秀的软件架构师应该致力于最大化可选项数量。</strong></p>

<p><a id="markdown-第17章-划分边界" name="第17章-划分边界"></a></p>

<h3>第17章 划分边界</h3>

<p>软件架构设计本身就是一门划分边界的艺术。</p>

<p>一个系统的GUI与业务逻辑的变更原因、变更速率显然是不同的，所以二者中间应该有一条边界。同样的，一个系统的业务逻辑与依赖注入框架之间的变更原因和变更速率也会不同，它们之间也应该画边界线。</p>

<p>这其实就是单一指责原则（SRP）的具体实现。SRP的作用就是告诉我们应该在哪里画边界线。</p>

<p><strong>插件式架构</strong></p>

<p>事实上，软件开发技术发展的历史就是一个如何想方设法方便地增加插件，从而构建一个可扩展、可维护的系统架构的故事。</p>

<p><a id="markdown-第21章-尖叫的软件架构" name="第21章-尖叫的软件架构"></a></p>

<h3>第21章 尖叫的软件架构</h3>

<p>架构设计的核心目标：</p>

<p>一个良好的架构设计应该围绕用例来展开，这样的架构设计可以在脱离框架、工具以及使用环境的情况下完整地描述用例。</p>

<blockquote><p>这就好像一个住宅建筑设计的首要目的应该是满足住宅的使用需求，而不是确保一定要用砖来构建这个房子。架构师应该花费很多精力来确保该架构的设计在满足用例需要的情况下，尽可能地允许用户能自由地选择建筑材料（砖头、石料或者木材）。</p></blockquote>

<p>而且，良好的架构设计应该尽可能地允许用户推迟和延后决定采用什么框架、数据库、Web服务以及其它与环境相关的工具。同时，良好的架构设计还应该让我们很容易改变这些决定。</p>

<p>总之，良好的架构设计应该只关注用例，并能将它们与其他的周边因素隔离。</p>

<p><a id="markdown-第22章-整洁架构" name="第22章-整洁架构"></a></p>

<h3>第22章 整洁架构</h3>

<p>整本书的核心总结。</p>

<p><img src="http://hongchaozhang.github.io/images/CleanArchitecture22fig01.jpg" alt="clean architecture image" /></p>

<p>代码中的依赖关系必须指向同心圆的内层，即由低层机制指向高层机制。</p>

<p>比如下面这个例子就严格地遵守了依赖倒置原则，同时也就遵守了上面的设计原则：依赖关系指向同心圆的内层：</p>

<p><img src="http://hongchaozhang.github.io/images/CleanArchitecture22fig02.jpg" alt="clean architecture example" /></p>

<p><a id="markdown-第23章-展示器和谦卑对象" name="第23章-展示器和谦卑对象"></a></p>

<h3>第23章 展示器和谦卑对象</h3>

<p>应用程序所能控制的，要在屏幕上显示的一切东西，都应该在视图模型中以字符串、布尔值或者枚举类型的形式存在。然后，视图部分除了加载视图模型所需要的值，不应该再做任何其他事情。因此，我们才能说视图是谦卑对象。</p>

<blockquote><p>这里的视图有点像Redux模式下的View了：只负责忠实地将Model展现出来。</p></blockquote>

<p><a id="markdown-第24章-不完全边界" name="第24章-不完全边界"></a></p>

<h3>第24章 不完全边界</h3>

<p>用于管理输入输出数据结构的双向多态边界接口，以及依赖反转关系的管理都需要耗费资源。某些情况下可以采用一些折中方案，采用某种不完全边界：单向边界、门户模式、省掉最后一步…。</p>

<p><a id="markdown-第25章-层次与边界" name="第25章-层次与边界"></a></p>

<h3>第25章 层次与边界</h3>

<p>“中庸”之道：
过度设计边界不对，一点不设计也是不合理的，我们能做的就是不断观察系统演进，权衡各个位置设计边界的成本与收益。</p>

<p><a id="markdown-第28章-测试边界" name="第28章-测试边界"></a></p>

<h3>第28章 测试边界</h3>

<p>测试：
针对系统组成部分来设计的测试是紧耦合的，比如针对每个类的每个方法进行的测试。最终这些测试都会被抛弃。</p>

<p>不要依赖于多变的东西。比如GUI一般是多变的，通过GUI来验证系统的测试一定是脆弱的。因此，我们在系统设计与测试设计时，应该让业务逻辑不通过GUI也能被测试。
怎么做：让GUI成为“谦卑对象”，只是忠实地反应一些数据（Redux模式）。</p>

<p><a id="markdown-第34章-拾遗" name="第34章-拾遗"></a></p>

<h3>第34章 拾遗</h3>

<p>这一章中，作者提到了一个重要的实现细节问题：访问权限修饰符（public、private等），以及该细节对整体设计架构的影响。</p>

<p>以网上书店为例，作者按照四种方法试图对系统进行模块化：按层封装，按功能封装，端口和适配器封装，按组件封装。每种模式都有各自的优缺点，但是这不是问题的重点。重点是：如果你在实现各个模式的时候，不能严格确定每个变量和方法的访问权限，那么所有的设计都等于“没有设计”。</p>

<p>四种设计模式图应该是这个样子：</p>

<p><img src="http://hongchaozhang.github.io/images/CleanArchitecture34fig08.jpg" alt="model with access control attributes" /></p>

<p>其中虚化的部分代表只可在本包内可见的部分。</p>

<p>如果不能严格使用访问权限修饰符，那么理想中的模块化将会发生变化。极端一点，如果所有属性和方法都是public，那么这四种模式将变成下面的样子：</p>

<p><img src="http://hongchaozhang.github.io/images/CleanArchitecture34fig07.jpg" alt="model with access control attributes" /></p>

<p><strong>四种模式将完全一样！完全一样，只是由于我们没有严格地使用访问权限修饰符！</strong></p>

<p><a id="markdown-其它人的一些读后总结" name="其它人的一些读后总结"></a>
<a id="markdown-其它人的一些读后总结" name="其它人的一些读后总结"></a></p>

<h2>其它人的一些读后总结</h2>

<p><a id="markdown-为什么说我们需要软件架构图" name="为什么说我们需要软件架构图"></a>
<a id="markdown-为什么说我们需要软件架构图httpswwwinfoqcnarticleghprruloyyoqs8fr1ph" name="为什么说我们需要软件架构图httpswwwinfoqcnarticleghprruloyyoqs8fr1ph"></a></p>

<h3><a href="https://www.infoq.cn/article/GhprrUlOYyOqS8*FR1pH">为什么说我们需要软件架构图？</a></h3>

<p>这篇文章中肯、实用，提出的一些观点具有很大的可操作性：
1. 我们常犯的最大的一个错误是为系统中具有高波动性的部分创建详细的架构图。除非是自动生成的，否则手动维护它们对我们来说就是一种负担。
2. 在实践中，大多数利益相关者对详细架构图不感兴趣，但会对一两个反映系统模块和边界的高级架构图感兴趣。除此之外，要深入理解系统，代码才是事实的来源。
3. 请停止为代码中自解释的内容创建详细的架构图，或者当没有真正受众时。
4. 直接询问利益相关者：你们希望从文档中获得什么信息？</p>

<p><a id="markdown-推荐架构整洁之道" name="推荐架构整洁之道"></a>
<a id="markdown-推荐架构整洁之道httpsblogcsdnnetcsdnsevennarticledetails83189597" name="推荐架构整洁之道httpsblogcsdnnetcsdnsevennarticledetails83189597"></a></p>

<h3><a href="https://blog.csdn.net/csdnsevenn/article/details/83189597">推荐《架构整洁之道》</a></h3>

<p>简单vs.简陋、平衡vs.妥协、迭代vs.半成品</p>

<p>这些拥有工匠精神的工程师们还是难以解决某些问题，这些人渐渐地发现，这个世界上有很多问题就像翘翘板一样，只能要一边，这一边上去了，另一边就下来了。就像要么用空间换时间，要么用时间换空间一样，你很难找到同时满足空间和时间要求的“双利解”；就像CAP的三选二的理论一样，这个世界不存在完美的解决方案，无论什么方案都有好的一面和不好的一面。而且，这些工程师还渐渐发现，每当引入一个新的技术来解决一个已有的问题时，这个新的技术就会带来更多的问题，问题就像有一个生命体一样，它们会不断地繁殖和进化。渐渐地，他们发现，问题的多少和系统的复杂度呈正比，而且不仅是线性正比，还可能呈级数正比，此时就越来越难做技术决定。但是有一些资深的工程师开始站出来挑战这些问题，有的基于业务分析给出平衡的方案，有的开始尝试设计更高级的技术，有的开始设计更灵活的系统，有的则开始简化和轻量化整个系统……这些高智商、经验足、不怕难的工程师们引领着整个行业前行。他们就是架构师！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[编程中的SOLID原则]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/12/04/solid-principles-while-programming/"/>
    <updated>2018-12-04T11:31:35+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/12/04/solid-principles-while-programming</id>
    <content type="html"><![CDATA[<p>Robert C. Martin (Bob大叔)在《敏捷软件开发》中提出了编程过程中的五个原则，以适应敏捷开发（Agile）的特点：以微小增量的方式构建软件。</p>

<!-- more -->


<p><br></p>

<ul>
<li><a href="#solid%E5%8E%9F%E5%88%99">SOLID原则</a></li>
<li><a href="#%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99the-single-responsibility-principle%E7%AE%80%E7%A7%B0srp">单一职责原则（The Single Responsibility Principle，简称SRP）</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89">定义</a></li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%81%8C%E8%B4%A3">什么是职责</a></li>
<li><a href="#%E7%BB%93%E8%AE%BA">结论</a></li>
</ul>
</li>
<li><a href="#%E5%BC%80%E6%94%BE%E5%B0%81%E9%97%AD%E5%8E%9F%E5%88%99the-open-close-principle%E7%AE%80%E7%A7%B0ocp">开放——封闭原则（The Open-Close Principle，简称OCP）</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-1">定义</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E6%98%AF%E6%8A%BD%E8%B1%A1">关键是抽象</a>

<ul>
<li><a href="#%E6%8E%A5%E5%8F%A3">接口</a></li>
<li><a href="#%E7%BB%A7%E6%89%BF">继承</a></li>
</ul>
</li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1">什么时候进行抽象</a></li>
<li><a href="#%E7%BB%93%E8%AE%BA-1">结论</a></li>
</ul>
</li>
<li><a href="#liskov%E6%9B%BF%E6%8D%A2%E5%8E%9F%E5%88%99the-liskov-substitution-priciple%E7%AE%80%E7%A7%B0lsp">Liskov替换原则（The Liskov Substitution Priciple，简称LSP）</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-2">定义</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E8%BF%9D%E5%8F%8Dlsp%E7%9A%84%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90">一个违反LSP的简单例子</a></li>
<li><a href="#%E6%AD%A3%E6%96%B9%E5%BD%A2%E5%92%8C%E9%95%BF%E6%96%B9%E5%BD%A2%E7%9A%84%E5%85%B3%E7%B3%BB%E6%9B%B4%E5%BE%AE%E5%A6%99%E7%9A%84%E8%BF%9D%E8%A7%84">正方形和长方形的关系：更微妙的违规</a></li>
<li><a href="#%E5%85%B6%E5%AE%83%E4%B8%80%E4%BA%9B%E5%AE%B9%E6%98%93%E5%AF%BC%E8%87%B4%E8%BF%9D%E5%8F%8Dlsp%E7%9A%84%E4%B9%A0%E6%83%AF%E7%94%A8%E6%B3%95">其它一些容易导致违反LSP的习惯用法</a>

<ul>
<li><a href="#%E5%AD%90%E7%B1%BB%E4%B8%AD%E7%9A%84%E9%80%80%E5%8C%96%E5%87%BD%E6%95%B0">子类中的退化函数</a></li>
<li><a href="#%E5%AD%90%E7%B1%BB%E6%8A%9B%E5%87%BA%E5%9F%BA%E7%B1%BB%E6%B2%A1%E6%9C%89%E7%9A%84%E5%BC%82%E5%B8%B8">子类抛出基类没有的异常</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E8%AE%BA-2">结论</a></li>
</ul>
</li>
<li><a href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99the-dependency-inversion-principle%E7%AE%80%E7%A7%B0dip">依赖倒置原则（The Dependency Inversion Principle，简称DIP）</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-3">定义</a></li>
<li><a href="#%E4%BE%9D%E8%B5%96%E4%BA%8E%E6%8A%BD%E8%B1%A1">依赖于抽象</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90">一个例子</a></li>
<li><a href="#%E7%BB%93%E8%AE%BA-3">结论</a></li>
</ul>
</li>
<li><a href="#%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99the-interface-segregation-principle%E7%AE%80%E7%A7%B0isp">接口隔离原则（The Interface Segregation Principle，简称ISP）</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-4">定义</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90%E5%AE%9A%E6%97%B6%E9%97%A8">一个例子：定时门</a>

<ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%A7%94%E6%89%98%E5%AF%B9%E6%8E%A5%E5%8F%A3%E5%88%86%E7%BB%84">使用委托对接口分组</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF%E5%AF%B9%E6%8E%A5%E5%8F%A3%E5%88%86%E7%BB%84">使用多重继承对接口分组</a></li>
</ul>
</li>
<li><a href="#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90atm%E7%95%8C%E9%9D%A2">一个例子：ATM界面</a>

<ul>
<li><a href="#%E5%A4%9A%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F%E4%B8%8E%E5%8D%95%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F">多参数形式与单参数形式</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E8%AE%BA-4">结论</a></li>
</ul>
</li>
</ul>


<p> <br></p>

<p><a id="markdown-solid原则" name="solid原则"></a></p>

<h2>SOLID原则</h2>

<p>SOLID是指我们编程时应该遵守的五个原则：</p>

<ol>
<li>单一职责原则（The Single Responsibility Principle，简称SRP）</li>
<li>开放——封闭原则（The Open-Close Principle，简称OCP）</li>
<li>Liskov替换原则（The Liskov Substitution Priciple，简称LSP）</li>
<li>依赖倒置原则（The Dependency Inversion Principle，简称DIP）</li>
<li>接口隔离原则（The Interface Segregation Principle，简称ISP）</li>
</ol>


<p>每个原则取一个字母（<strong>S</strong>RP，<strong>O</strong>CP，<strong>L</strong>SP，<strong>I</strong>SP，<strong>D</strong>IP），合称SOLID原则。</p>

<p><a id="markdown-单一职责原则the-single-responsibility-principle简称srp" name="单一职责原则the-single-responsibility-principle简称srp"></a></p>

<h2>单一职责原则（The Single Responsibility Principle，简称SRP）</h2>

<p><a id="markdown-定义" name="定义"></a></p>

<h3>定义</h3>

<p><strong>就一个类而言，应该只有一个引起它变化的原因。</strong></p>

<p>一个类如果有多个职责，但是你只需要其中的一个职责，你也不得不将其它职责包括进来，还有其它职责所依赖的所有组件。</p>

<p><a id="markdown-什么是职责" name="什么是职责"></a></p>

<h3>什么是职责</h3>

<p>在SRP中，我们把职责定义为“变化的原因”（a reason for change）。如果能够想到多于一个的动机去改变一个类，那么这个类就具有多于一个的职责。</p>

<p>比如Employee这个类如果同时包含了业务规则和对于持久化的控制，多数情况下，我们可以断定它们不应该放在一起：业务规则会频繁地变化，但是持久化的方式却不会如此频繁地变化，并且变化的原因也是完全不同的。</p>

<p><a id="markdown-结论" name="结论"></a></p>

<h3>结论</h3>

<p>SRP是所有原则中最简单的，也是最难运用的。软件设计很多时候要做的，就是发现职责，并把它分离出来。事实上，我们将要论述的其它原则都会以这样或者那样的方式回到这个问题上。</p>

<p><a id="markdown-开放封闭原则the-open-close-principle简称ocp" name="开放封闭原则the-open-close-principle简称ocp"></a></p>

<h2>开放——封闭原则（The Open-Close Principle，简称OCP）</h2>

<p><a id="markdown-定义-1" name="定义-1"></a></p>

<h3>定义</h3>

<p><strong>软件实体（类、模块、函数等）应该是可以扩展，但是不可修改的。</strong></p>

<p>OCP的定义，换个说法：</p>

<ul>
<li>对扩展开放（Open for extension）</li>
<li>对修改封闭（Close for modification）</li>
</ul>


<p>如果程序中的一处改动就会产生连锁反应，导致一系列相关模块的改动，OCP建议我们应该对程序进行重构。重构之后再进行同样的修改，就只需要添加新的功能模块，不需要对原有的代码进行修改。</p>

<p>如何在能在不改变模块原代码的情况下去更改它的行为或者为其添加功能呢？</p>

<p><a id="markdown-关键是抽象" name="关键是抽象"></a></p>

<h3>关键是抽象</h3>

<p>抽象一般有两种方式：
1. 接口
2. 继承</p>

<p><a id="markdown-接口" name="接口"></a></p>

<h4>接口</h4>

<p>用接口对需要的对象进行抽象，也就是所谓的“面向接口编程”。</p>

<p><img src="http://hongchaozhang.github.io/images/InterfaceProgramming.jpg" alt="interface programming" /></p>

<p>上面的a图是一个不遵循OCP的设计。Client和Server都是具体的类，Client要使用Server。如果我们希望Client使用另外一个不同的Server类，那么就需要把Client里面使用Server的地方都做响应的修改。</p>

<p>上面的b图是一个符合OCP的设计。如果需要使用一个不同的服务器类，只需要重新实现这个类，保证这个类也实现类ClientInterface接口，则Client这个类不需要做修改，同时扩展类Client的功能。</p>

<blockquote><p>这个接口为什么叫ClientInterface，而不叫ServerInterface或者AbstractServer之类？因为这个接口和Client的关系更密切。</p></blockquote>

<p><a id="markdown-继承" name="继承"></a></p>

<h4>继承</h4>

<p>继承一个抽象类（和接口类似）或者重写一个父类中的（虚）方法，也是OCP的惯用伎俩。典型的例子，就是那个图形的绘制的例子。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Square</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// draw square</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Circle</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// draw circle</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">([</span><span class="n">Shape</span><span class="p">]</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">Shape</span> <span class="n">shape</span> <span class="k">in</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">shape</span><span class="p">.</span><span class="n">draw</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果想扩展drawAllShapes方法，使其可以绘制一种新的形状，只需要重新创建一个Shape类的子类，drawAllShapes函数不需要改变，即可实现功能的扩展。这就是OCP。</p>

<p><a id="markdown-什么时候进行抽象" name="什么时候进行抽象"></a></p>

<h3>什么时候进行抽象</h3>

<p>即使是上面的形状绘制的例子，也不是完全的“对扩展开放，对修改关闭。”比如，我要求所有的圆必须在正方形之前绘制，就没法在不修改drawAllShapes的情况下进行这个功能扩展。</p>

<p>我们无法准确预测未来的功能扩展需求，所以，理论上来说，我们也无法实现完全的“对扩展开放，对修改关闭。”</p>

<p>而且更重要的，遵循OCP进行抽象的代价也是昂贵的。创建正确的抽象需要花费开发时间和精力。同时，这些抽象也增加了软件的设计复杂度。开发人员有能力处理的抽象的数量也是有限的。</p>

<p>所以，不要试图在刚开始就实现OCP，可以试着遵循下面的准则：</p>

<ul>
<li>只受一次愚弄</li>
</ul>


<p>也就是说，在刚开始编写代码的时候，假设变化不会发生。当变化发生时，我们就创建抽象进行隔离，防止以后发生同类变化。</p>

<p><a id="markdown-结论-1" name="结论-1"></a></p>

<h3>结论</h3>

<p>在很多方面，OCP都是面向对象设计的核心所在。遵循这个原则，可以带来面向对象技术所声称的巨大好处（也就是，灵活性、可重用性以及可维护性）。但是，对程序的每个部分都肆意地进行抽象也不是一个好主意。拒绝不成熟的抽象和抽象本身一样重要。</p>

<p><a id="markdown-liskov替换原则the-liskov-substitution-priciple简称lsp" name="liskov替换原则the-liskov-substitution-priciple简称lsp"></a></p>

<h2>Liskov替换原则（The Liskov Substitution Priciple，简称LSP）</h2>

<p><a id="markdown-定义-2" name="定义-2"></a></p>

<h3>定义</h3>

<p><strong>子类型必须能够替换掉它们的基类型。</strong></p>

<p>假设一个函数f，它的参数是某个基类型B。如果将基类型B的子类D传给f，会导致f出现错误的行为，那么D就违反了LSP原则。</p>

<p>此时，f的编写者想在f内对D进行检测，以便在把D传给f时，可以使f具有正确的行为。这个行为又违反了OCP原则，因为此时f对于基类型B的所有子类都不在封闭。</p>

<p><a id="markdown-一个违反lsp的简单例子" name="一个违反lsp的简单例子"></a></p>

<h3>一个违反LSP的简单例子</h3>

<p>对于LSP的违反常常会导致以明显违反OCP的方式使用运行时类型检测。这种方式常常是使用一个显式的if语句去确定一个对象的类型，以便于能够选择针对该类型的正确行为。考虑下面的例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Square</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">drawSquare</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// draw square</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Circle</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">drawCircle</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// draw circle</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">([</span><span class="n">Shape</span><span class="p">]</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">Shape</span> <span class="n">shape</span> <span class="k">in</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="kt">is</span> <span class="n">Square</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">shape</span><span class="p">.</span><span class="n">drawSquare</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="kt">is</span> <span class="n">Circle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">shape</span><span class="p">.</span><span class="n">drawCircle</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>很显然，上面的drawAllShapes违反了OCP原则，它必须知道所有的Shape的子类，并且，每创建一个子类，都需要修改drawAllShapes函数。</p>

<p>Square和Circle不能替换其基类型Shape就是违反了LSP原则，这又进一步导致了drawAllShapes违反了OCP原则。因而，对于LSP的违反也潜在违反了OCP原则。</p>

<p><a id="markdown-正方形和长方形的关系更微妙的违规" name="正方形和长方形的关系更微妙的违规"></a></p>

<h3>正方形和长方形的关系：更微妙的违规</h3>

<p>下面正方形继承长方形的例子，很微妙地违反了LSP原则。</p>

<p>长方形的实现如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="n">Rectangle</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">width</span><span class="p">:</span> <span class="n">Double</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">height</span><span class="p">:</span> <span class="n">Double</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">getWidth</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Double</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">width</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">getHeight</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Double</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">height</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">setWidth</span><span class="p">(</span><span class="n">_</span> <span class="nl">width</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">setHeight</span><span class="p">(</span><span class="n">_</span> <span class="nl">height</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">getArea</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Double</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="nb">self</span><span class="p">.</span><span class="n">height</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>正方形IS-A长方形，按照面向对象分析的方法，正方形应该继承长方形。同时为了保证正方形的四个边长度一致，需要对<code>setWidth</code>和<code>setHeight</code>两个函数重写。</p>

<p>实现如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">Square</span><span class="p">:</span> <span class="n">Rectangle</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">setWidth</span><span class="p">(</span><span class="n">_</span> <span class="nl">width</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">width</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">setHeight</span><span class="p">(</span><span class="n">_</span> <span class="nl">height</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">height</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Square看起来工作不错，而且这个设计似乎也是自相容的，正确的。可是这个结论是错误的，一个自相容的程序未必就和所有的用户程序相容。考虑下面的函数：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">tempFunc</span><span class="p">(</span><span class="n">_</span> <span class="nl">rect</span><span class="p">:</span> <span class="n">Rectangle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">rect</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>    <span class="n">rect</span><span class="p">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果传递一个Square的实例给<code>tempFunc</code>，那么程序就会报错。</p>

<p>有人可能对<code>tempFunc</code>存在的问题进行争辩，说函数<code>tempFunc</code>的编写者不应该假设宽和长是独立变化的。这时候<code>tempFunc</code>的编写者肯定不同意：函数以Rectangle为参数，长宽独立变化就是长方形的特性，为什么不能用？</p>

<p>这时候，我们应该反过来思考一下：IS-A是不是继承的唯一标准？</p>

<p><strong>IS-A不应该成为继承的准则，“可替换性”才是。</strong></p>

<p><a id="markdown-其它一些容易导致违反lsp的习惯用法" name="其它一些容易导致违反lsp的习惯用法"></a></p>

<h3>其它一些容易导致违反LSP的习惯用法</h3>

<p><a id="markdown-子类中的退化函数" name="子类中的退化函数"></a></p>

<h4>子类中的退化函数</h4>

<p>当子类在重写基类函数的时候，如果功能不如基类完备，即出现了退化，那么这个子类在某些情况下就不能替换基类，违反了LSP原则。</p>

<blockquote><p>这也许就是一些语言在子类重写基类函数的时候必须通过super调用基类函数，这就保证了重写不会退化。但是在Swift和Objective-C中可以不调用super。</p></blockquote>

<p><a id="markdown-子类抛出基类没有的异常" name="子类抛出基类没有的异常"></a></p>

<h4>子类抛出基类没有的异常</h4>

<p>此时要遵循LSP，要么改变使用者的期望，要么子类不抛出这个异常。</p>

<p><a id="markdown-结论-2" name="结论-2"></a></p>

<h3>结论</h3>

<p>OCP是很多说法的核心，而LSP是使OCP成为可能的主要原则之一。正是子类的可替换性才使得使用基类类型的模块在无需修改的情况下就可以扩展。这种可替换性必须是开发人员可以隐式依赖的东西。</p>

<p><a id="markdown-依赖倒置原则the-dependency-inversion-principle简称dip" name="依赖倒置原则the-dependency-inversion-principle简称dip"></a></p>

<h2>依赖倒置原则（The Dependency Inversion Principle，简称DIP）</h2>

<p><a id="markdown-定义-3" name="定义-3"></a></p>

<h3>定义</h3>

<ul>
<li><strong>高层模块不应该依赖于低级模块。二者都应该依赖于抽象。</strong></li>
<li><strong>抽象不应该依赖于细节，细节应该依赖于抽象。</strong></li>
</ul>


<blockquote><p>这里的“抽象”是指接口或者抽象类。</p>

<p>为什么用”倒置“：这是相对于传统的软件开发，比如结构化分析和设计。在这些设计中，倾向于创建一些高层模块依赖于低层模块的模块，策略（Policy）依赖于细节的软件结构。而DIP要求大家都依赖于抽象，而且这个抽象绝对不会放在低层模块中，而是放在高层模块中（或者独立出来一个模块），所以，不再是高层模块依赖低层模块，而是低层模块依赖高层模块（中的抽象）。</p></blockquote>

<p>传统软件开发可能会设计出下面这样的程序结构：</p>

<p><img src="http://hongchaozhang.github.io/images/DIP_bad_design.jpg" alt="DIP bad design" /></p>

<p>在这个设计中，高层模块依赖于低层模块，如果要重用，必须同时引入低层模块。如果高层模块能够独立于低层模块，那么，高层模块就可以非常容易地被重用。该原则是框架（framework）设计的核心原则。</p>

<p><img src="http://hongchaozhang.github.io/images/DIP_good_design.jpg" alt="DIP good design" /></p>

<p>上图展示了一个更为合适的模型。每个高层模块都为它所需要的服务声明一个独立的接口，较低的层次实现这些抽象接口，每个高层模块都通过接口使用低层模块。这样，高层模块就不依赖于低层模块，低层模块反而依赖于高层模块中定义的抽象服务接口。</p>

<blockquote><p>其实，低层模块也有重用的问题，也不应该直接依赖于高层模块。这里，应该将高层模块抽象出来的接口独立成一个模块，大家都依赖这个模块。</p></blockquote>

<p><strong>这里的倒置不仅仅是依赖关系的倒置，也是接口所有权的倒置。</strong>我们通常认为工具库应该拥有自己的接口，但是当应用了DIP之后，我们发现往往是客户拥有抽象接口，而它们的服务者则从这些抽象接口派生。</p>

<p><a id="markdown-依赖于抽象" name="依赖于抽象"></a></p>

<h3>依赖于抽象</h3>

<p>“依赖于抽象”这一启发式规则与DIP要求类似，要求我们不应该依赖具体的类，也就是说，程序中所有的依赖关系都应该终止于抽象（抽象类或者接口）。根据这一规则，可知：</p>

<ul>
<li>任何变量都不应该持有一个指向具体类的指针或者引用。</li>
<li>任何类都不应该从具体类派生。</li>
<li>任何方法都不应该重写它的任何基类中的已经实现了的方法。</li>
</ul>


<p>要完全遵守这个规则几乎是不可能的。对于一些具体的类，如果比较稳定，还是可以依赖的。比如Java或者Swift中的String类型，String比较稳定，不太会变化，依赖于它不会造成损害。</p>

<p>但是如果一个类不稳定，我们最好不要直接依赖它，而要用一个抽象接口隔离这个类的不稳定性，直接使用接口，而不是这个类。</p>

<p><a id="markdown-一个例子" name="一个例子"></a></p>

<h3>一个例子</h3>

<p>依赖倒置可以应用于任何存在一个类向另一个类发送消息的地方。例如Button对Lamp的控制。</p>

<p><img src="http://hongchaozhang.github.io/images/DIP_button_lamp_design.jpg" alt="DIP button lamp design" /></p>

<p>上图中的a设计是不成熟的：Button类依赖于Lamp类，当Lamp类改变时，Button类会受到影响。此外，想要重用Button来控制另外一种对象（比如Motor）是不可能的。Button控制着Lamp对象，并且也只能控制Lamp对象。</p>

<p>这个设计违反类DIP原则：应用程序的高层策略没有和低层的实现分离，抽象没有和具体细节分离。也可以说，高层策略依赖于低层模块，抽象自动依赖于细节。</p>

<p>什么是高层策略呢？它是应用背后的抽象，是那些不随具体细节的改变而改变的真理，它是系统内部的系统——它是隐喻（metaphore）。在Button/Lamp这个例子中，背后的抽象是检测用户的开/关指令并将指令传给目标对象。用什么机制检测用户的指令呢？是直接按下GUI上的一个按钮，还是一个实体按钮，或者一个安全系统中的运动监测器？无关紧要！目标对象是什么呢？无关紧要！这些都是不会影响到抽象的具体细节。</p>

<p>改进之后的b设计则是一个遵守DIP的设计。而且，接口本身没有所有者，可以独立放在一个不同于Button，也不同于Lamp的地方。</p>

<p><a id="markdown-结论-3" name="结论-3"></a></p>

<h3>结论</h3>

<p>传统程序设计，策略依赖于细节。面向对象设计倒置了这种依赖关系，使得细节和策略都依赖于抽象，并且常常是客户拥有服务接口。</p>

<p>事实上，这种依赖关系的倒置正好是面向对象的标志所在。如果依赖关系是倒置的，就是面向对象设计；否则，就是过程化设计。</p>

<p>依赖倒置关系是实现许多面向对象技术所宣称的好处的基本底层机制。它的正确应用对于创建可重用的框架来说是必要的。同时它对于构建在变化面前富有弹性的代码也是非常重要的。</p>

<p><a id="markdown-接口隔离原则the-interface-segregation-principle简称isp" name="接口隔离原则the-interface-segregation-principle简称isp"></a></p>

<h2>接口隔离原则（The Interface Segregation Principle，简称ISP）</h2>

<p><a id="markdown-定义-4" name="定义-4"></a></p>

<h3>定义</h3>

<p><strong>不应该强迫客户依赖于它们不用的方法。</strong></p>

<p>这个原则是用来处理“胖”接口所具有的缺点。如果类的接口不是内聚（cohesive）的，就表示该类具有“胖”的接口。换句话说，类的“胖”接口可以分解成多组方法，每一组方法都服务于不同的客户程序。</p>

<p>如果客户程序依赖于一个具有“胖”接口的类，就相当于强迫客户程序依赖它们不使用的方法，那么这些客户程序就面临着由于这些未使用的方法的改变所带来的变更。这无意中导致了所有客户程序之间的耦合。</p>

<p><a id="markdown-一个例子定时门" name="一个例子定时门"></a></p>

<h3>一个例子：定时门</h3>

<p><strong>问题描述：</strong></p>

<p>现在有一个Door的类，现在需要实现一个TimerDoor，如果门开的时间过长，就发出警报。为了做到这一点，TimerDoor需要跟另一个名为Timer的对象进行交互。如果一个对象希望得到超时通知，它可以调用Timer的register函数，该函数有两个参数，一个是超时时间，另一个是TimerClient对象，该对象的<code>timeout</code>函数会在超时时被Timer调用。</p>

<p>一个容易想到的实现如下图：</p>

<p><img src="http://hongchaozhang.github.io/images/door_bad_design.jpg" alt="timer door bad design" /></p>

<p>现在Door依赖TimerClient了，可是并不是所有种类的Door都需要定时功能。如果要创建无需定时功能的Door的子类，那么在子类中就必须要提供<code>timeout</code>方法的退化实现，这就有可能违反LSP原则，使得子类不能够替换父类。而且，这些子类的应用程中中也必须引入TimerClient的定义。使Door变“胖”，只是为了给其某个子类带来需要的功能，这就是接口污染。</p>

<p>下面应用接口隔离原则ISP重新设计这个TimerDoor。</p>

<p>TimerDoor应该“具有”两组接口，一组供Timer使用，一组供Door使用。如何将这两组接口分开呢？该问题的答案基于这样的事实：一个对象的客户不是必须通过该对象才能访问其接口，也可以通过委托或者该对象的基类来访问它。</p>

<p><a id="markdown-使用委托对接口分组" name="使用委托对接口分组"></a></p>

<h4>使用委托对接口分组</h4>

<p>该方案如下图所示，当TimerDoor需要向Timer对象注册一个超时请求时，它就创建一个DoorTimerAdaper，并把它注册给Timer。当Timer对象发送<code>timeout</code>消息给DoorTimerAdapter时，DoorTimerAdapter把这个消息委托给TimerDoor的<code>doorTimeout</code>方法。</p>

<p><img src="http://hongchaozhang.github.io/images/door_good_design_1.jpg" alt="timer door good design 1" /></p>

<p>这个设计是个比较通用的设计，在其他地方，也叫做“使用组合而非继承（Prefer Composition to Extension）”。但是这个设计略显复杂。下面基于多重继承的实现更加简洁。</p>

<p><a id="markdown-使用多重继承对接口分组" name="使用多重继承对接口分组"></a></p>

<h4>使用多重继承对接口分组</h4>

<p>不同语言的多重继承的实现是不一样的。倾向于使用Interface或者Protocol实现这一功能。</p>

<p><img src="http://hongchaozhang.github.io/images/door_good_design_2.jpg" alt="timer door good design 2" /></p>

<p>TimerDoor继承Door和TimerClient。尽管这两个基类的客户程序都可以使用TimerDoor，但是实际上都不需要依赖TimerDoor类。这样，它们就通过分离的接口使用同一个对象。</p>

<p>通常情况下，我们都会优先选择多重继承方法，只有当DoorTimerAdapter所做的转换是必须的时候，才考虑使用委托方案。</p>

<blockquote><p>DoorTimerAdapter将<code>timeout</code>接口转换成TimerDoor里面的<code>doorTimeout</code>接口，如果需要，在这个转换过程中还可以做些其它事情。</p></blockquote>

<p><a id="markdown-一个例子atm界面" name="一个例子atm界面"></a></p>

<h3>一个例子：ATM界面</h3>

<p>现在让我们考虑一个更有意义的例子：自动取款机ATM问题。对于ATM上面可执行的不同操作封装一个抽象接口Transaction，三种具体的操作（Deposit，Withdrawal，Transfer）都实现这个接口。每种操作对应的类都可以调用UI抽象接口中的不同方法，但是<strong>每个操作只调用自己对应的方法</strong>。</p>

<p>一个简单直接的实现如下：</p>

<p><img src="http://hongchaozhang.github.io/images/ATM_bad_design.jpg" width="400" alt="atm bad design" /></p>

<p>对于任何Transaction的子类的改动都有可能迫使对UI的相应改动，从而影响其它所有Transaction的子类以及所有依赖UI的类。如果要增加一种操作PayGasBillTransaction，为了处理该操作想要显示的特定消息，就必须要在UI中加入新的方法。这就导致所有其它Transaction都必须重新编译部署。</p>

<p>通过将UI接口分解成三个对应于不同操作的接口，可以避免这种耦合。设计如下：</p>

<p><img src="http://hongchaozhang.github.io/images/ATM_good_design.jpg" width="600" alt="atm good design" /></p>

<p>当我们需要增加一种新的Transaction时，其它Transaction都不需要重新编译部署。</p>

<p><a id="markdown-多参数形式与单参数形式" name="多参数形式与单参数形式"></a></p>

<h4>多参数形式与单参数形式</h4>

<p>考虑一个既要访问TransferUI又要访问DepositUI的函数。假设我们想把这两个UI传入该函数，是应该这样写：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kt">void</span> <span class="n">tempFund</span><span class="p">(</span><span class="n">_</span> <span class="nl">depositeUI</span><span class="p">:</span> <span class="n">DepositUI</span><span class="p">,</span> <span class="n">_</span> <span class="nl">transferUI</span><span class="p">:</span> <span class="n">TransferUI</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>还是应该这样写：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kt">void</span> <span class="n">tempFund</span><span class="p">(</span><span class="n">_</span> <span class="nl">ui</span><span class="p">:</span> <span class="n">UI</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>以第二种方法编写函数的诱惑是很强的。毕竟，在第一种多参数形式中，两个参数应用的是同一个对象，调用起来是这个样子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">tempFunc</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">ui</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>虽然上面的调用看起来有悖常理，但是我们还是应该倾向于多参数形式。单参数形式的函数依赖于UI中包含的每一个接口，如果WithDrawalUI发生了改变，那么函数及其所有客户程序都会受到影响。这更悖常理。此外，我们也不能保证传入函数的两个参数一直是同一个对象。也许以后，接口对象会因为某些原因而分离，此时，函数并不需要关注接口对象是合并还是分拆这一事实。</p>

<p><a id="markdown-结论-4" name="结论-4"></a></p>

<h3>结论</h3>

<p>“胖”类会导致其客户程序之间的耦合。当一个客户程序要求该“胖”类进行一个改动时，其它客户程序都会受到影响。因此客户程序应该仅仅依赖于它调用的方法，而不应该直接依赖于一个“胖”类。通过把“胖”类的接口分解为多个特定程序的接口，每个针对特定客户程序的接口只声明其对应客户程序需要的接口。接着，该“胖”类就可以继承所有分离出来的接口，并实现它们。这就解除了客户程序和其没有调用的方法间的依赖关系，并使客户程序之间互不依赖。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在swift和Objc之间转换的一些想法]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/11/13/some-ideas-on-converting-between-objc-and-swift/"/>
    <updated>2018-11-13T10:50:18+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/11/13/some-ideas-on-converting-between-objc-and-swift</id>
    <content type="html"><![CDATA[<!-- more -->


<p>在工作中我们有时候需要在swift和objc之间进行转换，这时候有没有一些工具可以帮助我们呢？</p>

<blockquote><p>当然，大部分时候，我们不需要转换，因为swift和objc的类和方法可以互相暴露给对方。</p></blockquote>

<h2>objc转换成swfit</h2>

<p>搜索了一下，找到了两个工具可以做这个事情：</p>

<h3><a href="https://github.com/yahoojapan/objc2swift">objc2swift</a></h3>

<p>objc2swift是雅虎日本的一个工具，支持在线转换。<a href="https://github.com/dzenbot/XCSwiftr/blob/master/README.md">XCSwiftr</a>就是一个基于objc2swift的xcode插件，通过<a href="https://github.com/alcatraz/Alcatraz">Alcatraz</a>进行管理安装，可以在Xcode里面进行objc到swift的转换。但是xcode自从8.0开始就不支持插件了。</p>

<blockquote><p>插件(plugin)只在xcode 8.0之前的版本才支持。从8.0开始，插件就不再支持，但是引入了扩展(extension)。扩展和插件不同的一点是：扩展在独立的进程里面运行，所以扩展的崩溃不会影响到xcode，但是插件的崩溃，则会导致xcode也崩溃。估计插件崩溃导致的xcode崩溃的锅都是Apple来背，Apple很不爽，就让xcode跟插件分开在不同的进程中运行。</p></blockquote>

<p>objc2swift的转换效果很一般。</p>

<p>objc源代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">MyClass</span>: <span class="bp">NSObject</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sayHelloTo:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">person</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">MyClass</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sayHelloTo:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">person</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">([</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;Hello, %@.&quot;</span><span class="p">,</span> <span class="n">person</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span> <span class="nl">performSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">test</span><span class="p">)];</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">test</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>转换之后：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">MyClass</span><span class="p">:</span> <span class="bp">NSObject</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">sayHelloTo</span><span class="p">(</span><span class="nl">person</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello, \(person).&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">performSelector</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">test</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>几个问题：</p>

<ol>
<li>方法名称没有按照swift的习惯改写：应该为<code>sayHello(to person: String)</code>，而不是<code>sayHelloTo(person: String)</code>。</li>
<li><code>performSelector:</code>方法完全转换错误：方法名称错误，应该为<code>perform(_ aSelector: Selector!)</code>，而且参数也错误，不应该为<code>String</code>类型，应该为<code>Selector</code>类型。</li>
<li><code>test</code>方法前面没有加上<code>@objc</code>，所以不能作为<code>#selector</code>的参数。</li>
</ol>


<h3><a href="https://objectivec2swift.com/#/home">Swiftify</a></h3>

<p>swiftify也支持在线转换，而且转换效果明显好于objc2swift。如果愿意花钱，swiftify还可以支持很多功能，包括xcode扩展（注意，这里是“扩展extension”，不是“插件plugin”）、finder扩展、整个工程的转换、离线转换等。</p>

<p>同样用上述objc源代码，转换之后为：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">MyClass</span><span class="p">:</span> <span class="bp">NSObject</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">sayHello</span><span class="p">(</span><span class="n">to</span> <span class="nl">person</span><span class="p">:</span> <span class="n">String</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello Swift, Goodbye Obj-C!&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">perform</span><span class="p">(</span><span class="err">#</span><span class="n">selector</span><span class="p">(</span><span class="n">MyClass</span><span class="p">.</span><span class="n">test</span><span class="p">))</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">@</span><span class="n">objc</span> <span class="k">func</span> <span class="n">test</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>swift转换成objc</h2>

<p><a href="https://objectivec2swift.com/#/home">Swiftify</a>的作者写了一篇博客<a href="https://www.quora.com/How-can-you-convert-Swift-to-Objective-C">How can you convert Swift to Objective-C?</a>，说明了这个问题：</p>

<p>原文是：</p>

<blockquote><p>When speaking about idiomatic Swift, converting method implementations from Swift to Objective-C is the task that cannot be solved for all cases. As you might imagine, many “modern” Swift features do not have any counterparts in Objective-C and thus cannot be converted without a human brain :)</p></blockquote>

<p>结论就是：由于swift有很多objc没有的语言特性，所以swift到objc无法完成自动转换。</p>

<p>但是转换之后的objc的头文件可以从build in “Generated Interface” ([ProjectName]-Swift.h)里面找到，拷贝出来，稍作修改即可。但是仅限于swift暴漏给objc的接口和属性。那些没有暴漏给objc的接口和属性，就需要手动去转换啦。</p>

<blockquote><p>[ProjectName]-Swift.h如果不能通过cmd+shift+O找到，可以从引用这个头文件的objc文件中通过“go to declaration"找到。</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[读朱光潜《谈修养》]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/11/05/du-zhu-guang-qian-tan-xiu-yang/"/>
    <updated>2018-11-05T12:44:57+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/11/05/du-zhu-guang-qian-tan-xiu-yang</id>
    <content type="html"><![CDATA[<p>《谈修养》的一点读书杂想和摘抄。</p>

<!-- more -->


<p><br></p>

<ul>
<li><a href="#%E8%B0%88%E5%A4%84%E7%BE%A4%E4%B8%8A%E4%B8%AD%E4%B8%8B">谈处群（上、中、下）</a></li>
<li><a href="#%E8%B0%88%E5%AD%A6%E9%97%AE">谈学问</a></li>
<li><a href="#%E8%B0%88%E8%AF%BB%E4%B9%A6">谈读书</a>

<ul>
<li><a href="#%E5%A5%BD%E4%B9%A6%E4%B8%8D%E5%8E%8C%E7%99%BE%E5%9B%9E%E8%AF%BB">好书不厌百回读</a></li>
<li><a href="#%E7%9F%A5%E8%AF%86%E7%B3%BB%E7%BB%9F%E5%8C%96">知识系统化</a></li>
</ul>
</li>
<li><a href="#%E8%B0%88%E8%8B%B1%E9%9B%84%E5%B4%87%E6%8B%9C">谈英雄崇拜</a>

<ul>
<li><a href="#%E8%8B%B1%E9%9B%84%E4%B8%8E%E5%8E%86%E5%8F%B2">英雄与历史</a></li>
<li><a href="#%E8%8B%B1%E9%9B%84%E4%B8%8E%E4%BA%BA%E6%A0%BC%E6%8F%90%E5%8D%87">英雄与人格提升</a></li>
</ul>
</li>
<li><a href="#%E8%B0%88%E4%BA%A4%E5%8F%8B">谈交友</a></li>
<li><a href="#%E8%B0%88%E9%9D%92%E5%B9%B4%E4%B8%8E%E6%81%8B%E7%88%B1%E7%BB%93%E5%A9%9A">谈青年与恋爱结婚</a></li>
<li><a href="#%E8%B0%88%E4%BC%91%E6%81%AF">谈休息</a></li>
<li><a href="#%E8%B0%88%E6%B6%88%E9%81%A3">谈消遣</a></li>
<li><a href="#%E8%B0%88%E4%BD%93%E8%82%B2">谈体育</a></li>
<li><a href="#%E8%B0%88%E7%BE%8E%E6%84%9F%E6%95%99%E8%82%B2">谈美感教育</a>

<ul>
<li><a href="#%E7%BE%8E%E8%82%B2%E6%98%AF%E6%9C%AC%E8%83%BD%E5%86%B2%E5%8A%A8%E5%92%8C%E6%83%85%E6%84%9F%E7%9A%84%E8%A7%A3%E6%94%BE">美育是本能冲动和情感的解放。</a></li>
<li><a href="#%E7%BE%8E%E8%82%B2%E6%98%AF%E7%9C%BC%E7%95%8C%E7%9A%84%E8%A7%A3%E6%94%BE">美育是眼界的解放。</a></li>
<li><a href="#%E7%BE%8E%E8%82%B2%E6%98%AF%E8%87%AA%E7%84%B6%E9%99%90%E5%88%B6%E7%9A%84%E8%A7%A3%E6%94%BE">美育是自然限制的解放。</a></li>
<li><a href="#%E7%88%B1%E7%BE%8E%E7%9A%84%E5%A4%A9%E6%80%A7%E9%9C%80%E8%A6%81%E5%9F%B9%E5%85%BB">爱美的天性需要培养</a></li>
</ul>
</li>
<li><a href="#%E7%BB%99%E7%94%B3%E6%8A%A5%E9%9D%92%E5%B9%B4%E7%9A%84%E9%9D%92%E5%B9%B4%E8%AF%BB%E8%80%85">给《申报青年》的青年读者</a></li>
</ul>


<p><br></p>

<p><a id="markdown-谈处群上中下" name="谈处群上中下"></a></p>

<h2>谈处群（上、中、下）</h2>

<p>说了很多，也颇有感触，但是没能总结出来。</p>

<p><a id="markdown-谈学问" name="谈学问"></a></p>

<h2>谈学问</h2>

<p>做学问不等同于“读书”。读书只是做学问的一种方式。</p>

<p>孔子那句“学而不思则罔，思而不学则怠”道出了学问的真谛。不能空想，也不能死读书。</p>

<p>学校教育的两个作用应该是：</p>

<ul>
<li>启发兴趣</li>
<li>指点门径</li>
</ul>


<p>而现在的学校不在这两个方面努力，只尽量在灌输知识。这种教育对于学问不仅无裨益，而且是障碍。</p>

<p><a id="markdown-谈读书" name="谈读书"></a></p>

<h2>谈读书</h2>

<p><a id="markdown-好书不厌百回读" name="好书不厌百回读"></a></p>

<h3>好书不厌百回读</h3>

<p>“好书不厌百回读，熟读深思子自知。”</p>

<p>多读不能算作荣誉，少读也不能算是耻辱。少读如果彻底，必能养成深思熟虑的习惯，涵泳优游，以至于变化气质；多读而不求甚解，则如驰骋十里洋场，虽珍奇满目，徒惹得心花意乱，空手而归。世间许多读书人只为装点门面，如暴发户炫耀家私，以多为贵。这在治学方面是自欺欺人，在做人方面是趣味低劣。</p>

<p><a id="markdown-知识系统化" name="知识系统化"></a></p>

<h3>知识系统化</h3>

<p>一书做几遍看，每一遍只着重某一方面。也就是说读书要有中心，有中心才易有系统组织。</p>

<p>一个人心中可以有多个系统中心，将看到的知识归到不同的系统框架中去。大凡零星片段的知识，不但易忘，而且无用。每次所得的新知识必须与旧有的知识联络贯穿，这就是说，必须围绕一个中心归聚到一个系统里去，才会生根，才会开花结果。</p>

<p><a id="markdown-谈英雄崇拜" name="谈英雄崇拜"></a></p>

<h2>谈英雄崇拜</h2>

<p><a id="markdown-英雄与历史" name="英雄与历史"></a></p>

<h3>英雄与历史</h3>

<p><strong>英雄造时势</strong></p>

<p>卡莱尔在《英雄崇拜》中说“人类在这世界上所成就的事业的历史，骨子里就是在当中工作的几个伟大任务的历史。”
尼采的超人主义，也是为英雄崇拜涂上了哲学色彩。</p>

<p><strong>时势造英雄</strong></p>

<p>托尔斯泰的《战争与和平》在传达“时势造英雄”的理念。</p>

<p><a id="markdown-英雄与人格提升" name="英雄与人格提升"></a></p>

<h3>英雄与人格提升</h3>

<p>撇开英雄和历史的关系不说，但是对人的教育感化的作用，就不能否定英雄崇拜。正所谓“高山仰止，景行行止。虽不能至，然心向往之。”</p>

<p>尤其在青少年时代，意向的力量大于概念，与其向他们说仁义道德，不如指点几个有血有肉的具有仁义道德的人给他们看。教育重人格感化，必须是一个具体的人格才真正有感化力。</p>

<p><a id="markdown-谈交友" name="谈交友"></a></p>

<h2>谈交友</h2>

<p>近朱者赤近墨者黑</p>

<p>与善人交，如入芝兰之室，久而不闻其香；与恶人交，如入鲍鱼之市，久而不闻其臭。</p>

<p>诤友难得</p>

<p><a id="markdown-谈青年与恋爱结婚" name="谈青年与恋爱结婚"></a></p>

<h2>谈青年与恋爱结婚</h2>

<p>青年人不宜过早恋爱和结婚，需要自然的方法引导，而非暴力禁止。自然的方法包括：</p>

<ol>
<li>精力有所发挥，精神有所委托。青年人精力旺盛，要他闲着，难免泛滥横流。假如他在工作里发生兴趣，在文艺里发生兴趣，甚至在游戏运动里发生兴趣，这就可以垄断他的心神，不叫它旁迁他涉。</li>
<li>改善社交生活，使同情心得到滋养。青年最需要的是同情，最怕的是寂寞，愈寂寞就愈感觉异性需要的迫切。一般青年追求异性，与其说是迫于性的冲动，毋宁说是迫于同情的需要。要满足这需要，社会生活如果丰富也就够了。一个青年如果有亲热的家庭生活，加上温暖的团体生活，不感觉到孤寂，他虽然还有“遇”恋爱的可能，却无“谋”恋爱的必要。交谊愈广泛，发生恋爱的可能性也就愈少。一个青年最危险的遭遇莫过于向来没有和一个女子有较深的接触，一碰见第一个女子就爱上了她。</li>
</ol>


<p><a id="markdown-谈休息" name="谈休息"></a></p>

<h2>谈休息</h2>

<p>节奏，优游涵泳</p>

<p>休息不仅为蓄力，也为整理酝酿，让筋肉技巧在潜意识中酝酿凝固。</p>

<p>我（朱光潜）生平最爱陶渊明在自祭文里所说的两句话：“勤靡余劳，心有常闲”，这是修养的极境，人事算尽了，而神仙福分也就在尽人事中享着。现代人的毛病是“勤有余劳，心无偶闲”。这使人心地驳杂，缺乏冲和弘毅的气象，日日困于名缰利锁，叫整个世界日趋于干枯黑暗。</p>

<p><a id="markdown-谈消遣" name="谈消遣"></a></p>

<h2>谈消遣</h2>

<p>身和心到活动都有有节奏到周期。此所谓“一张一弛文武之道”。</p>

<p>更番瓜代：脑力工作者要时不时地做些体力活动。</p>

<p>儒家六艺：诗书礼乐射御，其中后四项都带有消遣娱乐到意味。孔子谈修养，“局于人”之后即继以“游于艺”。</p>

<p>世间欢喜消遣的人，无论他们到嗜好如何不同，都有一个共同点，就是他们必都有强旺的生活力，运动家和艺术家如此，嫖客赌徒乃至于烟鬼也是如此。他们到生活力强旺，发泄到需求也就急迫。他们所不同者只在发泄方式。这有如大水，可以灌田、发电或推动机器，也可以泛滥横流，淹毙人畜草木。同是强旺到生活力，用在运动可以健身，用在艺术可以怡情养性，用在吃喝嫖赌就可以劳民伤财，为非作歹。“浪子回头是个宝”，也是这个道理。浪子必是生活力强旺到人，如果可以用于正道，也必是人上之人。</p>

<p><a id="markdown-谈体育" name="谈体育"></a></p>

<h2>谈体育</h2>

<p>德、智、体、美均衡发展。</p>

<p>健康有先天因素，也有后天因素。先天因素我们能做的就是优生优育，母亲的体格康健比父亲更重要。后天健康要注意三个方面。一是营养适宜，二是生活规律，三是心境要宽和冲淡，少动气，少存杂念。</p>

<blockquote><p>我国古代特别看中上述的第三点。“养生莫善于寡欲。”近代社会复杂，刺激特多，愈近于文明，愈远于自然，处处都是扰乱心智的事物，就是处处逼我们打消耗战。我们必须淡泊宁静，以逸待劳。这不但可以养生，也可以使学问事业得到较大的成就。</p></blockquote>

<p>要训练互助、尊重纪律的精神，最好的运动场所是运动场。</p>

<p><a id="markdown-谈美感教育" name="谈美感教育"></a></p>

<h2>谈美感教育</h2>

<p>朱子诗云：“半亩方塘一鉴开，天光云影共徘徊。问渠哪得清如许？为有源头活水来。”这诗所写的是一种修养的胜境。美感教育给我们的是“源头活水”。</p>

<p><a id="markdown-美育是本能冲动和情感的解放" name="美育是本能冲动和情感的解放"></a></p>

<h4>美育是本能冲动和情感的解放。</h4>

<p>宗教、法律、道德约束下的欲望，可以在美育中得到解放。</p>

<p><a id="markdown-美育是眼界的解放" name="美育是眼界的解放"></a></p>

<h4>美育是眼界的解放。</h4>

<p>美育可以培养发现生活美的眼睛。</p>

<p><a id="markdown-美育是自然限制的解放" name="美育是自然限制的解放"></a></p>

<h4>美育是自然限制的解放。</h4>

<p>这是德国唯心派哲学家康德、席勒、叔本华、尼采诸人所最看重的一点，现在我们用浅近语来说明它。</p>

<p>自然世界是有限的，受因果律支配的，其中毫末细故都有他的必然性。社会由历史铸就，人由遗传和环境造成。人的活动 寸步离不开物质生存条件的支配，没有翅膀就不能飞，绝饮食就会饿死。由此类推，人在自然中是极不自由的。动植物和非生物一味顺从自然，接受它的限制，没有过分希冀，也就没有失望和痛苦。人却不同，他有心灵，有不可压制的欲望。人可以说是两重奴隶，第一服从自然的限制，其次要受自己的欲望驱使。<strong>以无穷欲望处有限自然，人便觉得处处不如意，不自由，烦闷苦恼都由此起。</strong></p>

<p>专就物质说，人在自然面前是十分渺小的。但在精神方面，人可以跳开自然的圈套而征服自然，他可以在自然世界之外另在想象中造出较能合理慰情的世界。这就是艺术的创造。</p>

<p>多接受美感教育，就是多学会如何从自然限制中解放出来，由奴隶变成上帝，充分地感觉人的尊严。</p>

<p><a id="markdown-爱美的天性需要培养" name="爱美的天性需要培养"></a></p>

<h3>爱美的天性需要培养</h3>

<p>爱美是人的天性，虽是天性，仍需要培养，否则，便会凋零。</p>

<p>美育必须从年轻时入手，年纪愈大，外务愈纷繁，习惯的牢笼愈坚固，感觉愈迟钝，心里愈复杂，欣赏艺术力也就愈薄弱。</p>

<p>我时常想，无论学哪一科专门学问，干哪一行职业，每个人都应该会听音乐，不断地读文学作品，偶尔有欣赏图画、雕刻的机会。</p>

<p>从历史看，一个民族在最兴旺的时候，艺术成就必伟大，美育必发达。史诗悲剧时代的希腊、文艺复兴时代的意大利、莎士比亚时代的英国、歌德和贝多芬时代的德国都可以作证。现在我们要想复兴民族，必须恢复周以前歌乐舞的盛况，这就是说，必须提倡普及的美感教育。</p>

<p><a id="markdown-给申报青年的青年读者" name="给申报青年的青年读者"></a></p>

<h2>给《申报青年》的青年读者</h2>

<p>我很佩服英国人，他们总是事到头来，才想办法。事没有来到头来，他们总是冷静地等待着，观察着，今天决不打明天的计算。但是他们也决不肯放弃现在的机会，觉得一件事应该去做，就马上去做，不张皇也不迟疑。他们的国家内政外交如此，个人经营的事业也是如此。他们不幻想未来，他们的老谋深算都费在抓住现在和认清现在上面。他们出死力抓住现在，事到头来时，他们总是不慌不忙地处理的很妥当。这种冷静沉着的态度就是值得我们观摩的。</p>

<p>“三此”：此身，此时，此地。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于AR的一些使用场景]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/08/17/some-ideas-on-ar-usage/"/>
    <updated>2018-08-17T15:13:58+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/08/17/some-ideas-on-ar-usage</id>
    <content type="html"><![CDATA[<p>搜集一些有意思的AR应用。</p>

<!-- more -->


<p>主要参考：<a href="https://github.com/olucurious/Awesome-ARKit">Awesome ARKit</a>。这篇post里面还有很多实用的AR Tutorial和Resouces，如果自己动手，可以参考。</p>

<ul>
<li><a href="#app-store%E4%B8%8A%E9%9D%A2%E7%9A%84app">App Store上面的App</a>

<ul>
<li><a href="#%E7%A5%9E%E5%A5%87ar">神奇AR</a></li>
<li><a href="#ikea-place">IKEA Place</a></li>
<li><a href="#wallr">Wallr</a></li>
<li><a href="#horizon-explorer">Horizon Explorer</a></li>
<li><a href="#weare">WeAre</a></li>
<li><a href="#waazy---magic-ar-video-maker">Waazy - Magic AR Video Maker</a></li>
<li><a href="#human-anatomy-atlas-2019">Human Anatomy Atlas 2019</a></li>
</ul>
</li>
<li><a href="#github%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%A1%B9%E7%9B%AE">Github上面的项目</a>

<ul>
<li><a href="#arkit-occlusion-demo">arkit-occlusion-demo</a></li>
<li><a href="#arvideokit">[ARVideoKit]()</a></li>
<li><a href="#arkit-smb-homage">arkit-smb-homage</a></li>
<li><a href="#arkit-corelocation">ARKit-CoreLocation</a></li>
<li><a href="#arkitnavigationdemo">ARKitNavigationDemo</a></li>
<li><a href="#fineme">FineMe</a></li>
<li><a href="#arkitspitfire">ARKitSpitfire</a></li>
</ul>
</li>
<li><a href="#resources">Resources</a>

<ul>
<li><a href="#poly">Poly</a></li>
</ul>
</li>
</ul>


<p><a id="markdown-app-store上面的app" name="app-store上面的app"></a></p>

<h2>App Store上面的App</h2>

<p><a id="markdown-神奇arhttpsitunesapplecomcnappar-arid1327719623mt8" name="神奇ar"></a></p>

<h3><a href="https://itunes.apple.com/cn/app/%E7%A5%9E%E5%A5%87ar-%E7%89%B9%E6%95%88ar%E7%9B%B8%E6%9C%BA%E5%92%8C%E7%9F%AD%E8%A7%86%E9%A2%91%E6%8B%8D%E6%91%84%E7%A5%9E%E5%99%A8/id1327719623?mt=8">神奇AR</a></h3>

<p>这个AR应用非常棒，号称“中国第一AR平台”。打开App，以为自己是打开了“抖音”呢。其模仿抖音的痕迹很重，但是神奇AR的视频不同于抖音里面的视频：都是真实世界和虚拟世界的深入互动。支持下载很多3D模型。</p>

<p><a href="https://itunes.apple.com/cn/app/%E7%A5%9E%E5%A5%87ar-%E7%89%B9%E6%95%88ar%E7%9B%B8%E6%9C%BA%E5%92%8C%E7%9F%AD%E8%A7%86%E9%A2%91%E6%8B%8D%E6%91%84%E7%A5%9E%E5%99%A8/id1327719623?mt=8">神奇AR</a>还有一个很好的应用：可以让你将照片在真实场景中打开，支持默认的排列方式，也可以自由摆放多张照片。但是图片一圈都会默认带有一圈白色的过渡带和阴影，无法去除。对于不是标准长方形的图片（比如圆形的图片，圆形之外都是透明的），显示效果不佳。</p>

<p>而且，是免费的。也许是因为其主打段视频社交吧，所以免费。</p>

<p>看官方介绍：</p>

<blockquote><p>AR视频:
用户可以利用AR模型、特效、图片、视频等拍摄一段30秒的短视频，发布在神奇AR的视频流中，或者分享到各大媒体平台，将自己的创意展现给更多的人，告诉大家如何使用AR。
玩转AR:
用户可以打开AR摄像头，通过简单的操作，将AR模型放在真实世界中，创造各种神奇的景象，用AR就能创造电影里才能出现的特技。
丰富的模型:
神奇AR是一个开放内容平台，直接对接优质的AR内容提供者，他可以通过神奇AR把自己的作品第一时间开放给用户，所以我们拥有全世界最丰富的AR内容。</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/shenqiar.jpg" alt="神奇 AR" /></p>

<p><a id="markdown-ikea-placehttpsitunesapplecomusappikea-placeid1279244498mt8" name="ikea-place"></a></p>

<h3><a href="https://itunes.apple.com/us/app/ikea-place/id1279244498?mt=8">IKEA Place</a></h3>

<p>宜家的官方App，有丰富的宜家家具的3D模型，真实尺寸，可以提前放置到自己的房间，看看效果。</p>

<blockquote><p>IKEA Place lets you virtually &lsquo;place&rsquo; IKEA products in your space. The app includes 3D and true-to-scale models of everything from sofas and armchairs to footstools and coffee tables. IKEA Place gives you an accurate impression of the furniture’s size, design and functionality in your home so you can stop wondering and start doing.</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/IKEAPlace.jpg" alt="ikea place" /></p>

<p><a id="markdown-wallrhttpsitunesapplecomusappwallrid1278372745" name="wallr"></a></p>

<h3><a href="https://itunes.apple.com/us/app/wallr/id1278372745">Wallr</a></h3>

<p>Wallr可以让你将图片放置到真实场景的墙面上。如果你想买画装饰墙面，可以试试。不过这个功能已经在<a href="https://itunes.apple.com/cn/app/%E7%A5%9E%E5%A5%87ar-%E7%89%B9%E6%95%88ar%E7%9B%B8%E6%9C%BA%E5%92%8C%E7%9F%AD%E8%A7%86%E9%A2%91%E6%8B%8D%E6%91%84%E7%A5%9E%E5%99%A8/id1327719623?mt=8">神奇AR</a>中实现了，而且是免费的。</p>

<p>同时放置多张图片需要花钱购买。</p>

<p><img src="http://hongchaozhang.github.io/images/wallr.jpg" alt="wallr" /></p>

<p><a id="markdown-horizon-explorerhttpsitunesapplecomgbapphorizon-explorerid1326860431platformipadpreservescrollpositiontrueplatformipad" name="horizon-explorer"></a></p>

<h3><a href="https://itunes.apple.com/gb/app/horizon-explorer/id1326860431?platform=ipad&amp;preserveScrollPosition=true#platform/ipad">Horizon Explorer</a></h3>

<p>AR和地图、地理位置结合的一个应用。</p>

<p>展示你设备看到的地理位置的信息，包括距离、建筑物名称、地点名称等。并把路线在一张地图上面展示给你。</p>

<p>还可以将3D的地图展示给你，让你看看某个景点或者建筑物周围等地理信息。</p>

<p>来看官方介绍：</p>

<blockquote><p>Horizon Explorer shows you the horizon and skyline around you &amp; tells you what you&rsquo;re looking at.</p>

<p>Point your camera at a hill, village, lake or landmark and Horizon Explorer will tell you what you are looking at, how far away it is, and show you a map, and information about the point you&rsquo;re aiming at.</p>

<p>ARKit technology makes the labels and alignment much more stable than used to be possible.</p>

<p>Fly up high and see the terrain laid out below you to see what is over the hills around you, and get the lay of the land, then see the scale-model 3D map that you can walk around &amp; explore to find out what&rsquo;s behind hills, or investigate up close.</p>

<p>Tracking works best on top of a hill with an unobstructed view of your surroundings (close up trees, buildings, rocks etc. can confuse the tracking). You can drag the terrain with your finger to line up with the camera if the automatic tracking is not working very well. Or try waving your phone around in the air in a figure 8 to calibrate the compass.</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/HorizonExplorer.jpg" alt="Horizon Explorer" /></p>

<p><a id="markdown-wearehttpsitunesapplecomcnappweareid1304227680platformiphonepreservescrollpositiontrueplatformiphoneplatformiphoneplatformiphone" name="weare"></a></p>

<h3><a href="https://itunes.apple.com/cn/app/weare/id1304227680?platform=iphone&amp;preserveScrollPosition=true&amp;platform=iphone#platform/iphone&amp;platform=iphone">WeAre</a></h3>

<p>这个应用可以让你选择一些照片，以设备为中心围成一圈，并缓慢移动。还可以播放视频、背景音乐和编辑3D文字。用作者的话说，“可以打造一个或温馨浪漫的回忆相册,或缥缈遥远的世界.”</p>

<p>同时还是源码可以参考：<a href="https://github.com/SherlockQi/HeavenMemoirs">HeavenMemoirs - AR相册</a></p>

<p><img src="http://hongchaozhang.github.io/images/weare.jpg" alt="WeAre" /></p>

<p><a id="markdown-waazy---magic-ar-video-makerhttpsitunesapplecomusappwaazy-magic-ar-video-makerid1286992749" name="waazy---magic-ar-video-maker"></a></p>

<h3><a href="https://itunes.apple.com/us/app/waazy-magic-ar-video-maker/id1286992749">Waazy - Magic AR Video Maker</a></h3>

<p>没太看懂这个应用。感觉主要做社交视频分享。录制视频还需要AR Lens。直接看官方介绍吧：</p>

<blockquote><p>Waazy is an augmented reality short video clips shooting and sharing social network, making it possible to bring virtual characters and objects to the real world.</p>

<p>Features:
- Record cool moments with AR Lens
- Tons of free and awesome AR effects
- Can add multiple AR characters at the same time
- One tap to make all the characters dance together
- Easily move and rotate a virtual character with control pad
- Themes include fantasy, monster, fun, and landmarks
- Show your original AR videos to the world</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/wazzy.jpg" alt="wazzy" /></p>

<p><a id="markdown-human-anatomy-atlas-2019httpsitunesapplecomappid1117998129" name="human-anatomy-atlas-2019"></a></p>

<h3><a href="https://itunes.apple.com/app/id1117998129">Human Anatomy Atlas 2019</a></h3>

<p>其实这个主要是展示人体内部结构的3D素材，借助AR技术投射到真实场景，没有很新鲜的AR应用场景。</p>

<p>这个应用非常专业，下载需要钱，App内还要购买。</p>

<blockquote><p>Human Anatomy Atlas offers thousands of models to help understand and communicate how the human body looks and works&ndash;and includes textbook-level definitions. Use it as a reference, instead of an anatomy textbook, or to create virtual lab experiences.
Includes over 10,000 anatomical models with descriptions in English, Spanish, French, German, Italian, Japanese, and Simplified Chinese.</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/HumanAnatomyAtlas2019_1.jpg" alt="Human Anatomy Atlas 2019 1" /></p>

<p><img src="http://hongchaozhang.github.io/images/HumanAnatomyAtlas2019_2.jpg" alt="Human Anatomy Atlas 2019 2" /></p>

<p><a id="markdown-github上面的项目" name="github上面的项目"></a></p>

<h2>Github上面的项目</h2>

<p><a id="markdown-arkit-occlusion-demohttpsgithubcombjarnelarkit-occlusion" name="arkit-occlusion-demo"></a></p>

<h3><a href="https://github.com/bjarnel/arkit-occlusion">arkit-occlusion-demo</a></h3>

<p>事先用一些虚拟平面将真实的墙面、柜子面、门等标记出来，就可以让虚拟的小球在房间里面来回反弹，就像撞到真实的墙上返回来一样。</p>

<p><img src="http://hongchaozhang.github.io/images/occlusiongame.jpg" width="600" alt="occlusion game" /></p>

<p><a id="markdown-arvideokit" name="arvideokit"></a></p>

<h3><a href="">ARVideoKit</a></h3>

<p>一个用来录制AR视频的框架。</p>

<blockquote><p>An iOS Framework that enables developers to capture videos, photos, Live Photos, and GIFs with ARKit content.</p>

<p>In other words, you NO LONGER have to screen record/screenshot to capture videos and photos of your awesome ARKit apps!</p></blockquote>

<p>其实录屏/截屏不是也挺好的吗？！</p>

<blockquote><p>Key Features:</p>

<p>✅ Capture Photos from <code>ARSCNView</code>, <code>ARSKView</code>, and <code>SCNView</code></p>

<p>✅ Capture Live Photos &amp; GIFs from <code>ARSCNView</code>, <code>ARSKView</code>, and <code>SCNView</code></p>

<p>✅ Record Videos from <code>ARSCNView</code>, <code>ARSKView</code>, and <code>SCNView</code></p>

<p>✅ Pause/Resume video</p>

<p>✅ Allow device&rsquo;s Music playing in the background while recording a video</p>

<p>✅ Returns rendered and raw buffers in a protocol method for additional Image &amp; Video processing</p></blockquote>

<p><a id="markdown-arkit-smb-homagehttpsgithubcombjarnelarkit-smb-homage" name="arkit-smb-homage"></a></p>

<h3><a href="https://github.com/bjarnel/arkit-smb-homage">arkit-smb-homage</a></h3>

<p>在现实场景中玩超级玛丽。非常粗糙，但是创意还不错。</p>

<p><img src="http://hongchaozhang.github.io/images/supermario_beginning.jpg" width="600" alt="super mario beginning" /></p>

<p><img src="http://hongchaozhang.github.io/images/supermario_flag.jpg" width="600" alt="super mario flag" /></p>

<p><a id="markdown-arkit-corelocationhttpsgithubcomprojectdentarkit-corelocation" name="arkit-corelocation"></a></p>

<h3><a href="https://github.com/ProjectDent/ARKit-CoreLocation">ARKit-CoreLocation</a></h3>

<p>功能：</p>

<ol>
<li>这个库最主要的工作，是在试图整合ARKit和CoreLocation，以得到更加准确的定位，从而更好地应用于AR场景。</li>
<li>基于真实地理位置，标注出摄像头中某个建筑物或者景点的标注。这个功能类似于<a href="https://itunes.apple.com/gb/app/horizon-explorer/id1326860431?platform=ipad&amp;preserveScrollPosition=true#platform/ipad">Horizon Explorer</a>。</li>
</ol>


<p>TODO: 可以仔细看看此库附带的demo：</p>

<blockquote><p>The library and demo come with a bunch of additional features for configuration. It’s all fully documented to be sure to have a look around.</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/arkit+corelocation.jpg" width="600" alt="arkit + corelocation" /></p>

<p><a id="markdown-arkitnavigationdemohttpsgithubcomchriswebb09arkitnavigationdemo" name="arkitnavigationdemo"></a></p>

<h3><a href="https://github.com/chriswebb09/ARKitNavigationDemo">ARKitNavigationDemo</a></h3>

<p>在地图上选择目的地，然后在真实场景中进行AR导航。</p>

<p>但是，这个项目也只是Demo一下，作者也很谦虚：</p>

<blockquote><p>When it loads to the map, tap a place on the map where you want to navigate to and press okay. The tap can be sluggish, so you might have to try once or twice before you get it. When the navigation screen loads, tap the screen, then give it a few seconds. You should see the nodes render.</p></blockquote>

<p>TODO: 这个项目中推荐的一些参考文献还是值得看一看的。</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitNavigationDemo.gif" alt="ARKitNavigationDemo" /></p>

<p><a id="markdown-finemehttpsgithubcommmoaayfindme" name="fineme"></a></p>

<h3><a href="https://github.com/mmoaay/Findme">FineMe</a></h3>

<p>可以让你的朋友根据你录制的路线图找到你：</p>

<ol>
<li>通过各种方法，记录你的起点，并让另一个人知道你的起点。比如可以通过分享起点照片，或者分享起点位置。</li>
<li>通过ARKit记录你走过的路线，并将路线分享给另一个人。</li>
<li>另一个人如果找到了你的起点，就可以根据你分享的路径找到你。</li>
</ol>


<p>但是，由于ARKit不稳定，此方法也不一定奏效。</p>

<p>作者试图通过定位和距离提高路线的稳定性，但不知效果如何，分别见于以下两个分支：</p>

<ul>
<li><a href="https://github.com/mmoaay/Findme/tree/feature/location_optimize">According to location</a></li>
<li><a href="https://github.com/mmoaay/Findme/tree/feature/distance_optimize">According to distance</a></li>
</ul>


<p><a id="markdown-arkitspitfirehttpsgithubcomchriswebb09arkitspitfire" name="arkitspitfire"></a></p>

<h3><a href="https://github.com/chriswebb09/ARKitSpitfire">ARKitSpitfire</a></h3>

<p>可以让一架3D飞机模型，根据提供的地理位置经纬度，调整姿态，并飞向那里。</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitSpitfire.gif" alt="ARKitSpitfire" /></p>

<p><a id="markdown-resources" name="resources"></a></p>

<h2>Resources</h2>

<p><a id="markdown-polyhttpsgithubcompiemontepoly" name="poly"></a></p>

<h3><a href="https://github.com/piemonte/Poly">Poly</a></h3>

<p><a href="https://github.com/piemonte/Poly">Poly</a>是一个iOS库，用来从<a href="https://developers.google.com/poly/">Google Poly</a>上下载3D模型，包含搜索、下载管理和缓存功能。</p>

<p><a href="https://developers.google.com/poly/develop/ios">iOS Quickstart</a>展示了如何在iOS中下载使用<a href="https://developers.google.com/poly/">Google Poly</a>上面的3D资源。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[将代码查重工具CPD集成到Xcode]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/08/02/integrate-copy-and-paste-detector-into-xcode/"/>
    <updated>2018-08-02T18:34:40+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/08/02/integrate-copy-and-paste-detector-into-xcode</id>
    <content type="html"><![CDATA[<!-- more -->


<p><img src="http://hongchaozhang.github.io/images/copy_and_paste_image.jpeg" alt="copy and paster image" /></p>

<h2>DRY准则</h2>

<p>编程的一个基本准则就是DRY（Don&rsquo;t Repeat Yourself)，不写重复代码。简单来说，就是不要复制黏贴。</p>

<p>在开始之前，我们先讨论一下什么叫做“复制黏贴”？首先，如果你有相同的文件，肯定是极其糟糕的“复制黏贴”。如果你有两个类只是类名不同，但是做着相同或者类似的事情，也是很严重的“复制黏贴”。即使只有10行代码的重复，也是”复制黏贴“。根据作者个人经验，一个100000行的工程，完全不需要复制黏贴。</p>

<h3>复制黏贴的坏处</h3>

<p>在重复的代码处修改bug，还需要手动找到另外一处，做相同的修改。</p>

<h2>如何避免复制黏贴</h2>

<p>避免重复代码的传统方法是代码审查，但是对于代码审查者来说，找到重复代码是一件很困难的事情。</p>

<p>我们能不能在编译阶段就查找出重复代码，并要求这些重复代码移除掉之后才可以继续进行编译。</p>

<h2>安装CPD</h2>

<p>对于Swift代码，有两个工具可以做代码查重：</p>

<ul>
<li><a href="https://github.com/kucherenko/jscpd">jscpd</a></li>
<li><a href="https://pmd.github.io/">pmd</a></li>
</ul>


<h3><a href="https://pmd.github.io/">pmd</a></h3>

<p>其中，pmd可定制，并且比较稳定。开始之前，先通过homebrew进行安装：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install pmd</span></code></pre></td></tr></table></div></figure>


<blockquote><p>注意：对于其他语言，pmd都包含代码静态分析工具，但是对于Swift，只有一个代码查重工具CPD（Copy Paste Detector）。因此，如果想对Swift代码进行静态分析，可以选择<a href="https://github.com/realm/SwiftLint">SwiftLint</a>。</p></blockquote>

<h2>集成到Xcode</h2>

<p>为了将CPD功能集成到编译阶段，我们在Build Phase里新添加一个运行脚本（Run Script），并添加以下脚本：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Running CPD
</span><span class='line'>pmd cpd --files ${EXECUTABLE_NAME} --minimum-tokens 50 --language swift --encoding UTF-8 --format net.sourceforge.pmd.cpd.XMLRenderer &gt; cpd-output.xml --failOnViolation true
</span><span class='line'># Running script
</span><span class='line'>php ./cpd_script.php -cpd-xml cpd-output.xml</span></code></pre></td></tr></table></div></figure>


<p>让我们来看一下这一段脚本做了什么事情。</p>

<p>第一部分是说我们在项目根目录下对所有的文件进行代码查重：</p>

<ul>
<li><code>--minimum-tokens</code>指定重复代码的最少token数量。这里的token是一个比较抽象的概念，不是字符，不是单词，也不是短语的意思。根据经验来说，Swift语言的最优值是50：太大，会漏掉重复代码；太小，会将一些代码误判为重复代码。</li>
<li><code>--formant</code>指定输出格式，这里指定为xml文件。</li>
<li><code>--failOnViolation</code>标识为设置为<code>true</code>，意思是只要检测到重复代码，就不继续进行编译。</li>
</ul>


<blockquote><p>经测试，无论<code>--failOnViolation</code>设置成<code>true</code>，还是<code>false</code>，都不能阻断编译的正常运行。所有的warning都能正常地输出。</p></blockquote>

<p>第一部分脚本执行的结果，是一个xml文件，里面包含了整个工程里面的重复代码及其位置、行数等信息。下面让我们看看，怎么将这个难读的xml文件以warning的形式展示给开发者。</p>

<p>为了将xml文件转换成更好读的warning，需要在工程根目录下创建一个php文件，我们叫做cpd_script.php，拷贝下面的脚本到该文件中：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="nb">simplexml_load_file</span><span class="p">(</span><span class="s1">&#39;cpd-output.xml&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">duplication</span> <span class="k">as</span> <span class="nv">$duplication</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$files</span> <span class="o">=</span> <span class="nv">$duplication</span><span class="o">-&gt;</span><span class="na">xpath</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;:1: warning: &#39;</span><span class="o">.</span><span class="nv">$duplication</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39; copy-pasted lines from: &#39;</span>
</span><span class='line'>            <span class="o">.</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$otherFile</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$otherFile</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="nv">$otherFile</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">];</span> <span class="p">},</span>
</span><span class='line'>            <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$f</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$f</span> <span class="o">!=</span> <span class="nv">$file</span><span class="p">;</span> <span class="p">})))</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>我们在Build Phase中添加的脚本的第二部分就是运行这一段脚本，将生成的xml文件中的所有重复代码信息以warning的形式展示在Xcode中。如果你想了解如何在Xcode中生成warning，参考<a href="https://krakendev.io/blog/generating-warnings-in-xcode">Generating Warnings in Xcode</a>。</p>

<blockquote><p>我试了<a href="https://krakendev.io/blog/generating-warnings-in-xcode">Generating Warnings in Xcode</a>中说的方法，脚本有错误，为了将comment中有TODO:和FIXME:的地方标记为warning，将有ERROR:的地方标记为error，可以尝试将下面的脚本写到Build Phase的运行脚本（Run Script）中（参考<a href="https://medium.com/ios-os-x-development/highlight-warnings-in-xcode-521125121a75">Highlight Warnings in Xcode</a>）：</p>

<pre><code>TAGS="TODO:|FIXME:|WARNING:"
ERRORTAG="ERROR:"
find "${SRCROOT}" \( -name "*.h" -or -name "*.m" -or -name "*.swift" \) -print0 | xargs -0 egrep --with-filename --line-number --only-matching "($TAGS).*\$|($ERRORTAG).*\$" | perl -p -e "s/($TAGS)/ warning: \$1/"| perl -p -e "s/($ERRORTAG)/ error: \$1/"
</code></pre>

<p>其实不用这么复杂：以“#warning”开头，接下来跟上warning信息就可以了，Xcode会在左侧导航栏里面生成一种叫做User-Defined Issues的warning。</p></blockquote>

<p>现在编译工程，可以在Xcode左侧导航窗口看到所有的warning：</p>

<p><img src="http://hongchaozhang.github.io/images/cpd_warnings_in_navigation.jpg" alt="cpd warnings in navigation" /></p>

<p>在相应的文件中，也可以看到该文件所包含的重复代码的warning：</p>

<p><img src="http://hongchaozhang.github.io/images/cpd_warnings_in_file.jpg" alt="cpd warnings in file" /></p>

<p>这个warning的意思是说：从54行往下的41行代码和ErrorHandleTester.swift中从96行往下的41行代码重复。</p>

<blockquote><p>如果是刚安装的pmd，可能需要重启Xcode，让pmd命令生效。</p></blockquote>

<h3><a href="https://github.com/kucherenko/jscpd">jscpd</a></h3>

<p>生成的中间结果文件格式和pmd是一样的，节点名字也叫做<code>pmd-cpd</code>。</p>

<p>但是：<strong>jscpd支持yaml格式的配置文件。</strong>这一点很重要，我在工作中也是用jscpd，而不是pmd的cpd。jscpd的安装和使用方法同pmd的cpd基本一样，不再重复。</p>

<p>yaml语法参考<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">YAML语言教程</a>。</p>

<h2>什么时候使用</h2>

<p>Finding clones is typically useful in the following cases:</p>

<ul>
<li><p><strong>When updating existing code</strong>. When you are fixing a bug, or responding to changes in requirements, you usually start by finding the location in the code that you need to change. Before you make the change, search for clones of that code segment. If clones are discovered:</p>

<ul>
<li>Consider whether you need to make the same change to each clone.</li>
<li>Consider also whether this is a good opportunity to refactor the cloned code into a shared method or class.</li>
</ul>
</li>
<li><p><strong>Architectural cleanup</strong>. Towards the end of every iteration, use Analyze Solution for Code Clones on the Analyze menu.</p></li>
<li><p><strong>When you create code</strong>. When you have written new code, use the tool to find similar code that already existed.</p></li>
</ul>


<h2>结论</h2>

<p>作者：重复代码清理刻不容缓。这个工具可以帮助我们做这件事情，而且，几乎没有任何副作用。</p>

<h2>参考</h2>

<ul>
<li>翻译部分<a href="https://medium.com/@nvashanin/%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B8%D1%80%D1%83%D0%B5%D0%BC-copy-paste-detector-%D0%B4%D0%BB%D1%8F-swift-%D0%B2-xcode-9ae87c20748">Integrating Copy-Paste-Detector for Swift in Xcode</a>。</li>
<li>如何在Xcode中生成warning，参考<a href="https://krakendev.io/blog/generating-warnings-in-xcode">Generating Warnings in Xcode</a>。</li>
<li>如何编写jscpd的yaml配置文件，参考<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">YAML 语言教程</a>。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Introducing Create ML]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/06/15/introducing-create-ml/"/>
    <updated>2018-06-15T17:39:30+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/06/15/introducing-create-ml</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#background">Background</a></li>
<li><a href="#create-ml">Create ML</a></li>
<li><a href="#main-advantage-easy-to-use">Main Advantage: Easy to Use</a>

<ul>
<li><a href="#create-ml%E5%92%8Cturi-create">Create ML和Turi Create</a></li>
</ul>
</li>
<li><a href="#transfer-learning">Transfer Learning</a></li>
<li><a href="#improving-accuracy">Improving Accuracy</a></li>
<li><a href="#references-and-materials">References and Materials</a></li>
</ul>


<p>Apple released Core ML in WWDC2017, and I took a note on <a href="../../../../2017/12/28/coreml-usage/">CoreML Usage</a>, including mlmodel training using Microsoft <a href="https://www.customvision.ai/">Custom Vision</a>.</p>

<p>This post is about the background of Create ML, its advantages, its relations with Turi. There is no code in this post. If you are looking for the usage of Create ML, refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a>.</p>

<p><a id="markdown-background" name="background"></a></p>

<h2>Background</h2>

<p>Before 2018, where can we get the mlmodel file used in iOS and macOS?</p>

<ul>
<li><a href="https://github.com/tf-coreml/tf-coreml">TensorFlow</a>: Train machine learning models and easily convert them to the Core ML Model format.</li>
<li><a href="https://www.customvision.ai/">Custom Vision</a> from Microsoft</li>
<li><a href="https://pypi.org/project/coremltools/">Core ML Tools</a>: Use this python package to convert models from machine learning toolboxes into the Core ML format.</li>
<li><a href="https://github.com/apache/incubator-mxnet/tree/master/tools/coreml">Apache MXNet</a>: Train machine learning models and convert them to the Core ML format.</li>
<li><a href="https://github.com/onnx/onnx-coreml">ONNX</a>: Convert ONNX models you have created to the Core ML Model format.</li>
<li>&hellip;</li>
</ul>


<p>TensorFlow doesn&rsquo;t support GPU on macOS from version 1.2.</p>

<p><img src="http://hongchaozhang.github.io/images/tensorflow_not_support_gpu_on_macos.jpg" alt="tensor flow not support gpu on macos" /></p>

<p><strong>Core ML</strong>: Announced at WWDC 2017, and already supported by every major ML platform to convert existing models. But the existing models tend to be too big and/or too general.</p>

<p><strong>Turi Create</strong>: Acquired by Apple in 2016 ($200M), it lets you customize existing models with your own data. But … Python :[.</p>

<p><a id="markdown-create-ml" name="create-ml"></a></p>

<h2>Create ML</h2>

<p>Finally in WWDC2018, Apple announced <strong>Create ML</strong>, which can train machine learning models on macOS, able to use the GPU on macOS. The Create ML session and Turi Create session did not mention any word on each other, but obviousely, Create ML is based on Turi Create.</p>

<p>Based on Trui&rsquo;s model training, Create ML can make model training on macOS using GPU (maybe through Metal), and come up with models which can be used by Core ML framework.</p>

<p>With XCode Playground&rsquo;s updates, Apple gives CreateMLUI, a very easy way for model training: just need to drag your training data and test data into Playground.</p>

<p><a id="markdown-main-advantage-easy-to-use" name="main-advantage-easy-to-use"></a></p>

<h2>Main Advantage: Easy to Use</h2>

<p>Do model training using Swift in XCode.</p>

<blockquote><p><strong>Create ML</strong> is proof that Apple is committed to making it easier for you to use machine learning models in your apps. In this Create ML tutorial, you’ll learn how Create ML speeds up the workflow for improving your model by improving your data while also flattening the learning curve by doing it all in the comfort of Xcode and Swift.</p>

<p>&ndash;Refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a></p>

<p><strong>Create ML</strong>: Announced at WWDC 2018. ML in Xcode &amp; Swift! Currently includes only two of Turi Create’s seven task-focused toolkits, plus a generic classifier and regressor, and data tables. I see it as a trail of breadcrumbs leading you to the Turi Create gingerbread house, inhabited by a “good dog” instead of a witch! (Turi Create’s logo is a dog silhouette.)</p>

<p>&ndash;Refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a></p></blockquote>

<p>Refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a> to see how easy it is to use Create ML. There are some code comparasion between Create ML and Turi Create.</p>

<p><a id="markdown-create-ml和turi-create" name="create-ml和turi-create"></a></p>

<h3>Create ML和Turi Create</h3>

<p>Currently Create ML includes only two of Turi Create’s seven task-focused toolkits, plus a generic classifier and regressor, and data tables. Turi Create has five task-focused toolkits that aren’t (yet?) in Create ML:</p>

<ul>
<li>Recommender systems</li>
<li>Image similarity</li>
<li>Object detection</li>
<li>Style transfer</li>
<li>Activity classification</li>
</ul>


<p><a id="markdown-transfer-learning" name="transfer-learning"></a></p>

<h2>Transfer Learning</h2>

<p>The description of Transfer Learning from Apple Turi:</p>

<blockquote><p>It’s not uncommon for the task you want to solve to be related to something that has already been solved. Take, for example, the task of distinguishing cats from dogs. The famous ImageNet Challenge, for which CNN’s are the state-of-the-art, asks the trained model to categorize input into one of 1000 classes. Shouldn&rsquo;t features that distinguish between categories like lions and wolves also be useful for discriminating between cats and dogs?</p>

<p>The answer is a definitive yes. It is accomplished by simply removing the output layer of the Deep Neural Network for 1000 categories, and taking the signals that would have been propagating to the output layer and feeding them as features to a classifier for our new cats vs dogs task.</p>

<p>So, when you run the Turi Create image classifier, it breaks things down into something like this:</p>

<p>Stage 1: Create a CNN classifier on a large, general dataset. A good example is ImageNet, with 1000 categories and 1.2 million images. The models are already trained by researchers and are available for us to use.</p>

<p>Stage 2: The outputs of each layer in the CNN can be viewed as a meaningful vector representation of each image. Extract these feature vectors from the layer prior to the output layer on each image of your task.</p>

<p>Stage 3: Create a new classifier with those features as input for your own task.</p>

<p>At first glance, this seems even more complicated than just training the deep learning model. However, Stage 1 is reusable for many different problems, and once done, it doesn&rsquo;t have to be changed often.</p>

<p>In the end, this pipeline results in not needing to adjust hyper-parameters, faster training, and better performance even in cases where you don&rsquo;t have enough data to create a convention deep learning model. What&rsquo;s more, this technique is effective even if your Stage 3 classification task is relatively unrelated to the task Stage 1 is trained on. This idea was first explored by Donahue et al. (2013), and has since become one of the best ways to create image classifier models.</p>

<p>&ndash;Refer to <a href="https://apple.github.io/turicreate/docs/userguide/image_classifier/how-it-works.html#transfer-learning">truicreate transfer learning</a></p></blockquote>

<p>Some comments on transfer learning from web:</p>

<blockquote><p>What’s happening here? It’s called transfer learning, if you want to look it up. The underlying model — VisionFeaturePrint_Screen, which backs the Vision framework — was pre-trained on a ginormous dataset to recognize an enormous number of classes. It did this by learning what features to look for in an image, and how to combine these features to classify the image. Almost all of the training time for your dataset is the model extracting around 1000 features from your images. These could include low-level shapes and textures and higher-level shape of ears, distance between eyes, shape of snout. Then it spends a relatively tiny amount of time training a logistic regression model to separate your images into two classes. It’s similar to fitting a straight line to scattered points, but in 1000 dimensions instead of 2. But it’s still very quick to do: my run 1m 15s for feature extraction and 0.177886 seconds to train and apply the logistic regression.</p>

<p>Transfer learning only works successfully when features of your dataset are reasonably similar to features of the dataset that was used to train the model. A model pre-trained on ImageNet — a large collection of photos — might not transfer well to pencil drawings or microscopy images.</p>

<p>&ndash;Refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a></p></blockquote>

<p><a id="markdown-improving-accuracy" name="improving-accuracy"></a></p>

<h2>Improving Accuracy</h2>

<p>Refer to <a href="https://developer.apple.com/documentation/create_ml/improving_your_model_s_accuracy">Improving Your Model’s Accuracy</a> from Apple for improving training accuracy.</p>

<p>How to improve the model&rsquo;s training accuracy, validation accuracy and evaluation accuracy. <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a> describes the three &lsquo;accuracy&rsquo;s.</p>

<p><a id="markdown-references-and-materials" name="references-and-materials"></a></p>

<h2>References and Materials</h2>

<ol>
<li><p>You might like to browse two fascinating articles about features from (mostly) Google Brain/Research:</p>

<ul>
<li><p><a href="https://distill.pub/2018/building-blocks/">The Building Blocks of Interpretability</a>: image feature extracting</p></li>
<li><p><a href="https://distill.pub/2017/feature-visualization/">Feature Visualization</a></p></li>
</ul>
</li>
<li><p><a href="https://www.kaggle.com/">Kaggle</a> is a repository of datasets contributed by members, often supplemented by notebooks that analyze and visualize the data. It runs model prediction competitions, which leads to the next link:</p>

<ul>
<li>Machine Learning Zero-to-Hero: Everything you need in order to compete on Kaggle for the first time, step-by-step!</li>
</ul>
</li>
<li><p><a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a> describes the usage of Create ML and Turi Create, including the history, code, data preparation, improving model accuracy and so on.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What is new in ARKit 2]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/06/13/what-is-new-in-n-arkit-2/"/>
    <updated>2018-06-13T13:24:59+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/06/13/what-is-new-in-n-arkit-2</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#new-features-in-arkit-2">New Features in ARKit 2</a>

<ul>
<li><a href="#saving-and-loading-maps">Saving and Loading Maps</a>

<ul>
<li><a href="#world-tracking-recap">World Tracking Recap:</a></li>
<li><a href="#world-tracking-enhancement">World Tracking Enhancement:</a></li>
<li><a href="#saving-and-loading-maps">Saving and loading maps:</a></li>
<li><a href="#how-to-get-a-good-map">How to get a good map</a></li>
</ul>
</li>
<li><a href="#environment-texturing">Environment Texturing</a></li>
<li><a href="#image-tracking">Image Tracking</a></li>
<li><a href="#3d-object-detection">3D Object Detection</a></li>
<li><a href="#face-tracking-enhancements">Face Tracking Enhancements</a></li>
</ul>
</li>
<li><a href="#some-other-wwdc-sessions-related-to-ar">Some other WWDC Sessions Related to AR</a>

<ul>
<li><a href="#integrating-apps-and-content-with-ar-quick-look">Integrating Apps and Content with AR Quick Look</a></li>
<li><a href="#inside-swiftshot-creating-an-ar-game">Inside SwiftShot: Creating an AR Game</a></li>
<li><a href="#creating-great-ar-experiences">Creating Great AR Experiences</a></li>
<li><a href="#understanding-arkit-tracking-and-detection">Understanding ARKit Tracking and Detection</a></li>
</ul>
</li>
<li><a href="#some-other-materials-for-a-better-ar-app">Some other materials for a better AR app:</a>

<ul>
<li><a href="#building-your-first-ar-experience">Building Your First AR Experience</a></li>
<li><a href="#managing-session-lifecycle-and-tracking-quality">Managing Session Lifecycle and Tracking Quality</a></li>
<li><a href="#human-interface-guidelines---augmented-reality">Human Interface Guidelines - Augmented Reality</a></li>
<li><a href="#handling-3d-interaction-and-ui-controls-in-augmented-reality">Handling 3D Interaction and UI Controls in Augmented Reality</a></li>
<li><a href="#creating-a-multiuser-ar-experience">Creating a Multiuser AR Experience</a></li>
<li><a href="#swiftshot-creating-a-game-for-augmented-reality">SwiftShot: Creating a Game for Augmented Reality</a></li>
<li><a href="#recognizing-images-in-an-ar-experience">Recognizing Images in an AR Experience</a></li>
<li><a href="#scanning-and-detecting-3d-objects">Scanning and Detecting 3D Objects</a></li>
</ul>
</li>
</ul>


<p><a id="markdown-overview" name="overview"></a></p>

<h2>Overview</h2>

<p>In ARKit 1, we have:</p>

<ul>
<li>Device positioning from world tracking process</li>
<li>Horizontal and vertical plane detection from world tracking process</li>
<li>Lighting estimation</li>
<li>AR face tracking</li>
</ul>


<p>In ARKit 2, we have:</p>

<ul>
<li>Saving and loading maps</li>
<li>Environment Texturing</li>
<li>Image detection and tracking</li>
<li>3D object tracking</li>
<li>Improved face tracking</li>
</ul>


<p><a id="markdown-new-features-in-arkit-2" name="new-features-in-arkit-2"></a></p>

<h2>New Features in ARKit 2</h2>

<p><a id="markdown-saving-and-loading-maps" name="saving-and-loading-maps"></a></p>

<h3>Saving and Loading Maps</h3>

<p><a id="markdown-world-tracking-recap" name="world-tracking-recap"></a></p>

<h4>World Tracking Recap:</h4>

<ul>
<li>Position and orientation of the device.</li>
<li>Physical scale in the scene.</li>
<li>3D feature points.</li>
<li>Relocalization (iOS 11.3): we can relocalize objects when your AR session is interrupted, like phone coming or going from background. This feature is implemented by storing the mapping <code>ARWorldMap</code> between real world and the coordinate system. However the mapping is not exposed to developers.</li>
</ul>


<p><a id="markdown-world-tracking-enhancement" name="world-tracking-enhancement"></a></p>

<h4>World Tracking Enhancement:</h4>

<ul>
<li><strong>Saving and loading maps</strong>: expose the <code>ARWorldMap</code> to developers.</li>
<li>Faster initialization and plane detection</li>
<li>Robust tracking and plane detection</li>
<li>More accurate extent and boundary Continuous autofocus</li>
<li>New 4:3 video formats (iPad is also 4:3)</li>
</ul>


<p><a id="markdown-saving-and-loading-maps" name="saving-and-loading-maps"></a></p>

<h4>Saving and loading maps:</h4>

<p><code>ARWorldmap</code> contains:</p>

<ul>
<li>Mapping of physical 3D space: for representing 3D feature points in the coordinate system.</li>
<li>Mutable list of named anchors: for restoring previous 3D environment (like lighting node anchor), and relocalizing previously added virtual objects.</li>
<li>Raw feature points and extent: for debugging and visualization.</li>
<li>Serialization: for storing and recovering from an file.</li>
</ul>


<p><img src="http://hongchaozhang.github.io/images/arkit2_arworldmap.jpg" width="500" alt="arkit arworldmap" /></p>

<p>We can use the map in two different ways:</p>

<ul>
<li>Persistent: Restore previous AR scene for a new AR session. For example, you go to another room and come back or close the AR app and open it some time later.</li>
<li>Multiuser experience: We can share the map among devices through WiFi or bluetooth.</li>
</ul>


<p>The SwiftShot is an multiuser experience AR game:</p>

<p><img src="http://hongchaozhang.github.io/images/swiftshot.jpg" alt="arkit2 swiftshot" /></p>

<p>and the following is a small piece of the demo:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_multiuser_experience_demo.gif" alt="swift shot game" /></p>

<p><a id="markdown-how-to-get-a-good-map" name="how-to-get-a-good-map"></a></p>

<h4>How to get a good map</h4>

<p>In order to share or restore the map, we need to get a good one first. A good map should be:</p>

<!-- * Important for relocalization -->


<ul>
<li>Multiple points of view: If we record the mapping from one point of view, and try to restore the coordinate system from another point of view, it will fail.</li>
<li>Static, well-textured environment.</li>
<li>Dense feature points on the map.</li>
</ul>


<p>We can use the <code>WorldMappingStatus</code> status from <code>ARFrame</code> to decide if the current map is good enough for sharing or storing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">public</span> <span class="k">enum</span> <span class="nl">WorldMappingStatus</span> <span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">case</span> <span class="n">notAvailable</span>
</span><span class='line'>   <span class="k">case</span> <span class="n">limited</span>
</span><span class='line'>   <span class="k">case</span> <span class="n">extending</span>
</span><span class='line'>   <span class="k">case</span> <span class="n">mapped</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-environment-texturing" name="environment-texturing"></a></p>

<h3>Environment Texturing</h3>

<p>With the help of Environment Texturing, AR scene objects can reflect the environment texture on the surface of themselves, just like:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_environment_texturing_demo.jpg" alt="arkit2 environment texturing demo" /></p>

<p><a id="markdown-image-tracking" name="image-tracking"></a></p>

<h3>Image Tracking</h3>

<p>Moving objects can not be positioned in ARKit 1. In ARKit 2, specified images can be tracked in AR scene.</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_image_tracking.gif" alt="arkit 2 image tracking" /></p>

<p>The classes in ARKit 2 for image tracking are:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_image_tracking_classes.jpg" alt="arkit 2 image tracking classes" /></p>

<p>The detected <code>ARImageAnchor</code>s have properties like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">open</span> <span class="k">class</span> <span class="nl">ARImageAnchor</span> <span class="p">:</span> <span class="n">ARAnchor</span><span class="p">,</span> <span class="n">ARTrackable</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">public</span> <span class="k">var</span> <span class="nl">isTracked</span><span class="p">:</span> <span class="n">Bool</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">transform</span><span class="p">:</span> <span class="n">simd_float4x4</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">referenceImage</span><span class="p">:</span> <span class="n">ARReferenceImage</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The specified image should:</p>

<ul>
<li>Histogram should be broad</li>
<li>Not have multiple uniform color regions</li>
<li>Not have repeated structures</li>
</ul>


<p>The following is the demo:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_image_tracking_demo.gif" alt="arkit 2 image tracking demo" /></p>

<p>The inputs of the above demo are:</p>

<ul>
<li>an static image of the cat, the same as it is in the picture frame</li>
<li>an video of the cat</li>
</ul>


<p>The video is played at the position of the specified picture frame, with the same orientation of the picture frame.</p>

<p>There are two classes related to image tracking:</p>

<table>
<thead>
<tr>
<th>ARImageTrackingConfiguration </th>
<th> ARWorldTrackingConfiguration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Has No World Origin </td>
<td> Has World Origin</td>
</tr>
<tr>
<td>After detecting the image, only do things inside the place of the image. </td>
<td> After detecting the image, place some virtual objects outside the detected image plane.</td>
</tr>
</tbody>
</table>


<p><a id="markdown-3d-object-detection" name="3d-object-detection"></a></p>

<h3>3D Object Detection</h3>

<p>3D object detection workflow is:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_3D_object_tracking_classes.jpg" alt="arkit2 3D object tracking classes" /></p>

<p>The <code>ARObjectAnchor</code> contains properties like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">open</span> <span class="k">class</span> <span class="nl">ARObjectAnchor</span> <span class="p">:</span> <span class="n">ARAnchor</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">transform</span><span class="p">:</span> <span class="n">simd_float4x4</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">referenceObject</span><span class="p">:</span> <span class="n">ARReferenceObject</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and <code>ARReferenceObject</code> is the scanned 3D object:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">open</span> <span class="k">class</span> <span class="nl">ARReferenceObject</span>
</span><span class='line'>    <span class="p">:</span> <span class="bp">NSObject</span><span class="p">,</span> <span class="bp">NSCopying</span><span class="p">,</span> <span class="bp">NSSecureCoding</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="o">?</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">center</span><span class="p">:</span> <span class="n">simd_float3</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">extent</span><span class="p">:</span> <span class="n">simd_float3</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">rawFeaturePoints</span><span class="p">:</span> <span class="n">ARPointCloud</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>An <code>ARReferenceObject</code> contains only the spatial feature information needed for ARKit to recognize the real-world object, and is not a displayable 3D reconstruction of that object.</p></blockquote>

<p>In order to get the <code>ARReferenceObject</code>, we should scan the real object, and store the result as an file (.arobject) or an xcode asset catalog for ARKit to use. Fortunately, Apple supplies a demo for scanning 3D object to get the <code>ARReferenceObject</code>. Refer to: <a href="https://developer.apple.com/documentation/arkit/scanning_and_detecting_3d_objects">Scanning and Detecting 3D Objects</a> for detail and the rough steps of object scanning are:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_3D_object_scan.jpg" alt="arkit2 3D object scan" /></p>

<p>For scanned object in the real world, we can dynamically add some info around it (Museum is a good use case.), like the demo does:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_3D_object_tracking_demo.gif" alt="arkit2 object tracking demo" /></p>

<p><a id="markdown-face-tracking-enhancements" name="face-tracking-enhancements"></a></p>

<h3>Face Tracking Enhancements</h3>

<p>With face tracking, we can place something on it or around it.</p>

<p>Enhancements in ARKit 2:</p>

<ul>
<li>Gaze tracking</li>
<li>Tongue support</li>
</ul>


<blockquote><p>Gaze and Tongue can be input of the AR app.</p></blockquote>

<p>New changes in one screenshot:</p>

<p><img src="http://hongchaozhang.github.io/images/what-is-new-in-arkit-2.jpg" alt="what-is-new-in-arkit-2" /></p>

<p><a id="markdown-some-other-wwdc-sessions-related-to-ar" name="some-other-wwdc-sessions-related-to-ar"></a></p>

<h2>Some other WWDC Sessions Related to AR</h2>

<p><a id="markdown-integrating-apps-and-content-with-ar-quick-lookhttpsdeveloperapplecomvideosplaywwdc2018603" name="integrating-apps-and-content-with-ar-quick-lookhttpsdeveloperapplecomvideosplaywwdc2018603"></a></p>

<h3><a href="https://developer.apple.com/videos/play/wwdc2018/603/">Integrating Apps and Content with AR Quick Look</a></h3>

<p>A deeper dive into a new feature in iOS that provides a way to preview any AR object from a USDZ file.</p>

<p><img src="http://hongchaozhang.github.io/images/QLPreviewController.png" alt="QLPreviewController" /></p>

<ul>
<li>There’s a great sequence diagram presented (see above) (I wish more sessions would have these!) for previewing USDZ objects, of which the <code>QLPreviewController</code> plays a central role.</li>
<li>For web developers, it covers HTML samples for how to preview USDZ objects in Safari.</li>
<li>Then it goes into a deep dive on how to create the actual USDZ objects, with more examples on new AR texturing capabilities.</li>
<li>There’s also a quick overview on how to optimize the files, to keep the size down, and there’s a breakdown of the files that make up the USDZ format.</li>
</ul>


<p><a id="markdown-inside-swiftshot-creating-an-ar-gamehttpsdeveloperapplecomvideosplaywwdc2018605" name="inside-swiftshot-creating-an-ar-gamehttpsdeveloperapplecomvideosplaywwdc2018605"></a></p>

<h3><a href="https://developer.apple.com/videos/play/wwdc2018/605/">Inside SwiftShot: Creating an AR Game</a></h3>

<p>Covers world map sharing, networking, and the physics of how to build an AR game, as well as some design insight (I have limited game dev experience so I’ll do the best I can below).</p>

<ul>
<li>Pointers to remember with designing an AR game, such as “encouraging” the user to slowly move the device for world mapping!</li>
<li>It demonstrates the usage of image &amp; object detection, world map sharing, and iBeacons for the game.</li>
<li>Integrating <code>ARKit</code> with <code>SceneKit</code> and <code>Metal</code>, including the translation of physics data between each — position, velocity, and orientation.</li>
<li>Performance enhancement with the <code>BitStreamCodable</code> protocol.</li>
<li>A small look at how audio was integrated into the game.</li>
</ul>


<p><a id="markdown-creating-great-ar-experienceshttpsdeveloperapplecomvideosplaywwdc2018805" name="creating-great-ar-experienceshttpsdeveloperapplecomvideosplaywwdc2018805"></a></p>

<h3><a href="https://developer.apple.com/videos/play/wwdc2018/805/">Creating Great AR Experiences</a></h3>

<p>Best practises mainly from a UX &amp; design perspective (there are no code samples in this session).</p>

<ul>
<li>Logical dos and don’ts that may be useful, if you need help with thought towards product and empathy towards the user.</li>
<li>They emphasize the importance of using transitions between AR scapes.</li>
<li>Why AR is a special combination of touch and movement.</li>
<li>They advise that minimal battery impact should be a huge focus! This is a challenge, given that they recommend to render the FPS at 60 to avoid latency.</li>
<li>There’s a lengthy demonstration of creating an AR fireplace, with complex texturing, etc. It looks great, but unfortunately there were no coding samples accompanying the demo.</li>
</ul>


<p><a id="markdown-understanding-arkit-tracking-and-detectionhttpsdeveloperapplecomvideosplaywwdc2018610" name="understanding-arkit-tracking-and-detectionhttpsdeveloperapplecomvideosplaywwdc2018610"></a></p>

<h3><a href="https://developer.apple.com/videos/play/wwdc2018/610/">Understanding ARKit Tracking and Detection</a></h3>

<p>A good broad overview of all of the main AR concepts.</p>

<ul>
<li>This is such a good intro into not only AR on iOS, but AR in general, that it should have been part of 2017’s sessions when ARKit was first introduced. Better late than never. If you’re only going to watch one session, watch this one!</li>
<li>It recaps the main features of ARKit — <strong>orientation</strong>, <strong>world tracking</strong>, and <strong>plane detection</strong>, and demos all of these in depth with coding samples.</li>
<li>It then demos the new features of ARKit 2 — <strong>shared world mapping</strong>, <strong>image tracking</strong>, and <strong>object detection</strong> (which has been available in the Vision framework recapped above, but is now also accessible in ARKit).</li>
<li>A good explanation on a core AR principle, <strong>Visual Inertial Odometry</strong>, is given. Short of going into the actual physics equations behind it, this should give you a great understanding of VIO.</li>
</ul>


<p><a id="markdown-some-other-materials-for-a-better-ar-app" name="some-other-materials-for-a-better-ar-app"></a></p>

<h2>Some other materials for a better AR app:</h2>

<p><a id="markdown-building-your-first-ar-experiencehttpsdeveloperapplecomdocumentationarkitbuilding_your_first_ar_experience" name="building-your-first-ar-experiencehttpsdeveloperapplecomdocumentationarkitbuilding_your_first_ar_experience"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/building_your_first_ar_experience">Building Your First AR Experience</a></h3>

<p>This document demos an app for basic usage of ARKit.</p>

<p><a id="markdown-managing-session-lifecycle-and-tracking-qualityhttpsdeveloperapplecomdocumentationarkitmanaging_session_lifecycle_and_tracking_quality" name="managing-session-lifecycle-and-tracking-qualityhttpsdeveloperapplecomdocumentationarkitmanaging_session_lifecycle_and_tracking_quality"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/managing_session_lifecycle_and_tracking_quality">Managing Session Lifecycle and Tracking Quality</a></h3>

<p>Make your AR experience more robust by</p>

<ul>
<li>providing clear feedback, using <code>ARCamera.TrackingState</code>.</li>
<li>recovering from interruptions, using <code>ARCamera.TrackingState.Reason.relocalizing</code>.</li>
<li>resuming previous sessions, using <code>ARWorldMap</code>.</li>
</ul>


<p><a id="markdown-human-interface-guidelines---augmented-realityhttpsdeveloperapplecomdesignhuman-interface-guidelinesiossystem-capabilitiesaugmented-reality" name="human-interface-guidelines---augmented-realityhttpsdeveloperapplecomdesignhuman-interface-guidelinesiossystem-capabilitiesaugmented-reality"></a></p>

<h3><a href="https://developer.apple.com/design/human-interface-guidelines/ios/system-capabilities/augmented-reality/">Human Interface Guidelines - Augmented Reality</a></h3>

<p>This post describes how to rendering virtual objects, how to interact with virtual objects, how to handling interruptions. It is for UX.</p>

<p><a id="markdown-handling-3d-interaction-and-ui-controls-in-augmented-realityhttpsdeveloperapplecomdocumentationarkithandling_3d_interaction_and_ui_controls_in_augmented_reality" name="handling-3d-interaction-and-ui-controls-in-augmented-realityhttpsdeveloperapplecomdocumentationarkithandling_3d_interaction_and_ui_controls_in_augmented_reality"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/handling_3d_interaction_and_ui_controls_in_augmented_reality">Handling 3D Interaction and UI Controls in Augmented Reality</a></h3>

<p>This document describes the best practices for visual feedback, gesture interactions, and realistic rendering in AR experiences. And a demo app is supplied.</p>

<p><img src="http://hongchaozhang.github.io/images/arkit_demo_screenshot.jpg" alt="arkit demo" /></p>

<p><a id="markdown-creating-a-multiuser-ar-experiencehttpsdeveloperapplecomdocumentationarkitcreating_a_multiuser_ar_experience" name="creating-a-multiuser-ar-experiencehttpsdeveloperapplecomdocumentationarkitcreating_a_multiuser_ar_experience"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/creating_a_multiuser_ar_experience">Creating a Multiuser AR Experience</a></h3>

<p>This document demos an app (with source code) on how to transmit ARKit world-mapping data between nearby devices with the <a href="https://developer.apple.com/documentation/multipeerconnectivity">MultipeerConnectivity</a> framework (introduced in iOS 7.0) to create a shared basis for AR experiences. MultipeerConnectivity supports peer-to-peer connectivity and the discovery of nearby devices. With MultipeerConnectivity, you can not only share <code>ARWorldMap</code>, but also some actions. This makes multiuser AR game possible.</p>

<p>However:</p>

<ul>
<li>Recording and transmitting a world map and relocalizing to a world map are time-consuming, bandwidth-intensive operations. A good design is needed for better performance.</li>
<li>The persons received the world map data need to move their device so they see a similar perspective (also sent by the host) helps ARKit process the received map and establish a shared frame of reference for the multiuser experience.</li>
</ul>


<p><a id="markdown-swiftshot-creating-a-game-for-augmented-realityhttpsdeveloperapplecomdocumentationarkitswiftshot_creating_a_game_for_augmented_reality" name="swiftshot-creating-a-game-for-augmented-realityhttpsdeveloperapplecomdocumentationarkitswiftshot_creating_a_game_for_augmented_reality"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/swiftshot_creating_a_game_for_augmented_reality">SwiftShot: Creating a Game for Augmented Reality</a></h3>

<p>This document demos the SwiftShot game shown on WWDC 2018, including:</p>

<ul>
<li>Designing Gameplay for AR</li>
<li>Using Local Multipeer Networking and Sharing World Maps</li>
<li>Synchronizing Gameplay Actions</li>
<li>Solving Multiplayer Physics</li>
</ul>


<p><a id="markdown-recognizing-images-in-an-ar-experiencehttpsdeveloperapplecomdocumentationarkitrecognizing_images_in_an_ar_experience" name="recognizing-images-in-an-ar-experiencehttpsdeveloperapplecomdocumentationarkitrecognizing_images_in_an_ar_experience"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/recognizing_images_in_an_ar_experience">Recognizing Images in an AR Experience</a></h3>

<p>Detect known 2D images in the user’s environment, and use their positions to place AR content.</p>

<p><a id="markdown-scanning-and-detecting-3d-objectshttpsdeveloperapplecomdocumentationarkitscanning_and_detecting_3d_objects" name="scanning-and-detecting-3d-objectshttpsdeveloperapplecomdocumentationarkitscanning_and_detecting_3d_objects"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/scanning_and_detecting_3d_objects">Scanning and Detecting 3D Objects</a></h3>

<p>Record spatial features of real-world objects, then use the results to find those objects in the user’s environment and trigger AR content.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CNN与图像识别]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/05/02/cnn-and-image-classification/"/>
    <updated>2018-05-02T18:55:44+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/05/02/cnn-and-image-classification</id>
    <content type="html"><![CDATA[<ol>
<li>卷积神经网络用于图像识别的现状。</li>
<li>卷积与图像处理基础知识。</li>
<li>卷积神经网络每一层的可视化，了解神经网络内部的物理意义。</li>
<li>图像卷积滤波器与神经元和权重的关系。</li>
</ol>


<!-- more -->


<p><br></p>

<!-- TOC -->


<ul>
<li><a href="#%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E8%83%8C%E6%99%AF">卷积神经网络与图像识别背景</a>

<ul>
<li><a href="#lenet%E6%A6%82%E8%BF%B0">LeNet概述</a></li>
<li><a href="#imagenet%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E6%8C%91%E6%88%98%E8%B5%9B">ImageNet大规模图像识别挑战赛</a></li>
</ul>
</li>
<li><a href="#%E5%8D%B7%E7%A7%AF%E4%B8%8E%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86">卷积与图像处理</a>

<ul>
<li><a href="#%E5%8D%B7%E7%A7%AF%E7%9A%84%E5%AE%9A%E4%B9%89">卷积的定义</a></li>
<li><a href="#%E5%9B%BE%E5%83%8F%E5%8D%B7%E7%A7%AF%E7%9A%84%E7%89%A9%E7%90%86%E6%84%8F%E4%B9%89">图像卷积的物理意义</a></li>
</ul>
</li>
<li><a href="#lenet%E8%AF%A6%E8%A7%A3">LeNet详解</a></li>
<li><a href="#%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB%E8%BF%87%E7%A8%8B%E5%8F%AF%E8%A7%86%E5%8C%96">手写数字识别过程可视化</a></li>
<li><a href="#%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E7%A5%9E%E7%BB%8F%E5%85%83%E5%92%8C%E6%9D%83%E9%87%8D%E5%9C%A8%E5%93%AA%E9%87%8C">神经网络中的“神经元”和“权重”在哪里？</a></li>
</ul>


<!-- /TOC -->


<p><a id="markdown-卷积神经网络与图像识别背景" name="卷积神经网络与图像识别背景"></a></p>

<h2>卷积神经网络与图像识别背景</h2>

<p><a id="markdown-lenet概述" name="lenet概述"></a></p>

<h3>LeNet概述</h3>

<p>LeNet是最早用于深度学习了领域的卷积神经网络之一。Yann LeCun的这一杰作得名于他自1988年以来的系列成功迭代。彼时LeNet架构还主要被用于识别邮政编码等任务。LeNet的基本架构如下：</p>

<p><img src="http://hongchaozhang.github.io/images/201805lenet.jpg" alt="lenet" /></p>

<p>近几年已经出现了很多建立在LeNet之上的新架构，但是基本概念还是来自于LeNet。</p>

<p>卷积神经网络始自1990年代起，我们已经认识了最早的LeNet，其他一些很有影响力的架构列举如下：</p>

<ul>
<li>1990s至2012：从90年代到2010年代早期，卷积神经网络都处于孵化阶段。随着数据量增大和计算能力提高，卷积神经网络能搞定的问题也越来越有意思了。</li>
<li>AlexNet(2012)：2012年，Alex Krizhevsky发布了AlexNet，是LeNet的更深、更宽版本，并且大比分赢得了当年的ImageNet大规模图像识别挑战赛(ILSVRC)。这是一次非常重要的大突破，现在普及的卷积神经网络应用都要感谢这一壮举。</li>
<li>ZF Net(2013)：2013年的ILSVRC赢家是Matthew Zeiler和Rob Fergus的卷积网络，被称作ZF Net，这是调整过架构超参数的AlexNet改进型。</li>
<li>GoogleNet(2014)：2014的ILSVRC胜者是来自Google的Szegedy et al.。其主要贡献是研发了Inception Module，它<strong>大幅减少了网络中的参数数量（四百万，相比AlexNet的六千万）</strong>。</li>
<li>VGGNet(2014)：当年的ILSVRC亚军是VGGNet，突出贡献是展示了网络的深度（层次数量）是良好表现的关键因素。</li>
<li>ResNet(2015)： Kaiming He研发的Residual Network是2015年的ILSVRC冠军，也代表了卷积神经网络的最高水平，同时还是实践的默认选择（2016年5月）。</li>
<li>DenseNet（2016年8月）： 由Gao Huang发表，Densely Connected Convolutional Network的每一层都直接与其他各层前向连接。DenseNet已经在五个高难度的物体识别基础集上，显式出非凡的进步。</li>
</ul>


<p><a id="markdown-imagenet大规模图像识别挑战赛" name="imagenet大规模图像识别挑战赛"></a></p>

<h3>ImageNet大规模图像识别挑战赛</h3>

<p>参考<a href="http://www.sohu.com/a/143751643_473283">一个时代的终结：ImageNet竞赛2017是最后一届，WebVision 竞赛或接</a>。</p>

<p>上面的变种卷积神经网络基本上都来自一项比赛（DenseNet除外）：<strong>ImageNet大规模图像识别挑战赛</strong>(ImageNet Large Scale Visual Recognition Competition，ILSVRC)。</p>

<p>ILSVRC是基于ImageNet图像库的一个图像识别比赛。ImageNet可以说是计算机视觉研究人员进行大规模物体识别和检测时，最先想到的视觉大数据来源。ImageNet 数据集最初由斯坦福大学李飞飞等人在CVPR 2009的一篇论文中推出，并被用于替代 PASCAL数据集（后者在数据规模和多样性上都不如 ImageNet）和LabelMe数据集（在标准化上不如ImageNet）。</p>

<p>ImageNet不但是计算机视觉发展的重要推动者，也是这一波深度学习热潮的关键驱动力之一。截至2016年，ImageNet中含有超过1500万由人手工注释的图片网址，也就是带标签的图片，标签说明了图片中的内容，超过2.2万个类别。</p>

<p>CVPR2017研讨会“超越ILSVRC”将宣布今年是 ImageNet 竞赛正式组织的最后一年，2016年ILSVRC 的图像识别错误率已经达到约2.9%，不仅远远超越人类（5.1%），今后再进行这类竞赛意义也不大了。这无疑标志着一个时代的结束，但也是新征程的开始：未来，计算机视觉的重点在图像理解，而作为ILSVRC替代者的候选人之一是苏黎世理工大学和谷歌等联合提出的 WebVision Challenge，也将于CVPR2017同期举办，内容侧重于学习和理解网络数据。</p>

<p>历届ILSVRC的作品，可以参考<a href="https://blog.csdn.net/kangroger/article/details/56522132">ILSVRC历届冠军论文笔记</a>，包含模型框架和识别率等。</p>

<p><a id="markdown-卷积与图像处理" name="卷积与图像处理"></a></p>

<h2>卷积与图像处理</h2>

<p><a id="markdown-卷积的定义" name="卷积的定义"></a></p>

<h3>卷积的定义</h3>

<p><img src="http://hongchaozhang.github.io/images/201805convolution_definition.gif" alt="convolution definition demo" /></p>

<p>参考<a href="https://en.wikipedia.org/wiki/Convolution">Convolution</a>。</p>

<p><a id="markdown-图像卷积的物理意义" name="图像卷积的物理意义"></a></p>

<h3>图像卷积的物理意义</h3>

<p>卷积矩阵也叫“滤波器”、“核”或“特征探测器”。</p>

<p><img src="http://hongchaozhang.github.io/images/201805kernel_convolution.jpg" alt="image convolution" /></p>

<p><img src="http://hongchaozhang.github.io/images/201805image_convolution.jpg" alt="image convolutioon" /></p>

<p>参考<a href="https://en.wikipedia.org/wiki/Kernel_(image_processing">Kernel (image processing)</a>)。
￼</p>

<p><a id="markdown-lenet详解" name="lenet详解"></a></p>

<h2>LeNet详解</h2>

<p>参考<a href="http://cv-tricks.com/tensorflow-tutorial/training-convolutional-neural-network-for-image-classification/">Basics of Convolutional Neural network (CNN)</a>。</p>

<ol>
<li>Convolutional Layer</li>
<li>Pooling Layer</li>
<li>Fully Connected Layer</li>
<li>Understanding Training Process</li>
</ol>


<p><a href="https://ujjwalkarn.me/2016/08/11/intuitive-explanation-convnets/">An Intuitive Explanation of Convolutional Neural Networks</a>的讲解也不错，中文版在<a href="https://blog.csdn.net/lcy7289786/article/details/68958111">这里</a>。</p>

<p><a id="markdown-手写数字识别过程可视化" name="手写数字识别过程可视化"></a></p>

<h2>手写数字识别过程可视化</h2>

<p><img src="http://hongchaozhang.github.io/images/201805cnn_visualization.jpg" alt="cnn visualization" /></p>

<p>官方网站：
<a href="http://scs.ryerson.ca/~aharley/vis/">http://scs.ryerson.ca/~aharley/vis/</a></p>

<p>3D可视化：
<a href="http://scs.ryerson.ca/~aharley/vis/conv/">http://scs.ryerson.ca/~aharley/vis/conv/</a></p>

<p>2D可视化：
<a href="http://scs.ryerson.ca/~aharley/vis/conv/flat.html">http://scs.ryerson.ca/~aharley/vis/conv/flat.html</a></p>

<p>相关论文：
<a href="http://scs.ryerson.ca/~aharley/vis/harley_vis_isvc15.pdf">http://scs.ryerson.ca/~aharley/vis/harley_vis_isvc15.pdf</a></p>

<p><a id="markdown-神经网络中的神经元和权重在哪里" name="神经网络中的神经元和权重在哪里"></a></p>

<h2>神经网络中的“神经元”和“权重”在哪里？</h2>

<p><img src="http://hongchaozhang.github.io/images/201805convolution_weights.jpg" alt="convolution and weights" /></p>

<p>各个卷机滤波器的里面的每个位置的值，即是我们需要训练的权重（卷积滤波器的尺寸是需要我们提前指定好的），每个像素对应于一个神经元。</p>

<p>其中神经网络的基本概念可以参考<a href="http://playground.tensorflow.org/">TensorFlow Playground</a>。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift Coding Conventions]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/01/26/swift-coding-convention/"/>
    <updated>2018-01-26T11:37:05+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/01/26/swift-coding-convention</id>
    <content type="html"><![CDATA[<p>Collection of some Swift coding conventions, which will make Swift code more maintainable, more readable.</p>

<!-- more -->


<p>The following is conventions I like or I will likely misuse. For a complete version, go to:</p>

<ol>
<li><a href="https://github.com/raywenderlich/swift-style-guide/">The Official raywenderlich.com Swift Style Guide.</a></li>
<li>Swift <a href="https://swift.org/documentation/api-design-guidelines/">API Design Guidelines</a></li>
</ol>


<!-- TOC -->


<ul>
<li><a href="#naming">Naming</a>

<ul>
<li><a href="#try-to-form-grammatical-english-phrases">Try to Form Grammatical English Phrases</a></li>
<li><a href="#mutatingnonmutating-methods-naming">Mutating/Nonmutating Methods Naming</a></li>
<li><a href="#boolean-methods-naming">Boolean Methods Naming</a></li>
<li><a href="#protocol-naming">Protocol Naming</a></li>
<li><a href="#avoid-abbreviations">Avoid Abbreviations</a></li>
<li><a href="#delegates">Delegates</a></li>
</ul>
</li>
<li><a href="#code-organization">Code Organization</a>

<ul>
<li><a href="#protocol-conformance">Protocol Conformance</a></li>
</ul>
</li>
<li><a href="#classes-and-structures">Classes and Structures</a>

<ul>
<li><a href="#use-of-self">Use of Self</a></li>
<li><a href="#constants">Constants</a></li>
</ul>
</li>
<li><a href="#control-flow">Control Flow</a>

<ul>
<li><a href="#golden-path">Golden Path</a>

<ul>
<li><a href="#failing-guards">Failing Guards</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#argument-labels">Argument Labels</a></li>
</ul>


<!-- /TOC -->


<p><a id="markdown-naming" name="naming"></a></p>

<h2>Naming</h2>

<p>Descriptive and consistent naming makes software easier to read and understand. Use the Swift naming conventions described in the <a href="https://swift.org/documentation/api-design-guidelines/">API Design Guidelines</a>. Some key principles include:</p>

<ol>
<li>prioritizing clarity over brevity</li>
<li>striving for fluent usage</li>
<li>using uppercase for types (and protocols), lowercase for everything else</li>
<li>boolean types should read like assertions</li>
<li>choosing good parameter names that serve as documentation</li>
<li>generally avoiding abbreviations</li>
<li>taking advantage of default parameters</li>
<li>labeling closure and tuple parameters</li>
<li>verb methods follow the -ed, -ing rule for the non-mutating version</li>
<li>noun methods follow the formX rule for the mutating version</li>
<li>protocols that describe what something is should read as nouns</li>
<li>protocols that describe a capability should end in -able or -ible</li>
<li>striving for clarity at the call site</li>
</ol>


<p><a id="markdown-try-to-form-grammatical-english-phrases" name="try-to-form-grammatical-english-phrases"></a></p>

<h3>Try to Form Grammatical English Phrases</h3>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nl">at</span><span class="p">:</span> <span class="n">z</span><span class="p">)</span>          <span class="c1">// “x, insert y at z”</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">subViews</span><span class="p">(</span><span class="nl">havingColor</span><span class="p">:</span> <span class="n">y</span><span class="p">)</span>  <span class="c1">// “x&#39;s subviews having color y”</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">capitalizingNouns</span><span class="p">()</span>       <span class="c1">// “x, capitalizing nouns”</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nl">position</span><span class="p">:</span> <span class="n">z</span><span class="p">)</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">subViews</span><span class="p">(</span><span class="nl">color</span><span class="p">:</span> <span class="n">y</span><span class="p">)</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">nounCapitalize</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-mutatingnonmutating-methods-naming" name="mutatingnonmutating-methods-naming"></a></p>

<h3>Mutating/Nonmutating Methods Naming</h3>

<p>When the operation is naturally described by a verb, use the verb’s imperative for the mutating method and apply the “ed” or “ing” suffix to name its nonmutating counterpart.</p>

<table>
<thead>
<tr>
<th> Mutating  </th>
<th> Nonmutating </th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>x.sort()</code>    </td>
<td> <code>z = x.sorted()</code> </td>
</tr>
<tr>
<td> <code>x.append(y)</code> </td>
<td> <code>z = x.appending(y)</code> </td>
</tr>
</tbody>
</table>


<p><br>
When the operation is naturally described by a noun, use the noun for the nonmutating method and apply the “form” prefix to name its mutating counterpart.</p>

<table>
<thead>
<tr>
<th> Nonmutating   </th>
<th> Mutating </th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>x = y.union(z)</code>  </td>
<td> <code>y.formUnion(z)</code> </td>
</tr>
<tr>
<td> <code>j = c.successor(i)</code>  </td>
<td> <code>c.formSuccessor(&amp;i)</code> </td>
</tr>
</tbody>
</table>


<p><a id="markdown-boolean-methods-naming" name="boolean-methods-naming"></a></p>

<h3>Boolean Methods Naming</h3>

<p>Uses of Boolean methods and properties should read as assertions about the receiver when the use is nonmutating, e.g. <code>x.isEmpty</code>, <code>line1.intersects(line2)</code>.</p>

<p><a id="markdown-protocol-naming" name="protocol-naming"></a></p>

<h3>Protocol Naming</h3>

<p>Protocols that describe what something is should read as nouns (e.g. <code>Collection</code>).</p>

<p>Protocols that describe a capability should be named using the suffixes -able, -ible, or -ing (e.g. <code>Equatable</code>, <code>ProgressReporting</code>).</p>

<p><a id="markdown-avoid-abbreviations" name="avoid-abbreviations"></a></p>

<h3>Avoid Abbreviations</h3>

<blockquote><p>The intended meaning for any abbreviation you use should be easily found by a <strong>web search</strong>.</p></blockquote>

<p><a id="markdown-delegates" name="delegates"></a></p>

<h3>Delegates</h3>

<p>When creating custom delegate methods, an unnamed first parameter should be the delegate source. (UIKit contains numerous examples of this.)</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">namePickerView</span><span class="p">(</span><span class="n">_</span> <span class="nl">namePickerView</span><span class="p">:</span> <span class="n">NamePickerView</span><span class="p">,</span> <span class="n">didSelectName</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
</span><span class='line'><span class="k">func</span> <span class="n">namePickerViewShouldReload</span><span class="p">(</span><span class="n">_</span> <span class="nl">namePickerView</span><span class="p">:</span> <span class="n">NamePickerView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">didSelectName</span><span class="p">(</span><span class="nl">namePicker</span><span class="p">:</span> <span class="n">NamePickerViewController</span><span class="p">,</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
</span><span class='line'><span class="k">func</span> <span class="n">namePickerShouldReload</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Bool</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-code-organization" name="code-organization"></a></p>

<h2>Code Organization</h2>

<p>Use extensions to organize your code into logical blocks of functionality. Each extension should be set off with a <code>// MARK: - comment</code> to keep things well-organized.</p>

<p><a id="markdown-protocol-conformance" name="protocol-conformance"></a></p>

<h3>Protocol Conformance</h3>

<p>In particular, when adding protocol conformance to a model, prefer adding a separate extension for the protocol methods. This keeps the related methods grouped together with the protocol and can simplify instructions to add a protocol to a class with its associated methods.</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">MyViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// class stuff here</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// MARK: - UITableViewDataSource</span>
</span><span class='line'><span class="k">extension</span> <span class="nl">MyViewController</span><span class="p">:</span> <span class="bp">UITableViewDataSource</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// table view data source methods</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// MARK: - UIScrollViewDelegate</span>
</span><span class='line'><span class="k">extension</span> <span class="nl">MyViewController</span><span class="p">:</span> <span class="bp">UIScrollViewDelegate</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// scroll view delegate methods</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">MyViewController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">,</span> <span class="bp">UITableViewDataSource</span><span class="p">,</span> <span class="bp">UIScrollViewDelegate</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// all methods</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For UIKit view controllers, consider grouping lifecycle, custom accessors, and IBAction in separate class extensions.</p>

<p><a id="markdown-classes-and-structures" name="classes-and-structures"></a></p>

<h2>Classes and Structures</h2>

<p><a id="markdown-use-of-self" name="use-of-self"></a></p>

<h3>Use of Self</h3>

<p>For conciseness, avoid using <code>self</code> since Swift does not require it to access an object&rsquo;s properties or invoke its methods.</p>

<p>Use <code>self</code> only when required by the compiler (in <code>@escaping</code> closures, or in initializers to disambiguate properties from arguments). In other words, if it compiles without <code>self</code> then omit it.</p>

<p><a id="markdown-constants" name="constants"></a></p>

<h3>Constants</h3>

<p>Constants are defined using the <code>let</code> keyword, and variables with the <code>var</code> keyword. Always use <code>let</code> instead of <code>var</code> if the value of the variable will not change.</p>

<blockquote><p>Tip: A good technique is to define everything using <code>let</code> and only change it to <code>var</code> if the compiler complains!</p></blockquote>

<p>You can define constants on a type rather than on an instance of that type using type properties. To declare a type property as a constant simply use <code>static let</code>. Type properties declared in this way are generally preferred over global constants because they are easier to distinguish from instance properties.</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">enum</span> <span class="n">Math</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">static</span> <span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">2.718281828459045235360287</span>
</span><span class='line'>  <span class="k">static</span> <span class="k">let</span> <span class="n">root2</span> <span class="o">=</span> <span class="mf">1.41421356237309504880168872</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">hypotenuse</span> <span class="o">=</span> <span class="n">side</span> <span class="o">*</span> <span class="n">Math</span><span class="p">.</span><span class="n">root2</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">2.718281828459045235360287</span>  <span class="c1">// pollutes global namespace</span>
</span><span class='line'><span class="k">let</span> <span class="n">root2</span> <span class="o">=</span> <span class="mf">1.41421356237309504880168872</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">hypotenuse</span> <span class="o">=</span> <span class="n">side</span> <span class="o">*</span> <span class="n">root2</span> <span class="c1">// what is root2?</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-control-flow" name="control-flow"></a></p>

<h2>Control Flow</h2>

<p><a id="markdown-golden-path" name="golden-path"></a></p>

<h3>Golden Path</h3>

<p>When coding with conditionals, the left-hand margin of the code should be the &ldquo;golden&rdquo; or &ldquo;happy&rdquo; path. That is, don&rsquo;t nest <code>if</code> statements. Multiple return statements are OK. The <code>guard</code> statement is built for this.</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">computeFFT</span><span class="p">(</span><span class="nl">context</span><span class="p">:</span> <span class="n">Context</span><span class="o">?</span><span class="p">,</span> <span class="nl">inputData</span><span class="p">:</span> <span class="n">InputData</span><span class="o">?</span><span class="p">)</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Frequencies</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">guard</span> <span class="k">let</span> <span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">throw</span> <span class="n">FFTError</span><span class="p">.</span><span class="n">noContext</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">guard</span> <span class="k">let</span> <span class="n">inputData</span> <span class="o">=</span> <span class="n">inputData</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">throw</span> <span class="n">FFTError</span><span class="p">.</span><span class="n">noInputData</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// use context and input to compute the frequencies</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">frequencies</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">computeFFT</span><span class="p">(</span><span class="nl">context</span><span class="p">:</span> <span class="n">Context</span><span class="o">?</span><span class="p">,</span> <span class="nl">inputData</span><span class="p">:</span> <span class="n">InputData</span><span class="o">?</span><span class="p">)</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Frequencies</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="k">let</span> <span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">inputData</span> <span class="o">=</span> <span class="n">inputData</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// use context and input to compute the frequencies</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="n">frequencies</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">throw</span> <span class="n">FFTError</span><span class="p">.</span><span class="n">noInputData</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">throw</span> <span class="n">FFTError</span><span class="p">.</span><span class="n">noContext</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When multiple optionals are unwrapped either with <code>guard</code> or <code>if let</code>, minimize nesting by using the compound version when possible. Example:</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">guard</span> <span class="k">let</span> <span class="n">number1</span> <span class="o">=</span> <span class="n">number1</span><span class="p">,</span>
</span><span class='line'>      <span class="k">let</span> <span class="n">number2</span> <span class="o">=</span> <span class="n">number2</span><span class="p">,</span>
</span><span class='line'>      <span class="k">let</span> <span class="n">number3</span> <span class="o">=</span> <span class="n">number3</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;impossible&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// do something with numbers</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">if</span> <span class="k">let</span> <span class="n">number1</span> <span class="o">=</span> <span class="n">number1</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="k">let</span> <span class="n">number2</span> <span class="o">=</span> <span class="n">number2</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">number3</span> <span class="o">=</span> <span class="n">number3</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// do something with numbers</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;impossible&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;impossible&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;impossible&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-failing-guards" name="failing-guards"></a></p>

<h4>Failing Guards</h4>

<p><code>guard</code> statements are required to exit in some way. Generally, this should be simple one line statement such as <code>return</code>, <code>throw</code>, <code>break</code>, <code>continue</code>, and <code>fatalError()</code>. Large code blocks should be avoided. If cleanup code is required for multiple exit points, consider using a <code>defer</code> block to avoid cleanup code duplication.</p>

<p><a id="markdown-argument-labels" name="argument-labels"></a></p>

<h2>Argument Labels</h2>

<ol>
<li>Good practice</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">move</span><span class="p">(</span><span class="n">from</span> <span class="nl">start</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">to</span> <span class="nl">end</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nl">to</span><span class="p">:</span> <span class="n">y</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><p>Omit all labels when arguments can’t be usefully distinguished, e.g. <code>min(number1, number2)</code>, <code>zip(sequence1, sequence2)</code>.</p></li>
<li><p>When the first argument forms part of a prepositional phrase, give it an argument label. The argument label should normally begin at the preposition, e.g. <code>x.removeBoxes(havingLength: 12)</code>.</p>

<ul>
<li>An exception for the principle above arises when the first two arguments represent parts of a single abstraction. In such cases, begin the argument label after the preposition, to keep the abstraction clear.</li>
</ul>
</li>
</ol>


<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">a</span><span class="p">.</span><span class="n">moveTo</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="n">c</span><span class="p">)</span>
</span><span class='line'><span class="n">a</span><span class="p">.</span><span class="n">fadeFrom</span><span class="p">(</span><span class="nl">red</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nl">green</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="nl">blue</span><span class="p">:</span> <span class="n">d</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">a</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="nl">toX</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="n">c</span><span class="p">)</span>
</span><span class='line'><span class="n">a</span><span class="p">.</span><span class="n">fade</span><span class="p">(</span><span class="nl">fromRed</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nl">green</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="nl">blue</span><span class="p">:</span> <span class="n">d</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DR Project]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/01/02/dr-project/"/>
    <updated>2018-01-02T13:39:28+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/01/02/dr-project</id>
    <content type="html"><![CDATA[<p>Key words: ARKit, CoreML, SceneKit</p>

<!-- more -->


<p><a href="https://github.com/hongchaozhang/ProjectDataToReality">DR (Data to Reality)</a> is a demo for projecting data into reality: Using <strong>CoreML</strong> for object recognition, and then get the recognized object data and project the data to reality, just above the recognized object. In this process, <strong>ARKit</strong> helps us to get the real world object coordinate to put the data at, and <strong>SceneKit</strong> helps us to render the data in reality.</p>

<p>This is a screenshot in demo:</p>

<p><img src="http://hongchaozhang.github.io/images/DR-Screenshot-1.jpg" alt="project chart to reality" /></p>

<p>Refer to github <a href="https://github.com/hongchaozhang/ProjectDataToReality">Project Data to Reality</a> for demo project. In the github page, the following are told:</p>

<ol>
<li>Requirement</li>
<li>How to Run the Project</li>
<li>How to Use the Demo

<ol>
<li>Project Chart to Reality</li>
<li>Face Detection</li>
<li>Face Recognition</li>
</ol>
</li>
</ol>


<h2>Related techniques used</h2>

<ol>
<li><a href="../../../../2017/12/28/arkit-usage/">ARKit</a></li>
<li><a href="../../../../2017/12/28/coreml-usage/">CoreML</a></li>
<li><a href="../../../../2018/01/02/scenekit-usage/">SceneKit</a></li>
</ol>


<h2>Notes on the Demo</h2>

<p>As this is a rough demo, it need some enhancements:</p>

<ol>
<li>Only four kinds of fruits are supported: banana, orange, cucumber and strawberry. But for anything recognized by Inceptionv3.mlmodel, we can add a sphere and the name just at the world position of the object. (Set <code>showRecognizedResultNearby</code> to <code>true</code>.)</li>
<li>The chart data of the four kinds of fruits are images exported from other apps.</li>
<li>For face detection on iphone, rotate the device to left by 90 degrees to make it work on landscape. This is an issue need to be fixed.</li>
<li>Face recognition needs a trained face recognition model, called FaceRecognition.mlmodel.</li>
<li>Face recognition request doesn&rsquo;t crop the image from camera according to the face detection result. This should be done to make face recognition more robust.</li>
</ol>

]]></content>
  </entry>
  
</feed>
