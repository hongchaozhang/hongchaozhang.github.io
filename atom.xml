<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Reading Space]]></title>
  <link href="http://hongchaozhang.github.io/atom.xml" rel="self"/>
  <link href="http://hongchaozhang.github.io/"/>
  <updated>2019-06-13T13:41:25+08:00</updated>
  <id>http://hongchaozhang.github.io/</id>
  <author>
    <name><![CDATA[Zhang Hongchao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Swift Closure]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/06/04/on-swift-closure/"/>
    <updated>2019-06-04T17:24:47+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/06/04/on-swift-closure</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#function%E4%B8%8Eclosure%E7%9A%84%E5%85%B3%E7%B3%BB">Functionä¸Closureçš„å…³ç³»ï¼š</a></li>
<li><a href="#%E7%94%A8closure%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F">ç”¨Closureåˆå§‹åŒ–ä¸€ä¸ªå˜é‡</a></li>
<li><a href="#closure%E7%9A%84%E8%AF%AD%E6%B3%95%E7%B3%96">Closureçš„è¯­æ³•ç³–ï¼š</a></li>
<li><a href="#closure%E4%B8%8E%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F">Closureä¸å†…å­˜ç®¡ç†ã€å†…å­˜æ³„æ¼</a>

<ul>
<li><a href="#capture-list%E7%9A%84%E5%AE%9A%E4%B9%89">Capture Listçš„å®šä¹‰</a></li>
<li><a href="#weak-and-unowned-references">Weak and Unowned References</a></li>
</ul>
</li>
<li><a href="#closure%E6%8D%95%E8%8E%B7%E5%8F%98%E9%87%8F">Closureæ•è·å˜é‡</a></li>
</ul>


<p><a href="https://medium.com/@abhimuralidharan/functional-swift-all-about-closures-310bc8af31dd">Functional swift: All about Closures</a></p>

<p>è¿™ç¯‡å…¨é¢è¯¦ç»†æ˜“æ‡‚åœ°ä»‹ç»äº†Swiftçš„Closureï¼ŒåŒ…æ‹¬</p>

<ul>
<li>Closureçš„è¯­æ³•ï¼ŒåŒ…æ‹¬ä¸€äº›ç®€åŒ–å†™æ³•ï¼Œå¦‚Trailing Closures</li>
<li>Closureä¸Functionçš„åŒºåˆ«</li>
<li>Closureä¸å†…å­˜ç®¡ç†ã€å†…å­˜æ³„æ¼ï¼Œå¦‚capture listçš„ä½¿ç”¨ï¼Œweakä¸unownedçš„åŒºåˆ«</li>
<li>Functionså’Œclosureséƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸æ˜¯å€¼ç±»å‹</li>
</ul>


<p>ä¹Ÿå¯ä»¥çœ‹<a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html">å®˜æ–¹æ–‡æ¡£Closures</a>ï¼Œä½†æ˜¯å®˜æ–¹æ–‡æ¡£æ²¡æœ‰ä¸Šé¢çš„æ–‡ç« è¯¦ç»†ã€‚</p>

<p>ä¸‹é¢æœ‰é€‰æ‹©åœ°è®°å½•ä¸€ä¸‹ã€‚</p>

<p><a id="markdown-functionä¸closureçš„å…³ç³»" name="functionä¸closureçš„å…³ç³»"></a></p>

<h2>Functionä¸Closureçš„å…³ç³»ï¼š</h2>

<p>å‚è€ƒ<a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html">å®˜æ–¹æ–‡æ¡£Closures</a>é‡Œé¢çš„ä¸‰å¥è¯ç†è§£ä¸€ä¸‹ï¼š</p>

<blockquote><ul>
<li>Global functions are closures that have a name and do not capture any values.</li>
<li>Nested functions are closures that have a name and can capture values from their enclosing function.</li>
<li>Closure expressions are unnamed closures written in a lightweight syntax that can capture values from their surrounding context.</li>
</ul>
</blockquote>

<p>è¿˜æœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼š<strong>Closures and functions are first class types in swift</strong>ã€‚</p>

<blockquote><p>Functions and closures are first-class citizens in Swift because you can treat then like a normal value. For example, you canï¼š</p>

<ul>
<li>assign a function/closure to a local variable .</li>
<li>pass a function/closure as an argument .</li>
<li>return a function/closure .</li>
</ul>
</blockquote>

<p><a id="markdown-ç”¨closureåˆå§‹åŒ–ä¸€ä¸ªå˜é‡" name="ç”¨closureåˆå§‹åŒ–ä¸€ä¸ªå˜é‡"></a></p>

<h2>ç”¨Closureåˆå§‹åŒ–ä¸€ä¸ªå˜é‡</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="nl">setupViewUsingClosure</span><span class="p">:</span> <span class="bp">UIView</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">view</span> <span class="o">=</span> <span class="bp">UIView</span><span class="p">()</span>
</span><span class='line'>    <span class="n">view</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">.</span><span class="n">green</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">view</span>
</span><span class='line'><span class="p">}()</span> <span class="c1">//IMPORTANT!!! I have added () at the end.</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-closureçš„è¯­æ³•ç³–" name="closureçš„è¯­æ³•ç³–"></a></p>

<h2>Closureçš„è¯­æ³•ç³–ï¼š</h2>

<p><a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html">å®˜æ–¹æ–‡æ¡£Closures</a>æœ‰ä¸ªæ€»çš„è¯´æ˜ï¼š</p>

<blockquote><p>Swiftâ€™s closure expressions have a clean, clear style, with optimizations that encourage brief, clutter-free syntax in common scenarios. These optimizations include:</p>

<ul>
<li>Inferring parameter and return value types from context</li>
<li>Implicit returns from single-expression closures</li>
<li>Shorthand argument names</li>
<li>Trailing closure syntax</li>
</ul>
</blockquote>

<p>å½“ä½ ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªå†™æ³•çš„æ—¶å€™è‚¯å®šå¾ˆç–‘æƒ‘ï¼šå‚æ•°ã€ç±»å‹ã€å‡½æ•°è°ƒç”¨æ—¶çš„æ‹¬å·éƒ½è·‘å“ªå»äº†ï¼Ÿ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">rreversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span> <span class="p">{</span> <span class="err">$</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="err">$</span><span class="mi">1</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç†è§£äº†ä¸Šé¢å‡ ç‚¹ï¼Œå°±å¯ä»¥æ˜ç™½ä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆå†™ï¼Œä¸‹é¢è®©æˆ‘ä»¬ä¸€æ­¥æ­¥çœ‹æ¸…æ¥šã€‚</p>

<p>Closureçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>

<blockquote><p>Closure expressions are unnamed closures written in a lightweight syntax that can capture values from their surrounding context.</p>

<pre><code class="swift">{ (params) -&gt; returnType in
    statements
}
</code></pre></blockquote>

<p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">reversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span><span class="p">(</span><span class="nl">by</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nl">s1</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="nl">s2</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="k">in</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">s1</span> <span class="o">&gt;</span> <span class="n">s2</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>å› ä¸ºï¼š</p>

<blockquote><ul>
<li><strong>Inferring parameter and return value types from context</strong></li>
</ul>


<p>Because the sorting closure is passed as an argument to a method, Swift can infer the types of its parameters and the type of the value it returns.</p></blockquote>

<p>æ‰€ä»¥ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥å†™ä¸ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">reversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span><span class="p">(</span><span class="nl">by</span><span class="p">:</span> <span class="p">{</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="k">in</span> <span class="k">return</span> <span class="n">s1</span> <span class="o">&gt;</span> <span class="n">s2</span> <span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>å†å› ä¸ºï¼š</p>

<blockquote><ul>
<li><strong>Implicit returns from single-expression closures</strong></li>
</ul>


<p>Single-expression closures can implicitly return the result of their single expression by omitting the return keyword from their declaration.</p></blockquote>

<p>æ‰€ä»¥ï¼Œä»£ç ç»§ç»­æ”¹ä¸ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">reversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span><span class="p">(</span><span class="nl">by</span><span class="p">:</span> <span class="p">{</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="k">in</span> <span class="n">s1</span> <span class="o">&gt;</span> <span class="n">s2</span> <span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>å†å› ä¸ºï¼š</p>

<blockquote><ul>
<li><strong>Shorthand argument names</strong></li>
</ul>


<p>Swift automatically provides shorthand argument names to inline closures, which can be used to refer to the values of the closureâ€™s arguments by the names $0, $1, $2, and so on.</p></blockquote>

<p>ä»£ç ç»§ç»­æ”¹ä¸ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">rreversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span><span class="p">(</span><span class="nl">by</span><span class="p">:</span> <span class="p">{</span> <span class="err">$</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="err">$</span><span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>å†å› ä¸ºï¼š</p>

<blockquote><ul>
<li><strong>Trailing closure syntax</strong></li>
</ul>


<p>If you need to pass a closure expression to a function as the functionâ€™s final argument and the closure expression is long, it can be useful to write it as a trailing closure instead. A trailing closure is written after the function callâ€™s parentheses, even though it is still an argument to the function. When you use the trailing closure syntax, you donâ€™t write the argument label for the closure as part of the function call.</p></blockquote>

<p>ä»£ç å°±å¯ä»¥å†™æˆï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="s">&quot;Alex&quot;</span><span class="p">,</span> <span class="s">&quot;Ewa&quot;</span><span class="p">,</span> <span class="s">&quot;Barry&quot;</span><span class="p">,</span> <span class="s">&quot;Daniella&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">rreversedNames</span> <span class="o">=</span> <span class="n">names</span><span class="p">.</span><span class="n">sorted</span> <span class="p">{</span> <span class="err">$</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="err">$</span><span class="mi">1</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-closureä¸å†…å­˜ç®¡ç†å†…å­˜æ³„æ¼" name="closureä¸å†…å­˜ç®¡ç†å†…å­˜æ³„æ¼"></a></p>

<h2>Closureä¸å†…å­˜ç®¡ç†ã€å†…å­˜æ³„æ¼</h2>

<p>Closureå¸¦æ¥çš„å¾ªç¯å¼•ç”¨å’Œå†…å­˜æ³„æ¼ï¼Œä¸»è¦é€šè¿‡Capture Listæ¥è§£å†³ï¼š</p>

<blockquote><p>You resolve a strong reference cycle between a closure and a class instance by defining a capture list as part of the closureâ€™s definition. A capture list defines the rules to use when capturing one or more reference types within the closureâ€™s body.</p></blockquote>

<p>è¯¦ç»†å†…å®¹å‚è€ƒ<a href="https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html#ID56">Resolving Strong Reference Cycles for Closures</a>ã€‚ä¸‹é¢æ‘˜è¦ä¸€ä¸‹ã€‚</p>

<p><a id="markdown-capture-listçš„å®šä¹‰" name="capture-listçš„å®šä¹‰"></a></p>

<h3>Capture Listçš„å®šä¹‰</h3>

<blockquote><p>Each item in a capture list is a pairing of the weak or unowned keyword with a reference to a class instance (such as self) or a variable initialized with some value (such as delegate = self.delegate!). These pairings are written within a pair of square braces, separated by commas.</p></blockquote>

<p>Place the capture list before a closureâ€™s parameter list and return type if they are provided:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">lazy</span> <span class="k">var</span> <span class="nl">someClosure</span><span class="p">:</span> <span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="kr">unowned</span> <span class="nb">self</span><span class="p">,</span> <span class="k">weak</span> <span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">delegate</span><span class="o">!</span><span class="p">]</span> <span class="p">(</span><span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="nl">stringToProcess</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="k">in</span>
</span><span class='line'>    <span class="c1">// closure body goes here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-weak-and-unowned-references" name="weak-and-unowned-references"></a></p>

<h3>Weak and Unowned References</h3>

<blockquote><p>Define a capture in a closure as an unowned reference when the closure and the instance it captures will always refer to each other, and will always be deallocated at the same time.</p>

<p>Conversely, define a capture as a weak reference when the captured reference may become nil at some point in the future. Weak references are always of an optional type, and automatically become nil when the instance they reference is deallocated. This enables you to check for their existence within the closureâ€™s body.</p>

<p>NOTE: If the captured reference will never become nil, it should always be captured as an unowned reference, rather than a weak reference.</p></blockquote>

<p>å…³äºunownedçš„å¦ä¸€ä¸ªè§£é‡Šæ›´æ¸…æ¥šï¼š</p>

<blockquote><p>Like a weak reference, an unowned reference does not keep a strong hold on the instance it refers to. Unlike a weak reference, however, an unowned reference is used when the other instance has the same lifetime or a longer lifetime.</p></blockquote>

<p><a id="markdown-closureæ•è·å˜é‡" name="closureæ•è·å˜é‡"></a></p>

<h2>Closureæ•è·å˜é‡</h2>

<blockquote><p>Closures can capture and store references to any constants and variables from the context in which they are defined. This is known as closing over those constants and variables.</p></blockquote>

<p>æ¯”å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// capturing values</span>
</span><span class='line'><span class="k">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">var</span> <span class="n">closureArray</span> <span class="o">=</span> <span class="p">[()</span><span class="o">-&gt;</span><span class="p">()]()</span>
</span><span class='line'><span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mf">1.</span><span class="p">.</span><span class="mf">.5</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">closureArray</span><span class="p">.</span><span class="n">append</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// here i will be 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span><span class='line'><span class="n">closureArray</span><span class="p">[</span><span class="mi">4</span><span class="p">]()</span> <span class="c1">// prints 5</span>
</span></code></pre></td></tr></table></div></figure>


<p>The closure captures the current address of <code>i</code> and every time we access <code>i</code> , it . returns the current value.</p>

<p>If we want to prevent this behavior (capturing values) and print the value of i even if the properties change after their capturing inside the closure, we can explicitly capture the variable with a capture list like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">var</span> <span class="n">closureArray2</span> <span class="o">=</span> <span class="p">[()</span><span class="o">-&gt;</span><span class="p">()]()</span>
</span><span class='line'><span class="k">var</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mf">1.</span><span class="p">.</span><span class="mf">.5</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">closureArray2</span><span class="p">.</span><span class="n">append</span> <span class="p">{</span> <span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">in</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// here i will be 5</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">0</span><span class="p">]()</span> <span class="c1">// prints 0</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="c1">// prints 1</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">2</span><span class="p">]()</span> <span class="c1">// prints 2</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">3</span><span class="p">]()</span> <span class="c1">// prints 3</span>
</span><span class='line'><span class="n">closureArray2</span><span class="p">[</span><span class="mi">4</span><span class="p">]()</span> <span class="c1">// prints 4</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this way, we keep an immutable copy of the variable <code>j</code>. Thanks to this copy, further changes to <code>j</code>, outside the closure, will not affect the closure. <code>j</code> is a let constant here. It is not mutable.</p>

<p>We can add multiple values to the capture list :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">closure</span><span class="p">.</span><span class="n">append</span> <span class="p">{</span> <span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="k">in</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;\(j) \(k) \(l)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>also, you can have alias names for the values captured.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">closure</span><span class="p">.</span><span class="n">append</span> <span class="p">{</span> <span class="p">[</span><span class="n">a</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">]</span> <span class="k">in</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;\(a) \(b) \(c)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sequece and Collection in Swift]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/06/03/sequece-and-collection-in-swift/"/>
    <updated>2019-06-03T16:22:33+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/06/03/sequece-and-collection-in-swift</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#array-out-of-range-crash"><code>Array</code> out of Range Crash</a></li>
<li><a href="#homemade-collection">Homemade collection</a></li>
<li><a href="#sequences">Sequences</a>

<ul>
<li><a href="#how-to-conform-to-sequence-protocol">How to Conform to <code>Sequence</code> Protocol</a></li>
<li><a href="#make-our-section-conform-to-sequence-protocol">Make our <code>Section</code> Conform to <code>Sequence</code> Protocol</a></li>
<li><a href="#gifts">Gifts</a></li>
</ul>
</li>
<li><a href="#collections">Collections</a>

<ul>
<li><a href="#how-to-conform-to-collection-protocol">How to Conform to <code>Collection</code> Protocol</a></li>
<li><a href="#make-our-section-conform-to-collection-protocol">Make our <code>Section</code> Conform to <code>Collection</code> Protocol</a></li>
</ul>
</li>
<li><a href="#difference-between-array-and-collection">Difference between <code>Array</code> and <code>Collection</code></a></li>
<li><a href="#reference">Reference</a></li>
</ul>


<p>The content comes from the following posts:</p>

<ol>
<li><a href="https://medium.com/swift-programming/swift-sequences-ce22d76f120c">Swift Sequences</a></li>
<li><a href="https://medium.com/swift-programming/swift-collections-e5fff3cd6759">Swift Collections</a></li>
</ol>


<p>But some of the code inside is old and can&rsquo;t be compiled with swift 5.0. So rewritten the code using swift 5.0.</p>

<p><a id="markdown-array-out-of-range-crash" name="array-out-of-range-crash"></a></p>

<h2><code>Array</code> out of Range Crash</h2>

<p>Before diving into Swift Sequences, letâ€™s see a strange behavior.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class='line'><span class="n">array</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="err">ğŸ˜­</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">dic</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'><span class="n">dic</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="err">ğŸ˜</span>
</span><span class='line'>
</span><span class='line'><span class="err">ğŸ¤”</span>
</span></code></pre></td></tr></table></div></figure>


<p>In other words, when requesting an element that doesnâ€™t exist, why arrays crash whereas dictionaries donâ€™t?</p>

<p>Arrays and dictionaries are two base collections provided by the Swift standard library. We can access those collections elements through the [] notation, also known as subscript. Letâ€™s see how those subscripts are defined.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">Dictionary</span><span class="o">&lt;</span><span class="nl">Key</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">Value</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="nl">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Value</span><span class="o">?</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Whatâ€™s interesting is that arrays have a non optional return type. Subscript canâ€™t throw errors so there are no alternatives other than a fatalError if we request an index that doesnâ€™t exist.</p>

<p>For dictionaries, on the other hand, an optional Value is returned, which allows to gracefully return nil if the index doesnâ€™t exist.</p>

<p>We can adopt dictionaries safer approach by overloading the arrays subscriptâ€Šâ€”â€Šwe canâ€™t override them. Adding an external name to the parameter is enough.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">extension</span> <span class="n">Array</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="n">safe</span> <span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">count</span> <span class="o">?</span> <span class="nb">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">:</span> <span class="nb">nil</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We saw how we can create a new accessor to the elements of an array, but can we do the same with a homemade collection?</p>

<p><a id="markdown-homemade-collection" name="homemade-collection"></a></p>

<h2>Homemade collection</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">title</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">elements</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Internally, this â€˜collectionâ€™ is based on an array. This is an implementation detail for the simplicity of the example. We could have used a linked list as in this <a href="http://austinzheng.com/2015/01/24/swift-seq/">excellent article</a> by <a href="https://twitter.com/austinzheng">Austin Zheng</a>.</p>

<p>Creating a subscript on our collection is very easy, we can even reuse the arrayâ€™s extension we made earlier.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">title</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">elements</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="n">safe</span> <span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">index</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>An example in practice :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">cars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;911&quot;</span><span class="p">,</span> <span class="s">&quot;Cayman&quot;</span><span class="p">,</span> <span class="s">&quot;Cayenne&quot;</span><span class="p">]</span>
</span><span class='line'><span class="k">let</span> <span class="n">section</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="nl">title</span><span class="p">:</span> <span class="s">&quot;Porsche&quot;</span><span class="p">,</span> <span class="nl">elements</span><span class="p">:</span> <span class="n">cars</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">section</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'><span class="c1">// Optional(&quot;Cayman&quot;)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Great! But does that make our type a collection, as Swift defines it?</p>

<p><a id="markdown-sequences" name="sequences"></a></p>

<h2>Sequences</h2>

<p>When it comes to manipulating sets, the most abstract notion given by the standard library is the Sequence, defined as</p>

<blockquote><p>A type that can be iterated with a <code>forâ€¦in</code> loop.</p></blockquote>

<p><a id="markdown-how-to-conform-to-sequence-protocol" name="how-to-conform-to-sequence-protocol"></a></p>

<h3>How to Conform to <code>Sequence</code> Protocol</h3>

<p>This section is from <a href="https://developer.apple.com/documentation/swift/sequence">Sequece official site</a>.</p>

<p>Making your own custom types conform to Sequence enables many useful operations, like for-in looping and the contains method, without much effort. To add Sequence conformance to your own custom type, add a makeIterator() method that returns an iterator.</p>

<p>Alternatively, if your type can act as its own iterator, implementing the requirements of the IteratorProtocol protocol and declaring conformance to both Sequence and IteratorProtocol are sufficient.</p>

<p>Hereâ€™s a definition of a Countdown sequence that serves as its own iterator. The makeIterator() method is provided as a default implementation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="nl">Countdown</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">IteratorProtocol</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">count</span><span class="p">:</span> <span class="n">Int</span>
</span><span class='line'>
</span><span class='line'>    <span class="kr">mutating</span> <span class="k">func</span> <span class="n">next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Int</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">defer</span> <span class="p">{</span> <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span> <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">count</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">threeToGo</span> <span class="o">=</span> <span class="n">Countdown</span><span class="p">(</span><span class="nl">count</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">threeToGo</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// Prints &quot;3&quot;</span>
</span><span class='line'><span class="c1">// Prints &quot;2&quot;</span>
</span><span class='line'><span class="c1">// Prints &quot;1&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-make-our-section-conform-to-sequence-protocol" name="make-our-section-conform-to-sequence-protocol"></a></p>

<h3>Make our <code>Section</code> Conform to <code>Sequence</code> Protocol</h3>

<p>The <code>Section</code> struct can&rsquo;t act as its own iterator, we need to define an iterator for it, and then return an instance of the defined iterator inside <code>func makeIterator() -&gt; Section&lt;T&gt;.Iterator</code> method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;:</span> <span class="n">Sequence</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">title</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">elements</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="n">safe</span> <span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">index</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">struct</span> <span class="nl">Iterator</span><span class="p">:</span> <span class="n">IteratorProtocol</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="nl">array</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>        <span class="k">var</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">init</span> <span class="p">(</span><span class="n">_</span> <span class="nl">array</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="nb">self</span><span class="p">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kr">mutating</span> <span class="k">func</span> <span class="n">next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">tempIndex</span> <span class="o">=</span> <span class="n">currentIndex</span>
</span><span class='line'>            <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">tempIndex</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">makeIterator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Iterator</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Iterator</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-gifts" name="gifts"></a></p>

<h3>Gifts</h3>

<p>Is that all? No! By conforming to SequenceType we also get methods for free, here is some of them.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">min</span><span class="p">()</span>
</span><span class='line'><span class="c1">// 911</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">max</span><span class="p">()</span>
</span><span class='line'><span class="c1">// Cayman</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">sorted</span><span class="p">()</span>
</span><span class='line'><span class="c1">// [&quot;911&quot;, &quot;Cayenne&quot;, &quot;Cayman&quot;]</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;911&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">// true</span>
</span></code></pre></td></tr></table></div></figure>


<p>We get the min, max &amp; sort methods because the elements of our sequence, String in our case, are Comparable. Contains is available thanks to our elements being Equatable.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span> <span class="err">$</span><span class="mf">0.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">}</span>
</span><span class='line'><span class="c1">// [&quot;Cayman&quot;, &quot;Cayenne&quot;]</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="err">$</span><span class="mf">0.</span><span class="n">count</span> <span class="p">}</span>
</span><span class='line'><span class="c1">// [3, 6, 7]</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">reduce</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="err">$</span><span class="mi">0</span> <span class="o">+</span> <span class="err">$</span><span class="mf">1.</span><span class="n">count</span> <span class="p">}</span>
</span><span class='line'><span class="c1">// 16</span>
</span></code></pre></td></tr></table></div></figure>


<p>And for functional programming fans, filter, map and reduce are also given.</p>

<p><a id="markdown-collections" name="collections"></a></p>

<h2>Collections</h2>

<p>Sequence is the most basic set notion given by the Swift standard library. There is a more evolved one.</p>

<p>A collection is defined as follow :</p>

<blockquote><p>A multi-pass <em>sequence</em> with addressable positions</p></blockquote>

<p>As we saw previously, a sequence is a type that can be iterated with a <code>forâ€¦in</code> loop. It doesnâ€™t need that the elements might be iterated over several times. And it doesnâ€™t need that we give a way to access directly an element.</p>

<p>Collections require those last two points. As a side effect, it no longer allows us to have an infinite number of elements.</p>

<p>To be a collection, a type must conform to the <code>Collection</code> protocol.</p>

<p><a id="markdown-how-to-conform-to-collection-protocol" name="how-to-conform-to-collection-protocol"></a></p>

<h3>How to Conform to <code>Collection</code> Protocol</h3>

<p>This section comes from <a href="https://developer.apple.com/documentation/swift/collection">Collection official site</a>.</p>

<p>If you create a custom sequence that can provide repeated access to its elements, make sure that its type conforms to the Collection protocol in order to give a more useful and more efficient interface for sequence and collection operations. To add Collection conformance to your type, you must declare at least the following requirements:</p>

<ol>
<li>The <code>startIndex</code> and <code>endIndex</code> properties</li>
<li>A subscript that provides at least read-only access to your typeâ€™s elements</li>
<li>The <code>index(after:)</code> method for advancing an index into your collection</li>
<li>Conform to <code>Sequece</code> Protocol, as <code>Collection</code> is inherited from <code>Sequence</code></li>
</ol>


<p><a id="markdown-make-our-section-conform-to-collection-protocol" name="make-our-section-conform-to-collection-protocol"></a></p>

<h3>Make our <code>Section</code> Conform to <code>Collection</code> Protocol</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;:</span> <span class="n">Collection</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">title</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">elements</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// begin: required for Collection</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">startIndex</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">endIndex</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">elements</span><span class="p">.</span><span class="n">count</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">index</span><span class="p">(</span><span class="n">after</span> <span class="nl">i</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// end: required for Collection</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">subscript</span><span class="p">(</span><span class="n">safe</span> <span class="nl">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">index</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// begin: required for Sequence</span>
</span><span class='line'>    <span class="k">struct</span> <span class="nl">Iterator</span><span class="p">:</span> <span class="n">IteratorProtocol</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="nl">array</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
</span><span class='line'>        <span class="k">var</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">init</span> <span class="p">(</span><span class="n">_</span> <span class="nl">array</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="nb">self</span><span class="p">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kr">mutating</span> <span class="k">func</span> <span class="n">next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">tempIndex</span> <span class="o">=</span> <span class="n">currentIndex</span>
</span><span class='line'>            <span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="nl">safe</span><span class="p">:</span> <span class="n">tempIndex</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">makeIterator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Section</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Iterator</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Iterator</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// end: required for Sequence</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>endIndex</code> has to be after the last element. It allows to define an empty collection with <code>startIndex</code> = <code>endIndex</code>.</p>

<p>Like conforming to <code>Sequence</code>, we get some methods / properties for free:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">count</span>
</span><span class='line'><span class="c1">// 3</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">first</span>
</span><span class='line'><span class="c1">// 911</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">isEmpty</span>
</span><span class='line'><span class="c1">// false</span>
</span><span class='line'><span class="n">section</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nl">of</span><span class="p">:</span> <span class="s">&quot;911&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">// 0</span>
</span></code></pre></td></tr></table></div></figure>


<p>We get indexOf thanks to our Elements being Equatable.</p>

<p><a id="markdown-difference-between-array-and-collection" name="difference-between-array-and-collection"></a></p>

<h2>Difference between <code>Array</code> and <code>Collection</code></h2>

<p>We created our own collection, which is great, but what about that difference of behavior between Arrays and Dictionaries we talked about at the beginning of the post? We saw that Arrayâ€™s dangerous subscript was coming from the Indexable protocol, but what about Dictionaries?</p>

<p>Dictionaries, like Arrays, are a collection, as Swift defines it. They both conform to CollectionType. So Dictionaries are also required to provide an â€˜unsafeâ€™ subscript that takes an Index and returns a non optional Element. The one weâ€™re used to is just a convenience subscript.</p>

<p>A simple example shows that it is also really easy to get a crash with Dictionaries.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">dic</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="o">:</span> <span class="s">&quot;bmw&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="o">:</span> <span class="s">&quot;audi&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="o">:</span> <span class="s">&quot;citroen&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">var</span> <span class="n">index</span> <span class="o">=</span> <span class="n">dic</span><span class="p">.</span><span class="n">startIndex</span>
</span><span class='line'><span class="n">dic</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span class='line'><span class="c1">// (key: &quot;c&quot;, value: &quot;citroen&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="n">index</span> <span class="o">=</span> <span class="n">dic</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nl">after</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
</span><span class='line'><span class="n">print</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span class='line'><span class="c1">// (key: &quot;b&quot;, value: &quot;audi&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="n">index</span> <span class="o">=</span> <span class="n">dic</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nl">after</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
</span><span class='line'><span class="n">index</span> <span class="o">=</span> <span class="n">dic</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nl">after</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
</span><span class='line'><span class="n">dic</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span class='line'><span class="c1">// Fatal error</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>The last question that remains is why <code>Collection</code> requires a subscript that may crash? Simply for performance reason, it costs too much to check the validity of the given index. Crashing is faster :)</strong></p>

<p><a id="markdown-reference" name="reference"></a></p>

<h2>Reference</h2>

<ol>
<li><a href="https://medium.com/swift-programming/swift-sequences-ce22d76f120c">Swift Sequences</a></li>
<li><a href="https://medium.com/swift-programming/swift-collections-e5fff3cd6759">Swift Collections</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è‡ªç„¶è¯­è¨€ç†è§£ï¼ˆNLUï¼‰ç»¼è¿°]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/05/29/overview-of-nlp-and-nlu/"/>
    <updated>2019-05-29T17:27:58+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/05/29/overview-of-nlp-and-nlu</id>
    <content type="html"><![CDATA[<!-- more -->


<p>è¿™ç¯‡æ€»ç»“æœ‰ç‚¹ä¹±ï¼Œæƒå½“ç•™ä½œè‡ªå·±çœ‹ã€‚</p>

<ul>
<li><a href="#%E4%BA%BA%E6%9C%BA%E5%AF%B9%E8%AF%9D%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%9E%8B">äººæœºå¯¹è¯çš„ä¸¤ç§æ¨¡å‹</a></li>
<li><a href="#nlu%E4%B8%8Enlp">NLUä¸NLP</a>

<ul>
<li><a href="#stanford-corenlp">Stanford CoreNLP</a></li>
<li><a href="#ios-naturallanguage-framework">iOS <em>NaturalLanguage</em> framework</a>

<ul>
<li><a href="#custom-machine-learning-models">Custom Machine Learning Models</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E7%90%86%E8%A7%A3%E5%B9%B3%E5%8F%B0">è‡ªç„¶è¯­è¨€ç†è§£å¹³å°</a></li>
<li><a href="#google%E7%9A%84dialogflow">Googleçš„Dialogflow</a>

<ul>
<li><a href="#dialogflow%E7%9A%84%E5%8E%86%E5%8F%B2">Dialogflowçš„å†å²</a></li>
<li><a href="#dialogflow%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5">Dialogflowçš„ä¸€äº›æ¦‚å¿µ</a></li>
<li><a href="#%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0intents%E4%B9%8B%E9%97%B4%E7%9A%84entities%E5%85%B1%E4%BA%AB">ä¸¤ç§æ–¹æ³•å®ç°intentsä¹‹é—´çš„entitieså…±äº«</a></li>
<li><a href="#training-tab-in-dialogflow-platform">â€œTrainingâ€ tab in Dialogflow platform</a></li>
<li><a href="#integrations-analytics-and-fulfillment">â€œIntegrationsâ€, â€œAnalyticsâ€ and â€œFulfillmentâ€</a></li>
<li><a href="#prebuild-agent-and-small-talk">â€œPrebuild Agentâ€ and â€œSmall Talkâ€</a></li>
<li><a href="#%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8dialogflow%E7%9A%84%E4%BE%8B%E5%AD%90">ä¸€äº›ä½¿ç”¨Dialogflowçš„ä¾‹å­</a></li>
</ul>
</li>
<li><a href="#alexa-and-lex">Alexa and Lex</a></li>
<li><a href="#microsoft-luis-text-analytics-api">Microsoft LUIS Text Analytics API</a></li>
<li><a href="#facebook%E7%9A%84witai">Facebookçš„wit.ai</a></li>
<li><a href="#snips">Snips</a>

<ul>
<li><a href="#duckling">Duckling</a></li>
</ul>
</li>
<li><a href="#ibm%E7%9A%84watson">IBMçš„Watson</a></li>
<li><a href="#swiftnlc">SwiftNLC</a>

<ul>
<li><a href="#xunfei-command-recognition">Xunfei Command Recognition</a></li>
</ul>
</li>
<li><a href="#siri-and-sirikit">Siri and SiriKit</a>

<ul>
<li><a href="#sirikit-build-in-domain">SiriKit build-in domain</a></li>
<li><a href="#sirikit-custom-intent">SiriKit custom intent</a></li>
</ul>
</li>
</ul>


<p><a id="markdown-äººæœºå¯¹è¯çš„ä¸¤ç§æ¨¡å‹" name="äººæœºå¯¹è¯çš„ä¸¤ç§æ¨¡å‹"></a></p>

<h2>äººæœºå¯¹è¯çš„ä¸¤ç§æ¨¡å‹</h2>

<p>è‡ªç„¶è¯­è¨€ç†è§£ï¼ˆNLUï¼‰çš„æœ€ç»ˆç›®çš„æ˜¯è®©è®¡ç®—æœºèƒ½å¤Ÿç†è§£äººç±»çš„è¯­è¨€ï¼Œå®ç°äººæœºå¯¹è¯ã€‚ç›®å‰ï¼Œäººæœºå¯¹è¯æ¨¡å‹åŸºæœ¬ä¸Šæœ‰ä¸¤ç§ï¼š</p>

<ol>
<li>åŸºäºæ„å›¾(Intent-based)çš„å¯¹è¯ï¼šè¿™æ˜¯å½“NLPç®—æ³•ä½¿ç”¨intentså’Œentitiesè¿›è¡Œå¯¹è¯æ—¶ï¼Œé€šè¿‡è¯†åˆ«ç”¨æˆ·å£°æ˜ä¸­çš„åè¯å’ŒåŠ¨è¯ï¼Œç„¶åä¸å®ƒçš„dictionaryäº¤å‰å¼•ç”¨ï¼Œè®©botå¯ä»¥æ‰§è¡Œæœ‰æ•ˆçš„æ“ä½œã€‚ç›®å‰ï¼Œå¤§éƒ¨åˆ†å¹³å°éƒ½æ˜¯åŸºäºè¿™ç§æ¨¡å¼è¿›è¡Œè®­ç»ƒçš„ï¼ŒåŒ…æ‹¬è°·æ­Œçš„Dialogflowã€‚</li>
<li>åŸºäºæµç¨‹(Flow-based)çš„å¯¹è¯ï¼šåŸºäºæµç¨‹çš„å¯¹è¯æ˜¯æ™ºèƒ½é€šä¿¡çš„ä¸‹ä¸€ä¸ªçº§åˆ«ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šç»™äºˆä¸¤ä¸ªäººä¹‹é—´å¯¹è¯çš„è®¸å¤šä¸åŒæ ·æœ¬çš„RNNï¼ˆå¾ªç¯ç¥ç»ç½‘ç»œï¼‰ï¼Œåˆ›å»ºçš„æœºå™¨äººå°†æ ¹æ®ä½ è®­ç»ƒçš„MLæ¨¡å‹è¿›è¡Œå“åº”ã€‚ wit.aiæ˜¯åœ¨è¿™ä¸ªé¢†åŸŸå–å¾—å·¨å¤§è¿›å±•çš„å°‘æ•°ç½‘ç«™ä¹‹ä¸€ã€‚ä½†è¿™ä¸ªå¤ªè¶…å‰ï¼Œä¸æ˜¯æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨çš„å¯¹è±¡ï¼Œæ¥ä¸‹æ¥ä¹Ÿä¸ä¼šè®¨è®ºã€‚</li>
</ol>


<p>è¯¦ç»†è®¨è®ºå‚è€ƒï¼š<a href="https://chatbotsmagazine.com/bot-talks-intent-based-vs-flow-base-conversations-798788dc9cf6">Bot Talks: Intent-Based vs. Flow-Base Conversations</a>ã€‚</p>

<p><a id="markdown-nluä¸nlp" name="nluä¸nlp"></a></p>

<h2>NLUä¸NLP</h2>

<p>NLPï¼ˆNatural Language Processingï¼‰æ˜¯NLUï¼ˆNatural Language Understandingï¼‰çš„ä¸€ä¸ªå‰æœŸæ­¥éª¤ï¼šNLPç”¨äºå¯¹æ–‡æœ¬æˆ–è€…è¯­éŸ³è¿›è¡Œæœºå™¨å­¦ä¹ è®­ç»ƒå’Œè¯†åˆ«æ—¶çš„ç‰¹å¾æå–é˜¶æ®µã€‚</p>

<p><a id="markdown-stanford-corenlp" name="stanford-corenlp"></a></p>

<h3>Stanford CoreNLP</h3>

<p>å¯ä»¥å»<a href="http://nlp.stanford.edu:8080/corenlp/process">Stanford CoreNLP</a>è¯•ä¸€ä¸‹æ•ˆæœã€‚ä½¿ç”¨ç•Œé¢å¯ä»¥çœ‹ä¸€ä¸‹ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/NLU_Stanford_CoreNLP.png" alt="stanford CoreNLP" /></p>

<p><a id="markdown-ios-naturallanguage-framework" name="ios-naturallanguage-framework"></a></p>

<h3>iOS <em>NaturalLanguage</em> framework</h3>

<p>iOSçš„<em>NaturalLanguage</em>æ¡†æ¶å¯ä»¥åšçš„äº‹æƒ…å¦‚ä¸‹ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/NLU_AppleNLP.png" alt="Apple nlp framework" /></p>

<p><a id="markdown-custom-machine-learning-models" name="custom-machine-learning-models"></a></p>

<h4>Custom Machine Learning Models</h4>

<p>ç”¨æˆ·å¯ä»¥è‡ªå·±è®­ç»ƒæ¨¡å‹ï¼Œç”¨äºä¸‹åˆ—äº‹æƒ…ï¼š</p>

<p>NSLinguisticTagger:</p>

<ul>
<li>Language identification</li>
<li>Tokenization in Word/Sentence/Paragraph</li>
<li>Part of speech</li>
<li>Lemmatization</li>
<li>Named entity recognition</li>
</ul>


<p>With custom models:</p>

<ol>
<li>Text classification

<ul>
<li>Sentiment classification</li>
<li>Topic classification</li>
<li>Domain classification</li>
</ul>
</li>
<li>Word tagging

<ul>
<li>Part of speech</li>
<li>Named entity</li>
<li>Slot parsing

<ul>
<li>Chunking</li>
</ul>
</li>
<li></li>
</ul>
</li>
</ol>


<p><a id="markdown-è‡ªç„¶è¯­è¨€ç†è§£å¹³å°" name="è‡ªç„¶è¯­è¨€ç†è§£å¹³å°"></a></p>

<h2>è‡ªç„¶è¯­è¨€ç†è§£å¹³å°</h2>

<p>ä¸€äº›æ¯”è¾ƒæœ‰åæ°”çš„è‡ªç„¶è¯­è¨€ç†è§£å¹³å°ï¼š</p>

<ul>
<li>Facebookâ€™s Wit.ai,</li>
<li>IBM Watsonâ€™s Conversation Service,</li>
<li>Microsoftâ€™s Language Understanding and Intelligence Service or</li>
<li>Google NLP API</li>
</ul>


<p>Wit.ai joined Facebook on 2015.1.5</p>

<p>ä¸€äº›å¸¸è§äº§å“åŠå…¶èƒŒåçš„æ”¯æ’‘æŠ€æœ¯ï¼š</p>

<ul>
<li>Amazon: Echo &lt;- Alexa &lt;- Lex</li>
<li>Apple: iPhone &lt;- Siri &lt;- SiriKit</li>
<li>Google: Android phone &lt;- Google Asistant &lt;- Dialogflow</li>
<li>Microsoft: Windows phone &lt;- Cortana &lt;- Luis</li>
</ul>


<p>ä¸‹é¢é€‰æ‹©ä¸€äº›å¹³å°åšç®€å•ä»‹ç»ã€‚</p>

<p><a id="markdown-googleçš„dialogflow" name="googleçš„dialogflow"></a></p>

<h2>Googleçš„Dialogflow</h2>

<blockquote><p><a href="https://dialogflow.com/">Googleçš„Dialogflow</a>Give users new ways to interact with your product by building engaging voice and text-based conversational interfaces, such as voice apps and chatbots, powered by AI. Connect with users on your website, mobile app, the Google Assistant, Amazon Alexa, Facebook Messenger, and other popular platforms and devices.</p></blockquote>

<p><a id="markdown-dialogflowçš„å†å²" name="dialogflowçš„å†å²"></a></p>

<h3>Dialogflowçš„å†å²</h3>

<p>Dialogflowå°±æ˜¯Speaktoitå…¬å¸çš„api.aiã€‚</p>

<ul>
<li>2011: Speaktoit developed an intelligent personal assistant for mobile phones</li>
<li>2014: Speaktoit released api.ai</li>
<li>2016: Google buys Speaktoit to power Google Assistant</li>
<li>2017: api.ai is renamed to Dialogflow</li>
</ul>


<p><a id="markdown-dialogflowçš„ä¸€äº›æ¦‚å¿µ" name="dialogflowçš„ä¸€äº›æ¦‚å¿µ"></a></p>

<h3>Dialogflowçš„ä¸€äº›æ¦‚å¿µ</h3>

<ul>
<li>Agents: ä¸€å¥—moduleåŒ…å«dialogflowåŠè‡ªç„¶èªè¨€ç†è§£ä½¿ç”¨è€…çš„èªç¾©å¾Œï¼ŒåŸ·è¡Œæ•´å€‹å‹•ä½œ action. Ex:å¦‚ä¸Šåœ– TestAgent</li>
<li>Intents: ä½¿ç”¨è€…çš„æ„åœ–ã€‚æ„åœ–ç”±é–‹ç™¼äººå“¡é…ç½®ã€‚</li>
<li>Entities:é‡è¦çš„é—œéµå­—çœ¼(æˆ‘çœŸçš„ä¸çŸ¥é“æ€éº¼ç¿»å¥½ï¼ŒGoogleèªªé€™å€‹å­—å«åšå¯¦é«”?) å¾ç”¨æˆ¶å£ä¸­æ‰€æåˆ°çš„é‡è¦çš„é—œéµå­—çœ¼è½‰æ›æˆé‡è¦çš„è³‡è¨Šï¼Œç±æ­¤æä¾›çµ¦Intentã€‚ä¾‹å¦‚ï¼šâ€œè¨‚é£›æ©Ÿâ€ ï¼šé€™å¥è©±ä¸­é‚„éœ€è¦ åŸå¸‚ æ—¥æœŸ ç­‰è³‡è¨Šï¼Œä¾†èƒ½å®Œæˆè¨‚é£›æ©Ÿé€™å€‹å‹•ä½œï¼Œæ‰€ä»¥ åŸå¸‚ å’Œ æ—¥æœŸ å°±æ˜¯Entities.</li>
<li>Fulfilment: ç¨‹å¼æ’°å¯«çš„åœ°æ–¹ã€‚ä¾‹å¦‚ è¨‚é£›æ©Ÿ é‚„å¾—ä¸²é£›æ©Ÿå…¬å¸çš„APIæ‰æœ‰å¯èƒ½å®Œæˆè¨‚è³¼ï¼Œæ‰€ä»¥ç¨‹å¼é‚ç·å°±æ˜¯å¯«åœ¨é€™è£¡ã€‚</li>
<li>Integrations: LINE, Google home etc..</li>
<li>Prebuilt Agents:Â dialogflowå¹«ä½ é å…ˆè¨“ç·´å¥½çš„Agentï¼Œä½ å¯ä»¥æ‹¿ä¾†ç”¨ã€‚</li>
<li>Smalltalk:Â ä¹Ÿæ˜¯dialogflowå¹«ä½ é å…ˆè¨“ç·´å¥½çš„Agentï¼Œå¹«åŠ©ä½ çš„chatbotå°è©±æ›´å‹å–„.</li>
</ul>


<p><a id="markdown-ä¸¤ç§æ–¹æ³•å®ç°intentsä¹‹é—´çš„entitieså…±äº«" name="ä¸¤ç§æ–¹æ³•å®ç°intentsä¹‹é—´çš„entitieså…±äº«"></a></p>

<h3>ä¸¤ç§æ–¹æ³•å®ç°intentsä¹‹é—´çš„entitieså…±äº«</h3>

<ul>
<li>Context: åœ¨çº¿æ€§å¯¹è¯ä¸­ï¼Œå®Œæˆè®¯æ¯åœ¨Intentä¸­çš„ä¼ é€ã€‚</li>
<li>Followup Intent</li>
</ul>


<blockquote><p>å¯¹è¯ç”Ÿå‘½å‘¨æœŸï¼Œå°±æ˜¯è¿™ä¸ªå‚æ•°å¯ä»¥å­˜å¤šä¹…ã€‚</p></blockquote>

<p><a id="markdown-training-tab-in-dialogflow-platform" name="training-tab-in-dialogflow-platform"></a></p>

<h3>â€œTrainingâ€ tab in Dialogflow platform</h3>

<blockquote><p><a href="https://console.dialogflow.com/api-client/#/agent/dea6f73c-7c22-44b6-a1a8-45cdcd160bfc/training">å®˜æ–¹å…³äºTrainingçš„è¯´æ˜</a>ï¼šä½ å°†æ”¶åˆ°æ‰€æœ‰å‘é€ç»™agentçš„å›è¦†è®¯æ¯ä»¥åŠagentå›è¦†çš„å†…å®¹ï¼Œå¦‚æœä½ å‘Šè¯‰ä½ çš„agentä¸€äº›å›åº”æ–‡æœ¬ï¼Œä½†å®ƒå›åº”ä½ ä¸å–œæ¬¢çš„è¾“å‡ºï¼Œè¿™å°±éå¸¸æœ‰ç”¨ï¼Œè‹¥ä½ ç¨åæ„è¯†åˆ°å¿˜è®°äº†æŸä¸ªå…³é”®å­—çš„åŒä¹‰è¯ï¼Œå¹¶ä¸”ç”¨æˆ·æ­£åœ¨ä½¿ç”¨è¿™ä¸ªå…³é”®å­—ï¼Œé‚£ä¹ˆä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œå¯ä»¥å»å‘Šè¯‰ä½ çš„ä»£ç†åœ¨è¿™ç§æƒ…å†µä¸‹åº”è¯¥åšä»€ä¹ˆã€‚</p></blockquote>

<p><a id="markdown-integrations-analytics-and-fulfillment" name="integrations-analytics-and-fulfillment"></a></p>

<h3>â€œIntegrationsâ€, â€œAnalyticsâ€ and â€œFulfillmentâ€</h3>

<blockquote><p>åœ¨Trainingä¸‹æ–¹ï¼Œä½ å¯ä»¥çœ‹åˆ°Integrationsã€‚åœ¨è¿™é‡Œï¼Œå¯ä»¥ç®¡ç†ä½ çš„agentå»ä¸²æ¥ä¸åŒçš„æœåŠ¡ï¼Œä¾‹å¦‚Google Assistantï¼ŒTwitterï¼ŒSlackï¼ŒMessengerï¼ŒCortanaï¼ŒAlexaç­‰ç­‰ã€‚ Integrationsä¹‹åï¼Œè¿˜æœ‰Analyticsï¼ŒåŸºæœ¬ä¸Šç”¨æ¥æ˜¾ç¤ºå»ºè®®åç§°ï¼Œä¹‹åè¿˜æœ‰Fulfillmentï¼Œå¦‚æœä½ è¦è°ƒç”¨ä¸€ä¸ªAPIå¹¶å®ç°ä¸€ä¸ªwebhookï¼Œè¿™å°±æ˜¯ä½ ä¼šéœ€è¦æ¥çš„åœ°æ–¹ã€‚</p></blockquote>

<p><a id="markdown-prebuild-agent-and-small-talk" name="prebuild-agent-and-small-talk"></a></p>

<h3>â€œPrebuild Agentâ€ and â€œSmall Talkâ€</h3>

<p>æœ€åä¸¤ä¸ªé€‰é¡¹åŠŸèƒ½éå¸¸ç®€å•ï¼Œä½†å¾ˆæœ‰ç”¨ã€‚ç¬¬ä¸€ä¸ªæ˜¯Prebuilt Agentsï¼Œåœ¨è¿™é‡Œï¼Œä½ å¯ä»¥importä¸€ä¸ªé¢„å…ˆå­˜åœ¨çš„ä»£ç†æ¡†æ¶ï¼Œæœ‰å¾ˆå¤šä¾‹å­ï¼Œå¦‚é£Ÿç‰©ä¼ é€’æœºå™¨äººï¼ŒéŸ³ä¹æœºå™¨äººï¼Œç”šè‡³ï¼ˆæŠ±æ­‰ï¼Œä½†ä½ çœŸçš„éœ€è¦çŸ¥é“è¿™ä¸ªï¼‰hotelé¢„è®¢æœºå™¨äººï¼æœ€åä¸€ä¸ªé€‰é¡¹æ˜¯Small Talkï¼Œå¦‚æœä½ å°†ä»£ç†è®¾è®¡ä¸ºåƒSiriæˆ–Google Assistantè¿™æ ·çš„æ¯æ—¥ä¼™ä¼´(daily companion)ï¼Œè¿™ä¸ªé€‰é¡¹éå¸¸æœ‰ç”¨ï¼ŒSmall Talkå…è®¸ä½ æ·»åŠ å¸¸è§é—®é¢˜çš„ç­”æ¡ˆï¼Œæˆ‘ä»¬éƒ½å–œæ¬¢é—®æˆ‘ä»¬çš„æœºå™¨äººï¼Œå¦‚â€ä½ å‡ å²ï¼Ÿâ€æˆ–â€ä½ ä½å“ªé‡Œï¼Ÿâ€ï¼Œä»¥åŠæ›´çƒ­é—¨çš„é—®é¢˜â€ä½ æ„¿æ„å«ç»™æˆ‘å—ï¼Ÿâ€</p>

<p><a id="markdown-ä¸€äº›ä½¿ç”¨dialogflowçš„ä¾‹å­" name="ä¸€äº›ä½¿ç”¨dialogflowçš„ä¾‹å­"></a></p>

<h3>ä¸€äº›ä½¿ç”¨Dialogflowçš„ä¾‹å­</h3>

<ol>
<li>æ—å»ºå®çš„7ç¯‡æ–‡ç« ï¼šå¦‚ä½•ä½¿ç”¨Dialogflowå»ºç«‹Chatbot #1-#7</li>
<li><a href="https://medium.com/@wolkesau/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8dialogflow%E5%BB%BA%E7%AB%8Bchatbot-1-%E4%BB%8B%E7%B4%B9-62736bcdad95">ç”¨Dialogflowå»ºç«‹LINE Chatbot #1 ä»‹ç´¹</a></li>
<li><a href="https://github.com/appcoda/ChatbotHotel">A Demo for booking hotel based on Dialogflow</a></li>
<li><a href="https://www.appcoda.com.tw/chatbot-dialogflow-ios/">èŠå¤©æ©Ÿå™¨äººæ•™å­¸ï¼šä½¿ç”¨Dialogflow (API.AI)é–‹ç™¼ iOS Chatbot App</a></li>
</ol>


<p><a id="markdown-alexa-and-lex" name="alexa-and-lex"></a></p>

<h2>Alexa and Lex</h2>

<blockquote><p>Echo to Alexa as iPhone to Siri
Lex is whats inside Alexa
Lex is part of AWS, but Alexa isn&rsquo;t</p>

<p>Alexa is more focusing on communication using voice. Hence it has some special requirements for utterances. For example, the number is not supported in the utterances. You need to use &lsquo;Show me three elements&rsquo; instead of &lsquo;Show me 3 elements&rsquo;. For acronym, we need to use &lsquo;n.b.a&rsquo; instead of &lsquo;NBA&rsquo;.</p>

<p>Lex is a platform which can power bot who accept text input.</p>

<p>Amazon Lex è®©æ‚¨å¯ä»¥å°†è¯­éŸ³å’Œæ–‡æœ¬èŠå¤©è®¿é—®é›†æˆåˆ°ç°æœ‰åº”ç”¨ç¨‹åºä¸­ã€‚Amazon Alexa å…è®¸æ‚¨ä½¿ç”¨ Amazon Echo æˆ–ä»»ä½•å¯ç”¨ Alexa Voice Service çš„è®¾å¤‡ä¸ºå®¶åº­æˆ–å·¥ä½œåœºæ‰€çš„ç”¨æˆ·æä¾›å…æè¯­éŸ³æ¥å£ã€‚</p></blockquote>

<p><a id="markdown-microsoft-luis-text-analytics-api" name="microsoft-luis-text-analytics-api"></a></p>

<h2>Microsoft LUIS Text Analytics API</h2>

<ol>
<li>Detect language</li>
<li>Analyze sentiment</li>
<li>Extract key phrases

<ul>
<li>ä½¿ç”¨æ–¹æ³•å‚è€ƒ<a href="https://docs.microsoft.com/en-us/azure/cognitive-services/text-analytics/quickstarts/python">Python demo</a>ã€‚</li>
</ul>
</li>
<li>Identify entities

<ul>
<li>ä½¿ç”¨æ–¹æ³•å‚è€ƒ<a href="https://docs.microsoft.com/en-us/azure/cognitive-services/text-analytics/quickstarts/python">Python demo</a>ã€‚</li>
</ul>
</li>
</ol>


<p><a id="markdown-facebookçš„witai" name="facebookçš„witai"></a></p>

<h2>Facebookçš„wit.ai</h2>

<p>å‚è§<a href="https://wit.ai/">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<p><a id="markdown-snips" name="snips"></a></p>

<h2>Snips</h2>

<p>Snipsçš„è®¾è®¡æµç¨‹è¿˜æ˜¯éå¸¸å¥½çš„ ï¼ŒåŒ…å«åŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„ç¡®å®šæ€§è¯†åˆ«å’ŒåŸºäºæœºå™¨å­¦ä¹ çš„å¯èƒ½æ€§è¯†åˆ«ã€‚ä¸€äº›èµ„æ–™ï¼š</p>

<ul>
<li><a href="https://medium.com/snips-ai/an-introduction-to-snips-nlu-the-open-source-library-behind-snips-embedded-voice-platform-b12b1a60a41a">Post</a></li>
<li><a href="https://snips-nlu.readthedocs.io/en/latest/index.html">Document</a></li>
<li><a href="https://github.com/snipsco/snips-platform-swift">GitHub for iOS app demo</a></li>
<li><a href="https://console.snips.ai/assistants/proj_ageaw4b4d83">Snips assistent generation</a></li>
</ul>


<p><a id="markdown-duckling" name="duckling"></a></p>

<h3>Duckling</h3>

<p>Snipsä½¿ç”¨<a href="https://github.com/facebook/duckling">Duckling</a>è¿›è¡Œä¸‹é¢çš„ç†è§£ï¼š</p>

<p>è¾“å…¥ï¼š"the first Tuesday of October"
è¾“å‡ºï¼š{&ldquo;value&rdquo;:&ldquo;2017-10-03T00:00:00.000-07:00&rdquo;,&ldquo;grain&rdquo;:&ldquo;day&rdquo;}</p>

<blockquote><p>Note:
* Spin your own Duckling server or using wit.aiâ€™s build entities.
* <a href="https://medium.com/wit-ai/open-sourcing-duckling-our-probabilistic-date-parser-4351ee66c4ba">Open Sourcing Duckling, our probabilistic (date)Â parser</a></p></blockquote>

<p><a id="markdown-ibmçš„watson" name="ibmçš„watson"></a></p>

<h2>IBMçš„Watson</h2>

<p>å‚çœ‹<a href="https://www.ibm.com/watson/services/natural-language-classifier/">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<p><a id="markdown-swiftnlc" name="swiftnlc"></a></p>

<h2>SwiftNLC</h2>

<ul>
<li><a href="https://chatbotsmagazine.com/coreml-nlc-with-keras-tensorflow-and-apple-nslinguistictagger-1659021ea8e5">Offline Intent Understanding: CoreML NLC with Keras/TensorFlow and Apple NSLinguisticTagger</a></li>
<li><a href="https://heartbeat.fritz.ai/implementing-a-natural-language-classifier-in-ios-with-keras-core-ml-358f114c0b51">Implementing a Natural Language Classifier in iOS with Keras + Core ML</a></li>
</ul>


<p><a id="markdown-xunfei-command-recognition" name="xunfei-command-recognition"></a></p>

<h3>Xunfei Command Recognition</h3>

<p>ä¾‹å¦‚ï¼Œå¼€å‘ä¸€ä¸ªç®€å•çš„è¯­éŸ³æ‹¨å·åº”ç”¨ï¼Œå¯å®šä¹‰å¦‚ä¸‹è¯­æ³•ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;commands&gt;:(æ‰¾ä¸€ä¸‹|æ‰“ç”µè¯ç»™) &lt;name&gt;;
</span><span class='line'>&lt;name&gt;: å¼ ä¸‰|æå››;</span></code></pre></td></tr></table></div></figure>


<p>è¯¥è¯­æ³•ä½¿è¯†åˆ«å¼•æ“å¯ä»¥æ”¯æŒä»¥ä¸‹è¯´æ³•ï¼šæ‰¾ä¸€ä¸‹å¼ ä¸‰ ã€æ‰“ç”µè¯ç»™å¼ ä¸‰ ã€æ‰¾ä¸€ä¸‹æå›› ã€æ‰“ç”µè¯ç»™æå››ã€‚
å‡¡æ˜¯ç”¨æˆ·è¯´å‡ºè¿™ä¸ªèŒƒå›´ä¸­çš„ä»»æ„ä¸€å¥è¯ï¼Œå‡å¯ä»¥è¢«è¯†åˆ«ç³»ç»Ÿè¯†åˆ«ã€‚å¦‚æœç”¨æˆ·è¯´çš„è¯ä¸åœ¨ä¸Šè¿°èŒƒå›´ä¸­ï¼Œè¯†åˆ«ç³»ç»Ÿå¯èƒ½æ‹’ç»è¯†åˆ«ã€‚</p>

<p><a id="markdown-siri-and-sirikit" name="siri-and-sirikit"></a></p>

<h2>Siri and SiriKit</h2>

<p><a id="markdown-sirikit-build-in-domain" name="sirikit-build-in-domain"></a></p>

<h3>SiriKit build-in domain</h3>

<p>SiriKitæ”¯æŒçš„build-inçš„domainåŒ…æ‹¬ï¼š</p>

<ul>
<li>Messaging</li>
<li>Lists and Notes</li>
<li>Workouts</li>
<li>Payments</li>
<li>VoIP Calling</li>
<li>Visual Codes</li>
<li>Photos</li>
<li>Ride Booking</li>
<li>Car Commands</li>
<li>CarPlay</li>
<li>Restaurant Reservations</li>
</ul>


<p>åŸºäºbuild-inçš„domainï¼Œå¯ä»¥ä¸ç»è¿‡ä»»ä½•æœºå™¨æ¨¡å‹è®­ç»ƒè¾¾åˆ°ä¸‹é¢çš„æ•ˆæœï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>â€œHey Siri, send a UnicornChat messageâ€
</span><span class='line'>â€œTo whom?â€
</span><span class='line'>â€œCelestraâ€
</span><span class='line'>â€œWhat do you want to say to Celestra?â€
</span><span class='line'>â€œLetâ€™s add more sparkle transitionsâ€ </span></code></pre></td></tr></table></div></figure>


<p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹åšä¸€äº›äº‹æƒ…ã€‚</p>

<blockquote><p>Domain model can be trained and used through NLP framework.</p></blockquote>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¸®åŠ©Siriè¯†åˆ«è‡ªå®šä¹‰çš„è¯å…¸ï¼ˆWWDC2017 228_making_great_sirikit_experiences)ã€‚å¯ä»¥æ”¯æŒä¸¤ç§è‡ªå®šä¹‰çš„è¯å…¸ï¼š</p>

<ul>
<li>App vocabulary: known to all your users and unique to your app, supplied in the plist file.</li>
<li>User vocabulary: known only to some specific users, supplied at the runtime.</li>
</ul>


<p>ä½†æ˜¯ï¼Œæ³¨æ„ï¼š</p>

<ul>
<li>Need to update the user vocabulary if some info changes.</li>
<li>Need to reset the user vocabulary if the user reset the app, or log out.</li>
</ul>


<p><a id="markdown-sirikit-custom-intent" name="sirikit-custom-intent"></a></p>

<h3>SiriKit custom intent</h3>

<p>SiriKitçš„custom intentåªæ˜¯ç”¨æ¥å®ç°Siri Shortcutçš„ï¼Œä¸èƒ½æºå¸¦å‚æ•°ã€‚</p>

<blockquote><p>Custom intent can only be used as shortcut and NO parameters will be extracted from the voice command.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Offline Natural Language Understanding Engine on iOS]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/05/22/offline-natural-language-understanding-engine-on-ios/"/>
    <updated>2019-05-22T16:04:28+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/05/22/offline-natural-language-understanding-engine-on-ios</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#objective">Objective</a>

<ul>
<li><a href="#what-is-a-good-nlu-engine">What is a good NLU engine</a>

<ul>
<li><a href="#deterministic-behavior">Deterministic behavior</a></li>
<li><a href="#generalization-power">Generalization power</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#design-and-workflow">Design and Workflow</a></li>
<li><a href="#deterministic-intent-parser">Deterministic Intent Parser</a></li>
<li><a href="#probabilistic-intent-parser">Probabilistic Intent Parser</a>

<ul>
<li><a href="#intent-classification">Intent Classification</a>

<ul>
<li><a href="#model-training">Model Training</a></li>
<li><a href="#model-usage">Model Usage</a></li>
</ul>
</li>
<li><a href="#slot-filling">Slot Filling</a>

<ul>
<li><a href="#model-training-1">Model Training</a></li>
<li><a href="#model-usage-1">Model Usage</a></li>
</ul>
</li>
<li><a href="#model-size">Model Size</a></li>
<li><a href="#problems-to-be-solved">Problems to Be Solved</a>

<ul>
<li><a href="#intent-classification-model-has-no-probability-output">Intent Classification Model Has No Probability Output</a></li>
<li><a href="#slot-filling-model-tagges-the-label-by-words-not-phrase">Slot Filling Model Tagges the Label by Words, not Phrase</a></li>
</ul>
</li>
</ul>
</li>
</ul>


<p><a id="markdown-objective" name="objective"></a></p>

<h2>Objective</h2>

<p><img src="http://hongchaozhang.github.io/images/NLUObjective.png" alt="nlu objective" /></p>

<p>We want an NLU Engine to understand the normal text command on Mobile. We hope the engine can know the command&rsquo;s intent and the info the command needs to execute.</p>

<p>Currently, there are many NLU related tools, like Google Dialogflow, Amazon Lex, Facebook Wit.ai, Microsoft Luis. However, they are all online tools. Considering the privacy problem, we are trying to build our own offline NLU Engine.</p>

<p><a id="markdown-what-is-a-good-nlu-engine" name="what-is-a-good-nlu-engine"></a></p>

<h3>What is a good NLU engine</h3>

<p>Letâ€™s start by looking at a simple example, and see what you would expect from a good NLU engine.</p>

<p>First, we need some examples to train the NLU engine. Consider the following dataset, used to train a simple weather assistant with a few query examples:</p>

<ul>
<li>Give me the weather for [tomorrow](date)</li>
<li>Show me the [Paris](location) weather for [Sunday](date)</li>
</ul>


<p><a id="markdown-deterministic-behavior" name="deterministic-behavior"></a></p>

<h4>Deterministic behavior</h4>

<p>The first thing you want is that all the examples you give to train the model are correctly supported by the engine. This makes the system predictable and easy to use: if a query is not correctly parsed, then add it to the dataset and it will work right away.</p>

<p><a id="markdown-generalization-power" name="generalization-power"></a></p>

<h4>Generalization power</h4>

<p>Having this deterministic behavior is great for robustness and predictability, but a powerful NLU engine also needs to have some generalization power. You want the system not only to recognize patterns provided in the training set, but also all the possible variations that come from speaking naturally. If we go back to the previous dataset, it is reasonable to expect the NLU engine to parse a query like: â€œWhatâ€™s the weather in Beijing right now?â€ even though it is not one of the training examples.</p>

<p><a id="markdown-design-and-workflow" name="design-and-workflow"></a></p>

<h2>Design and Workflow</h2>

<p><img src="http://hongchaozhang.github.io/images/NLUDesign.png" alt="nlu design" /></p>

<p>In order to satisfy these objectives: deterministic behavior and generalization power, we built the processing pipeline described in the figure above. It receives a text as input, and outputs a structured response containing the intent and the list of slots. The main processing unit of the pipeline is the NLU engine. It contains two intent parsers which are called successively: a deterministic intent parser and a probabilistic one.</p>

<p>The deterministic parser relies on regular expressions to match intent and slots, which results in perfect behavior on training examples but doesnâ€™t generalize. This parser is the first to be used because of its strictness.</p>

<p>The probabilistic parser is used whenever the first parser fails to find a match. It uses machine learning to generalize beyond the set of sentences seen at train time, thus making our NLU engine be able to cope with examples which are not in the scope of the training data set. This parser involves two successive steps: intent classification and slot filling. These two steps rely on trained machine learning models to classify intent and extract slots.</p>

<p><a id="markdown-deterministic-intent-parser" name="deterministic-intent-parser"></a></p>

<h2>Deterministic Intent Parser</h2>

<p>The Deterministic Intent Parse is the first step to be used. This parser relies on some regular expressions to match the intent and slots. If the new input has the same structure with one of the training examples, we will find its intent and slots by comparing the input with the matched regular expression.</p>

<p>The regular expressions are built based on the training examples. For a training case:</p>

<ul>
<li>What is the weather in [Alaska](location)</li>
</ul>


<p>We will build a regular expression:</p>

<ul>
<li>(what is the weather in)(?&lt;location1&gt;.+)</li>
</ul>


<p><a id="markdown-probabilistic-intent-parser" name="probabilistic-intent-parser"></a></p>

<h2>Probabilistic Intent Parser</h2>

<p>If the Deterministic Intent Parser fails to find the intent and slots, the Probabilistic Intent Parser will be used.</p>

<p>The Probabilistic Intent Parser has two steps:</p>

<ul>
<li>Intent Classification</li>
<li>Slot Filling</li>
</ul>


<p>The Intent Classification is to find the intent of the input command text, and the Slot Filling is to extract all the slots needed by the intent. These two steps are both based on trained machine models.</p>

<p>Apple has released CreateML for training natural language models, which also integrates the powerful NatrualLanguage framework functions, like Tokenization, Part of Speech, Lemmatization, Name Entity Recognition, etc. This will make the training process very simple, and the trained model will be more accurate and smaller.</p>

<p><a id="markdown-intent-classification" name="intent-classification"></a></p>

<h3>Intent Classification</h3>

<p><a id="markdown-model-training" name="model-training"></a></p>

<h4>Model Training</h4>

<p>For Intent Classification model training, we prepare the data set as follows (The size of the training data is 3282 falling into four intents.):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;I would like the forecast in cupertino california  tomorrow&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;searchWeatherForecast&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Forecast in Maine USA next week&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;searchWeatherForecast&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Will I be able to wear open-toed shoes twenty three hours and seven minutes from now in Severn?&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;searchWeatherForecastItem&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Should I bring a raincoat to the Belgrade and Loreto areas of Oman at midnight?&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;searchWeatherForecastItem&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Apple has release CreateML framework for training machine learning models easily inside Swift playground and the trained model can be saved as mlmodel type. And the MLTextClassifier class from CreateML will benefit from Apple&rsquo;s NatrualLanguage framework for Tokenization, Part of Speech, Lemmatization, etc.</p>

<p>The training script is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">trainingDataPath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;intentClassificationFile&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="nl">inDirectory</span><span class="p">:</span> <span class="s">&quot;Data/text/train&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLDataTable</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span>  <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="n">trainingDataPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initializing the classifier with a training data.</span>
</span><span class='line'><span class="k">let</span> <span class="n">classifier</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLTextClassifier</span><span class="p">(</span><span class="nl">trainingData</span><span class="p">:</span> <span class="n">trainingData</span><span class="p">,</span> <span class="nl">textColumn</span><span class="p">:</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="nl">labelColumn</span><span class="p">:</span> <span class="s">&quot;label&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Evaluating training &amp; validation accuracies.</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">classifier</span><span class="p">.</span><span class="n">trainingMetrics</span><span class="p">.</span><span class="n">classificationError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'><span class="k">let</span> <span class="n">validationAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">classifier</span><span class="p">.</span><span class="n">validationMetrics</span><span class="p">.</span><span class="n">classificationError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initializing the properly labeled testing data from Resources folder.</span>
</span><span class='line'><span class="k">let</span> <span class="n">testingDataPath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;intentClassificationFile&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="nl">inDirectory</span><span class="p">:</span> <span class="s">&quot;Data/text/test&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">testingData</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLDataTable</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span><span class="n">testingDataPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Counting the testing evaluation.</span>
</span><span class='line'><span class="k">let</span> <span class="n">evaluationMetrics</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">.</span><span class="n">evaluation</span><span class="p">(</span><span class="nl">on</span><span class="p">:</span> <span class="n">testingData</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">evaluationAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">evaluationMetrics</span><span class="p">.</span><span class="n">classificationError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Confusion matrix in order to see which labels were classified wrongly.</span>
</span><span class='line'><span class="k">let</span> <span class="n">confusionMatrix</span> <span class="o">=</span> <span class="n">evaluationMetrics</span><span class="p">.</span><span class="n">confusion</span>
</span><span class='line'><span class="n">print</span><span class="p">(</span><span class="s">&quot;Confusion matrix: \(confusionMatrix)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Metadata for saving the model.</span>
</span><span class='line'><span class="k">let</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">MLModelMetadata</span><span class="p">(</span><span class="nl">author</span><span class="p">:</span> <span class="s">&quot;Hongchao Zhang&quot;</span><span class="p">,</span>
</span><span class='line'>                            <span class="nl">shortDescription</span><span class="p">:</span> <span class="s">&quot;A model trained to classify weather related commands.&quot;</span><span class="p">,</span>
</span><span class='line'>                            <span class="nl">version</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Saving the model. Remember to update the path.</span>
</span><span class='line'><span class="n">try</span><span class="o">!</span> <span class="n">classifier</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="s">&quot;/Users/hozhang/Downloads/textClassifier.mlmodel&quot;</span><span class="p">),</span>
</span><span class='line'>                    <span class="nl">metadata</span><span class="p">:</span> <span class="n">metadata</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can get 99.23% training accuracy and 98.87% validation accuracy.</p>

<p><a id="markdown-model-usage" name="model-usage"></a></p>

<h4>Model Usage</h4>

<p>For the trained model of mlmodel type, we can use it in our iOS app through NLModel (from NatrualLanguage framework). The demo swift code may be like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">modelUrl</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;Data/text/textClassifier&quot;</span><span class="p">,</span> <span class="nl">withExtension</span><span class="p">:</span> <span class="s">&quot;mlmodel&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">compiledModelUrl</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLModel</span><span class="p">.</span><span class="n">compileModel</span><span class="p">(</span><span class="nl">at</span><span class="p">:</span> <span class="n">modelUrl</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">classifier</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">NLModel</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span> <span class="n">compiledModelUrl</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="n">requestText</span>
</span><span class='line'><span class="k">let</span> <span class="n">label</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">.</span><span class="n">predictedLabel</span><span class="p">(</span><span class="k">for</span><span class="o">:</span> <span class="n">text</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">print</span><span class="p">(</span><span class="s">&quot;text: \(text)</span><span class="se">\n</span><span class="s">label:\(label ?? &quot;</span><span class="n">Not</span> <span class="n">detected</span><span class="o">!</span><span class="s">&quot;)&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><strong>How to use .mlmodel file?</strong></p>

<p>.mlmodel file needs to be compiled before using. There are two ways to do this: offline and online:</p>

<ol>
<li>offline: drag the mlmodel into your project, xcode will compile the .mlmodel for you before you build you app.</li>
<li>online: use <code>MLModel.compileModel</code> to compile your .mlmodel file at runtime. This is especially useful when your are at swift playground, where you cannot get xcode&rsquo;s help for comipling.</li>
</ol>
</blockquote>

<p><a id="markdown-slot-filling" name="slot-filling"></a></p>

<h3>Slot Filling</h3>

<p><a id="markdown-model-training-1" name="model-training-1"></a></p>

<h4>Model Training</h4>

<p>For Slot Filling model training, we prepare the data set as follows (The size of the training data is: 3282.):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;would&quot;</span><span class="p">,</span> <span class="s2">&quot;like&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;forecast&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;california&quot;</span><span class="p">,</span> <span class="s2">&quot;tomorrow&quot;</span><span class="p">],</span>
</span><span class='line'>    <span class="nt">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">]</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;Maine&quot;</span><span class="p">,</span> <span class="s2">&quot;next week&quot;</span><span class="p">],</span>
</span><span class='line'>    <span class="nt">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">]</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Like Intent Classification model training, CreateML framework also makes it easy. Like MLTextClassifier, the MLWordTagger class from CreateML will also benefit from NatrualLanguage framework for Part of Speech, Lemmatization, Name Entity Recognition, etc.</p>

<p>The training script is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// Initializing the training data from Resources folder.</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingDataPath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;slotParsingFile&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="nl">inDirectory</span><span class="p">:</span> <span class="s">&quot;Data/text/train&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLDataTable</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span>  <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="n">trainingDataPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initializing the classifier with a training data.</span>
</span><span class='line'><span class="k">let</span> <span class="n">classifier</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLWordTagger</span><span class="p">(</span><span class="nl">trainingData</span><span class="p">:</span> <span class="n">trainingData</span><span class="p">,</span> <span class="nl">tokenColumn</span><span class="p">:</span> <span class="s">&quot;tokens&quot;</span><span class="p">,</span> <span class="nl">labelColumn</span><span class="p">:</span> <span class="s">&quot;labels&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Evaluating training &amp; validation accuracies.</span>
</span><span class='line'><span class="k">let</span> <span class="n">trainingAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">classifier</span><span class="p">.</span><span class="n">trainingMetrics</span><span class="p">.</span><span class="n">taggingError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'><span class="k">let</span> <span class="n">validationAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">classifier</span><span class="p">.</span><span class="n">validationMetrics</span><span class="p">.</span><span class="n">taggingError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initializing the properly labeled testing data from Resources folder.</span>
</span><span class='line'><span class="k">let</span> <span class="n">testingDataPath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;slotParsingFile&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="nl">inDirectory</span><span class="p">:</span> <span class="s">&quot;Data/text/test&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">testingData</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLDataTable</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span><span class="n">testingDataPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Counting the testing evaluation.</span>
</span><span class='line'><span class="k">let</span> <span class="n">evaluationMetrics</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">.</span><span class="n">evaluation</span><span class="p">(</span><span class="nl">on</span><span class="p">:</span> <span class="n">testingData</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">evaluationAccuracy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">evaluationMetrics</span><span class="p">.</span><span class="n">taggingError</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Confusion matrix in order to see which labels were classified wrongly.</span>
</span><span class='line'><span class="k">let</span> <span class="n">confusionMatrix</span> <span class="o">=</span> <span class="n">evaluationMetrics</span><span class="p">.</span><span class="n">confusion</span>
</span><span class='line'><span class="n">print</span><span class="p">(</span><span class="s">&quot;Confusion matrix: \(confusionMatrix)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Metadata for saving the model.</span>
</span><span class='line'><span class="k">let</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">MLModelMetadata</span><span class="p">(</span><span class="nl">author</span><span class="p">:</span> <span class="s">&quot;Hongchao Zhang&quot;</span><span class="p">,</span>
</span><span class='line'>                                <span class="nl">shortDescription</span><span class="p">:</span> <span class="s">&quot;A model trained to parse slots from weather related commands.&quot;</span><span class="p">,</span>
</span><span class='line'>                                <span class="nl">version</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Saving the model. Remember to update the path.</span>
</span><span class='line'><span class="n">try</span><span class="o">!</span> <span class="n">classifier</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="s">&quot;/Users/hozhang/Downloads/slotParsing.mlmodel&quot;</span><span class="p">),</span>
</span><span class='line'>                        <span class="nl">metadata</span><span class="p">:</span> <span class="n">metadata</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can get 99.64% training accuracy and 98.38% validation accuracy.</p>

<p><a id="markdown-model-usage-1" name="model-usage-1"></a></p>

<h4>Model Usage</h4>

<p>We can load the mlmodel into an NLTagger (from NatrualLanguage framework), and use the NLTagger to tag labels for each word of the input command text. The demo swift script is like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">weatherTagSchema</span> <span class="o">=</span> <span class="n">NLTagScheme</span><span class="p">(</span><span class="s">&quot;Weather&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">modelUrl</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;Data/text/slotParsing&quot;</span><span class="p">,</span> <span class="nl">withExtension</span><span class="p">:</span> <span class="s">&quot;mlmodel&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">compiledModelUrl</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">MLModel</span><span class="p">.</span><span class="n">compileModel</span><span class="p">(</span><span class="nl">at</span><span class="p">:</span> <span class="n">modelUrl</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">taggerModel</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">NLModel</span><span class="p">(</span><span class="nl">contentsOf</span><span class="p">:</span> <span class="n">compiledModelUrl</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">weatherTagger</span> <span class="o">=</span> <span class="n">NLTagger</span><span class="p">(</span><span class="nl">tagSchemes</span><span class="p">:</span> <span class="p">[</span><span class="n">weatherTagSchema</span><span class="p">])</span>
</span><span class='line'><span class="n">weatherTagger</span><span class="p">.</span><span class="n">setModels</span><span class="p">([</span><span class="n">taggerModel</span><span class="p">],</span> <span class="nl">forTagScheme</span><span class="p">:</span> <span class="n">weatherTagSchema</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="n">requestText</span>
</span><span class='line'><span class="n">weatherTagger</span><span class="p">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">text</span>
</span><span class='line'><span class="n">weatherTagger</span><span class="p">.</span><span class="n">enumerateTags</span><span class="p">(</span><span class="k">in</span><span class="o">:</span> <span class="n">text</span><span class="p">.</span><span class="n">startIndex</span><span class="p">..</span><span class="o">&lt;</span><span class="n">text</span><span class="p">.</span><span class="n">endIndex</span><span class="p">,</span> <span class="nl">unit</span><span class="p">:</span> <span class="p">.</span><span class="n">word</span><span class="p">,</span> <span class="nl">scheme</span><span class="p">:</span> <span class="n">weatherTagSchema</span><span class="p">,</span> <span class="nl">options</span><span class="p">:</span> <span class="p">[])</span> <span class="p">{</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">tokenRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="k">in</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">.</span><span class="n">rawValue</span> <span class="o">!=</span> <span class="s">&quot;Whitespace&quot;</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;\(text[tokenRange]): \(tag.rawValue)&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">true</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong> Reference </strong></p>

<ol>
<li><a href="https://developer.apple.com/documentation/createml/creating_a_text_classifier_model">Creating a Text Classifier Model</a>: Apple offical site for training and using machine learning models through CreateML framework.</li>
<li>WWDC video <a href="https://developer.apple.com/videos/play/wwdc2018/713/">Introducing Natural Language Framework</a>: This session introduces NLP framework and its relation with CreateML framework.</li>
</ol>


<p><a id="markdown-model-size" name="model-size"></a></p>

<h3>Model Size</h3>

<p>For the iOS app, we hope the machine learning model size is small enough. Apple&rsquo;s NatrualLanguage framework has done many optimizations on machine learning model size. The following data is from WWDC 2018 (session 713: Introducing NatrualLanguage Framework):</p>

<table>
<thead>
<tr>
<th>&ndash; </th>
<th> Open Source CRFSuite </th>
<th> Natural Language Framework</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name Entity Recognition </td>
<td> 70MB  </td>
<td> 1.4MB</td>
</tr>
<tr>
<td>Chunking </td>
<td> 30MB </td>
<td> 1.8MB</td>
</tr>
</tbody>
</table>


<p>We can see that the model will be much smaller than that trained from an open source platform.</p>

<p>The size of the two models we trained is (The training data size is: 3282):</p>

<table>
<thead>
<tr>
<th>Model </th>
<th> Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intent Classification </td>
<td> 41K</td>
</tr>
<tr>
<td>Slot Filling </td>
<td> 609K</td>
</tr>
</tbody>
</table>


<p>If your model is a neural network, you can reduce the size of your model by the following way:
<a href="https://developer.apple.com/documentation/coreml/reducing_the_size_of_your_core_ml_app">Reducing the Size of Your Core ML App</a>. You can control the precision of the neural network parameters, and thus the size of the trained model.</p>

<p>If still your model is large, you can
<a href="https://developer.apple.com/documentation/coreml/core_ml_api/downloading_and_compiling_a_model_on_the_user_s_device">Downloading and Compiling a Model on the User&rsquo;s Device</a> at runtime.</p>

<p><a id="markdown-problems-to-be-solved" name="problems-to-be-solved"></a></p>

<h3>Problems to Be Solved</h3>

<p>For Probabilistic Intent Parser, we still have some problems.</p>

<p><a id="markdown-intent-classification-model-has-no-probability-output" name="intent-classification-model-has-no-probability-output"></a></p>

<h4>Intent Classification Model Has No Probability Output</h4>

<p>We may need the probability to define the reliability of the estimated intent of an input command text.</p>

<p>However, the model trained through <code>MLTextClassifier</code> has no probability output API. If we really need the probability output, we can use other platforms to train the model, like tensorflow. That way, we will not benefit from NatrualLanguage framework and we need to consider these things by ourselves, like Tokenization, Part of Speech, Lemmatization, etc.</p>

<blockquote><p>Try other tools for training models with probability output, like Turi.</p></blockquote>

<p><a id="markdown-slot-filling-model-tagges-the-label-by-words-not-phrase" name="slot-filling-model-tagges-the-label-by-words-not-phrase"></a></p>

<h4>Slot Filling Model Tagges the Label by Words, not Phrase</h4>

<p>The NLTagger class only supply the following four tag level: word, sentence, paragraph, and document. There is no &ldquo;phrase&rdquo; tag level. For example, &ldquo;New York&rdquo; will be treated as &ldquo;New&rdquo; and &ldquo;York&rdquo;, and the tagged label will both be &ldquo;location&rdquo;. We need to compose them together manually.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¦‚ä½•æ§åˆ¶iOSåº”ç”¨çš„å±å¹•æ–¹å‘]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/05/21/understand-ios-app-orientations/"/>
    <updated>2019-05-21T18:24:35+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/05/21/understand-ios-app-orientations</id>
    <content type="html"><![CDATA[<!-- more -->


<h2>èƒŒæ™¯</h2>

<p>ä¸€ä¸ªiOSåº”ç”¨é»˜è®¤éƒ½ä¼šæ”¯æŒæ‰€æœ‰çš„æ˜¯ä¸ªæ–¹å‘ï¼Œå½“ç”¨æˆ·æ—‹è½¬å±å¹•çš„æ—¶å€™ï¼Œåº”ç”¨ä¼šè‡ªåŠ¨æ—‹è½¬ã€‚</p>

<p>æœ‰äº›æ—¶å€™ï¼Œè¿™å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚æ¯”å¦‚ä½ è®¾è®¡äº†ä¸€ä¸ªåªæ”¯æŒç«–å±æ–¹å‘çš„åº”ç”¨ï¼Œä½†æ˜¯åˆæƒ³åœ¨æŸäº›æ—¶å€™æ”¯æŒLandscapeæ¨¡å¼ï¼Œæ¯”å¦‚æ’­æ”¾è§†é¢‘çš„æ—¶å€™ã€‚iOSåº”ç”¨æœ‰å¾ˆå¤šåœ°æ–¹çš„è®¾ç½®ä¼šå½±å“å±å¹•æ–¹å‘ï¼ŒiOS9ä¹‹åï¼ŒiPadåˆæ”¯æŒäº†split viewï¼Œä½¿å¾—è¿™ä¸ªæ§åˆ¶æ›´åŠ å¤æ‚ã€‚</p>

<h2>æ€»èµ·</h2>

<p>iPhoneæ¯”è¾ƒç®€å•ï¼Œå› ä¸ºå…¶æ²¡æœ‰spit viewçš„åŠŸèƒ½ï¼ŒiPadå› ä¸ºæœ‰äº†spilt viewåŠŸèƒ½ï¼Œåœ¨å±å¹•æ–¹å‘çš„æ§åˆ¶ä¸Šæ›´å¤æ‚ä¸€äº›ã€‚</p>

<p>é¦–å…ˆï¼Œéœ€è¦æ˜ç¡®ï¼šæœ‰å“ªäº›å› ç´ ä¼šå½±å“åˆ°Appçš„å±å¹•æ–¹å‘ï¼Ÿ</p>

<p><strong>1. Projectè®¾ç½®ï¼ˆinfo.plistï¼‰</strong></p>

<p>æœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥è¿›è¡Œè¯¥é¡¹è®¾ç½®ï¼š</p>

<ul>
<li><p>Project->Target->General->Device Orientation</p>

<p><img src="http://hongchaozhang.github.io/images/ScreenOrientationProjectSetting.png" alt="screen orientation project setting" /></p></li>
<li><p>Projectçš„info.plisté…ç½®æ–‡ä»¶</p>

<p><img src="http://hongchaozhang.github.io/images/ScreenOrientationInfoPlist.png" alt="screen orientation info plist" /></p></li>
</ul>


<p>è¿™ä¸¤ä¸ªåœ°æ–¹çš„è®¾ç½®æ˜¯ä¸€è‡´çš„ï¼šåœ¨ä¸€ä¸ªåœ°æ–¹æ”¹åŠ¨ï¼Œå¦ä¸€ä¸ªåœ°æ–¹ä¼šåŒæ­¥ä¿®æ”¹ã€‚å…¶ä¸­ï¼šinfo.plistä¸­çš„â€œSupported interface orientations (iPad)â€å±æ€§å¯¹åº”äºiPadçš„è®¾ç½®ï¼ˆDeviceé€‰æ‹©iPadï¼‰ï¼Œinfo.plistä¸­çš„â€œSupported interface orientationsâ€å±æ€§å¯¹åº”äºiPhoneå’ŒUniversalçš„è®¾ç½®ï¼ˆDeviceé€‰æ‹©iPhoneæˆ–è€…Universalï¼Œè¿™ä¸¤é¡¹çš„è®¾ç½®å§‹ç»ˆä¿æŒä¸€è‡´ï¼‰ã€‚</p>

<p><strong>2. åœ¨ä»£ç ä¸­è®¾ç½®åº”ç”¨æ”¯æŒçš„å±å¹•æ–¹å‘</strong></p>

<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åœ¨ä»£ç ä¸­è®¾ç½®åº”ç”¨æ”¯æŒçš„å±å¹•æ–¹å‘ï¼š</p>

<ul>
<li><code>UIApplicationDelegate</code>ä¸­çš„<code>supportedInterfaceOrientationsForWindow:</code>æ–¹æ³•</li>
<li>æ¯ä¸ª<code>UIViewController</code>è¿˜å¯ä»¥é€šè¿‡<code>supportedInterfaceOrientations</code>æ–¹æ³•è®¾ç½®è‡ªå·±æ”¯æŒçš„å±å¹•æ–¹å‘</li>
</ul>


<p>ç³»ç»Ÿä¼šè‡ªåŠ¨å°†ä¸¤ç§æ–¹æ³•ä¸­æ”¯æŒçš„å±å¹•æ–¹å‘å–äº¤é›†ï¼Œä½œä¸ºæœ€ç»ˆè¯¥view controlleræ”¯æŒçš„å±å¹•æ–¹å‘ã€‚å¦‚æœäº¤é›†ä¸ºç©ºï¼Œé‚£ä¹ˆåº”ç”¨å°†ä¼šCrashã€‚</p>

<p><strong>3. <code>UIViewController</code>ä¸­çš„<code>shouldAutorotate</code>å±æ€§</strong></p>

<p>è¯¥å±æ€§æ˜¯åªè¯»å±æ€§ï¼Œç”¨æ¥æ§åˆ¶è¯¥view controllerå¯ä¸å¯ä»¥æ—‹è½¬ã€‚å¯ä»¥åœ¨è‡ªå·±çš„view controllerä¸­å°†å…¶overrideï¼Œè¿”å›è‡ªå·±çš„é€»è¾‘ï¼Œç”šè‡³å°†å…¶overrideä¸ºè¯»å†™å±æ€§ï¼Œå¯ä»¥åœ¨å…¶å®ƒåœ°æ–¹è¿›è¡Œè®¾ç½®ã€‚æ¯”å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="n">public</span> <span class="k">var</span> <span class="nl">shouldAutorotate</span><span class="p">:</span> <span class="n">Bool</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">get</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">shouldAutorotateVariable</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="kr">set</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">shouldAutorotateVariable</span> <span class="o">=</span> <span class="n">newValue</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å…¶ä¸­<code>shouldAutorotateVariable</code>ä¸ºview controllerä¸­è‡ªå®šä¹‰çš„ä¸€ç§æœ‰å˜é‡ã€‚</p>

<h2>iPhone</h2>

<p>å¦‚æœæŸä¸ªview controllerä¸­çš„<code>shouldAutorotate</code>è¢«è®¾ç½®ä¸º<code>false</code>ï¼Œé‚£ä¹ˆç³»ç»Ÿå°†å¿½ç•¥ä¸‹é¢çš„è®¾ç½®ï¼š</p>

<ul>
<li><code>UIApplicationDelegate</code>ä¸­çš„<code>supportedInterfaceOrientationsForWindow:</code>æ–¹æ³•</li>
<li>è¯¥<code>UIViewController</code>é€šè¿‡<code>supportedInterfaceOrientations</code>æ–¹æ³•è®¾ç½®çš„è‡ªå·±æ”¯æŒçš„å±å¹•æ–¹å‘</li>
</ul>


<p>ç³»ç»Ÿåªè€ƒè™‘ç”¨æˆ·åœ¨â€œProjectè®¾ç½®ï¼ˆinfo.plistï¼‰â€ä¸­çš„è®¾ç½®ã€‚</p>

<p>å¦‚æœæŸä¸ªview controllerä¸­çš„<code>shouldAutorotate</code>æœªè¢«é‡å†™ï¼ˆæˆ–è€…è¢«é‡å†™ä¸º<code>true</code>ï¼‰ï¼Œé‚£ä¹ˆç³»ç»Ÿå°†ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ä¸‹é¢ä¸¤ä¸ªè®¾ç½®çš„äº¤é›†ï¼š</p>

<ul>
<li><code>UIApplicationDelegate</code>ä¸­çš„<code>supportedInterfaceOrientationsForWindow:</code>æ–¹æ³•</li>
<li>è¯¥<code>UIViewController</code>é€šè¿‡<code>supportedInterfaceOrientations</code>æ–¹æ³•è®¾ç½®çš„è‡ªå·±æ”¯æŒçš„å±å¹•æ–¹å‘</li>
</ul>


<p>å¦‚æœæ²¡æœ‰ä»¥ä¸Šä¸¤ä¸ªè®¾ç½®ï¼Œå†ä½¿ç”¨â€œProjectè®¾ç½®ï¼ˆinfo.plistï¼‰â€ä¸­çš„è®¾ç½®ã€‚</p>

<h2>iPad</h2>

<p>ä»iOS9å¼€å§‹ï¼ŒiPadå¼€å§‹æ”¯æŒsplit viewåŠŸèƒ½ã€‚å…³äºè¿™ä¸ªåŠŸèƒ½çš„è®¾ç½®è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒè‹¹æœå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developer.apple.com/library/archive/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/QuickStartForSlideOverAndSplitView.html#//apple_ref/doc/uid/TP40015145-CH13-SW1">Slide Over and Split View Quick Start</a>ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ï¼šå¦‚æœinfo.plistä¸­çš„â€œSupported interface orientations (iPad)â€å±æ€§å¯¹åº”çš„å€¼åŒ…å«äº†å››ä¸ªæ–¹å‘ï¼ŒåŒæ—¶<code>UIRequiresFullScreen</code>å¯¹åº”çš„å€¼ä¸º<code>NO</code>ï¼Œé‚£ä¹ˆç³»ç»Ÿé»˜è®¤è¯¥åº”ç”¨æ”¯æŒsplit viewå±æ€§ï¼ŒåŒæ—¶ç³»ç»Ÿå°†å¿½ç•¥ä¸‹é¢ä¸¤å¤„ä»£ç ï¼š</p>

<ul>
<li><code>UIApplicationDelegate</code>ä¸­çš„<code>supportedInterfaceOrientationsForWindow:</code>æ–¹æ³•</li>
<li><code>UIViewController</code>é€šè¿‡<code>supportedInterfaceOrientations</code>æ–¹æ³•è®¾ç½®çš„è‡ªå·±æ”¯æŒçš„å±å¹•æ–¹å‘</li>
</ul>


<p>ä»¥åŠ<code>UIViewController</code>ä¸­<code>shouldAutorotate</code>çš„å€¼ã€‚</p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼šæ”¯æŒsplit viewçš„åº”ç”¨å°†ä¸èƒ½è¢«ç¦æ­¢æ—‹è½¬ï¼Œè‡³å°‘ä¸èƒ½é€šè¿‡æœ¬æ–‡ä¸­çš„æ–¹æ³•è¿›è¡Œç¦æ­¢æ—‹è½¬ã€‚</p>

<p>å¦‚æœinfo.plistä¸­çš„â€œSupported interface orientations (iPad)â€å±æ€§å¯¹åº”çš„å€¼æœªåŒ…å«å››ä¸ªæ–¹å‘ï¼Œæˆ–è€…â€œUIRequiresFullScreenâ€å¯¹åº”çš„å€¼ä¸º<code>NO</code>ï¼Œé‚£ä¹ˆè¯¥åº”ç”¨ä¸æ”¯æŒsplit viewåŠŸèƒ½ï¼Œå…¶å±å¹•æ–¹å‘æ§åˆ¶æ–¹æ³•åŒiPhoneç›¸åŒã€‚</p>

<blockquote><p>æ³¨æ„ï¼šå¯¹äºâ€œProjectè®¾ç½®ï¼ˆinfo.plistï¼‰â€è®¾ç½®ï¼Œå»ºè®®åœ¨info.plistä¸­è¿›è¡Œï¼Œç›´æ¥è®¾ç½®ä¸€ä¸‹ä¸‰ä¸ªå±æ€§çš„å€¼ï¼š
* Supported interface orientations (iPad)
* Supported interface orientations
* UIRequiresFullScreen</p>

<p>åœ¨Project->Target->General->Device Orientationä¸­è¿›è¡Œè®¾ç½®ï¼Œæœ‰ç‚¹è¿·æƒ‘æ€§ï¼šå› ä¸ºå³ä½¿â€œDeviceâ€é€‰çš„æ˜¯â€œUniversalâ€ï¼Œâ€œiPadâ€ä¸‹é¢çš„è®¾ç½®ä¹Ÿä¼šèµ·ä½œç”¨ã€‚</p></blockquote>

<h2>å‚è€ƒ</h2>

<ol>
<li><a href="https://mobiarch.wordpress.com/2017/04/22/controlling-screen-orientation-of-ios-apps/">Controlling Screen Orientation of iOS Apps</a></li>
<li><a href="https://stackoverflow.com/questions/32782044/ios-9-supportedinterfaceorientations-not-working/32782517#32782517">iOS 9 supportedInterfaceOrientations not working</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/QuickStartForSlideOverAndSplitView.html#//apple_ref/doc/uid/TP40015145-CH13-SW1">Slide Over and Split View Quick Start</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ¶æ„æ•´æ´ä¹‹é“æ€»ç»“ï¼ˆThe Clean Architectureï¼‰]]></title>
    <link href="http://hongchaozhang.github.io/blog/2019/02/12/reading-the-clean-architecture/"/>
    <updated>2019-02-12T17:55:48+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2019/02/12/reading-the-clean-architecture</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#%E6%80%BB%E4%BD%93%E6%84%9F%E6%83%B3">æ€»ä½“æ„Ÿæƒ³</a></li>
<li><a href="#%E7%AB%A0%E8%8A%82%E5%B0%8F%E7%BB%93">ç« èŠ‚å°ç»“</a>

<ul>
<li><a href="#%E7%AC%AC2%E7%AB%A0-%E4%B8%A4%E4%B8%AA%E4%BB%B7%E5%80%BC%E7%BB%B4%E5%BA%A6">ç¬¬2ç«  ä¸¤ä¸ªä»·å€¼ç»´åº¦</a></li>
<li><a href="#%E7%AC%AC14%E7%AB%A0-%E7%BB%84%E4%BB%B6%E8%80%A6%E5%90%88">ç¬¬14ç«  ç»„ä»¶è€¦åˆ</a></li>
<li><a href="#%E7%AC%AC15%E7%AB%A0-%E4%BB%80%E4%B9%88%E6%98%AF%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84">ç¬¬15ç«  ä»€ä¹ˆæ˜¯è½¯ä»¶æ¶æ„</a></li>
<li><a href="#%E7%AC%AC17%E7%AB%A0-%E5%88%92%E5%88%86%E8%BE%B9%E7%95%8C">ç¬¬17ç«  åˆ’åˆ†è¾¹ç•Œ</a></li>
<li><a href="#%E7%AC%AC21%E7%AB%A0-%E5%B0%96%E5%8F%AB%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84">ç¬¬21ç«  å°–å«çš„è½¯ä»¶æ¶æ„</a></li>
<li><a href="#%E7%AC%AC22%E7%AB%A0-%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84">ç¬¬22ç«  æ•´æ´æ¶æ„</a></li>
<li><a href="#%E7%AC%AC23%E7%AB%A0-%E5%B1%95%E7%A4%BA%E5%99%A8%E5%92%8C%E8%B0%A6%E5%8D%91%E5%AF%B9%E8%B1%A1">ç¬¬23ç«  å±•ç¤ºå™¨å’Œè°¦å‘å¯¹è±¡</a></li>
<li><a href="#%E7%AC%AC24%E7%AB%A0-%E4%B8%8D%E5%AE%8C%E5%85%A8%E8%BE%B9%E7%95%8C">ç¬¬24ç«  ä¸å®Œå…¨è¾¹ç•Œ</a></li>
<li><a href="#%E7%AC%AC25%E7%AB%A0-%E5%B1%82%E6%AC%A1%E4%B8%8E%E8%BE%B9%E7%95%8C">ç¬¬25ç«  å±‚æ¬¡ä¸è¾¹ç•Œ</a></li>
<li><a href="#%E7%AC%AC28%E7%AB%A0-%E6%B5%8B%E8%AF%95%E8%BE%B9%E7%95%8C">ç¬¬28ç«  æµ‹è¯•è¾¹ç•Œ</a></li>
<li><a href="#%E7%AC%AC34%E7%AB%A0-%E6%8B%BE%E9%81%97">ç¬¬34ç«  æ‹¾é—</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E5%AE%83%E4%BA%BA%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%BB%E5%90%8E%E6%80%BB%E7%BB%93">å…¶å®ƒäººçš„ä¸€äº›è¯»åæ€»ç»“</a>

<ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AF%B4%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%9B%BE">ä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬éœ€è¦è½¯ä»¶æ¶æ„å›¾ï¼Ÿ</a></li>
<li><a href="#%E6%8E%A8%E8%8D%90%E6%9E%B6%E6%9E%84%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93">æ¨èã€Šæ¶æ„æ•´æ´ä¹‹é“ã€‹</a></li>
</ul>
</li>
</ul>


<p><a id="markdown-æ€»ä½“æ„Ÿæƒ³" name="æ€»ä½“æ„Ÿæƒ³"></a></p>

<h2>æ€»ä½“æ„Ÿæƒ³</h2>

<p>å…¨ä¹¦ä¸‹æ¥ï¼Œå°è±¡æœ€æ·±ã€ä¸”æœ€å…·æœ‰æ“ä½œæ€§çš„ï¼Œå°±æ˜¯ï¼š</p>

<p><strong>ä¾èµ–åè½¬</strong></p>

<p>æºä»£ç ä¾èµ–æ–¹å‘æ°¸è¿œæ˜¯æ§åˆ¶æµæ–¹å‘çš„åè½¬ã€‚
ä¾èµ–å…³ç³»å¿…é¡»è¦æŒ‡å‘æ›´ç¨³å®šçš„æ–¹å‘ï¼šä½å±‚ç»„ä»¶ä¾èµ–é«˜å±‚ç»„ä»¶ï¼Œå…¶ä¸­ä½å±‚ç»„ä»¶ä¸ç¨³å®šï¼Œé«˜å±‚ç»„ä»¶ç¨³å®šã€‚
ä¾èµ–å…³ç³»åº”è¯¥æŒ‡å‘æ›´ç¨³å®šçš„æ–¹å‘ã€‚</p>

<p>ç¨³å®šæŠ½è±¡åŸåˆ™ï¼šä¸€ä¸ªç»„ä»¶çš„æŠ½è±¡ç¨‹åº¦åº”è¯¥ä¸å…¶ç¨³å®šæ€§ä¿æŒä¸€è‡´ã€‚</p>

<p>ç³»ç»Ÿçš„æŠ½è±¡ç¨‹åº¦å’Œç¨³å®šæ€§éƒ½å¯ä»¥é‡åŒ–ï¼Œè¿›è€Œç”¨æ¥è¯„æµ‹ç³»ç»Ÿçš„è´¨é‡ã€‚</p>

<p>ç³»ç»Ÿåœ¨è¿è¡Œæ—¶çš„ä¾èµ–å…³ç³»ä¸ç¼–è¯‘æ—¶çš„ä¾èµ–å…³ç³»æ˜¯ç›¸åçš„ï¼šå½“é«˜å±‚ç»„ä»¶çš„å®¢æˆ·ç«¯éœ€è¦è°ƒç”¨ä½å±‚ç»„ä»¶ä¸­çš„æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿ç”¨åŠ¨æ€å½¢å¼çš„å¤šæ€æ¥åè½¬ä¾èµ–å…³ç³»ã€‚ï¼ˆç¬¬18ç« ï¼‰</p>

<p>æˆ‘ä»¬å¸Œæœ›æºç ä¸­çš„ä¾èµ–å…³ç³»ä¸å…¶æ•°æ®æµå‘è„±é’©ï¼Œè€Œä¸ç»„ä»¶æ‰€åœ¨çš„å±‚æ¬¡æŒ‚é’©ã€‚é«˜å±‚ç»„ä»¶å˜æ›´çš„åŸå› å…·æœ‰â€œç¨€å°‘è€Œé‡å¤§â€çš„ç‰¹ç‚¹ï¼Œä½å±‚ç»„ä»¶å˜æ›´çš„åŸå› å…·æœ‰â€œé¢‘ç¹è€Œä¸é‡å¤§â€çš„ç‰¹ç‚¹ã€‚ï¼ˆç¬¬19ç« ï¼‰</p>

<p><a id="markdown-ç« èŠ‚å°ç»“" name="ç« èŠ‚å°ç»“"></a>
<a id="markdown-ç« èŠ‚å°ç»“" name="ç« èŠ‚å°ç»“"></a></p>

<h2>ç« èŠ‚å°ç»“</h2>

<p><a id="markdown-ç¬¬2ç« -ä¸¤ä¸ªä»·å€¼ç»´åº¦" name="ç¬¬2ç« -ä¸¤ä¸ªä»·å€¼ç»´åº¦"></a></p>

<h3>ç¬¬2ç«  ä¸¤ä¸ªä»·å€¼ç»´åº¦</h3>

<p>ç³»ç»Ÿè¡Œä¸ºï¼Œæ˜¯ç´§æ€¥çš„ã€‚</p>

<p>ç³»ç»Ÿæ¶æ„ï¼Œæ˜¯é‡è¦çš„ã€‚</p>

<p>å¹³è¡¡ç³»ç»Ÿæ¶æ„çš„é‡è¦æ€§ä¸åŠŸèƒ½çš„ç´§æ€¥ç¨‹åº¦è¿™ä»¶äº‹ï¼Œæ˜¯è½¯ä»¶ç ”å‘äººå‘˜è‡ªå·±çš„èŒè´£ã€‚å› ä¸ºä¸šåŠ¡éƒ¨é—¨æœ¬æ¥å°±æ²¡æœ‰èƒ½åŠ›è¯„ä¼°æ¶æ„è®¾è®¡çš„é‡è¦ç¨‹åº¦ã€‚</p>

<p>è¯·è®°ä½ï¼šå¦‚æœå¿½è§†è½¯ä»¶æ¶æ„çš„ä»·å€¼ï¼Œç³»ç»Ÿå°†ä¼šå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ï¼Œæœ€ç»ˆå†ä¹Ÿæ— æ³•ä¿®æ”¹ã€‚å¦‚æœç³»ç»Ÿå˜æˆäº†è¿™ä¸ªæ ·å­ï¼Œé‚£ä¹ˆè¯´æ˜è½¯ä»¶å¼€å‘å›¢é˜Ÿæ²¡æœ‰å’Œéœ€æ±‚æ–¹åšè¶³å¤Ÿçš„æŠ—äº‰ï¼Œæ²¡æœ‰å®Œæˆè‡ªå·±åº”å°½çš„èŒè´£ã€‚</p>

<p><a id="markdown-ç¬¬14ç« -ç»„ä»¶è€¦åˆ" name="ç¬¬14ç« -ç»„ä»¶è€¦åˆ"></a></p>

<h3>ç¬¬14ç«  ç»„ä»¶è€¦åˆ</h3>

<p>ç»„ä»¶ä¾èµ–å…³ç³»å›¾ä¸æ˜¯ç³»ç»ŸåŠŸèƒ½å•å…ƒå…³ç³»å›¾ï¼Œè€Œæ˜¯åº”ç”¨ç¨‹åºåœ¨æ„å»ºæ€§å’Œç»´æŠ¤æ€§æ–¹é¢çš„ä¸€å¼ åœ°å›¾ã€‚æ‰€ä»¥ç»„ä»¶ä¾èµ–å…³ç³»å›¾ä¸èƒ½åƒç³»ç»ŸåŠŸèƒ½å•å…ƒå…³ç³»å›¾ä¸€æ ·åœ¨è®¾è®¡ä¹‹åˆå°±ç¡®å®šä¸‹æ¥ï¼Œè€Œæ˜¯éšç€å¼€å‘è¿›ç¨‹ä¸­å‡ºç°çš„ç»´æŠ¤æ€§å’Œæ„å»ºæ€§çš„éœ€æ±‚è€Œäº§ç”Ÿçš„ã€‚</p>

<p><a id="markdown-ç¬¬15ç« -ä»€ä¹ˆæ˜¯è½¯ä»¶æ¶æ„" name="ç¬¬15ç« -ä»€ä¹ˆæ˜¯è½¯ä»¶æ¶æ„"></a></p>

<h3>ç¬¬15ç«  ä»€ä¹ˆæ˜¯è½¯ä»¶æ¶æ„</h3>

<p>å¦‚æœæƒ³è®¾è®¡ä¸€ä¸ªä¾¿äºæ¨è¿›å„é¡¹å·¥ä½œçš„ç³»ç»Ÿï¼Œå…¶ç­–ç•¥å°±æ˜¯è¦åœ¨è®¾è®¡ä¸­å°½å¯èƒ½é•¿æ—¶é—´åœ°ä¿ç•™å°½å¯èƒ½å¤šçš„é€‰é¡¹ã€‚</p>

<p>å¦‚æœåœ¨å¼€å‘é«˜å±‚ç­–ç•¥æ—¶æœ‰æ„è¯†åœ°è®©è‡ªå·±æ‘†è„±å…·ä½“ç»†èŠ‚çš„çº ç¼ ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸å…·ä½“å®ç°ç›¸å…³çš„ç»†èŠ‚å†³ç­–æ¨è¿Ÿæˆ–å»¶åï¼Œå› ä¸ºè¶Šåˆ°é¡¹ç›®çš„åæœŸï¼Œæˆ‘ä»¬å°±æ‹¥æœ‰è¶Šå¤šçš„ä¿¡æ¯æ¥åšå‡ºåˆç†çš„å†³ç­–ã€‚
å¦å¤–ï¼Œæˆ‘ä»¬ä¿ç•™è¿™äº›å¯é€‰é¡¹çš„æ—¶é—´è¶Šé•¿ï¼Œå®éªŒçš„æœºä¼šè¶Šå¤šï¼Œæˆ‘ä»¬åšå†³ç­–çš„æ—¶å€™å°±èƒ½æ‹¥æœ‰è¶Šå……åˆ†çš„ä¿¡æ¯ã€‚</p>

<p><strong>ä¸€ä¸ªä¼˜ç§€çš„è½¯ä»¶æ¶æ„å¸ˆåº”è¯¥è‡´åŠ›äºæœ€å¤§åŒ–å¯é€‰é¡¹æ•°é‡ã€‚</strong></p>

<p><a id="markdown-ç¬¬17ç« -åˆ’åˆ†è¾¹ç•Œ" name="ç¬¬17ç« -åˆ’åˆ†è¾¹ç•Œ"></a></p>

<h3>ç¬¬17ç«  åˆ’åˆ†è¾¹ç•Œ</h3>

<p>è½¯ä»¶æ¶æ„è®¾è®¡æœ¬èº«å°±æ˜¯ä¸€é—¨åˆ’åˆ†è¾¹ç•Œçš„è‰ºæœ¯ã€‚</p>

<p>ä¸€ä¸ªç³»ç»Ÿçš„GUIä¸ä¸šåŠ¡é€»è¾‘çš„å˜æ›´åŸå› ã€å˜æ›´é€Ÿç‡æ˜¾ç„¶æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥äºŒè€…ä¸­é—´åº”è¯¥æœ‰ä¸€æ¡è¾¹ç•Œã€‚åŒæ ·çš„ï¼Œä¸€ä¸ªç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘ä¸ä¾èµ–æ³¨å…¥æ¡†æ¶ä¹‹é—´çš„å˜æ›´åŸå› å’Œå˜æ›´é€Ÿç‡ä¹Ÿä¼šä¸åŒï¼Œå®ƒä»¬ä¹‹é—´ä¹Ÿåº”è¯¥ç”»è¾¹ç•Œçº¿ã€‚</p>

<p>è¿™å…¶å®å°±æ˜¯å•ä¸€æŒ‡è´£åŸåˆ™ï¼ˆSRPï¼‰çš„å…·ä½“å®ç°ã€‚SRPçš„ä½œç”¨å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬åº”è¯¥åœ¨å“ªé‡Œç”»è¾¹ç•Œçº¿ã€‚</p>

<p><strong>æ’ä»¶å¼æ¶æ„</strong></p>

<p>äº‹å®ä¸Šï¼Œè½¯ä»¶å¼€å‘æŠ€æœ¯å‘å±•çš„å†å²å°±æ˜¯ä¸€ä¸ªå¦‚ä½•æƒ³æ–¹è®¾æ³•æ–¹ä¾¿åœ°å¢åŠ æ’ä»¶ï¼Œä»è€Œæ„å»ºä¸€ä¸ªå¯æ‰©å±•ã€å¯ç»´æŠ¤çš„ç³»ç»Ÿæ¶æ„çš„æ•…äº‹ã€‚</p>

<p><a id="markdown-ç¬¬21ç« -å°–å«çš„è½¯ä»¶æ¶æ„" name="ç¬¬21ç« -å°–å«çš„è½¯ä»¶æ¶æ„"></a></p>

<h3>ç¬¬21ç«  å°–å«çš„è½¯ä»¶æ¶æ„</h3>

<p>æ¶æ„è®¾è®¡çš„æ ¸å¿ƒç›®æ ‡ï¼š</p>

<p>ä¸€ä¸ªè‰¯å¥½çš„æ¶æ„è®¾è®¡åº”è¯¥å›´ç»•ç”¨ä¾‹æ¥å±•å¼€ï¼Œè¿™æ ·çš„æ¶æ„è®¾è®¡å¯ä»¥åœ¨è„±ç¦»æ¡†æ¶ã€å·¥å…·ä»¥åŠä½¿ç”¨ç¯å¢ƒçš„æƒ…å†µä¸‹å®Œæ•´åœ°æè¿°ç”¨ä¾‹ã€‚</p>

<blockquote><p>è¿™å°±å¥½åƒä¸€ä¸ªä½å®…å»ºç­‘è®¾è®¡çš„é¦–è¦ç›®çš„åº”è¯¥æ˜¯æ»¡è¶³ä½å®…çš„ä½¿ç”¨éœ€æ±‚ï¼Œè€Œä¸æ˜¯ç¡®ä¿ä¸€å®šè¦ç”¨ç –æ¥æ„å»ºè¿™ä¸ªæˆ¿å­ã€‚æ¶æ„å¸ˆåº”è¯¥èŠ±è´¹å¾ˆå¤šç²¾åŠ›æ¥ç¡®ä¿è¯¥æ¶æ„çš„è®¾è®¡åœ¨æ»¡è¶³ç”¨ä¾‹éœ€è¦çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½åœ°å…è®¸ç”¨æˆ·èƒ½è‡ªç”±åœ°é€‰æ‹©å»ºç­‘ææ–™ï¼ˆç –å¤´ã€çŸ³æ–™æˆ–è€…æœ¨æï¼‰ã€‚</p></blockquote>

<p>è€Œä¸”ï¼Œè‰¯å¥½çš„æ¶æ„è®¾è®¡åº”è¯¥å°½å¯èƒ½åœ°å…è®¸ç”¨æˆ·æ¨è¿Ÿå’Œå»¶åå†³å®šé‡‡ç”¨ä»€ä¹ˆæ¡†æ¶ã€æ•°æ®åº“ã€WebæœåŠ¡ä»¥åŠå…¶å®ƒä¸ç¯å¢ƒç›¸å…³çš„å·¥å…·ã€‚åŒæ—¶ï¼Œè‰¯å¥½çš„æ¶æ„è®¾è®¡è¿˜åº”è¯¥è®©æˆ‘ä»¬å¾ˆå®¹æ˜“æ”¹å˜è¿™äº›å†³å®šã€‚</p>

<p>æ€»ä¹‹ï¼Œè‰¯å¥½çš„æ¶æ„è®¾è®¡åº”è¯¥åªå…³æ³¨ç”¨ä¾‹ï¼Œå¹¶èƒ½å°†å®ƒä»¬ä¸å…¶ä»–çš„å‘¨è¾¹å› ç´ éš”ç¦»ã€‚</p>

<p><a id="markdown-ç¬¬22ç« -æ•´æ´æ¶æ„" name="ç¬¬22ç« -æ•´æ´æ¶æ„"></a></p>

<h3>ç¬¬22ç«  æ•´æ´æ¶æ„</h3>

<p>æ•´æœ¬ä¹¦çš„æ ¸å¿ƒæ€»ç»“ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/CleanArchitecture22fig01.jpg" alt="clean architecture image" /></p>

<p>ä»£ç ä¸­çš„ä¾èµ–å…³ç³»å¿…é¡»æŒ‡å‘åŒå¿ƒåœ†çš„å†…å±‚ï¼Œå³ç”±ä½å±‚æœºåˆ¶æŒ‡å‘é«˜å±‚æœºåˆ¶ã€‚</p>

<p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­å°±ä¸¥æ ¼åœ°éµå®ˆäº†ä¾èµ–å€’ç½®åŸåˆ™ï¼ŒåŒæ—¶ä¹Ÿå°±éµå®ˆäº†ä¸Šé¢çš„è®¾è®¡åŸåˆ™ï¼šä¾èµ–å…³ç³»æŒ‡å‘åŒå¿ƒåœ†çš„å†…å±‚ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/CleanArchitecture22fig02.jpg" alt="clean architecture example" /></p>

<p><a id="markdown-ç¬¬23ç« -å±•ç¤ºå™¨å’Œè°¦å‘å¯¹è±¡" name="ç¬¬23ç« -å±•ç¤ºå™¨å’Œè°¦å‘å¯¹è±¡"></a></p>

<h3>ç¬¬23ç«  å±•ç¤ºå™¨å’Œè°¦å‘å¯¹è±¡</h3>

<p>åº”ç”¨ç¨‹åºæ‰€èƒ½æ§åˆ¶çš„ï¼Œè¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„ä¸€åˆ‡ä¸œè¥¿ï¼Œéƒ½åº”è¯¥åœ¨è§†å›¾æ¨¡å‹ä¸­ä»¥å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼æˆ–è€…æšä¸¾ç±»å‹çš„å½¢å¼å­˜åœ¨ã€‚ç„¶åï¼Œè§†å›¾éƒ¨åˆ†é™¤äº†åŠ è½½è§†å›¾æ¨¡å‹æ‰€éœ€è¦çš„å€¼ï¼Œä¸åº”è¯¥å†åšä»»ä½•å…¶ä»–äº‹æƒ…ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ‰èƒ½è¯´è§†å›¾æ˜¯è°¦å‘å¯¹è±¡ã€‚</p>

<blockquote><p>è¿™é‡Œçš„è§†å›¾æœ‰ç‚¹åƒReduxæ¨¡å¼ä¸‹çš„Viewäº†ï¼šåªè´Ÿè´£å¿ å®åœ°å°†Modelå±•ç°å‡ºæ¥ã€‚</p></blockquote>

<p><a id="markdown-ç¬¬24ç« -ä¸å®Œå…¨è¾¹ç•Œ" name="ç¬¬24ç« -ä¸å®Œå…¨è¾¹ç•Œ"></a></p>

<h3>ç¬¬24ç«  ä¸å®Œå…¨è¾¹ç•Œ</h3>

<p>ç”¨äºç®¡ç†è¾“å…¥è¾“å‡ºæ•°æ®ç»“æ„çš„åŒå‘å¤šæ€è¾¹ç•Œæ¥å£ï¼Œä»¥åŠä¾èµ–åè½¬å…³ç³»çš„ç®¡ç†éƒ½éœ€è¦è€—è´¹èµ„æºã€‚æŸäº›æƒ…å†µä¸‹å¯ä»¥é‡‡ç”¨ä¸€äº›æŠ˜ä¸­æ–¹æ¡ˆï¼Œé‡‡ç”¨æŸç§ä¸å®Œå…¨è¾¹ç•Œï¼šå•å‘è¾¹ç•Œã€é—¨æˆ·æ¨¡å¼ã€çœæ‰æœ€åä¸€æ­¥â€¦ã€‚</p>

<p><a id="markdown-ç¬¬25ç« -å±‚æ¬¡ä¸è¾¹ç•Œ" name="ç¬¬25ç« -å±‚æ¬¡ä¸è¾¹ç•Œ"></a></p>

<h3>ç¬¬25ç«  å±‚æ¬¡ä¸è¾¹ç•Œ</h3>

<p>â€œä¸­åº¸â€ä¹‹é“ï¼š
è¿‡åº¦è®¾è®¡è¾¹ç•Œä¸å¯¹ï¼Œä¸€ç‚¹ä¸è®¾è®¡ä¹Ÿæ˜¯ä¸åˆç†çš„ï¼Œæˆ‘ä»¬èƒ½åšçš„å°±æ˜¯ä¸æ–­è§‚å¯Ÿç³»ç»Ÿæ¼”è¿›ï¼Œæƒè¡¡å„ä¸ªä½ç½®è®¾è®¡è¾¹ç•Œçš„æˆæœ¬ä¸æ”¶ç›Šã€‚</p>

<p><a id="markdown-ç¬¬28ç« -æµ‹è¯•è¾¹ç•Œ" name="ç¬¬28ç« -æµ‹è¯•è¾¹ç•Œ"></a></p>

<h3>ç¬¬28ç«  æµ‹è¯•è¾¹ç•Œ</h3>

<p>æµ‹è¯•ï¼š
é’ˆå¯¹ç³»ç»Ÿç»„æˆéƒ¨åˆ†æ¥è®¾è®¡çš„æµ‹è¯•æ˜¯ç´§è€¦åˆçš„ï¼Œæ¯”å¦‚é’ˆå¯¹æ¯ä¸ªç±»çš„æ¯ä¸ªæ–¹æ³•è¿›è¡Œçš„æµ‹è¯•ã€‚æœ€ç»ˆè¿™äº›æµ‹è¯•éƒ½ä¼šè¢«æŠ›å¼ƒã€‚</p>

<p>ä¸è¦ä¾èµ–äºå¤šå˜çš„ä¸œè¥¿ã€‚æ¯”å¦‚GUIä¸€èˆ¬æ˜¯å¤šå˜çš„ï¼Œé€šè¿‡GUIæ¥éªŒè¯ç³»ç»Ÿçš„æµ‹è¯•ä¸€å®šæ˜¯è„†å¼±çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç³»ç»Ÿè®¾è®¡ä¸æµ‹è¯•è®¾è®¡æ—¶ï¼Œåº”è¯¥è®©ä¸šåŠ¡é€»è¾‘ä¸é€šè¿‡GUIä¹Ÿèƒ½è¢«æµ‹è¯•ã€‚
æ€ä¹ˆåšï¼šè®©GUIæˆä¸ºâ€œè°¦å‘å¯¹è±¡â€ï¼Œåªæ˜¯å¿ å®åœ°ååº”ä¸€äº›æ•°æ®ï¼ˆReduxæ¨¡å¼ï¼‰ã€‚</p>

<p><a id="markdown-ç¬¬34ç« -æ‹¾é—" name="ç¬¬34ç« -æ‹¾é—"></a></p>

<h3>ç¬¬34ç«  æ‹¾é—</h3>

<p>è¿™ä¸€ç« ä¸­ï¼Œä½œè€…æåˆ°äº†ä¸€ä¸ªé‡è¦çš„å®ç°ç»†èŠ‚é—®é¢˜ï¼šè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼ˆpublicã€privateç­‰ï¼‰ï¼Œä»¥åŠè¯¥ç»†èŠ‚å¯¹æ•´ä½“è®¾è®¡æ¶æ„çš„å½±å“ã€‚</p>

<p>ä»¥ç½‘ä¸Šä¹¦åº—ä¸ºä¾‹ï¼Œä½œè€…æŒ‰ç…§å››ç§æ–¹æ³•è¯•å›¾å¯¹ç³»ç»Ÿè¿›è¡Œæ¨¡å—åŒ–ï¼šæŒ‰å±‚å°è£…ï¼ŒæŒ‰åŠŸèƒ½å°è£…ï¼Œç«¯å£å’Œé€‚é…å™¨å°è£…ï¼ŒæŒ‰ç»„ä»¶å°è£…ã€‚æ¯ç§æ¨¡å¼éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œä½†æ˜¯è¿™ä¸æ˜¯é—®é¢˜çš„é‡ç‚¹ã€‚é‡ç‚¹æ˜¯ï¼šå¦‚æœä½ åœ¨å®ç°å„ä¸ªæ¨¡å¼çš„æ—¶å€™ï¼Œä¸èƒ½ä¸¥æ ¼ç¡®å®šæ¯ä¸ªå˜é‡å’Œæ–¹æ³•çš„è®¿é—®æƒé™ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è®¾è®¡éƒ½ç­‰äºâ€œæ²¡æœ‰è®¾è®¡â€ã€‚</p>

<p>å››ç§è®¾è®¡æ¨¡å¼å›¾åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/CleanArchitecture34fig08.jpg" alt="model with access control attributes" /></p>

<p>å…¶ä¸­è™šåŒ–çš„éƒ¨åˆ†ä»£è¡¨åªå¯åœ¨æœ¬åŒ…å†…å¯è§çš„éƒ¨åˆ†ã€‚</p>

<p>å¦‚æœä¸èƒ½ä¸¥æ ¼ä½¿ç”¨è®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆç†æƒ³ä¸­çš„æ¨¡å—åŒ–å°†ä¼šå‘ç”Ÿå˜åŒ–ã€‚æç«¯ä¸€ç‚¹ï¼Œå¦‚æœæ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯publicï¼Œé‚£ä¹ˆè¿™å››ç§æ¨¡å¼å°†å˜æˆä¸‹é¢çš„æ ·å­ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/CleanArchitecture34fig07.jpg" alt="model with access control attributes" /></p>

<p><strong>å››ç§æ¨¡å¼å°†å®Œå…¨ä¸€æ ·ï¼å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯ç”±äºæˆ‘ä»¬æ²¡æœ‰ä¸¥æ ¼åœ°ä½¿ç”¨è®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼</strong></p>

<p><a id="markdown-å…¶å®ƒäººçš„ä¸€äº›è¯»åæ€»ç»“" name="å…¶å®ƒäººçš„ä¸€äº›è¯»åæ€»ç»“"></a>
<a id="markdown-å…¶å®ƒäººçš„ä¸€äº›è¯»åæ€»ç»“" name="å…¶å®ƒäººçš„ä¸€äº›è¯»åæ€»ç»“"></a></p>

<h2>å…¶å®ƒäººçš„ä¸€äº›è¯»åæ€»ç»“</h2>

<p><a id="markdown-ä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬éœ€è¦è½¯ä»¶æ¶æ„å›¾" name="ä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬éœ€è¦è½¯ä»¶æ¶æ„å›¾"></a>
<a id="markdown-ä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬éœ€è¦è½¯ä»¶æ¶æ„å›¾httpswwwinfoqcnarticleghprruloyyoqs8fr1ph" name="ä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬éœ€è¦è½¯ä»¶æ¶æ„å›¾httpswwwinfoqcnarticleghprruloyyoqs8fr1ph"></a></p>

<h3><a href="https://www.infoq.cn/article/GhprrUlOYyOqS8*FR1pH">ä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬éœ€è¦è½¯ä»¶æ¶æ„å›¾ï¼Ÿ</a></h3>

<p>è¿™ç¯‡æ–‡ç« ä¸­è‚¯ã€å®ç”¨ï¼Œæå‡ºçš„ä¸€äº›è§‚ç‚¹å…·æœ‰å¾ˆå¤§çš„å¯æ“ä½œæ€§ï¼š
1. æˆ‘ä»¬å¸¸çŠ¯çš„æœ€å¤§çš„ä¸€ä¸ªé”™è¯¯æ˜¯ä¸ºç³»ç»Ÿä¸­å…·æœ‰é«˜æ³¢åŠ¨æ€§çš„éƒ¨åˆ†åˆ›å»ºè¯¦ç»†çš„æ¶æ„å›¾ã€‚é™¤éæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¦åˆ™æ‰‹åŠ¨ç»´æŠ¤å®ƒä»¬å¯¹æˆ‘ä»¬æ¥è¯´å°±æ˜¯ä¸€ç§è´Ÿæ‹…ã€‚
2. åœ¨å®è·µä¸­ï¼Œå¤§å¤šæ•°åˆ©ç›Šç›¸å…³è€…å¯¹è¯¦ç»†æ¶æ„å›¾ä¸æ„Ÿå…´è¶£ï¼Œä½†ä¼šå¯¹ä¸€ä¸¤ä¸ªåæ˜ ç³»ç»Ÿæ¨¡å—å’Œè¾¹ç•Œçš„é«˜çº§æ¶æ„å›¾æ„Ÿå…´è¶£ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¦æ·±å…¥ç†è§£ç³»ç»Ÿï¼Œä»£ç æ‰æ˜¯äº‹å®çš„æ¥æºã€‚
3. è¯·åœæ­¢ä¸ºä»£ç ä¸­è‡ªè§£é‡Šçš„å†…å®¹åˆ›å»ºè¯¦ç»†çš„æ¶æ„å›¾ï¼Œæˆ–è€…å½“æ²¡æœ‰çœŸæ­£å—ä¼—æ—¶ã€‚
4. ç›´æ¥è¯¢é—®åˆ©ç›Šç›¸å…³è€…ï¼šä½ ä»¬å¸Œæœ›ä»æ–‡æ¡£ä¸­è·å¾—ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</p>

<p><a id="markdown-æ¨èæ¶æ„æ•´æ´ä¹‹é“" name="æ¨èæ¶æ„æ•´æ´ä¹‹é“"></a>
<a id="markdown-æ¨èæ¶æ„æ•´æ´ä¹‹é“httpsblogcsdnnetcsdnsevennarticledetails83189597" name="æ¨èæ¶æ„æ•´æ´ä¹‹é“httpsblogcsdnnetcsdnsevennarticledetails83189597"></a></p>

<h3><a href="https://blog.csdn.net/csdnsevenn/article/details/83189597">æ¨èã€Šæ¶æ„æ•´æ´ä¹‹é“ã€‹</a></h3>

<p>ç®€å•vs.ç®€é™‹ã€å¹³è¡¡vs.å¦¥åã€è¿­ä»£vs.åŠæˆå“</p>

<p>è¿™äº›æ‹¥æœ‰å·¥åŒ ç²¾ç¥çš„å·¥ç¨‹å¸ˆä»¬è¿˜æ˜¯éš¾ä»¥è§£å†³æŸäº›é—®é¢˜ï¼Œè¿™äº›äººæ¸æ¸åœ°å‘ç°ï¼Œè¿™ä¸ªä¸–ç•Œä¸Šæœ‰å¾ˆå¤šé—®é¢˜å°±åƒç¿˜ç¿˜æ¿ä¸€æ ·ï¼Œåªèƒ½è¦ä¸€è¾¹ï¼Œè¿™ä¸€è¾¹ä¸Šå»äº†ï¼Œå¦ä¸€è¾¹å°±ä¸‹æ¥äº†ã€‚å°±åƒè¦ä¹ˆç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œè¦ä¹ˆç”¨æ—¶é—´æ¢ç©ºé—´ä¸€æ ·ï¼Œä½ å¾ˆéš¾æ‰¾åˆ°åŒæ—¶æ»¡è¶³ç©ºé—´å’Œæ—¶é—´è¦æ±‚çš„â€œåŒåˆ©è§£â€ï¼›å°±åƒCAPçš„ä¸‰é€‰äºŒçš„ç†è®ºä¸€æ ·ï¼Œè¿™ä¸ªä¸–ç•Œä¸å­˜åœ¨å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œæ— è®ºä»€ä¹ˆæ–¹æ¡ˆéƒ½æœ‰å¥½çš„ä¸€é¢å’Œä¸å¥½çš„ä¸€é¢ã€‚è€Œä¸”ï¼Œè¿™äº›å·¥ç¨‹å¸ˆè¿˜æ¸æ¸å‘ç°ï¼Œæ¯å½“å¼•å…¥ä¸€ä¸ªæ–°çš„æŠ€æœ¯æ¥è§£å†³ä¸€ä¸ªå·²æœ‰çš„é—®é¢˜æ—¶ï¼Œè¿™ä¸ªæ–°çš„æŠ€æœ¯å°±ä¼šå¸¦æ¥æ›´å¤šçš„é—®é¢˜ï¼Œé—®é¢˜å°±åƒæœ‰ä¸€ä¸ªç”Ÿå‘½ä½“ä¸€æ ·ï¼Œå®ƒä»¬ä¼šä¸æ–­åœ°ç¹æ®–å’Œè¿›åŒ–ã€‚æ¸æ¸åœ°ï¼Œä»–ä»¬å‘ç°ï¼Œé—®é¢˜çš„å¤šå°‘å’Œç³»ç»Ÿçš„å¤æ‚åº¦å‘ˆæ­£æ¯”ï¼Œè€Œä¸”ä¸ä»…æ˜¯çº¿æ€§æ­£æ¯”ï¼Œè¿˜å¯èƒ½å‘ˆçº§æ•°æ­£æ¯”ï¼Œæ­¤æ—¶å°±è¶Šæ¥è¶Šéš¾åšæŠ€æœ¯å†³å®šã€‚ä½†æ˜¯æœ‰ä¸€äº›èµ„æ·±çš„å·¥ç¨‹å¸ˆå¼€å§‹ç«™å‡ºæ¥æŒ‘æˆ˜è¿™äº›é—®é¢˜ï¼Œæœ‰çš„åŸºäºä¸šåŠ¡åˆ†æç»™å‡ºå¹³è¡¡çš„æ–¹æ¡ˆï¼Œæœ‰çš„å¼€å§‹å°è¯•è®¾è®¡æ›´é«˜çº§çš„æŠ€æœ¯ï¼Œæœ‰çš„å¼€å§‹è®¾è®¡æ›´çµæ´»çš„ç³»ç»Ÿï¼Œæœ‰çš„åˆ™å¼€å§‹ç®€åŒ–å’Œè½»é‡åŒ–æ•´ä¸ªç³»ç»Ÿâ€¦â€¦è¿™äº›é«˜æ™ºå•†ã€ç»éªŒè¶³ã€ä¸æ€•éš¾çš„å·¥ç¨‹å¸ˆä»¬å¼•é¢†ç€æ•´ä¸ªè¡Œä¸šå‰è¡Œã€‚ä»–ä»¬å°±æ˜¯æ¶æ„å¸ˆï¼</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¼–ç¨‹ä¸­çš„SOLIDåŸåˆ™]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/12/04/solid-principles-while-programming/"/>
    <updated>2018-12-04T11:31:35+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/12/04/solid-principles-while-programming</id>
    <content type="html"><![CDATA[<p>Robert C. Martin (Bobå¤§å”)åœ¨ã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹ä¸­æå‡ºäº†ç¼–ç¨‹è¿‡ç¨‹ä¸­çš„äº”ä¸ªåŸåˆ™ï¼Œä»¥é€‚åº”æ•æ·å¼€å‘ï¼ˆAgileï¼‰çš„ç‰¹ç‚¹ï¼šä»¥å¾®å°å¢é‡çš„æ–¹å¼æ„å»ºè½¯ä»¶ã€‚</p>

<!-- more -->


<p><br></p>

<ul>
<li><a href="#solid%E5%8E%9F%E5%88%99">SOLIDåŸåˆ™</a></li>
<li><a href="#%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99the-single-responsibility-principle%E7%AE%80%E7%A7%B0srp">å•ä¸€èŒè´£åŸåˆ™ï¼ˆThe Single Responsibility Principleï¼Œç®€ç§°SRPï¼‰</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89">å®šä¹‰</a></li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%81%8C%E8%B4%A3">ä»€ä¹ˆæ˜¯èŒè´£</a></li>
<li><a href="#%E7%BB%93%E8%AE%BA">ç»“è®º</a></li>
</ul>
</li>
<li><a href="#%E5%BC%80%E6%94%BE%E5%B0%81%E9%97%AD%E5%8E%9F%E5%88%99the-open-close-principle%E7%AE%80%E7%A7%B0ocp">å¼€æ”¾â€”â€”å°é—­åŸåˆ™ï¼ˆThe Open-Close Principleï¼Œç®€ç§°OCPï¼‰</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-1">å®šä¹‰</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E6%98%AF%E6%8A%BD%E8%B1%A1">å…³é”®æ˜¯æŠ½è±¡</a>

<ul>
<li><a href="#%E6%8E%A5%E5%8F%A3">æ¥å£</a></li>
<li><a href="#%E7%BB%A7%E6%89%BF">ç»§æ‰¿</a></li>
</ul>
</li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1">ä»€ä¹ˆæ—¶å€™è¿›è¡ŒæŠ½è±¡</a></li>
<li><a href="#%E7%BB%93%E8%AE%BA-1">ç»“è®º</a></li>
</ul>
</li>
<li><a href="#liskov%E6%9B%BF%E6%8D%A2%E5%8E%9F%E5%88%99the-liskov-substitution-priciple%E7%AE%80%E7%A7%B0lsp">Liskovæ›¿æ¢åŸåˆ™ï¼ˆThe Liskov Substitution Pricipleï¼Œç®€ç§°LSPï¼‰</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-2">å®šä¹‰</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E8%BF%9D%E5%8F%8Dlsp%E7%9A%84%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90">ä¸€ä¸ªè¿åLSPçš„ç®€å•ä¾‹å­</a></li>
<li><a href="#%E6%AD%A3%E6%96%B9%E5%BD%A2%E5%92%8C%E9%95%BF%E6%96%B9%E5%BD%A2%E7%9A%84%E5%85%B3%E7%B3%BB%E6%9B%B4%E5%BE%AE%E5%A6%99%E7%9A%84%E8%BF%9D%E8%A7%84">æ­£æ–¹å½¢å’Œé•¿æ–¹å½¢çš„å…³ç³»ï¼šæ›´å¾®å¦™çš„è¿è§„</a></li>
<li><a href="#%E5%85%B6%E5%AE%83%E4%B8%80%E4%BA%9B%E5%AE%B9%E6%98%93%E5%AF%BC%E8%87%B4%E8%BF%9D%E5%8F%8Dlsp%E7%9A%84%E4%B9%A0%E6%83%AF%E7%94%A8%E6%B3%95">å…¶å®ƒä¸€äº›å®¹æ˜“å¯¼è‡´è¿åLSPçš„ä¹ æƒ¯ç”¨æ³•</a>

<ul>
<li><a href="#%E5%AD%90%E7%B1%BB%E4%B8%AD%E7%9A%84%E9%80%80%E5%8C%96%E5%87%BD%E6%95%B0">å­ç±»ä¸­çš„é€€åŒ–å‡½æ•°</a></li>
<li><a href="#%E5%AD%90%E7%B1%BB%E6%8A%9B%E5%87%BA%E5%9F%BA%E7%B1%BB%E6%B2%A1%E6%9C%89%E7%9A%84%E5%BC%82%E5%B8%B8">å­ç±»æŠ›å‡ºåŸºç±»æ²¡æœ‰çš„å¼‚å¸¸</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E8%AE%BA-2">ç»“è®º</a></li>
</ul>
</li>
<li><a href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99the-dependency-inversion-principle%E7%AE%80%E7%A7%B0dip">ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆThe Dependency Inversion Principleï¼Œç®€ç§°DIPï¼‰</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-3">å®šä¹‰</a></li>
<li><a href="#%E4%BE%9D%E8%B5%96%E4%BA%8E%E6%8A%BD%E8%B1%A1">ä¾èµ–äºæŠ½è±¡</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90">ä¸€ä¸ªä¾‹å­</a></li>
<li><a href="#%E7%BB%93%E8%AE%BA-3">ç»“è®º</a></li>
</ul>
</li>
<li><a href="#%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99the-interface-segregation-principle%E7%AE%80%E7%A7%B0isp">æ¥å£éš”ç¦»åŸåˆ™ï¼ˆThe Interface Segregation Principleï¼Œç®€ç§°ISPï¼‰</a>

<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-4">å®šä¹‰</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90%E5%AE%9A%E6%97%B6%E9%97%A8">ä¸€ä¸ªä¾‹å­ï¼šå®šæ—¶é—¨</a>

<ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%A7%94%E6%89%98%E5%AF%B9%E6%8E%A5%E5%8F%A3%E5%88%86%E7%BB%84">ä½¿ç”¨å§”æ‰˜å¯¹æ¥å£åˆ†ç»„</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF%E5%AF%B9%E6%8E%A5%E5%8F%A3%E5%88%86%E7%BB%84">ä½¿ç”¨å¤šé‡ç»§æ‰¿å¯¹æ¥å£åˆ†ç»„</a></li>
</ul>
</li>
<li><a href="#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90atm%E7%95%8C%E9%9D%A2">ä¸€ä¸ªä¾‹å­ï¼šATMç•Œé¢</a>

<ul>
<li><a href="#%E5%A4%9A%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F%E4%B8%8E%E5%8D%95%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F">å¤šå‚æ•°å½¢å¼ä¸å•å‚æ•°å½¢å¼</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E8%AE%BA-4">ç»“è®º</a></li>
</ul>
</li>
</ul>


<p> <br></p>

<p><a id="markdown-solidåŸåˆ™" name="solidåŸåˆ™"></a></p>

<h2>SOLIDåŸåˆ™</h2>

<p>SOLIDæ˜¯æŒ‡æˆ‘ä»¬ç¼–ç¨‹æ—¶åº”è¯¥éµå®ˆçš„äº”ä¸ªåŸåˆ™ï¼š</p>

<ol>
<li>å•ä¸€èŒè´£åŸåˆ™ï¼ˆThe Single Responsibility Principleï¼Œç®€ç§°SRPï¼‰</li>
<li>å¼€æ”¾â€”â€”å°é—­åŸåˆ™ï¼ˆThe Open-Close Principleï¼Œç®€ç§°OCPï¼‰</li>
<li>Liskovæ›¿æ¢åŸåˆ™ï¼ˆThe Liskov Substitution Pricipleï¼Œç®€ç§°LSPï¼‰</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆThe Dependency Inversion Principleï¼Œç®€ç§°DIPï¼‰</li>
<li>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆThe Interface Segregation Principleï¼Œç®€ç§°ISPï¼‰</li>
</ol>


<p>æ¯ä¸ªåŸåˆ™å–ä¸€ä¸ªå­—æ¯ï¼ˆ<strong>S</strong>RPï¼Œ<strong>O</strong>CPï¼Œ<strong>L</strong>SPï¼Œ<strong>I</strong>SPï¼Œ<strong>D</strong>IPï¼‰ï¼Œåˆç§°SOLIDåŸåˆ™ã€‚</p>

<p><a id="markdown-å•ä¸€èŒè´£åŸåˆ™the-single-responsibility-principleç®€ç§°srp" name="å•ä¸€èŒè´£åŸåˆ™the-single-responsibility-principleç®€ç§°srp"></a></p>

<h2>å•ä¸€èŒè´£åŸåˆ™ï¼ˆThe Single Responsibility Principleï¼Œç®€ç§°SRPï¼‰</h2>

<p><a id="markdown-å®šä¹‰" name="å®šä¹‰"></a></p>

<h3>å®šä¹‰</h3>

<p><strong>å°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚</strong></p>

<p>ä¸€ä¸ªç±»å¦‚æœæœ‰å¤šä¸ªèŒè´£ï¼Œä½†æ˜¯ä½ åªéœ€è¦å…¶ä¸­çš„ä¸€ä¸ªèŒè´£ï¼Œä½ ä¹Ÿä¸å¾—ä¸å°†å…¶å®ƒèŒè´£åŒ…æ‹¬è¿›æ¥ï¼Œè¿˜æœ‰å…¶å®ƒèŒè´£æ‰€ä¾èµ–çš„æ‰€æœ‰ç»„ä»¶ã€‚</p>

<p><a id="markdown-ä»€ä¹ˆæ˜¯èŒè´£" name="ä»€ä¹ˆæ˜¯èŒè´£"></a></p>

<h3>ä»€ä¹ˆæ˜¯èŒè´£</h3>

<p>åœ¨SRPä¸­ï¼Œæˆ‘ä»¬æŠŠèŒè´£å®šä¹‰ä¸ºâ€œå˜åŒ–çš„åŸå› â€ï¼ˆa reason for changeï¼‰ã€‚å¦‚æœèƒ½å¤Ÿæƒ³åˆ°å¤šäºä¸€ä¸ªçš„åŠ¨æœºå»æ”¹å˜ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±å…·æœ‰å¤šäºä¸€ä¸ªçš„èŒè´£ã€‚</p>

<p>æ¯”å¦‚Employeeè¿™ä¸ªç±»å¦‚æœåŒæ—¶åŒ…å«äº†ä¸šåŠ¡è§„åˆ™å’Œå¯¹äºæŒä¹…åŒ–çš„æ§åˆ¶ï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ–­å®šå®ƒä»¬ä¸åº”è¯¥æ”¾åœ¨ä¸€èµ·ï¼šä¸šåŠ¡è§„åˆ™ä¼šé¢‘ç¹åœ°å˜åŒ–ï¼Œä½†æ˜¯æŒä¹…åŒ–çš„æ–¹å¼å´ä¸ä¼šå¦‚æ­¤é¢‘ç¹åœ°å˜åŒ–ï¼Œå¹¶ä¸”å˜åŒ–çš„åŸå› ä¹Ÿæ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p>

<p><a id="markdown-ç»“è®º" name="ç»“è®º"></a></p>

<h3>ç»“è®º</h3>

<p>SRPæ˜¯æ‰€æœ‰åŸåˆ™ä¸­æœ€ç®€å•çš„ï¼Œä¹Ÿæ˜¯æœ€éš¾è¿ç”¨çš„ã€‚è½¯ä»¶è®¾è®¡å¾ˆå¤šæ—¶å€™è¦åšçš„ï¼Œå°±æ˜¯å‘ç°èŒè´£ï¼Œå¹¶æŠŠå®ƒåˆ†ç¦»å‡ºæ¥ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å°†è¦è®ºè¿°çš„å…¶å®ƒåŸåˆ™éƒ½ä¼šä»¥è¿™æ ·æˆ–è€…é‚£æ ·çš„æ–¹å¼å›åˆ°è¿™ä¸ªé—®é¢˜ä¸Šã€‚</p>

<p><a id="markdown-å¼€æ”¾å°é—­åŸåˆ™the-open-close-principleç®€ç§°ocp" name="å¼€æ”¾å°é—­åŸåˆ™the-open-close-principleç®€ç§°ocp"></a></p>

<h2>å¼€æ”¾â€”â€”å°é—­åŸåˆ™ï¼ˆThe Open-Close Principleï¼Œç®€ç§°OCPï¼‰</h2>

<p><a id="markdown-å®šä¹‰-1" name="å®šä¹‰-1"></a></p>

<h3>å®šä¹‰</h3>

<p><strong>è½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥æ˜¯å¯ä»¥æ‰©å±•ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚</strong></p>

<p>OCPçš„å®šä¹‰ï¼Œæ¢ä¸ªè¯´æ³•ï¼š</p>

<ul>
<li>å¯¹æ‰©å±•å¼€æ”¾ï¼ˆOpen for extensionï¼‰</li>
<li>å¯¹ä¿®æ”¹å°é—­ï¼ˆClose for modificationï¼‰</li>
</ul>


<p>å¦‚æœç¨‹åºä¸­çš„ä¸€å¤„æ”¹åŠ¨å°±ä¼šäº§ç”Ÿè¿é”ååº”ï¼Œå¯¼è‡´ä¸€ç³»åˆ—ç›¸å…³æ¨¡å—çš„æ”¹åŠ¨ï¼ŒOCPå»ºè®®æˆ‘ä»¬åº”è¯¥å¯¹ç¨‹åºè¿›è¡Œé‡æ„ã€‚é‡æ„ä¹‹åå†è¿›è¡ŒåŒæ ·çš„ä¿®æ”¹ï¼Œå°±åªéœ€è¦æ·»åŠ æ–°çš„åŠŸèƒ½æ¨¡å—ï¼Œä¸éœ€è¦å¯¹åŸæœ‰çš„ä»£ç è¿›è¡Œä¿®æ”¹ã€‚</p>

<p>å¦‚ä½•åœ¨èƒ½åœ¨ä¸æ”¹å˜æ¨¡å—åŸä»£ç çš„æƒ…å†µä¸‹å»æ›´æ”¹å®ƒçš„è¡Œä¸ºæˆ–è€…ä¸ºå…¶æ·»åŠ åŠŸèƒ½å‘¢ï¼Ÿ</p>

<p><a id="markdown-å…³é”®æ˜¯æŠ½è±¡" name="å…³é”®æ˜¯æŠ½è±¡"></a></p>

<h3>å…³é”®æ˜¯æŠ½è±¡</h3>

<p>æŠ½è±¡ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š
1. æ¥å£
2. ç»§æ‰¿</p>

<p><a id="markdown-æ¥å£" name="æ¥å£"></a></p>

<h4>æ¥å£</h4>

<p>ç”¨æ¥å£å¯¹éœ€è¦çš„å¯¹è±¡è¿›è¡ŒæŠ½è±¡ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œé¢å‘æ¥å£ç¼–ç¨‹â€ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/InterfaceProgramming.jpg" alt="interface programming" /></p>

<p>ä¸Šé¢çš„aå›¾æ˜¯ä¸€ä¸ªä¸éµå¾ªOCPçš„è®¾è®¡ã€‚Clientå’ŒServeréƒ½æ˜¯å…·ä½“çš„ç±»ï¼ŒClientè¦ä½¿ç”¨Serverã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›Clientä½¿ç”¨å¦å¤–ä¸€ä¸ªä¸åŒçš„Serverç±»ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠClienté‡Œé¢ä½¿ç”¨Serverçš„åœ°æ–¹éƒ½åšå“åº”çš„ä¿®æ”¹ã€‚</p>

<p>ä¸Šé¢çš„bå›¾æ˜¯ä¸€ä¸ªç¬¦åˆOCPçš„è®¾è®¡ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„æœåŠ¡å™¨ç±»ï¼Œåªéœ€è¦é‡æ–°å®ç°è¿™ä¸ªç±»ï¼Œä¿è¯è¿™ä¸ªç±»ä¹Ÿå®ç°ç±»ClientInterfaceæ¥å£ï¼Œåˆ™Clientè¿™ä¸ªç±»ä¸éœ€è¦åšä¿®æ”¹ï¼ŒåŒæ—¶æ‰©å±•ç±»Clientçš„åŠŸèƒ½ã€‚</p>

<blockquote><p>è¿™ä¸ªæ¥å£ä¸ºä»€ä¹ˆå«ClientInterfaceï¼Œè€Œä¸å«ServerInterfaceæˆ–è€…AbstractServerä¹‹ç±»ï¼Ÿå› ä¸ºè¿™ä¸ªæ¥å£å’ŒClientçš„å…³ç³»æ›´å¯†åˆ‡ã€‚</p></blockquote>

<p><a id="markdown-ç»§æ‰¿" name="ç»§æ‰¿"></a></p>

<h4>ç»§æ‰¿</h4>

<p>ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆå’Œæ¥å£ç±»ä¼¼ï¼‰æˆ–è€…é‡å†™ä¸€ä¸ªçˆ¶ç±»ä¸­çš„ï¼ˆè™šï¼‰æ–¹æ³•ï¼Œä¹Ÿæ˜¯OCPçš„æƒ¯ç”¨ä¼ä¿©ã€‚å…¸å‹çš„ä¾‹å­ï¼Œå°±æ˜¯é‚£ä¸ªå›¾å½¢çš„ç»˜åˆ¶çš„ä¾‹å­ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Square</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// draw square</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Circle</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// draw circle</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">([</span><span class="n">Shape</span><span class="p">]</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">Shape</span> <span class="n">shape</span> <span class="k">in</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">shape</span><span class="p">.</span><span class="n">draw</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæƒ³æ‰©å±•drawAllShapesæ–¹æ³•ï¼Œä½¿å…¶å¯ä»¥ç»˜åˆ¶ä¸€ç§æ–°çš„å½¢çŠ¶ï¼Œåªéœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªShapeç±»çš„å­ç±»ï¼ŒdrawAllShapeså‡½æ•°ä¸éœ€è¦æ”¹å˜ï¼Œå³å¯å®ç°åŠŸèƒ½çš„æ‰©å±•ã€‚è¿™å°±æ˜¯OCPã€‚</p>

<p><a id="markdown-ä»€ä¹ˆæ—¶å€™è¿›è¡ŒæŠ½è±¡" name="ä»€ä¹ˆæ—¶å€™è¿›è¡ŒæŠ½è±¡"></a></p>

<h3>ä»€ä¹ˆæ—¶å€™è¿›è¡ŒæŠ½è±¡</h3>

<p>å³ä½¿æ˜¯ä¸Šé¢çš„å½¢çŠ¶ç»˜åˆ¶çš„ä¾‹å­ï¼Œä¹Ÿä¸æ˜¯å®Œå…¨çš„â€œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚â€æ¯”å¦‚ï¼Œæˆ‘è¦æ±‚æ‰€æœ‰çš„åœ†å¿…é¡»åœ¨æ­£æ–¹å½¢ä¹‹å‰ç»˜åˆ¶ï¼Œå°±æ²¡æ³•åœ¨ä¸ä¿®æ”¹drawAllShapesçš„æƒ…å†µä¸‹è¿›è¡Œè¿™ä¸ªåŠŸèƒ½æ‰©å±•ã€‚</p>

<p>æˆ‘ä»¬æ— æ³•å‡†ç¡®é¢„æµ‹æœªæ¥çš„åŠŸèƒ½æ‰©å±•éœ€æ±‚ï¼Œæ‰€ä»¥ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•å®ç°å®Œå…¨çš„â€œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚â€</p>

<p>è€Œä¸”æ›´é‡è¦çš„ï¼Œéµå¾ªOCPè¿›è¡ŒæŠ½è±¡çš„ä»£ä»·ä¹Ÿæ˜¯æ˜‚è´µçš„ã€‚åˆ›å»ºæ­£ç¡®çš„æŠ½è±¡éœ€è¦èŠ±è´¹å¼€å‘æ—¶é—´å’Œç²¾åŠ›ã€‚åŒæ—¶ï¼Œè¿™äº›æŠ½è±¡ä¹Ÿå¢åŠ äº†è½¯ä»¶çš„è®¾è®¡å¤æ‚åº¦ã€‚å¼€å‘äººå‘˜æœ‰èƒ½åŠ›å¤„ç†çš„æŠ½è±¡çš„æ•°é‡ä¹Ÿæ˜¯æœ‰é™çš„ã€‚</p>

<p>æ‰€ä»¥ï¼Œä¸è¦è¯•å›¾åœ¨åˆšå¼€å§‹å°±å®ç°OCPï¼Œå¯ä»¥è¯•ç€éµå¾ªä¸‹é¢çš„å‡†åˆ™ï¼š</p>

<ul>
<li>åªå—ä¸€æ¬¡æ„šå¼„</li>
</ul>


<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åˆšå¼€å§‹ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œå‡è®¾å˜åŒ–ä¸ä¼šå‘ç”Ÿã€‚å½“å˜åŒ–å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å°±åˆ›å»ºæŠ½è±¡è¿›è¡Œéš”ç¦»ï¼Œé˜²æ­¢ä»¥åå‘ç”ŸåŒç±»å˜åŒ–ã€‚</p>

<p><a id="markdown-ç»“è®º-1" name="ç»“è®º-1"></a></p>

<h3>ç»“è®º</h3>

<p>åœ¨å¾ˆå¤šæ–¹é¢ï¼ŒOCPéƒ½æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„æ ¸å¿ƒæ‰€åœ¨ã€‚éµå¾ªè¿™ä¸ªåŸåˆ™ï¼Œå¯ä»¥å¸¦æ¥é¢å‘å¯¹è±¡æŠ€æœ¯æ‰€å£°ç§°çš„å·¨å¤§å¥½å¤„ï¼ˆä¹Ÿå°±æ˜¯ï¼Œçµæ´»æ€§ã€å¯é‡ç”¨æ€§ä»¥åŠå¯ç»´æŠ¤æ€§ï¼‰ã€‚ä½†æ˜¯ï¼Œå¯¹ç¨‹åºçš„æ¯ä¸ªéƒ¨åˆ†éƒ½è‚†æ„åœ°è¿›è¡ŒæŠ½è±¡ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚æ‹’ç»ä¸æˆç†Ÿçš„æŠ½è±¡å’ŒæŠ½è±¡æœ¬èº«ä¸€æ ·é‡è¦ã€‚</p>

<p><a id="markdown-liskovæ›¿æ¢åŸåˆ™the-liskov-substitution-pricipleç®€ç§°lsp" name="liskovæ›¿æ¢åŸåˆ™the-liskov-substitution-pricipleç®€ç§°lsp"></a></p>

<h2>Liskovæ›¿æ¢åŸåˆ™ï¼ˆThe Liskov Substitution Pricipleï¼Œç®€ç§°LSPï¼‰</h2>

<p><a id="markdown-å®šä¹‰-2" name="å®šä¹‰-2"></a></p>

<h3>å®šä¹‰</h3>

<p><strong>å­ç±»å‹å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰å®ƒä»¬çš„åŸºç±»å‹ã€‚</strong></p>

<p>å‡è®¾ä¸€ä¸ªå‡½æ•°fï¼Œå®ƒçš„å‚æ•°æ˜¯æŸä¸ªåŸºç±»å‹Bã€‚å¦‚æœå°†åŸºç±»å‹Bçš„å­ç±»Dä¼ ç»™fï¼Œä¼šå¯¼è‡´få‡ºç°é”™è¯¯çš„è¡Œä¸ºï¼Œé‚£ä¹ˆDå°±è¿åäº†LSPåŸåˆ™ã€‚</p>

<p>æ­¤æ—¶ï¼Œfçš„ç¼–å†™è€…æƒ³åœ¨få†…å¯¹Dè¿›è¡Œæ£€æµ‹ï¼Œä»¥ä¾¿åœ¨æŠŠDä¼ ç»™fæ—¶ï¼Œå¯ä»¥ä½¿få…·æœ‰æ­£ç¡®çš„è¡Œä¸ºã€‚è¿™ä¸ªè¡Œä¸ºåˆè¿åäº†OCPåŸåˆ™ï¼Œå› ä¸ºæ­¤æ—¶få¯¹äºåŸºç±»å‹Bçš„æ‰€æœ‰å­ç±»éƒ½ä¸åœ¨å°é—­ã€‚</p>

<p><a id="markdown-ä¸€ä¸ªè¿ålspçš„ç®€å•ä¾‹å­" name="ä¸€ä¸ªè¿ålspçš„ç®€å•ä¾‹å­"></a></p>

<h3>ä¸€ä¸ªè¿åLSPçš„ç®€å•ä¾‹å­</h3>

<p>å¯¹äºLSPçš„è¿åå¸¸å¸¸ä¼šå¯¼è‡´ä»¥æ˜æ˜¾è¿åOCPçš„æ–¹å¼ä½¿ç”¨è¿è¡Œæ—¶ç±»å‹æ£€æµ‹ã€‚è¿™ç§æ–¹å¼å¸¸å¸¸æ˜¯ä½¿ç”¨ä¸€ä¸ªæ˜¾å¼çš„ifè¯­å¥å»ç¡®å®šä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œä»¥ä¾¿äºèƒ½å¤Ÿé€‰æ‹©é’ˆå¯¹è¯¥ç±»å‹çš„æ­£ç¡®è¡Œä¸ºã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Square</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">drawSquare</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// draw square</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Circle</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">drawCircle</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// draw circle</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">([</span><span class="n">Shape</span><span class="p">]</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">Shape</span> <span class="n">shape</span> <span class="k">in</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="kt">is</span> <span class="n">Square</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">shape</span><span class="p">.</span><span class="n">drawSquare</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="kt">is</span> <span class="n">Circle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">shape</span><span class="p">.</span><span class="n">drawCircle</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¾ˆæ˜¾ç„¶ï¼Œä¸Šé¢çš„drawAllShapesè¿åäº†OCPåŸåˆ™ï¼Œå®ƒå¿…é¡»çŸ¥é“æ‰€æœ‰çš„Shapeçš„å­ç±»ï¼Œå¹¶ä¸”ï¼Œæ¯åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œéƒ½éœ€è¦ä¿®æ”¹drawAllShapeså‡½æ•°ã€‚</p>

<p>Squareå’ŒCircleä¸èƒ½æ›¿æ¢å…¶åŸºç±»å‹Shapeå°±æ˜¯è¿åäº†LSPåŸåˆ™ï¼Œè¿™åˆè¿›ä¸€æ­¥å¯¼è‡´äº†drawAllShapesè¿åäº†OCPåŸåˆ™ã€‚å› è€Œï¼Œå¯¹äºLSPçš„è¿åä¹Ÿæ½œåœ¨è¿åäº†OCPåŸåˆ™ã€‚</p>

<p><a id="markdown-æ­£æ–¹å½¢å’Œé•¿æ–¹å½¢çš„å…³ç³»æ›´å¾®å¦™çš„è¿è§„" name="æ­£æ–¹å½¢å’Œé•¿æ–¹å½¢çš„å…³ç³»æ›´å¾®å¦™çš„è¿è§„"></a></p>

<h3>æ­£æ–¹å½¢å’Œé•¿æ–¹å½¢çš„å…³ç³»ï¼šæ›´å¾®å¦™çš„è¿è§„</h3>

<p>ä¸‹é¢æ­£æ–¹å½¢ç»§æ‰¿é•¿æ–¹å½¢çš„ä¾‹å­ï¼Œå¾ˆå¾®å¦™åœ°è¿åäº†LSPåŸåˆ™ã€‚</p>

<p>é•¿æ–¹å½¢çš„å®ç°å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="n">Rectangle</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">width</span><span class="p">:</span> <span class="n">Double</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">height</span><span class="p">:</span> <span class="n">Double</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">getWidth</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Double</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">width</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">getHeight</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Double</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">height</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">setWidth</span><span class="p">(</span><span class="n">_</span> <span class="nl">width</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">setHeight</span><span class="p">(</span><span class="n">_</span> <span class="nl">height</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">getArea</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Double</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="nb">self</span><span class="p">.</span><span class="n">height</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ­£æ–¹å½¢IS-Aé•¿æ–¹å½¢ï¼ŒæŒ‰ç…§é¢å‘å¯¹è±¡åˆ†æçš„æ–¹æ³•ï¼Œæ­£æ–¹å½¢åº”è¯¥ç»§æ‰¿é•¿æ–¹å½¢ã€‚åŒæ—¶ä¸ºäº†ä¿è¯æ­£æ–¹å½¢çš„å››ä¸ªè¾¹é•¿åº¦ä¸€è‡´ï¼Œéœ€è¦å¯¹<code>setWidth</code>å’Œ<code>setHeight</code>ä¸¤ä¸ªå‡½æ•°é‡å†™ã€‚</p>

<p>å®ç°å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">Square</span><span class="p">:</span> <span class="n">Rectangle</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">setWidth</span><span class="p">(</span><span class="n">_</span> <span class="nl">width</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">width</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">setHeight</span><span class="p">(</span><span class="n">_</span> <span class="nl">height</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">height</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Squareçœ‹èµ·æ¥å·¥ä½œä¸é”™ï¼Œè€Œä¸”è¿™ä¸ªè®¾è®¡ä¼¼ä¹ä¹Ÿæ˜¯è‡ªç›¸å®¹çš„ï¼Œæ­£ç¡®çš„ã€‚å¯æ˜¯è¿™ä¸ªç»“è®ºæ˜¯é”™è¯¯çš„ï¼Œä¸€ä¸ªè‡ªç›¸å®¹çš„ç¨‹åºæœªå¿…å°±å’Œæ‰€æœ‰çš„ç”¨æˆ·ç¨‹åºç›¸å®¹ã€‚è€ƒè™‘ä¸‹é¢çš„å‡½æ•°ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">tempFunc</span><span class="p">(</span><span class="n">_</span> <span class="nl">rect</span><span class="p">:</span> <span class="n">Rectangle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">rect</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>    <span class="n">rect</span><span class="p">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœä¼ é€’ä¸€ä¸ªSquareçš„å®ä¾‹ç»™<code>tempFunc</code>ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šæŠ¥é”™ã€‚</p>

<p>æœ‰äººå¯èƒ½å¯¹<code>tempFunc</code>å­˜åœ¨çš„é—®é¢˜è¿›è¡Œäº‰è¾©ï¼Œè¯´å‡½æ•°<code>tempFunc</code>çš„ç¼–å†™è€…ä¸åº”è¯¥å‡è®¾å®½å’Œé•¿æ˜¯ç‹¬ç«‹å˜åŒ–çš„ã€‚è¿™æ—¶å€™<code>tempFunc</code>çš„ç¼–å†™è€…è‚¯å®šä¸åŒæ„ï¼šå‡½æ•°ä»¥Rectangleä¸ºå‚æ•°ï¼Œé•¿å®½ç‹¬ç«‹å˜åŒ–å°±æ˜¯é•¿æ–¹å½¢çš„ç‰¹æ€§ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ</p>

<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥åè¿‡æ¥æ€è€ƒä¸€ä¸‹ï¼šIS-Aæ˜¯ä¸æ˜¯ç»§æ‰¿çš„å”¯ä¸€æ ‡å‡†ï¼Ÿ</p>

<p><strong>IS-Aä¸åº”è¯¥æˆä¸ºç»§æ‰¿çš„å‡†åˆ™ï¼Œâ€œå¯æ›¿æ¢æ€§â€æ‰æ˜¯ã€‚</strong></p>

<p><a id="markdown-å…¶å®ƒä¸€äº›å®¹æ˜“å¯¼è‡´è¿ålspçš„ä¹ æƒ¯ç”¨æ³•" name="å…¶å®ƒä¸€äº›å®¹æ˜“å¯¼è‡´è¿ålspçš„ä¹ æƒ¯ç”¨æ³•"></a></p>

<h3>å…¶å®ƒä¸€äº›å®¹æ˜“å¯¼è‡´è¿åLSPçš„ä¹ æƒ¯ç”¨æ³•</h3>

<p><a id="markdown-å­ç±»ä¸­çš„é€€åŒ–å‡½æ•°" name="å­ç±»ä¸­çš„é€€åŒ–å‡½æ•°"></a></p>

<h4>å­ç±»ä¸­çš„é€€åŒ–å‡½æ•°</h4>

<p>å½“å­ç±»åœ¨é‡å†™åŸºç±»å‡½æ•°çš„æ—¶å€™ï¼Œå¦‚æœåŠŸèƒ½ä¸å¦‚åŸºç±»å®Œå¤‡ï¼Œå³å‡ºç°äº†é€€åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªå­ç±»åœ¨æŸäº›æƒ…å†µä¸‹å°±ä¸èƒ½æ›¿æ¢åŸºç±»ï¼Œè¿åäº†LSPåŸåˆ™ã€‚</p>

<blockquote><p>è¿™ä¹Ÿè®¸å°±æ˜¯ä¸€äº›è¯­è¨€åœ¨å­ç±»é‡å†™åŸºç±»å‡½æ•°çš„æ—¶å€™å¿…é¡»é€šè¿‡superè°ƒç”¨åŸºç±»å‡½æ•°ï¼Œè¿™å°±ä¿è¯äº†é‡å†™ä¸ä¼šé€€åŒ–ã€‚ä½†æ˜¯åœ¨Swiftå’ŒObjective-Cä¸­å¯ä»¥ä¸è°ƒç”¨superã€‚</p></blockquote>

<p><a id="markdown-å­ç±»æŠ›å‡ºåŸºç±»æ²¡æœ‰çš„å¼‚å¸¸" name="å­ç±»æŠ›å‡ºåŸºç±»æ²¡æœ‰çš„å¼‚å¸¸"></a></p>

<h4>å­ç±»æŠ›å‡ºåŸºç±»æ²¡æœ‰çš„å¼‚å¸¸</h4>

<p>æ­¤æ—¶è¦éµå¾ªLSPï¼Œè¦ä¹ˆæ”¹å˜ä½¿ç”¨è€…çš„æœŸæœ›ï¼Œè¦ä¹ˆå­ç±»ä¸æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚</p>

<p><a id="markdown-ç»“è®º-2" name="ç»“è®º-2"></a></p>

<h3>ç»“è®º</h3>

<p>OCPæ˜¯å¾ˆå¤šè¯´æ³•çš„æ ¸å¿ƒï¼Œè€ŒLSPæ˜¯ä½¿OCPæˆä¸ºå¯èƒ½çš„ä¸»è¦åŸåˆ™ä¹‹ä¸€ã€‚æ­£æ˜¯å­ç±»çš„å¯æ›¿æ¢æ€§æ‰ä½¿å¾—ä½¿ç”¨åŸºç±»ç±»å‹çš„æ¨¡å—åœ¨æ— éœ€ä¿®æ”¹çš„æƒ…å†µä¸‹å°±å¯ä»¥æ‰©å±•ã€‚è¿™ç§å¯æ›¿æ¢æ€§å¿…é¡»æ˜¯å¼€å‘äººå‘˜å¯ä»¥éšå¼ä¾èµ–çš„ä¸œè¥¿ã€‚</p>

<p><a id="markdown-ä¾èµ–å€’ç½®åŸåˆ™the-dependency-inversion-principleç®€ç§°dip" name="ä¾èµ–å€’ç½®åŸåˆ™the-dependency-inversion-principleç®€ç§°dip"></a></p>

<h2>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆThe Dependency Inversion Principleï¼Œç®€ç§°DIPï¼‰</h2>

<p><a id="markdown-å®šä¹‰-3" name="å®šä¹‰-3"></a></p>

<h3>å®šä¹‰</h3>

<ul>
<li><strong>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½çº§æ¨¡å—ã€‚äºŒè€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚</strong></li>
<li><strong>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚</strong></li>
</ul>


<blockquote><p>è¿™é‡Œçš„â€œæŠ½è±¡â€æ˜¯æŒ‡æ¥å£æˆ–è€…æŠ½è±¡ç±»ã€‚</p>

<p>ä¸ºä»€ä¹ˆç”¨â€å€’ç½®â€œï¼šè¿™æ˜¯ç›¸å¯¹äºä¼ ç»Ÿçš„è½¯ä»¶å¼€å‘ï¼Œæ¯”å¦‚ç»“æ„åŒ–åˆ†æå’Œè®¾è®¡ã€‚åœ¨è¿™äº›è®¾è®¡ä¸­ï¼Œå€¾å‘äºåˆ›å»ºä¸€äº›é«˜å±‚æ¨¡å—ä¾èµ–äºä½å±‚æ¨¡å—çš„æ¨¡å—ï¼Œç­–ç•¥ï¼ˆPolicyï¼‰ä¾èµ–äºç»†èŠ‚çš„è½¯ä»¶ç»“æ„ã€‚è€ŒDIPè¦æ±‚å¤§å®¶éƒ½ä¾èµ–äºæŠ½è±¡ï¼Œè€Œä¸”è¿™ä¸ªæŠ½è±¡ç»å¯¹ä¸ä¼šæ”¾åœ¨ä½å±‚æ¨¡å—ä¸­ï¼Œè€Œæ˜¯æ”¾åœ¨é«˜å±‚æ¨¡å—ä¸­ï¼ˆæˆ–è€…ç‹¬ç«‹å‡ºæ¥ä¸€ä¸ªæ¨¡å—ï¼‰ï¼Œæ‰€ä»¥ï¼Œä¸å†æ˜¯é«˜å±‚æ¨¡å—ä¾èµ–ä½å±‚æ¨¡å—ï¼Œè€Œæ˜¯ä½å±‚æ¨¡å—ä¾èµ–é«˜å±‚æ¨¡å—ï¼ˆä¸­çš„æŠ½è±¡ï¼‰ã€‚</p></blockquote>

<p>ä¼ ç»Ÿè½¯ä»¶å¼€å‘å¯èƒ½ä¼šè®¾è®¡å‡ºä¸‹é¢è¿™æ ·çš„ç¨‹åºç»“æ„ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/DIP_bad_design.jpg" alt="DIP bad design" /></p>

<p>åœ¨è¿™ä¸ªè®¾è®¡ä¸­ï¼Œé«˜å±‚æ¨¡å—ä¾èµ–äºä½å±‚æ¨¡å—ï¼Œå¦‚æœè¦é‡ç”¨ï¼Œå¿…é¡»åŒæ—¶å¼•å…¥ä½å±‚æ¨¡å—ã€‚å¦‚æœé«˜å±‚æ¨¡å—èƒ½å¤Ÿç‹¬ç«‹äºä½å±‚æ¨¡å—ï¼Œé‚£ä¹ˆï¼Œé«˜å±‚æ¨¡å—å°±å¯ä»¥éå¸¸å®¹æ˜“åœ°è¢«é‡ç”¨ã€‚è¯¥åŸåˆ™æ˜¯æ¡†æ¶ï¼ˆframeworkï¼‰è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/DIP_good_design.jpg" alt="DIP good design" /></p>

<p>ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªæ›´ä¸ºåˆé€‚çš„æ¨¡å‹ã€‚æ¯ä¸ªé«˜å±‚æ¨¡å—éƒ½ä¸ºå®ƒæ‰€éœ€è¦çš„æœåŠ¡å£°æ˜ä¸€ä¸ªç‹¬ç«‹çš„æ¥å£ï¼Œè¾ƒä½çš„å±‚æ¬¡å®ç°è¿™äº›æŠ½è±¡æ¥å£ï¼Œæ¯ä¸ªé«˜å±‚æ¨¡å—éƒ½é€šè¿‡æ¥å£ä½¿ç”¨ä½å±‚æ¨¡å—ã€‚è¿™æ ·ï¼Œé«˜å±‚æ¨¡å—å°±ä¸ä¾èµ–äºä½å±‚æ¨¡å—ï¼Œä½å±‚æ¨¡å—åè€Œä¾èµ–äºé«˜å±‚æ¨¡å—ä¸­å®šä¹‰çš„æŠ½è±¡æœåŠ¡æ¥å£ã€‚</p>

<blockquote><p>å…¶å®ï¼Œä½å±‚æ¨¡å—ä¹Ÿæœ‰é‡ç”¨çš„é—®é¢˜ï¼Œä¹Ÿä¸åº”è¯¥ç›´æ¥ä¾èµ–äºé«˜å±‚æ¨¡å—ã€‚è¿™é‡Œï¼Œåº”è¯¥å°†é«˜å±‚æ¨¡å—æŠ½è±¡å‡ºæ¥çš„æ¥å£ç‹¬ç«‹æˆä¸€ä¸ªæ¨¡å—ï¼Œå¤§å®¶éƒ½ä¾èµ–è¿™ä¸ªæ¨¡å—ã€‚</p></blockquote>

<p><strong>è¿™é‡Œçš„å€’ç½®ä¸ä»…ä»…æ˜¯ä¾èµ–å…³ç³»çš„å€’ç½®ï¼Œä¹Ÿæ˜¯æ¥å£æ‰€æœ‰æƒçš„å€’ç½®ã€‚</strong>æˆ‘ä»¬é€šå¸¸è®¤ä¸ºå·¥å…·åº“åº”è¯¥æ‹¥æœ‰è‡ªå·±çš„æ¥å£ï¼Œä½†æ˜¯å½“åº”ç”¨äº†DIPä¹‹åï¼Œæˆ‘ä»¬å‘ç°å¾€å¾€æ˜¯å®¢æˆ·æ‹¥æœ‰æŠ½è±¡æ¥å£ï¼Œè€Œå®ƒä»¬çš„æœåŠ¡è€…åˆ™ä»è¿™äº›æŠ½è±¡æ¥å£æ´¾ç”Ÿã€‚</p>

<p><a id="markdown-ä¾èµ–äºæŠ½è±¡" name="ä¾èµ–äºæŠ½è±¡"></a></p>

<h3>ä¾èµ–äºæŠ½è±¡</h3>

<p>â€œä¾èµ–äºæŠ½è±¡â€è¿™ä¸€å¯å‘å¼è§„åˆ™ä¸DIPè¦æ±‚ç±»ä¼¼ï¼Œè¦æ±‚æˆ‘ä»¬ä¸åº”è¯¥ä¾èµ–å…·ä½“çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºä¸­æ‰€æœ‰çš„ä¾èµ–å…³ç³»éƒ½åº”è¯¥ç»ˆæ­¢äºæŠ½è±¡ï¼ˆæŠ½è±¡ç±»æˆ–è€…æ¥å£ï¼‰ã€‚æ ¹æ®è¿™ä¸€è§„åˆ™ï¼Œå¯çŸ¥ï¼š</p>

<ul>
<li>ä»»ä½•å˜é‡éƒ½ä¸åº”è¯¥æŒæœ‰ä¸€ä¸ªæŒ‡å‘å…·ä½“ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ã€‚</li>
<li>ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿã€‚</li>
<li>ä»»ä½•æ–¹æ³•éƒ½ä¸åº”è¯¥é‡å†™å®ƒçš„ä»»ä½•åŸºç±»ä¸­çš„å·²ç»å®ç°äº†çš„æ–¹æ³•ã€‚</li>
</ul>


<p>è¦å®Œå…¨éµå®ˆè¿™ä¸ªè§„åˆ™å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚å¯¹äºä¸€äº›å…·ä½“çš„ç±»ï¼Œå¦‚æœæ¯”è¾ƒç¨³å®šï¼Œè¿˜æ˜¯å¯ä»¥ä¾èµ–çš„ã€‚æ¯”å¦‚Javaæˆ–è€…Swiftä¸­çš„Stringç±»å‹ï¼ŒStringæ¯”è¾ƒç¨³å®šï¼Œä¸å¤ªä¼šå˜åŒ–ï¼Œä¾èµ–äºå®ƒä¸ä¼šé€ æˆæŸå®³ã€‚</p>

<p>ä½†æ˜¯å¦‚æœä¸€ä¸ªç±»ä¸ç¨³å®šï¼Œæˆ‘ä»¬æœ€å¥½ä¸è¦ç›´æ¥ä¾èµ–å®ƒï¼Œè€Œè¦ç”¨ä¸€ä¸ªæŠ½è±¡æ¥å£éš”ç¦»è¿™ä¸ªç±»çš„ä¸ç¨³å®šæ€§ï¼Œç›´æ¥ä½¿ç”¨æ¥å£ï¼Œè€Œä¸æ˜¯è¿™ä¸ªç±»ã€‚</p>

<p><a id="markdown-ä¸€ä¸ªä¾‹å­" name="ä¸€ä¸ªä¾‹å­"></a></p>

<h3>ä¸€ä¸ªä¾‹å­</h3>

<p>ä¾èµ–å€’ç½®å¯ä»¥åº”ç”¨äºä»»ä½•å­˜åœ¨ä¸€ä¸ªç±»å‘å¦ä¸€ä¸ªç±»å‘é€æ¶ˆæ¯çš„åœ°æ–¹ã€‚ä¾‹å¦‚Buttonå¯¹Lampçš„æ§åˆ¶ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/DIP_button_lamp_design.jpg" alt="DIP button lamp design" /></p>

<p>ä¸Šå›¾ä¸­çš„aè®¾è®¡æ˜¯ä¸æˆç†Ÿçš„ï¼šButtonç±»ä¾èµ–äºLampç±»ï¼Œå½“Lampç±»æ”¹å˜æ—¶ï¼ŒButtonç±»ä¼šå—åˆ°å½±å“ã€‚æ­¤å¤–ï¼Œæƒ³è¦é‡ç”¨Buttonæ¥æ§åˆ¶å¦å¤–ä¸€ç§å¯¹è±¡ï¼ˆæ¯”å¦‚Motorï¼‰æ˜¯ä¸å¯èƒ½çš„ã€‚Buttonæ§åˆ¶ç€Lampå¯¹è±¡ï¼Œå¹¶ä¸”ä¹Ÿåªèƒ½æ§åˆ¶Lampå¯¹è±¡ã€‚</p>

<p>è¿™ä¸ªè®¾è®¡è¿åç±»DIPåŸåˆ™ï¼šåº”ç”¨ç¨‹åºçš„é«˜å±‚ç­–ç•¥æ²¡æœ‰å’Œä½å±‚çš„å®ç°åˆ†ç¦»ï¼ŒæŠ½è±¡æ²¡æœ‰å’Œå…·ä½“ç»†èŠ‚åˆ†ç¦»ã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œé«˜å±‚ç­–ç•¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼ŒæŠ½è±¡è‡ªåŠ¨ä¾èµ–äºç»†èŠ‚ã€‚</p>

<p>ä»€ä¹ˆæ˜¯é«˜å±‚ç­–ç•¥å‘¢ï¼Ÿå®ƒæ˜¯åº”ç”¨èƒŒåçš„æŠ½è±¡ï¼Œæ˜¯é‚£äº›ä¸éšå…·ä½“ç»†èŠ‚çš„æ”¹å˜è€Œæ”¹å˜çš„çœŸç†ï¼Œå®ƒæ˜¯ç³»ç»Ÿå†…éƒ¨çš„ç³»ç»Ÿâ€”â€”å®ƒæ˜¯éšå–»ï¼ˆmetaphoreï¼‰ã€‚åœ¨Button/Lampè¿™ä¸ªä¾‹å­ä¸­ï¼ŒèƒŒåçš„æŠ½è±¡æ˜¯æ£€æµ‹ç”¨æˆ·çš„å¼€/å…³æŒ‡ä»¤å¹¶å°†æŒ‡ä»¤ä¼ ç»™ç›®æ ‡å¯¹è±¡ã€‚ç”¨ä»€ä¹ˆæœºåˆ¶æ£€æµ‹ç”¨æˆ·çš„æŒ‡ä»¤å‘¢ï¼Ÿæ˜¯ç›´æ¥æŒ‰ä¸‹GUIä¸Šçš„ä¸€ä¸ªæŒ‰é’®ï¼Œè¿˜æ˜¯ä¸€ä¸ªå®ä½“æŒ‰é’®ï¼Œæˆ–è€…ä¸€ä¸ªå®‰å…¨ç³»ç»Ÿä¸­çš„è¿åŠ¨ç›‘æµ‹å™¨ï¼Ÿæ— å…³ç´§è¦ï¼ç›®æ ‡å¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ— å…³ç´§è¦ï¼è¿™äº›éƒ½æ˜¯ä¸ä¼šå½±å“åˆ°æŠ½è±¡çš„å…·ä½“ç»†èŠ‚ã€‚</p>

<p>æ”¹è¿›ä¹‹åçš„bè®¾è®¡åˆ™æ˜¯ä¸€ä¸ªéµå®ˆDIPçš„è®¾è®¡ã€‚è€Œä¸”ï¼Œæ¥å£æœ¬èº«æ²¡æœ‰æ‰€æœ‰è€…ï¼Œå¯ä»¥ç‹¬ç«‹æ”¾åœ¨ä¸€ä¸ªä¸åŒäºButtonï¼Œä¹Ÿä¸åŒäºLampçš„åœ°æ–¹ã€‚</p>

<p><a id="markdown-ç»“è®º-3" name="ç»“è®º-3"></a></p>

<h3>ç»“è®º</h3>

<p>ä¼ ç»Ÿç¨‹åºè®¾è®¡ï¼Œç­–ç•¥ä¾èµ–äºç»†èŠ‚ã€‚é¢å‘å¯¹è±¡è®¾è®¡å€’ç½®äº†è¿™ç§ä¾èµ–å…³ç³»ï¼Œä½¿å¾—ç»†èŠ‚å’Œç­–ç•¥éƒ½ä¾èµ–äºæŠ½è±¡ï¼Œå¹¶ä¸”å¸¸å¸¸æ˜¯å®¢æˆ·æ‹¥æœ‰æœåŠ¡æ¥å£ã€‚</p>

<p>äº‹å®ä¸Šï¼Œè¿™ç§ä¾èµ–å…³ç³»çš„å€’ç½®æ­£å¥½æ˜¯é¢å‘å¯¹è±¡çš„æ ‡å¿—æ‰€åœ¨ã€‚å¦‚æœä¾èµ–å…³ç³»æ˜¯å€’ç½®çš„ï¼Œå°±æ˜¯é¢å‘å¯¹è±¡è®¾è®¡ï¼›å¦åˆ™ï¼Œå°±æ˜¯è¿‡ç¨‹åŒ–è®¾è®¡ã€‚</p>

<p>ä¾èµ–å€’ç½®å…³ç³»æ˜¯å®ç°è®¸å¤šé¢å‘å¯¹è±¡æŠ€æœ¯æ‰€å®£ç§°çš„å¥½å¤„çš„åŸºæœ¬åº•å±‚æœºåˆ¶ã€‚å®ƒçš„æ­£ç¡®åº”ç”¨å¯¹äºåˆ›å»ºå¯é‡ç”¨çš„æ¡†æ¶æ¥è¯´æ˜¯å¿…è¦çš„ã€‚åŒæ—¶å®ƒå¯¹äºæ„å»ºåœ¨å˜åŒ–é¢å‰å¯Œæœ‰å¼¹æ€§çš„ä»£ç ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚</p>

<p><a id="markdown-æ¥å£éš”ç¦»åŸåˆ™the-interface-segregation-principleç®€ç§°isp" name="æ¥å£éš”ç¦»åŸåˆ™the-interface-segregation-principleç®€ç§°isp"></a></p>

<h2>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆThe Interface Segregation Principleï¼Œç®€ç§°ISPï¼‰</h2>

<p><a id="markdown-å®šä¹‰-4" name="å®šä¹‰-4"></a></p>

<h3>å®šä¹‰</h3>

<p><strong>ä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ä¾èµ–äºå®ƒä»¬ä¸ç”¨çš„æ–¹æ³•ã€‚</strong></p>

<p>è¿™ä¸ªåŸåˆ™æ˜¯ç”¨æ¥å¤„ç†â€œèƒ–â€æ¥å£æ‰€å…·æœ‰çš„ç¼ºç‚¹ã€‚å¦‚æœç±»çš„æ¥å£ä¸æ˜¯å†…èšï¼ˆcohesiveï¼‰çš„ï¼Œå°±è¡¨ç¤ºè¯¥ç±»å…·æœ‰â€œèƒ–â€çš„æ¥å£ã€‚æ¢å¥è¯è¯´ï¼Œç±»çš„â€œèƒ–â€æ¥å£å¯ä»¥åˆ†è§£æˆå¤šç»„æ–¹æ³•ï¼Œæ¯ä¸€ç»„æ–¹æ³•éƒ½æœåŠ¡äºä¸åŒçš„å®¢æˆ·ç¨‹åºã€‚</p>

<p>å¦‚æœå®¢æˆ·ç¨‹åºä¾èµ–äºä¸€ä¸ªå…·æœ‰â€œèƒ–â€æ¥å£çš„ç±»ï¼Œå°±ç›¸å½“äºå¼ºè¿«å®¢æˆ·ç¨‹åºä¾èµ–å®ƒä»¬ä¸ä½¿ç”¨çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™äº›å®¢æˆ·ç¨‹åºå°±é¢ä¸´ç€ç”±äºè¿™äº›æœªä½¿ç”¨çš„æ–¹æ³•çš„æ”¹å˜æ‰€å¸¦æ¥çš„å˜æ›´ã€‚è¿™æ— æ„ä¸­å¯¼è‡´äº†æ‰€æœ‰å®¢æˆ·ç¨‹åºä¹‹é—´çš„è€¦åˆã€‚</p>

<p><a id="markdown-ä¸€ä¸ªä¾‹å­å®šæ—¶é—¨" name="ä¸€ä¸ªä¾‹å­å®šæ—¶é—¨"></a></p>

<h3>ä¸€ä¸ªä¾‹å­ï¼šå®šæ—¶é—¨</h3>

<p><strong>é—®é¢˜æè¿°ï¼š</strong></p>

<p>ç°åœ¨æœ‰ä¸€ä¸ªDoorçš„ç±»ï¼Œç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªTimerDoorï¼Œå¦‚æœé—¨å¼€çš„æ—¶é—´è¿‡é•¿ï¼Œå°±å‘å‡ºè­¦æŠ¥ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼ŒTimerDooréœ€è¦è·Ÿå¦ä¸€ä¸ªåä¸ºTimerçš„å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å¸Œæœ›å¾—åˆ°è¶…æ—¶é€šçŸ¥ï¼Œå®ƒå¯ä»¥è°ƒç”¨Timerçš„registerå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è¶…æ—¶æ—¶é—´ï¼Œå¦ä¸€ä¸ªæ˜¯TimerClientå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„<code>timeout</code>å‡½æ•°ä¼šåœ¨è¶…æ—¶æ—¶è¢«Timerè°ƒç”¨ã€‚</p>

<p>ä¸€ä¸ªå®¹æ˜“æƒ³åˆ°çš„å®ç°å¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/door_bad_design.jpg" alt="timer door bad design" /></p>

<p>ç°åœ¨Doorä¾èµ–TimerClientäº†ï¼Œå¯æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰ç§ç±»çš„Dooréƒ½éœ€è¦å®šæ—¶åŠŸèƒ½ã€‚å¦‚æœè¦åˆ›å»ºæ— éœ€å®šæ—¶åŠŸèƒ½çš„Doorçš„å­ç±»ï¼Œé‚£ä¹ˆåœ¨å­ç±»ä¸­å°±å¿…é¡»è¦æä¾›<code>timeout</code>æ–¹æ³•çš„é€€åŒ–å®ç°ï¼Œè¿™å°±æœ‰å¯èƒ½è¿åLSPåŸåˆ™ï¼Œä½¿å¾—å­ç±»ä¸èƒ½å¤Ÿæ›¿æ¢çˆ¶ç±»ã€‚è€Œä¸”ï¼Œè¿™äº›å­ç±»çš„åº”ç”¨ç¨‹ä¸­ä¸­ä¹Ÿå¿…é¡»å¼•å…¥TimerClientçš„å®šä¹‰ã€‚ä½¿Doorå˜â€œèƒ–â€ï¼Œåªæ˜¯ä¸ºäº†ç»™å…¶æŸä¸ªå­ç±»å¸¦æ¥éœ€è¦çš„åŠŸèƒ½ï¼Œè¿™å°±æ˜¯æ¥å£æ±¡æŸ“ã€‚</p>

<p>ä¸‹é¢åº”ç”¨æ¥å£éš”ç¦»åŸåˆ™ISPé‡æ–°è®¾è®¡è¿™ä¸ªTimerDoorã€‚</p>

<p>TimerDooråº”è¯¥â€œå…·æœ‰â€ä¸¤ç»„æ¥å£ï¼Œä¸€ç»„ä¾›Timerä½¿ç”¨ï¼Œä¸€ç»„ä¾›Doorä½¿ç”¨ã€‚å¦‚ä½•å°†è¿™ä¸¤ç»„æ¥å£åˆ†å¼€å‘¢ï¼Ÿè¯¥é—®é¢˜çš„ç­”æ¡ˆåŸºäºè¿™æ ·çš„äº‹å®ï¼šä¸€ä¸ªå¯¹è±¡çš„å®¢æˆ·ä¸æ˜¯å¿…é¡»é€šè¿‡è¯¥å¯¹è±¡æ‰èƒ½è®¿é—®å…¶æ¥å£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å§”æ‰˜æˆ–è€…è¯¥å¯¹è±¡çš„åŸºç±»æ¥è®¿é—®å®ƒã€‚</p>

<p><a id="markdown-ä½¿ç”¨å§”æ‰˜å¯¹æ¥å£åˆ†ç»„" name="ä½¿ç”¨å§”æ‰˜å¯¹æ¥å£åˆ†ç»„"></a></p>

<h4>ä½¿ç”¨å§”æ‰˜å¯¹æ¥å£åˆ†ç»„</h4>

<p>è¯¥æ–¹æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“TimerDooréœ€è¦å‘Timerå¯¹è±¡æ³¨å†Œä¸€ä¸ªè¶…æ—¶è¯·æ±‚æ—¶ï¼Œå®ƒå°±åˆ›å»ºä¸€ä¸ªDoorTimerAdaperï¼Œå¹¶æŠŠå®ƒæ³¨å†Œç»™Timerã€‚å½“Timerå¯¹è±¡å‘é€<code>timeout</code>æ¶ˆæ¯ç»™DoorTimerAdapteræ—¶ï¼ŒDoorTimerAdapteræŠŠè¿™ä¸ªæ¶ˆæ¯å§”æ‰˜ç»™TimerDoorçš„<code>doorTimeout</code>æ–¹æ³•ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/door_good_design_1.jpg" alt="timer door good design 1" /></p>

<p>è¿™ä¸ªè®¾è®¡æ˜¯ä¸ªæ¯”è¾ƒé€šç”¨çš„è®¾è®¡ï¼Œåœ¨å…¶ä»–åœ°æ–¹ï¼Œä¹Ÿå«åšâ€œä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿ï¼ˆPrefer Composition to Extensionï¼‰â€ã€‚ä½†æ˜¯è¿™ä¸ªè®¾è®¡ç•¥æ˜¾å¤æ‚ã€‚ä¸‹é¢åŸºäºå¤šé‡ç»§æ‰¿çš„å®ç°æ›´åŠ ç®€æ´ã€‚</p>

<p><a id="markdown-ä½¿ç”¨å¤šé‡ç»§æ‰¿å¯¹æ¥å£åˆ†ç»„" name="ä½¿ç”¨å¤šé‡ç»§æ‰¿å¯¹æ¥å£åˆ†ç»„"></a></p>

<h4>ä½¿ç”¨å¤šé‡ç»§æ‰¿å¯¹æ¥å£åˆ†ç»„</h4>

<p>ä¸åŒè¯­è¨€çš„å¤šé‡ç»§æ‰¿çš„å®ç°æ˜¯ä¸ä¸€æ ·çš„ã€‚å€¾å‘äºä½¿ç”¨Interfaceæˆ–è€…Protocolå®ç°è¿™ä¸€åŠŸèƒ½ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/door_good_design_2.jpg" alt="timer door good design 2" /></p>

<p>TimerDoorç»§æ‰¿Doorå’ŒTimerClientã€‚å°½ç®¡è¿™ä¸¤ä¸ªåŸºç±»çš„å®¢æˆ·ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨TimerDoorï¼Œä½†æ˜¯å®é™…ä¸Šéƒ½ä¸éœ€è¦ä¾èµ–TimerDoorç±»ã€‚è¿™æ ·ï¼Œå®ƒä»¬å°±é€šè¿‡åˆ†ç¦»çš„æ¥å£ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>

<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šä¼˜å…ˆé€‰æ‹©å¤šé‡ç»§æ‰¿æ–¹æ³•ï¼Œåªæœ‰å½“DoorTimerAdapteræ‰€åšçš„è½¬æ¢æ˜¯å¿…é¡»çš„æ—¶å€™ï¼Œæ‰è€ƒè™‘ä½¿ç”¨å§”æ‰˜æ–¹æ¡ˆã€‚</p>

<blockquote><p>DoorTimerAdapterå°†<code>timeout</code>æ¥å£è½¬æ¢æˆTimerDooré‡Œé¢çš„<code>doorTimeout</code>æ¥å£ï¼Œå¦‚æœéœ€è¦ï¼Œåœ¨è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­è¿˜å¯ä»¥åšäº›å…¶å®ƒäº‹æƒ…ã€‚</p></blockquote>

<p><a id="markdown-ä¸€ä¸ªä¾‹å­atmç•Œé¢" name="ä¸€ä¸ªä¾‹å­atmç•Œé¢"></a></p>

<h3>ä¸€ä¸ªä¾‹å­ï¼šATMç•Œé¢</h3>

<p>ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªæ›´æœ‰æ„ä¹‰çš„ä¾‹å­ï¼šè‡ªåŠ¨å–æ¬¾æœºATMé—®é¢˜ã€‚å¯¹äºATMä¸Šé¢å¯æ‰§è¡Œçš„ä¸åŒæ“ä½œå°è£…ä¸€ä¸ªæŠ½è±¡æ¥å£Transactionï¼Œä¸‰ç§å…·ä½“çš„æ“ä½œï¼ˆDepositï¼ŒWithdrawalï¼ŒTransferï¼‰éƒ½å®ç°è¿™ä¸ªæ¥å£ã€‚æ¯ç§æ“ä½œå¯¹åº”çš„ç±»éƒ½å¯ä»¥è°ƒç”¨UIæŠ½è±¡æ¥å£ä¸­çš„ä¸åŒæ–¹æ³•ï¼Œä½†æ˜¯<strong>æ¯ä¸ªæ“ä½œåªè°ƒç”¨è‡ªå·±å¯¹åº”çš„æ–¹æ³•</strong>ã€‚</p>

<p>ä¸€ä¸ªç®€å•ç›´æ¥çš„å®ç°å¦‚ä¸‹ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/ATM_bad_design.jpg" width="400" alt="atm bad design" /></p>

<p>å¯¹äºä»»ä½•Transactionçš„å­ç±»çš„æ”¹åŠ¨éƒ½æœ‰å¯èƒ½è¿«ä½¿å¯¹UIçš„ç›¸åº”æ”¹åŠ¨ï¼Œä»è€Œå½±å“å…¶å®ƒæ‰€æœ‰Transactionçš„å­ç±»ä»¥åŠæ‰€æœ‰ä¾èµ–UIçš„ç±»ã€‚å¦‚æœè¦å¢åŠ ä¸€ç§æ“ä½œPayGasBillTransactionï¼Œä¸ºäº†å¤„ç†è¯¥æ“ä½œæƒ³è¦æ˜¾ç¤ºçš„ç‰¹å®šæ¶ˆæ¯ï¼Œå°±å¿…é¡»è¦åœ¨UIä¸­åŠ å…¥æ–°çš„æ–¹æ³•ã€‚è¿™å°±å¯¼è‡´æ‰€æœ‰å…¶å®ƒTransactionéƒ½å¿…é¡»é‡æ–°ç¼–è¯‘éƒ¨ç½²ã€‚</p>

<p>é€šè¿‡å°†UIæ¥å£åˆ†è§£æˆä¸‰ä¸ªå¯¹åº”äºä¸åŒæ“ä½œçš„æ¥å£ï¼Œå¯ä»¥é¿å…è¿™ç§è€¦åˆã€‚è®¾è®¡å¦‚ä¸‹ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/ATM_good_design.jpg" width="600" alt="atm good design" /></p>

<p>å½“æˆ‘ä»¬éœ€è¦å¢åŠ ä¸€ç§æ–°çš„Transactionæ—¶ï¼Œå…¶å®ƒTransactionéƒ½ä¸éœ€è¦é‡æ–°ç¼–è¯‘éƒ¨ç½²ã€‚</p>

<p><a id="markdown-å¤šå‚æ•°å½¢å¼ä¸å•å‚æ•°å½¢å¼" name="å¤šå‚æ•°å½¢å¼ä¸å•å‚æ•°å½¢å¼"></a></p>

<h4>å¤šå‚æ•°å½¢å¼ä¸å•å‚æ•°å½¢å¼</h4>

<p>è€ƒè™‘ä¸€ä¸ªæ—¢è¦è®¿é—®TransferUIåˆè¦è®¿é—®DepositUIçš„å‡½æ•°ã€‚å‡è®¾æˆ‘ä»¬æƒ³æŠŠè¿™ä¸¤ä¸ªUIä¼ å…¥è¯¥å‡½æ•°ï¼Œæ˜¯åº”è¯¥è¿™æ ·å†™ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kt">void</span> <span class="n">tempFund</span><span class="p">(</span><span class="n">_</span> <span class="nl">depositeUI</span><span class="p">:</span> <span class="n">DepositUI</span><span class="p">,</span> <span class="n">_</span> <span class="nl">transferUI</span><span class="p">:</span> <span class="n">TransferUI</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿˜æ˜¯åº”è¯¥è¿™æ ·å†™ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kt">void</span> <span class="n">tempFund</span><span class="p">(</span><span class="n">_</span> <span class="nl">ui</span><span class="p">:</span> <span class="n">UI</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»¥ç¬¬äºŒç§æ–¹æ³•ç¼–å†™å‡½æ•°çš„è¯±æƒ‘æ˜¯å¾ˆå¼ºçš„ã€‚æ¯•ç«Ÿï¼Œåœ¨ç¬¬ä¸€ç§å¤šå‚æ•°å½¢å¼ä¸­ï¼Œä¸¤ä¸ªå‚æ•°åº”ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">tempFunc</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">ui</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>è™½ç„¶ä¸Šé¢çš„è°ƒç”¨çœ‹èµ·æ¥æœ‰æ‚–å¸¸ç†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯åº”è¯¥å€¾å‘äºå¤šå‚æ•°å½¢å¼ã€‚å•å‚æ•°å½¢å¼çš„å‡½æ•°ä¾èµ–äºUIä¸­åŒ…å«çš„æ¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœWithDrawalUIå‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆå‡½æ•°åŠå…¶æ‰€æœ‰å®¢æˆ·ç¨‹åºéƒ½ä¼šå—åˆ°å½±å“ã€‚è¿™æ›´æ‚–å¸¸ç†ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ä¿è¯ä¼ å…¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°ä¸€ç›´æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ä¹Ÿè®¸ä»¥åï¼Œæ¥å£å¯¹è±¡ä¼šå› ä¸ºæŸäº›åŸå› è€Œåˆ†ç¦»ï¼Œæ­¤æ—¶ï¼Œå‡½æ•°å¹¶ä¸éœ€è¦å…³æ³¨æ¥å£å¯¹è±¡æ˜¯åˆå¹¶è¿˜æ˜¯åˆ†æ‹†è¿™ä¸€äº‹å®ã€‚</p>

<p><a id="markdown-ç»“è®º-4" name="ç»“è®º-4"></a></p>

<h3>ç»“è®º</h3>

<p>â€œèƒ–â€ç±»ä¼šå¯¼è‡´å…¶å®¢æˆ·ç¨‹åºä¹‹é—´çš„è€¦åˆã€‚å½“ä¸€ä¸ªå®¢æˆ·ç¨‹åºè¦æ±‚è¯¥â€œèƒ–â€ç±»è¿›è¡Œä¸€ä¸ªæ”¹åŠ¨æ—¶ï¼Œå…¶å®ƒå®¢æˆ·ç¨‹åºéƒ½ä¼šå—åˆ°å½±å“ã€‚å› æ­¤å®¢æˆ·ç¨‹åºåº”è¯¥ä»…ä»…ä¾èµ–äºå®ƒè°ƒç”¨çš„æ–¹æ³•ï¼Œè€Œä¸åº”è¯¥ç›´æ¥ä¾èµ–äºä¸€ä¸ªâ€œèƒ–â€ç±»ã€‚é€šè¿‡æŠŠâ€œèƒ–â€ç±»çš„æ¥å£åˆ†è§£ä¸ºå¤šä¸ªç‰¹å®šç¨‹åºçš„æ¥å£ï¼Œæ¯ä¸ªé’ˆå¯¹ç‰¹å®šå®¢æˆ·ç¨‹åºçš„æ¥å£åªå£°æ˜å…¶å¯¹åº”å®¢æˆ·ç¨‹åºéœ€è¦çš„æ¥å£ã€‚æ¥ç€ï¼Œè¯¥â€œèƒ–â€ç±»å°±å¯ä»¥ç»§æ‰¿æ‰€æœ‰åˆ†ç¦»å‡ºæ¥çš„æ¥å£ï¼Œå¹¶å®ç°å®ƒä»¬ã€‚è¿™å°±è§£é™¤äº†å®¢æˆ·ç¨‹åºå’Œå…¶æ²¡æœ‰è°ƒç”¨çš„æ–¹æ³•é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä½¿å®¢æˆ·ç¨‹åºä¹‹é—´äº’ä¸ä¾èµ–ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[åœ¨swiftå’ŒObjcä¹‹é—´è½¬æ¢çš„ä¸€äº›æƒ³æ³•]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/11/13/some-ideas-on-converting-between-objc-and-swift/"/>
    <updated>2018-11-13T10:50:18+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/11/13/some-ideas-on-converting-between-objc-and-swift</id>
    <content type="html"><![CDATA[<!-- more -->


<p>åœ¨å·¥ä½œä¸­æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦åœ¨swiftå’Œobjcä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œè¿™æ—¶å€™æœ‰æ²¡æœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘¢ï¼Ÿ</p>

<blockquote><p>å½“ç„¶ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦è½¬æ¢ï¼Œå› ä¸ºswiftå’Œobjcçš„ç±»å’Œæ–¹æ³•å¯ä»¥äº’ç›¸æš´éœ²ç»™å¯¹æ–¹ã€‚</p></blockquote>

<h2>objcè½¬æ¢æˆswfit</h2>

<p>æœç´¢äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸¤ä¸ªå·¥å…·å¯ä»¥åšè¿™ä¸ªäº‹æƒ…ï¼š</p>

<h3><a href="https://github.com/yahoojapan/objc2swift">objc2swift</a></h3>

<p>objc2swiftæ˜¯é›…è™æ—¥æœ¬çš„ä¸€ä¸ªå·¥å…·ï¼Œæ”¯æŒåœ¨çº¿è½¬æ¢ã€‚<a href="https://github.com/dzenbot/XCSwiftr/blob/master/README.md">XCSwiftr</a>å°±æ˜¯ä¸€ä¸ªåŸºäºobjc2swiftçš„xcodeæ’ä»¶ï¼Œé€šè¿‡<a href="https://github.com/alcatraz/Alcatraz">Alcatraz</a>è¿›è¡Œç®¡ç†å®‰è£…ï¼Œå¯ä»¥åœ¨Xcodeé‡Œé¢è¿›è¡Œobjcåˆ°swiftçš„è½¬æ¢ã€‚ä½†æ˜¯xcodeè‡ªä»8.0å¼€å§‹å°±ä¸æ”¯æŒæ’ä»¶äº†ã€‚</p>

<blockquote><p>æ’ä»¶(plugin)åªåœ¨xcode 8.0ä¹‹å‰çš„ç‰ˆæœ¬æ‰æ”¯æŒã€‚ä»8.0å¼€å§‹ï¼Œæ’ä»¶å°±ä¸å†æ”¯æŒï¼Œä½†æ˜¯å¼•å…¥äº†æ‰©å±•(extension)ã€‚æ‰©å±•å’Œæ’ä»¶ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼šæ‰©å±•åœ¨ç‹¬ç«‹çš„è¿›ç¨‹é‡Œé¢è¿è¡Œï¼Œæ‰€ä»¥æ‰©å±•çš„å´©æºƒä¸ä¼šå½±å“åˆ°xcodeï¼Œä½†æ˜¯æ’ä»¶çš„å´©æºƒï¼Œåˆ™ä¼šå¯¼è‡´xcodeä¹Ÿå´©æºƒã€‚ä¼°è®¡æ’ä»¶å´©æºƒå¯¼è‡´çš„xcodeå´©æºƒçš„é”…éƒ½æ˜¯Appleæ¥èƒŒï¼ŒAppleå¾ˆä¸çˆ½ï¼Œå°±è®©xcodeè·Ÿæ’ä»¶åˆ†å¼€åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­è¿è¡Œã€‚</p></blockquote>

<p>objc2swiftçš„è½¬æ¢æ•ˆæœå¾ˆä¸€èˆ¬ã€‚</p>

<p>objcæºä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">MyClass</span>: <span class="bp">NSObject</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sayHelloTo:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">person</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">MyClass</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sayHelloTo:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">person</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">([</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;Hello, %@.&quot;</span><span class="p">,</span> <span class="n">person</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span> <span class="nl">performSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">test</span><span class="p">)];</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">test</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>è½¬æ¢ä¹‹åï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">MyClass</span><span class="p">:</span> <span class="bp">NSObject</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">sayHelloTo</span><span class="p">(</span><span class="nl">person</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello, \(person).&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">performSelector</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">test</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å‡ ä¸ªé—®é¢˜ï¼š</p>

<ol>
<li>æ–¹æ³•åç§°æ²¡æœ‰æŒ‰ç…§swiftçš„ä¹ æƒ¯æ”¹å†™ï¼šåº”è¯¥ä¸º<code>sayHello(to person: String)</code>ï¼Œè€Œä¸æ˜¯<code>sayHelloTo(person: String)</code>ã€‚</li>
<li><code>performSelector:</code>æ–¹æ³•å®Œå…¨è½¬æ¢é”™è¯¯ï¼šæ–¹æ³•åç§°é”™è¯¯ï¼Œåº”è¯¥ä¸º<code>perform(_ aSelector: Selector!)</code>ï¼Œè€Œä¸”å‚æ•°ä¹Ÿé”™è¯¯ï¼Œä¸åº”è¯¥ä¸º<code>String</code>ç±»å‹ï¼Œåº”è¯¥ä¸º<code>Selector</code>ç±»å‹ã€‚</li>
<li><code>test</code>æ–¹æ³•å‰é¢æ²¡æœ‰åŠ ä¸Š<code>@objc</code>ï¼Œæ‰€ä»¥ä¸èƒ½ä½œä¸º<code>#selector</code>çš„å‚æ•°ã€‚</li>
</ol>


<h3><a href="https://objectivec2swift.com/#/home">Swiftify</a></h3>

<p>swiftifyä¹Ÿæ”¯æŒåœ¨çº¿è½¬æ¢ï¼Œè€Œä¸”è½¬æ¢æ•ˆæœæ˜æ˜¾å¥½äºobjc2swiftã€‚å¦‚æœæ„¿æ„èŠ±é’±ï¼Œswiftifyè¿˜å¯ä»¥æ”¯æŒå¾ˆå¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬xcodeæ‰©å±•ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæ˜¯â€œæ‰©å±•extensionâ€ï¼Œä¸æ˜¯â€œæ’ä»¶pluginâ€ï¼‰ã€finderæ‰©å±•ã€æ•´ä¸ªå·¥ç¨‹çš„è½¬æ¢ã€ç¦»çº¿è½¬æ¢ç­‰ã€‚</p>

<p>åŒæ ·ç”¨ä¸Šè¿°objcæºä»£ç ï¼Œè½¬æ¢ä¹‹åä¸ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">MyClass</span><span class="p">:</span> <span class="bp">NSObject</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">func</span> <span class="n">sayHello</span><span class="p">(</span><span class="n">to</span> <span class="nl">person</span><span class="p">:</span> <span class="n">String</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello Swift, Goodbye Obj-C!&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">perform</span><span class="p">(</span><span class="err">#</span><span class="n">selector</span><span class="p">(</span><span class="n">MyClass</span><span class="p">.</span><span class="n">test</span><span class="p">))</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">@</span><span class="n">objc</span> <span class="k">func</span> <span class="n">test</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>swiftè½¬æ¢æˆobjc</h2>

<p><a href="https://objectivec2swift.com/#/home">Swiftify</a>çš„ä½œè€…å†™äº†ä¸€ç¯‡åšå®¢<a href="https://www.quora.com/How-can-you-convert-Swift-to-Objective-C">How can you convert Swift to Objective-C?</a>ï¼Œè¯´æ˜äº†è¿™ä¸ªé—®é¢˜ï¼š</p>

<p>åŸæ–‡æ˜¯ï¼š</p>

<blockquote><p>When speaking about idiomatic Swift, converting method implementations from Swift to Objective-C is the task that cannot be solved for all cases. As you might imagine, many â€œmodernâ€ Swift features do not have any counterparts in Objective-C and thus cannot be converted without a human brain :)</p></blockquote>

<p>ç»“è®ºå°±æ˜¯ï¼šç”±äºswiftæœ‰å¾ˆå¤šobjcæ²¡æœ‰çš„è¯­è¨€ç‰¹æ€§ï¼Œæ‰€ä»¥swiftåˆ°objcæ— æ³•å®Œæˆè‡ªåŠ¨è½¬æ¢ã€‚</p>

<p>ä½†æ˜¯è½¬æ¢ä¹‹åçš„objcçš„å¤´æ–‡ä»¶å¯ä»¥ä»build in â€œGenerated Interfaceâ€ ([ProjectName]-Swift.h)é‡Œé¢æ‰¾åˆ°ï¼Œæ‹·è´å‡ºæ¥ï¼Œç¨ä½œä¿®æ”¹å³å¯ã€‚ä½†æ˜¯ä»…é™äºswiftæš´æ¼ç»™objcçš„æ¥å£å’Œå±æ€§ã€‚é‚£äº›æ²¡æœ‰æš´æ¼ç»™objcçš„æ¥å£å’Œå±æ€§ï¼Œå°±éœ€è¦æ‰‹åŠ¨å»è½¬æ¢å•¦ã€‚</p>

<blockquote><p>[ProjectName]-Swift.hå¦‚æœä¸èƒ½é€šè¿‡cmd+shift+Oæ‰¾åˆ°ï¼Œå¯ä»¥ä»å¼•ç”¨è¿™ä¸ªå¤´æ–‡ä»¶çš„objcæ–‡ä»¶ä¸­é€šè¿‡â€œgo to declaration"æ‰¾åˆ°ã€‚</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è¯»æœ±å…‰æ½œã€Šè°ˆä¿®å…»ã€‹]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/11/05/du-zhu-guang-qian-tan-xiu-yang/"/>
    <updated>2018-11-05T12:44:57+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/11/05/du-zhu-guang-qian-tan-xiu-yang</id>
    <content type="html"><![CDATA[<p>ã€Šè°ˆä¿®å…»ã€‹çš„ä¸€ç‚¹è¯»ä¹¦æ‚æƒ³å’Œæ‘˜æŠ„ã€‚</p>

<!-- more -->


<p><br></p>

<ul>
<li><a href="#%E8%B0%88%E5%A4%84%E7%BE%A4%E4%B8%8A%E4%B8%AD%E4%B8%8B">è°ˆå¤„ç¾¤ï¼ˆä¸Šã€ä¸­ã€ä¸‹ï¼‰</a></li>
<li><a href="#%E8%B0%88%E5%AD%A6%E9%97%AE">è°ˆå­¦é—®</a></li>
<li><a href="#%E8%B0%88%E8%AF%BB%E4%B9%A6">è°ˆè¯»ä¹¦</a>

<ul>
<li><a href="#%E5%A5%BD%E4%B9%A6%E4%B8%8D%E5%8E%8C%E7%99%BE%E5%9B%9E%E8%AF%BB">å¥½ä¹¦ä¸åŒç™¾å›è¯»</a></li>
<li><a href="#%E7%9F%A5%E8%AF%86%E7%B3%BB%E7%BB%9F%E5%8C%96">çŸ¥è¯†ç³»ç»ŸåŒ–</a></li>
</ul>
</li>
<li><a href="#%E8%B0%88%E8%8B%B1%E9%9B%84%E5%B4%87%E6%8B%9C">è°ˆè‹±é›„å´‡æ‹œ</a>

<ul>
<li><a href="#%E8%8B%B1%E9%9B%84%E4%B8%8E%E5%8E%86%E5%8F%B2">è‹±é›„ä¸å†å²</a></li>
<li><a href="#%E8%8B%B1%E9%9B%84%E4%B8%8E%E4%BA%BA%E6%A0%BC%E6%8F%90%E5%8D%87">è‹±é›„ä¸äººæ ¼æå‡</a></li>
</ul>
</li>
<li><a href="#%E8%B0%88%E4%BA%A4%E5%8F%8B">è°ˆäº¤å‹</a></li>
<li><a href="#%E8%B0%88%E9%9D%92%E5%B9%B4%E4%B8%8E%E6%81%8B%E7%88%B1%E7%BB%93%E5%A9%9A">è°ˆé’å¹´ä¸æ‹çˆ±ç»“å©š</a></li>
<li><a href="#%E8%B0%88%E4%BC%91%E6%81%AF">è°ˆä¼‘æ¯</a></li>
<li><a href="#%E8%B0%88%E6%B6%88%E9%81%A3">è°ˆæ¶ˆé£</a></li>
<li><a href="#%E8%B0%88%E4%BD%93%E8%82%B2">è°ˆä½“è‚²</a></li>
<li><a href="#%E8%B0%88%E7%BE%8E%E6%84%9F%E6%95%99%E8%82%B2">è°ˆç¾æ„Ÿæ•™è‚²</a>

<ul>
<li><a href="#%E7%BE%8E%E8%82%B2%E6%98%AF%E6%9C%AC%E8%83%BD%E5%86%B2%E5%8A%A8%E5%92%8C%E6%83%85%E6%84%9F%E7%9A%84%E8%A7%A3%E6%94%BE">ç¾è‚²æ˜¯æœ¬èƒ½å†²åŠ¨å’Œæƒ…æ„Ÿçš„è§£æ”¾ã€‚</a></li>
<li><a href="#%E7%BE%8E%E8%82%B2%E6%98%AF%E7%9C%BC%E7%95%8C%E7%9A%84%E8%A7%A3%E6%94%BE">ç¾è‚²æ˜¯çœ¼ç•Œçš„è§£æ”¾ã€‚</a></li>
<li><a href="#%E7%BE%8E%E8%82%B2%E6%98%AF%E8%87%AA%E7%84%B6%E9%99%90%E5%88%B6%E7%9A%84%E8%A7%A3%E6%94%BE">ç¾è‚²æ˜¯è‡ªç„¶é™åˆ¶çš„è§£æ”¾ã€‚</a></li>
<li><a href="#%E7%88%B1%E7%BE%8E%E7%9A%84%E5%A4%A9%E6%80%A7%E9%9C%80%E8%A6%81%E5%9F%B9%E5%85%BB">çˆ±ç¾çš„å¤©æ€§éœ€è¦åŸ¹å…»</a></li>
</ul>
</li>
<li><a href="#%E7%BB%99%E7%94%B3%E6%8A%A5%E9%9D%92%E5%B9%B4%E7%9A%84%E9%9D%92%E5%B9%B4%E8%AF%BB%E8%80%85">ç»™ã€Šç”³æŠ¥é’å¹´ã€‹çš„é’å¹´è¯»è€…</a></li>
</ul>


<p><br></p>

<p><a id="markdown-è°ˆå¤„ç¾¤ä¸Šä¸­ä¸‹" name="è°ˆå¤„ç¾¤ä¸Šä¸­ä¸‹"></a></p>

<h2>è°ˆå¤„ç¾¤ï¼ˆä¸Šã€ä¸­ã€ä¸‹ï¼‰</h2>

<p>è¯´äº†å¾ˆå¤šï¼Œä¹Ÿé¢‡æœ‰æ„Ÿè§¦ï¼Œä½†æ˜¯æ²¡èƒ½æ€»ç»“å‡ºæ¥ã€‚</p>

<p><a id="markdown-è°ˆå­¦é—®" name="è°ˆå­¦é—®"></a></p>

<h2>è°ˆå­¦é—®</h2>

<p>åšå­¦é—®ä¸ç­‰åŒäºâ€œè¯»ä¹¦â€ã€‚è¯»ä¹¦åªæ˜¯åšå­¦é—®çš„ä¸€ç§æ–¹å¼ã€‚</p>

<p>å­”å­é‚£å¥â€œå­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ€ â€é“å‡ºäº†å­¦é—®çš„çœŸè°›ã€‚ä¸èƒ½ç©ºæƒ³ï¼Œä¹Ÿä¸èƒ½æ­»è¯»ä¹¦ã€‚</p>

<p>å­¦æ ¡æ•™è‚²çš„ä¸¤ä¸ªä½œç”¨åº”è¯¥æ˜¯ï¼š</p>

<ul>
<li>å¯å‘å…´è¶£</li>
<li>æŒ‡ç‚¹é—¨å¾„</li>
</ul>


<p>è€Œç°åœ¨çš„å­¦æ ¡ä¸åœ¨è¿™ä¸¤ä¸ªæ–¹é¢åŠªåŠ›ï¼Œåªå°½é‡åœ¨çŒè¾“çŸ¥è¯†ã€‚è¿™ç§æ•™è‚²å¯¹äºå­¦é—®ä¸ä»…æ— è£¨ç›Šï¼Œè€Œä¸”æ˜¯éšœç¢ã€‚</p>

<p><a id="markdown-è°ˆè¯»ä¹¦" name="è°ˆè¯»ä¹¦"></a></p>

<h2>è°ˆè¯»ä¹¦</h2>

<p><a id="markdown-å¥½ä¹¦ä¸åŒç™¾å›è¯»" name="å¥½ä¹¦ä¸åŒç™¾å›è¯»"></a></p>

<h3>å¥½ä¹¦ä¸åŒç™¾å›è¯»</h3>

<p>â€œå¥½ä¹¦ä¸åŒç™¾å›è¯»ï¼Œç†Ÿè¯»æ·±æ€å­è‡ªçŸ¥ã€‚â€</p>

<p>å¤šè¯»ä¸èƒ½ç®—ä½œè£èª‰ï¼Œå°‘è¯»ä¹Ÿä¸èƒ½ç®—æ˜¯è€»è¾±ã€‚å°‘è¯»å¦‚æœå½»åº•ï¼Œå¿…èƒ½å…»æˆæ·±æ€ç†Ÿè™‘çš„ä¹ æƒ¯ï¼Œæ¶µæ³³ä¼˜æ¸¸ï¼Œä»¥è‡³äºå˜åŒ–æ°”è´¨ï¼›å¤šè¯»è€Œä¸æ±‚ç”šè§£ï¼Œåˆ™å¦‚é©°éª‹åé‡Œæ´‹åœºï¼Œè™½çå¥‡æ»¡ç›®ï¼Œå¾’æƒ¹å¾—å¿ƒèŠ±æ„ä¹±ï¼Œç©ºæ‰‹è€Œå½’ã€‚ä¸–é—´è®¸å¤šè¯»ä¹¦äººåªä¸ºè£…ç‚¹é—¨é¢ï¼Œå¦‚æš´å‘æˆ·ç‚«è€€å®¶ç§ï¼Œä»¥å¤šä¸ºè´µã€‚è¿™åœ¨æ²»å­¦æ–¹é¢æ˜¯è‡ªæ¬ºæ¬ºäººï¼Œåœ¨åšäººæ–¹é¢æ˜¯è¶£å‘³ä½åŠ£ã€‚</p>

<p><a id="markdown-çŸ¥è¯†ç³»ç»ŸåŒ–" name="çŸ¥è¯†ç³»ç»ŸåŒ–"></a></p>

<h3>çŸ¥è¯†ç³»ç»ŸåŒ–</h3>

<p>ä¸€ä¹¦åšå‡ éçœ‹ï¼Œæ¯ä¸€éåªç€é‡æŸä¸€æ–¹é¢ã€‚ä¹Ÿå°±æ˜¯è¯´è¯»ä¹¦è¦æœ‰ä¸­å¿ƒï¼Œæœ‰ä¸­å¿ƒæ‰æ˜“æœ‰ç³»ç»Ÿç»„ç»‡ã€‚</p>

<p>ä¸€ä¸ªäººå¿ƒä¸­å¯ä»¥æœ‰å¤šä¸ªç³»ç»Ÿä¸­å¿ƒï¼Œå°†çœ‹åˆ°çš„çŸ¥è¯†å½’åˆ°ä¸åŒçš„ç³»ç»Ÿæ¡†æ¶ä¸­å»ã€‚å¤§å‡¡é›¶æ˜Ÿç‰‡æ®µçš„çŸ¥è¯†ï¼Œä¸ä½†æ˜“å¿˜ï¼Œè€Œä¸”æ— ç”¨ã€‚æ¯æ¬¡æ‰€å¾—çš„æ–°çŸ¥è¯†å¿…é¡»ä¸æ—§æœ‰çš„çŸ¥è¯†è”ç»œè´¯ç©¿ï¼Œè¿™å°±æ˜¯è¯´ï¼Œå¿…é¡»å›´ç»•ä¸€ä¸ªä¸­å¿ƒå½’èšåˆ°ä¸€ä¸ªç³»ç»Ÿé‡Œå»ï¼Œæ‰ä¼šç”Ÿæ ¹ï¼Œæ‰ä¼šå¼€èŠ±ç»“æœã€‚</p>

<p><a id="markdown-è°ˆè‹±é›„å´‡æ‹œ" name="è°ˆè‹±é›„å´‡æ‹œ"></a></p>

<h2>è°ˆè‹±é›„å´‡æ‹œ</h2>

<p><a id="markdown-è‹±é›„ä¸å†å²" name="è‹±é›„ä¸å†å²"></a></p>

<h3>è‹±é›„ä¸å†å²</h3>

<p><strong>è‹±é›„é€ æ—¶åŠ¿</strong></p>

<p>å¡è±å°”åœ¨ã€Šè‹±é›„å´‡æ‹œã€‹ä¸­è¯´â€œäººç±»åœ¨è¿™ä¸–ç•Œä¸Šæ‰€æˆå°±çš„äº‹ä¸šçš„å†å²ï¼Œéª¨å­é‡Œå°±æ˜¯åœ¨å½“ä¸­å·¥ä½œçš„å‡ ä¸ªä¼Ÿå¤§ä»»åŠ¡çš„å†å²ã€‚â€
å°¼é‡‡çš„è¶…äººä¸»ä¹‰ï¼Œä¹Ÿæ˜¯ä¸ºè‹±é›„å´‡æ‹œæ¶‚ä¸Šäº†å“²å­¦è‰²å½©ã€‚</p>

<p><strong>æ—¶åŠ¿é€ è‹±é›„</strong></p>

<p>æ‰˜å°”æ–¯æ³°çš„ã€Šæˆ˜äº‰ä¸å’Œå¹³ã€‹åœ¨ä¼ è¾¾â€œæ—¶åŠ¿é€ è‹±é›„â€çš„ç†å¿µã€‚</p>

<p><a id="markdown-è‹±é›„ä¸äººæ ¼æå‡" name="è‹±é›„ä¸äººæ ¼æå‡"></a></p>

<h3>è‹±é›„ä¸äººæ ¼æå‡</h3>

<p>æ’‡å¼€è‹±é›„å’Œå†å²çš„å…³ç³»ä¸è¯´ï¼Œä½†æ˜¯å¯¹äººçš„æ•™è‚²æ„ŸåŒ–çš„ä½œç”¨ï¼Œå°±ä¸èƒ½å¦å®šè‹±é›„å´‡æ‹œã€‚æ­£æ‰€è°“â€œé«˜å±±ä»°æ­¢ï¼Œæ™¯è¡Œè¡Œæ­¢ã€‚è™½ä¸èƒ½è‡³ï¼Œç„¶å¿ƒå‘å¾€ä¹‹ã€‚â€</p>

<p>å°¤å…¶åœ¨é’å°‘å¹´æ—¶ä»£ï¼Œæ„å‘çš„åŠ›é‡å¤§äºæ¦‚å¿µï¼Œä¸å…¶å‘ä»–ä»¬è¯´ä»ä¹‰é“å¾·ï¼Œä¸å¦‚æŒ‡ç‚¹å‡ ä¸ªæœ‰è¡€æœ‰è‚‰çš„å…·æœ‰ä»ä¹‰é“å¾·çš„äººç»™ä»–ä»¬çœ‹ã€‚æ•™è‚²é‡äººæ ¼æ„ŸåŒ–ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªå…·ä½“çš„äººæ ¼æ‰çœŸæ­£æœ‰æ„ŸåŒ–åŠ›ã€‚</p>

<p><a id="markdown-è°ˆäº¤å‹" name="è°ˆäº¤å‹"></a></p>

<h2>è°ˆäº¤å‹</h2>

<p>è¿‘æœ±è€…èµ¤è¿‘å¢¨è€…é»‘</p>

<p>ä¸å–„äººäº¤ï¼Œå¦‚å…¥èŠå…°ä¹‹å®¤ï¼Œä¹…è€Œä¸é—»å…¶é¦™ï¼›ä¸æ¶äººäº¤ï¼Œå¦‚å…¥é²é±¼ä¹‹å¸‚ï¼Œä¹…è€Œä¸é—»å…¶è‡­ã€‚</p>

<p>è¯¤å‹éš¾å¾—</p>

<p><a id="markdown-è°ˆé’å¹´ä¸æ‹çˆ±ç»“å©š" name="è°ˆé’å¹´ä¸æ‹çˆ±ç»“å©š"></a></p>

<h2>è°ˆé’å¹´ä¸æ‹çˆ±ç»“å©š</h2>

<p>é’å¹´äººä¸å®œè¿‡æ—©æ‹çˆ±å’Œç»“å©šï¼Œéœ€è¦è‡ªç„¶çš„æ–¹æ³•å¼•å¯¼ï¼Œè€Œéæš´åŠ›ç¦æ­¢ã€‚è‡ªç„¶çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p>

<ol>
<li>ç²¾åŠ›æœ‰æ‰€å‘æŒ¥ï¼Œç²¾ç¥æœ‰æ‰€å§”æ‰˜ã€‚é’å¹´äººç²¾åŠ›æ—ºç››ï¼Œè¦ä»–é—²ç€ï¼Œéš¾å…æ³›æ»¥æ¨ªæµã€‚å‡å¦‚ä»–åœ¨å·¥ä½œé‡Œå‘ç”Ÿå…´è¶£ï¼Œåœ¨æ–‡è‰ºé‡Œå‘ç”Ÿå…´è¶£ï¼Œç”šè‡³åœ¨æ¸¸æˆè¿åŠ¨é‡Œå‘ç”Ÿå…´è¶£ï¼Œè¿™å°±å¯ä»¥å„æ–­ä»–çš„å¿ƒç¥ï¼Œä¸å«å®ƒæ—è¿ä»–æ¶‰ã€‚</li>
<li>æ”¹å–„ç¤¾äº¤ç”Ÿæ´»ï¼Œä½¿åŒæƒ…å¿ƒå¾—åˆ°æ»‹å…»ã€‚é’å¹´æœ€éœ€è¦çš„æ˜¯åŒæƒ…ï¼Œæœ€æ€•çš„æ˜¯å¯‚å¯ï¼Œæ„ˆå¯‚å¯å°±æ„ˆæ„Ÿè§‰å¼‚æ€§éœ€è¦çš„è¿«åˆ‡ã€‚ä¸€èˆ¬é’å¹´è¿½æ±‚å¼‚æ€§ï¼Œä¸å…¶è¯´æ˜¯è¿«äºæ€§çš„å†²åŠ¨ï¼Œæ¯‹å®è¯´æ˜¯è¿«äºåŒæƒ…çš„éœ€è¦ã€‚è¦æ»¡è¶³è¿™éœ€è¦ï¼Œç¤¾ä¼šç”Ÿæ´»å¦‚æœä¸°å¯Œä¹Ÿå°±å¤Ÿäº†ã€‚ä¸€ä¸ªé’å¹´å¦‚æœæœ‰äº²çƒ­çš„å®¶åº­ç”Ÿæ´»ï¼ŒåŠ ä¸Šæ¸©æš–çš„å›¢ä½“ç”Ÿæ´»ï¼Œä¸æ„Ÿè§‰åˆ°å­¤å¯‚ï¼Œä»–è™½ç„¶è¿˜æœ‰â€œé‡â€æ‹çˆ±çš„å¯èƒ½ï¼Œå´æ— â€œè°‹â€æ‹çˆ±çš„å¿…è¦ã€‚äº¤è°Šæ„ˆå¹¿æ³›ï¼Œå‘ç”Ÿæ‹çˆ±çš„å¯èƒ½æ€§ä¹Ÿå°±æ„ˆå°‘ã€‚ä¸€ä¸ªé’å¹´æœ€å±é™©çš„é­é‡è«è¿‡äºå‘æ¥æ²¡æœ‰å’Œä¸€ä¸ªå¥³å­æœ‰è¾ƒæ·±çš„æ¥è§¦ï¼Œä¸€ç¢°è§ç¬¬ä¸€ä¸ªå¥³å­å°±çˆ±ä¸Šäº†å¥¹ã€‚</li>
</ol>


<p><a id="markdown-è°ˆä¼‘æ¯" name="è°ˆä¼‘æ¯"></a></p>

<h2>è°ˆä¼‘æ¯</h2>

<p>èŠ‚å¥ï¼Œä¼˜æ¸¸æ¶µæ³³</p>

<p>ä¼‘æ¯ä¸ä»…ä¸ºè“„åŠ›ï¼Œä¹Ÿä¸ºæ•´ç†é…é…¿ï¼Œè®©ç­‹è‚‰æŠ€å·§åœ¨æ½œæ„è¯†ä¸­é…é…¿å‡å›ºã€‚</p>

<p>æˆ‘ï¼ˆæœ±å…‰æ½œï¼‰ç”Ÿå¹³æœ€çˆ±é™¶æ¸Šæ˜åœ¨è‡ªç¥­æ–‡é‡Œæ‰€è¯´çš„ä¸¤å¥è¯ï¼šâ€œå‹¤é¡ä½™åŠ³ï¼Œå¿ƒæœ‰å¸¸é—²â€ï¼Œè¿™æ˜¯ä¿®å…»çš„æå¢ƒï¼Œäººäº‹ç®—å°½äº†ï¼Œè€Œç¥ä»™ç¦åˆ†ä¹Ÿå°±åœ¨å°½äººäº‹ä¸­äº«ç€ã€‚ç°ä»£äººçš„æ¯›ç—…æ˜¯â€œå‹¤æœ‰ä½™åŠ³ï¼Œå¿ƒæ— å¶é—²â€ã€‚è¿™ä½¿äººå¿ƒåœ°é©³æ‚ï¼Œç¼ºä¹å†²å’Œå¼˜æ¯…çš„æ°”è±¡ï¼Œæ—¥æ—¥å›°äºåç¼°åˆ©é”ï¼Œå«æ•´ä¸ªä¸–ç•Œæ—¥è¶‹äºå¹²æ¯é»‘æš—ã€‚</p>

<p><a id="markdown-è°ˆæ¶ˆé£" name="è°ˆæ¶ˆé£"></a></p>

<h2>è°ˆæ¶ˆé£</h2>

<p>èº«å’Œå¿ƒåˆ°æ´»åŠ¨éƒ½æœ‰æœ‰èŠ‚å¥åˆ°å‘¨æœŸã€‚æ­¤æ‰€è°“â€œä¸€å¼ ä¸€å¼›æ–‡æ­¦ä¹‹é“â€ã€‚</p>

<p>æ›´ç•ªç“œä»£ï¼šè„‘åŠ›å·¥ä½œè€…è¦æ—¶ä¸æ—¶åœ°åšäº›ä½“åŠ›æ´»åŠ¨ã€‚</p>

<p>å„’å®¶å…­è‰ºï¼šè¯—ä¹¦ç¤¼ä¹å°„å¾¡ï¼Œå…¶ä¸­åå››é¡¹éƒ½å¸¦æœ‰æ¶ˆé£å¨±ä¹åˆ°æ„å‘³ã€‚å­”å­è°ˆä¿®å…»ï¼Œâ€œå±€äºäººâ€ä¹‹åå³ç»§ä»¥â€œæ¸¸äºè‰ºâ€ã€‚</p>

<p>ä¸–é—´æ¬¢å–œæ¶ˆé£çš„äººï¼Œæ— è®ºä»–ä»¬åˆ°å—œå¥½å¦‚ä½•ä¸åŒï¼Œéƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œå°±æ˜¯ä»–ä»¬å¿…éƒ½æœ‰å¼ºæ—ºçš„ç”Ÿæ´»åŠ›ï¼Œè¿åŠ¨å®¶å’Œè‰ºæœ¯å®¶å¦‚æ­¤ï¼Œå«–å®¢èµŒå¾’ä¹ƒè‡³äºçƒŸé¬¼ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä»–ä»¬åˆ°ç”Ÿæ´»åŠ›å¼ºæ—ºï¼Œå‘æ³„åˆ°éœ€æ±‚ä¹Ÿå°±æ€¥è¿«ã€‚ä»–ä»¬æ‰€ä¸åŒè€…åªåœ¨å‘æ³„æ–¹å¼ã€‚è¿™æœ‰å¦‚å¤§æ°´ï¼Œå¯ä»¥çŒç”°ã€å‘ç”µæˆ–æ¨åŠ¨æœºå™¨ï¼Œä¹Ÿå¯ä»¥æ³›æ»¥æ¨ªæµï¼Œæ·¹æ¯™äººç•œè‰æœ¨ã€‚åŒæ˜¯å¼ºæ—ºåˆ°ç”Ÿæ´»åŠ›ï¼Œç”¨åœ¨è¿åŠ¨å¯ä»¥å¥èº«ï¼Œç”¨åœ¨è‰ºæœ¯å¯ä»¥æ€¡æƒ…å…»æ€§ï¼Œç”¨åœ¨åƒå–å«–èµŒå°±å¯ä»¥åŠ³æ°‘ä¼¤è´¢ï¼Œä¸ºéä½œæ­¹ã€‚â€œæµªå­å›å¤´æ˜¯ä¸ªå®â€ï¼Œä¹Ÿæ˜¯è¿™ä¸ªé“ç†ã€‚æµªå­å¿…æ˜¯ç”Ÿæ´»åŠ›å¼ºæ—ºåˆ°äººï¼Œå¦‚æœå¯ä»¥ç”¨äºæ­£é“ï¼Œä¹Ÿå¿…æ˜¯äººä¸Šä¹‹äººã€‚</p>

<p><a id="markdown-è°ˆä½“è‚²" name="è°ˆä½“è‚²"></a></p>

<h2>è°ˆä½“è‚²</h2>

<p>å¾·ã€æ™ºã€ä½“ã€ç¾å‡è¡¡å‘å±•ã€‚</p>

<p>å¥åº·æœ‰å…ˆå¤©å› ç´ ï¼Œä¹Ÿæœ‰åå¤©å› ç´ ã€‚å…ˆå¤©å› ç´ æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯ä¼˜ç”Ÿä¼˜è‚²ï¼Œæ¯äº²çš„ä½“æ ¼åº·å¥æ¯”çˆ¶äº²æ›´é‡è¦ã€‚åå¤©å¥åº·è¦æ³¨æ„ä¸‰ä¸ªæ–¹é¢ã€‚ä¸€æ˜¯è¥å…»é€‚å®œï¼ŒäºŒæ˜¯ç”Ÿæ´»è§„å¾‹ï¼Œä¸‰æ˜¯å¿ƒå¢ƒè¦å®½å’Œå†²æ·¡ï¼Œå°‘åŠ¨æ°”ï¼Œå°‘å­˜æ‚å¿µã€‚</p>

<blockquote><p>æˆ‘å›½å¤ä»£ç‰¹åˆ«çœ‹ä¸­ä¸Šè¿°çš„ç¬¬ä¸‰ç‚¹ã€‚â€œå…»ç”Ÿè«å–„äºå¯¡æ¬²ã€‚â€è¿‘ä»£ç¤¾ä¼šå¤æ‚ï¼Œåˆºæ¿€ç‰¹å¤šï¼Œæ„ˆè¿‘äºæ–‡æ˜ï¼Œæ„ˆè¿œäºè‡ªç„¶ï¼Œå¤„å¤„éƒ½æ˜¯æ‰°ä¹±å¿ƒæ™ºçš„äº‹ç‰©ï¼Œå°±æ˜¯å¤„å¤„é€¼æˆ‘ä»¬æ‰“æ¶ˆè€—æˆ˜ã€‚æˆ‘ä»¬å¿…é¡»æ·¡æ³Šå®é™ï¼Œä»¥é€¸å¾…åŠ³ã€‚è¿™ä¸ä½†å¯ä»¥å…»ç”Ÿï¼Œä¹Ÿå¯ä»¥ä½¿å­¦é—®äº‹ä¸šå¾—åˆ°è¾ƒå¤§çš„æˆå°±ã€‚</p></blockquote>

<p>è¦è®­ç»ƒäº’åŠ©ã€å°Šé‡çºªå¾‹çš„ç²¾ç¥ï¼Œæœ€å¥½çš„è¿åŠ¨åœºæ‰€æ˜¯è¿åŠ¨åœºã€‚</p>

<p><a id="markdown-è°ˆç¾æ„Ÿæ•™è‚²" name="è°ˆç¾æ„Ÿæ•™è‚²"></a></p>

<h2>è°ˆç¾æ„Ÿæ•™è‚²</h2>

<p>æœ±å­è¯—äº‘ï¼šâ€œåŠäº©æ–¹å¡˜ä¸€é‰´å¼€ï¼Œå¤©å…‰äº‘å½±å…±å¾˜å¾Šã€‚é—®æ¸ å“ªå¾—æ¸…å¦‚è®¸ï¼Ÿä¸ºæœ‰æºå¤´æ´»æ°´æ¥ã€‚â€è¿™è¯—æ‰€å†™çš„æ˜¯ä¸€ç§ä¿®å…»çš„èƒœå¢ƒã€‚ç¾æ„Ÿæ•™è‚²ç»™æˆ‘ä»¬çš„æ˜¯â€œæºå¤´æ´»æ°´â€ã€‚</p>

<p><a id="markdown-ç¾è‚²æ˜¯æœ¬èƒ½å†²åŠ¨å’Œæƒ…æ„Ÿçš„è§£æ”¾" name="ç¾è‚²æ˜¯æœ¬èƒ½å†²åŠ¨å’Œæƒ…æ„Ÿçš„è§£æ”¾"></a></p>

<h4>ç¾è‚²æ˜¯æœ¬èƒ½å†²åŠ¨å’Œæƒ…æ„Ÿçš„è§£æ”¾ã€‚</h4>

<p>å®—æ•™ã€æ³•å¾‹ã€é“å¾·çº¦æŸä¸‹çš„æ¬²æœ›ï¼Œå¯ä»¥åœ¨ç¾è‚²ä¸­å¾—åˆ°è§£æ”¾ã€‚</p>

<p><a id="markdown-ç¾è‚²æ˜¯çœ¼ç•Œçš„è§£æ”¾" name="ç¾è‚²æ˜¯çœ¼ç•Œçš„è§£æ”¾"></a></p>

<h4>ç¾è‚²æ˜¯çœ¼ç•Œçš„è§£æ”¾ã€‚</h4>

<p>ç¾è‚²å¯ä»¥åŸ¹å…»å‘ç°ç”Ÿæ´»ç¾çš„çœ¼ç›ã€‚</p>

<p><a id="markdown-ç¾è‚²æ˜¯è‡ªç„¶é™åˆ¶çš„è§£æ”¾" name="ç¾è‚²æ˜¯è‡ªç„¶é™åˆ¶çš„è§£æ”¾"></a></p>

<h4>ç¾è‚²æ˜¯è‡ªç„¶é™åˆ¶çš„è§£æ”¾ã€‚</h4>

<p>è¿™æ˜¯å¾·å›½å”¯å¿ƒæ´¾å“²å­¦å®¶åº·å¾·ã€å¸­å‹’ã€å”æœ¬åã€å°¼é‡‡è¯¸äººæ‰€æœ€çœ‹é‡çš„ä¸€ç‚¹ï¼Œç°åœ¨æˆ‘ä»¬ç”¨æµ…è¿‘è¯­æ¥è¯´æ˜å®ƒã€‚</p>

<p>è‡ªç„¶ä¸–ç•Œæ˜¯æœ‰é™çš„ï¼Œå—å› æœå¾‹æ”¯é…çš„ï¼Œå…¶ä¸­æ¯«æœ«ç»†æ•…éƒ½æœ‰ä»–çš„å¿…ç„¶æ€§ã€‚ç¤¾ä¼šç”±å†å²é“¸å°±ï¼Œäººç”±é—ä¼ å’Œç¯å¢ƒé€ æˆã€‚äººçš„æ´»åŠ¨ å¯¸æ­¥ç¦»ä¸å¼€ç‰©è´¨ç”Ÿå­˜æ¡ä»¶çš„æ”¯é…ï¼Œæ²¡æœ‰ç¿…è†€å°±ä¸èƒ½é£ï¼Œç»é¥®é£Ÿå°±ä¼šé¥¿æ­»ã€‚ç”±æ­¤ç±»æ¨ï¼Œäººåœ¨è‡ªç„¶ä¸­æ˜¯æä¸è‡ªç”±çš„ã€‚åŠ¨æ¤ç‰©å’Œéç”Ÿç‰©ä¸€å‘³é¡ºä»è‡ªç„¶ï¼Œæ¥å—å®ƒçš„é™åˆ¶ï¼Œæ²¡æœ‰è¿‡åˆ†å¸Œå†€ï¼Œä¹Ÿå°±æ²¡æœ‰å¤±æœ›å’Œç—›è‹¦ã€‚äººå´ä¸åŒï¼Œä»–æœ‰å¿ƒçµï¼Œæœ‰ä¸å¯å‹åˆ¶çš„æ¬²æœ›ã€‚äººå¯ä»¥è¯´æ˜¯ä¸¤é‡å¥´éš¶ï¼Œç¬¬ä¸€æœä»è‡ªç„¶çš„é™åˆ¶ï¼Œå…¶æ¬¡è¦å—è‡ªå·±çš„æ¬²æœ›é©±ä½¿ã€‚<strong>ä»¥æ— ç©·æ¬²æœ›å¤„æœ‰é™è‡ªç„¶ï¼Œäººä¾¿è§‰å¾—å¤„å¤„ä¸å¦‚æ„ï¼Œä¸è‡ªç”±ï¼Œçƒ¦é—·è‹¦æ¼éƒ½ç”±æ­¤èµ·ã€‚</strong></p>

<p>ä¸“å°±ç‰©è´¨è¯´ï¼Œäººåœ¨è‡ªç„¶é¢å‰æ˜¯ååˆ†æ¸ºå°çš„ã€‚ä½†åœ¨ç²¾ç¥æ–¹é¢ï¼Œäººå¯ä»¥è·³å¼€è‡ªç„¶çš„åœˆå¥—è€Œå¾æœè‡ªç„¶ï¼Œä»–å¯ä»¥åœ¨è‡ªç„¶ä¸–ç•Œä¹‹å¤–å¦åœ¨æƒ³è±¡ä¸­é€ å‡ºè¾ƒèƒ½åˆç†æ…°æƒ…çš„ä¸–ç•Œã€‚è¿™å°±æ˜¯è‰ºæœ¯çš„åˆ›é€ ã€‚</p>

<p>å¤šæ¥å—ç¾æ„Ÿæ•™è‚²ï¼Œå°±æ˜¯å¤šå­¦ä¼šå¦‚ä½•ä»è‡ªç„¶é™åˆ¶ä¸­è§£æ”¾å‡ºæ¥ï¼Œç”±å¥´éš¶å˜æˆä¸Šå¸ï¼Œå……åˆ†åœ°æ„Ÿè§‰äººçš„å°Šä¸¥ã€‚</p>

<p><a id="markdown-çˆ±ç¾çš„å¤©æ€§éœ€è¦åŸ¹å…»" name="çˆ±ç¾çš„å¤©æ€§éœ€è¦åŸ¹å…»"></a></p>

<h3>çˆ±ç¾çš„å¤©æ€§éœ€è¦åŸ¹å…»</h3>

<p>çˆ±ç¾æ˜¯äººçš„å¤©æ€§ï¼Œè™½æ˜¯å¤©æ€§ï¼Œä»éœ€è¦åŸ¹å…»ï¼Œå¦åˆ™ï¼Œä¾¿ä¼šå‡‹é›¶ã€‚</p>

<p>ç¾è‚²å¿…é¡»ä»å¹´è½»æ—¶å…¥æ‰‹ï¼Œå¹´çºªæ„ˆå¤§ï¼Œå¤–åŠ¡æ„ˆçº·ç¹ï¼Œä¹ æƒ¯çš„ç‰¢ç¬¼æ„ˆåšå›ºï¼Œæ„Ÿè§‰æ„ˆè¿Ÿé’ï¼Œå¿ƒé‡Œæ„ˆå¤æ‚ï¼Œæ¬£èµè‰ºæœ¯åŠ›ä¹Ÿå°±æ„ˆè–„å¼±ã€‚</p>

<p>æˆ‘æ—¶å¸¸æƒ³ï¼Œæ— è®ºå­¦å“ªä¸€ç§‘ä¸“é—¨å­¦é—®ï¼Œå¹²å“ªä¸€è¡ŒèŒä¸šï¼Œæ¯ä¸ªäººéƒ½åº”è¯¥ä¼šå¬éŸ³ä¹ï¼Œä¸æ–­åœ°è¯»æ–‡å­¦ä½œå“ï¼Œå¶å°”æœ‰æ¬£èµå›¾ç”»ã€é›•åˆ»çš„æœºä¼šã€‚</p>

<p>ä»å†å²çœ‹ï¼Œä¸€ä¸ªæ°‘æ—åœ¨æœ€å…´æ—ºçš„æ—¶å€™ï¼Œè‰ºæœ¯æˆå°±å¿…ä¼Ÿå¤§ï¼Œç¾è‚²å¿…å‘è¾¾ã€‚å²è¯—æ‚²å‰§æ—¶ä»£çš„å¸Œè…Šã€æ–‡è‰ºå¤å…´æ—¶ä»£çš„æ„å¤§åˆ©ã€èå£«æ¯”äºšæ—¶ä»£çš„è‹±å›½ã€æ­Œå¾·å’Œè´å¤šèŠ¬æ—¶ä»£çš„å¾·å›½éƒ½å¯ä»¥ä½œè¯ã€‚ç°åœ¨æˆ‘ä»¬è¦æƒ³å¤å…´æ°‘æ—ï¼Œå¿…é¡»æ¢å¤å‘¨ä»¥å‰æ­Œä¹èˆçš„ç››å†µï¼Œè¿™å°±æ˜¯è¯´ï¼Œå¿…é¡»æå€¡æ™®åŠçš„ç¾æ„Ÿæ•™è‚²ã€‚</p>

<p><a id="markdown-ç»™ç”³æŠ¥é’å¹´çš„é’å¹´è¯»è€…" name="ç»™ç”³æŠ¥é’å¹´çš„é’å¹´è¯»è€…"></a></p>

<h2>ç»™ã€Šç”³æŠ¥é’å¹´ã€‹çš„é’å¹´è¯»è€…</h2>

<p>æˆ‘å¾ˆä½©æœè‹±å›½äººï¼Œä»–ä»¬æ€»æ˜¯äº‹åˆ°å¤´æ¥ï¼Œæ‰æƒ³åŠæ³•ã€‚äº‹æ²¡æœ‰æ¥åˆ°å¤´æ¥ï¼Œä»–ä»¬æ€»æ˜¯å†·é™åœ°ç­‰å¾…ç€ï¼Œè§‚å¯Ÿç€ï¼Œä»Šå¤©å†³ä¸æ‰“æ˜å¤©çš„è®¡ç®—ã€‚ä½†æ˜¯ä»–ä»¬ä¹Ÿå†³ä¸è‚¯æ”¾å¼ƒç°åœ¨çš„æœºä¼šï¼Œè§‰å¾—ä¸€ä»¶äº‹åº”è¯¥å»åšï¼Œå°±é©¬ä¸Šå»åšï¼Œä¸å¼ çš‡ä¹Ÿä¸è¿Ÿç–‘ã€‚ä»–ä»¬çš„å›½å®¶å†…æ”¿å¤–äº¤å¦‚æ­¤ï¼Œä¸ªäººç»è¥çš„äº‹ä¸šä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä»–ä»¬ä¸å¹»æƒ³æœªæ¥ï¼Œä»–ä»¬çš„è€è°‹æ·±ç®—éƒ½è´¹åœ¨æŠ“ä½ç°åœ¨å’Œè®¤æ¸…ç°åœ¨ä¸Šé¢ã€‚ä»–ä»¬å‡ºæ­»åŠ›æŠ“ä½ç°åœ¨ï¼Œäº‹åˆ°å¤´æ¥æ—¶ï¼Œä»–ä»¬æ€»æ˜¯ä¸æ…Œä¸å¿™åœ°å¤„ç†çš„å¾ˆå¦¥å½“ã€‚è¿™ç§å†·é™æ²‰ç€çš„æ€åº¦å°±æ˜¯å€¼å¾—æˆ‘ä»¬è§‚æ‘©çš„ã€‚</p>

<p>â€œä¸‰æ­¤â€ï¼šæ­¤èº«ï¼Œæ­¤æ—¶ï¼Œæ­¤åœ°ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…³äºARçš„ä¸€äº›ä½¿ç”¨åœºæ™¯]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/08/17/some-ideas-on-ar-usage/"/>
    <updated>2018-08-17T15:13:58+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/08/17/some-ideas-on-ar-usage</id>
    <content type="html"><![CDATA[<p>æœé›†ä¸€äº›æœ‰æ„æ€çš„ARåº”ç”¨ã€‚</p>

<!-- more -->


<p>ä¸»è¦å‚è€ƒï¼š<a href="https://github.com/olucurious/Awesome-ARKit">Awesome ARKit</a>ã€‚è¿™ç¯‡posté‡Œé¢è¿˜æœ‰å¾ˆå¤šå®ç”¨çš„AR Tutorialå’ŒResoucesï¼Œå¦‚æœè‡ªå·±åŠ¨æ‰‹ï¼Œå¯ä»¥å‚è€ƒã€‚</p>

<ul>
<li><a href="#app-store%E4%B8%8A%E9%9D%A2%E7%9A%84app">App Storeä¸Šé¢çš„App</a>

<ul>
<li><a href="#%E7%A5%9E%E5%A5%87ar">ç¥å¥‡AR</a></li>
<li><a href="#ikea-place">IKEA Place</a></li>
<li><a href="#wallr">Wallr</a></li>
<li><a href="#horizon-explorer">Horizon Explorer</a></li>
<li><a href="#weare">WeAre</a></li>
<li><a href="#waazy---magic-ar-video-maker">Waazy - Magic AR Video Maker</a></li>
<li><a href="#human-anatomy-atlas-2019">Human Anatomy Atlas 2019</a></li>
</ul>
</li>
<li><a href="#github%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%A1%B9%E7%9B%AE">Githubä¸Šé¢çš„é¡¹ç›®</a>

<ul>
<li><a href="#arkit-occlusion-demo">arkit-occlusion-demo</a></li>
<li><a href="#arvideokit">[ARVideoKit]()</a></li>
<li><a href="#arkit-smb-homage">arkit-smb-homage</a></li>
<li><a href="#arkit-corelocation">ARKit-CoreLocation</a></li>
<li><a href="#arkitnavigationdemo">ARKitNavigationDemo</a></li>
<li><a href="#fineme">FineMe</a></li>
<li><a href="#arkitspitfire">ARKitSpitfire</a></li>
</ul>
</li>
<li><a href="#resources">Resources</a>

<ul>
<li><a href="#poly">Poly</a></li>
</ul>
</li>
</ul>


<p><a id="markdown-app-storeä¸Šé¢çš„app" name="app-storeä¸Šé¢çš„app"></a></p>

<h2>App Storeä¸Šé¢çš„App</h2>

<p><a id="markdown-ç¥å¥‡arhttpsitunesapplecomcnappar-arid1327719623mt8" name="ç¥å¥‡ar"></a></p>

<h3><a href="https://itunes.apple.com/cn/app/%E7%A5%9E%E5%A5%87ar-%E7%89%B9%E6%95%88ar%E7%9B%B8%E6%9C%BA%E5%92%8C%E7%9F%AD%E8%A7%86%E9%A2%91%E6%8B%8D%E6%91%84%E7%A5%9E%E5%99%A8/id1327719623?mt=8">ç¥å¥‡AR</a></h3>

<p>è¿™ä¸ªARåº”ç”¨éå¸¸æ£’ï¼Œå·ç§°â€œä¸­å›½ç¬¬ä¸€ARå¹³å°â€ã€‚æ‰“å¼€Appï¼Œä»¥ä¸ºè‡ªå·±æ˜¯æ‰“å¼€äº†â€œæŠ–éŸ³â€å‘¢ã€‚å…¶æ¨¡ä»¿æŠ–éŸ³çš„ç—•è¿¹å¾ˆé‡ï¼Œä½†æ˜¯ç¥å¥‡ARçš„è§†é¢‘ä¸åŒäºæŠ–éŸ³é‡Œé¢çš„è§†é¢‘ï¼šéƒ½æ˜¯çœŸå®ä¸–ç•Œå’Œè™šæ‹Ÿä¸–ç•Œçš„æ·±å…¥äº’åŠ¨ã€‚æ”¯æŒä¸‹è½½å¾ˆå¤š3Dæ¨¡å‹ã€‚</p>

<p><a href="https://itunes.apple.com/cn/app/%E7%A5%9E%E5%A5%87ar-%E7%89%B9%E6%95%88ar%E7%9B%B8%E6%9C%BA%E5%92%8C%E7%9F%AD%E8%A7%86%E9%A2%91%E6%8B%8D%E6%91%84%E7%A5%9E%E5%99%A8/id1327719623?mt=8">ç¥å¥‡AR</a>è¿˜æœ‰ä¸€ä¸ªå¾ˆå¥½çš„åº”ç”¨ï¼šå¯ä»¥è®©ä½ å°†ç…§ç‰‡åœ¨çœŸå®åœºæ™¯ä¸­æ‰“å¼€ï¼Œæ”¯æŒé»˜è®¤çš„æ’åˆ—æ–¹å¼ï¼Œä¹Ÿå¯ä»¥è‡ªç”±æ‘†æ”¾å¤šå¼ ç…§ç‰‡ã€‚ä½†æ˜¯å›¾ç‰‡ä¸€åœˆéƒ½ä¼šé»˜è®¤å¸¦æœ‰ä¸€åœˆç™½è‰²çš„è¿‡æ¸¡å¸¦å’Œé˜´å½±ï¼Œæ— æ³•å»é™¤ã€‚å¯¹äºä¸æ˜¯æ ‡å‡†é•¿æ–¹å½¢çš„å›¾ç‰‡ï¼ˆæ¯”å¦‚åœ†å½¢çš„å›¾ç‰‡ï¼Œåœ†å½¢ä¹‹å¤–éƒ½æ˜¯é€æ˜çš„ï¼‰ï¼Œæ˜¾ç¤ºæ•ˆæœä¸ä½³ã€‚</p>

<p>è€Œä¸”ï¼Œæ˜¯å…è´¹çš„ã€‚ä¹Ÿè®¸æ˜¯å› ä¸ºå…¶ä¸»æ‰“æ®µè§†é¢‘ç¤¾äº¤å§ï¼Œæ‰€ä»¥å…è´¹ã€‚</p>

<p>çœ‹å®˜æ–¹ä»‹ç»ï¼š</p>

<blockquote><p>ARè§†é¢‘:
ç”¨æˆ·å¯ä»¥åˆ©ç”¨ARæ¨¡å‹ã€ç‰¹æ•ˆã€å›¾ç‰‡ã€è§†é¢‘ç­‰æ‹æ‘„ä¸€æ®µ30ç§’çš„çŸ­è§†é¢‘ï¼Œå‘å¸ƒåœ¨ç¥å¥‡ARçš„è§†é¢‘æµä¸­ï¼Œæˆ–è€…åˆ†äº«åˆ°å„å¤§åª’ä½“å¹³å°ï¼Œå°†è‡ªå·±çš„åˆ›æ„å±•ç°ç»™æ›´å¤šçš„äººï¼Œå‘Šè¯‰å¤§å®¶å¦‚ä½•ä½¿ç”¨ARã€‚
ç©è½¬AR:
ç”¨æˆ·å¯ä»¥æ‰“å¼€ARæ‘„åƒå¤´ï¼Œé€šè¿‡ç®€å•çš„æ“ä½œï¼Œå°†ARæ¨¡å‹æ”¾åœ¨çœŸå®ä¸–ç•Œä¸­ï¼Œåˆ›é€ å„ç§ç¥å¥‡çš„æ™¯è±¡ï¼Œç”¨ARå°±èƒ½åˆ›é€ ç”µå½±é‡Œæ‰èƒ½å‡ºç°çš„ç‰¹æŠ€ã€‚
ä¸°å¯Œçš„æ¨¡å‹:
ç¥å¥‡ARæ˜¯ä¸€ä¸ªå¼€æ”¾å†…å®¹å¹³å°ï¼Œç›´æ¥å¯¹æ¥ä¼˜è´¨çš„ARå†…å®¹æä¾›è€…ï¼Œä»–å¯ä»¥é€šè¿‡ç¥å¥‡ARæŠŠè‡ªå·±çš„ä½œå“ç¬¬ä¸€æ—¶é—´å¼€æ”¾ç»™ç”¨æˆ·ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹¥æœ‰å…¨ä¸–ç•Œæœ€ä¸°å¯Œçš„ARå†…å®¹ã€‚</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/shenqiar.jpg" alt="ç¥å¥‡ AR" /></p>

<p><a id="markdown-ikea-placehttpsitunesapplecomusappikea-placeid1279244498mt8" name="ikea-place"></a></p>

<h3><a href="https://itunes.apple.com/us/app/ikea-place/id1279244498?mt=8">IKEA Place</a></h3>

<p>å®œå®¶çš„å®˜æ–¹Appï¼Œæœ‰ä¸°å¯Œçš„å®œå®¶å®¶å…·çš„3Dæ¨¡å‹ï¼ŒçœŸå®å°ºå¯¸ï¼Œå¯ä»¥æå‰æ”¾ç½®åˆ°è‡ªå·±çš„æˆ¿é—´ï¼Œçœ‹çœ‹æ•ˆæœã€‚</p>

<blockquote><p>IKEA Place lets you virtually &lsquo;place&rsquo; IKEA products in your space. The app includes 3D and true-to-scale models of everything from sofas and armchairs to footstools and coffee tables. IKEA Place gives you an accurate impression of the furnitureâ€™s size, design and functionality in your home so you can stop wondering and start doing.</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/IKEAPlace.jpg" alt="ikea place" /></p>

<p><a id="markdown-wallrhttpsitunesapplecomusappwallrid1278372745" name="wallr"></a></p>

<h3><a href="https://itunes.apple.com/us/app/wallr/id1278372745">Wallr</a></h3>

<p>Wallrå¯ä»¥è®©ä½ å°†å›¾ç‰‡æ”¾ç½®åˆ°çœŸå®åœºæ™¯çš„å¢™é¢ä¸Šã€‚å¦‚æœä½ æƒ³ä¹°ç”»è£…é¥°å¢™é¢ï¼Œå¯ä»¥è¯•è¯•ã€‚ä¸è¿‡è¿™ä¸ªåŠŸèƒ½å·²ç»åœ¨<a href="https://itunes.apple.com/cn/app/%E7%A5%9E%E5%A5%87ar-%E7%89%B9%E6%95%88ar%E7%9B%B8%E6%9C%BA%E5%92%8C%E7%9F%AD%E8%A7%86%E9%A2%91%E6%8B%8D%E6%91%84%E7%A5%9E%E5%99%A8/id1327719623?mt=8">ç¥å¥‡AR</a>ä¸­å®ç°äº†ï¼Œè€Œä¸”æ˜¯å…è´¹çš„ã€‚</p>

<p>åŒæ—¶æ”¾ç½®å¤šå¼ å›¾ç‰‡éœ€è¦èŠ±é’±è´­ä¹°ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/wallr.jpg" alt="wallr" /></p>

<p><a id="markdown-horizon-explorerhttpsitunesapplecomgbapphorizon-explorerid1326860431platformipadpreservescrollpositiontrueplatformipad" name="horizon-explorer"></a></p>

<h3><a href="https://itunes.apple.com/gb/app/horizon-explorer/id1326860431?platform=ipad&amp;preserveScrollPosition=true#platform/ipad">Horizon Explorer</a></h3>

<p>ARå’Œåœ°å›¾ã€åœ°ç†ä½ç½®ç»“åˆçš„ä¸€ä¸ªåº”ç”¨ã€‚</p>

<p>å±•ç¤ºä½ è®¾å¤‡çœ‹åˆ°çš„åœ°ç†ä½ç½®çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è·ç¦»ã€å»ºç­‘ç‰©åç§°ã€åœ°ç‚¹åç§°ç­‰ã€‚å¹¶æŠŠè·¯çº¿åœ¨ä¸€å¼ åœ°å›¾ä¸Šé¢å±•ç¤ºç»™ä½ ã€‚</p>

<p>è¿˜å¯ä»¥å°†3Dçš„åœ°å›¾å±•ç¤ºç»™ä½ ï¼Œè®©ä½ çœ‹çœ‹æŸä¸ªæ™¯ç‚¹æˆ–è€…å»ºç­‘ç‰©å‘¨å›´ç­‰åœ°ç†ä¿¡æ¯ã€‚</p>

<p>æ¥çœ‹å®˜æ–¹ä»‹ç»ï¼š</p>

<blockquote><p>Horizon Explorer shows you the horizon and skyline around you &amp; tells you what you&rsquo;re looking at.</p>

<p>Point your camera at a hill, village, lake or landmark and Horizon Explorer will tell you what you are looking at, how far away it is, and show you a map, and information about the point you&rsquo;re aiming at.</p>

<p>ARKit technology makes the labels and alignment much more stable than used to be possible.</p>

<p>Fly up high and see the terrain laid out below you to see what is over the hills around you, and get the lay of the land, then see the scale-model 3D map that you can walk around &amp; explore to find out what&rsquo;s behind hills, or investigate up close.</p>

<p>Tracking works best on top of a hill with an unobstructed view of your surroundings (close up trees, buildings, rocks etc. can confuse the tracking). You can drag the terrain with your finger to line up with the camera if the automatic tracking is not working very well. Or try waving your phone around in the air in a figure 8 to calibrate the compass.</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/HorizonExplorer.jpg" alt="Horizon Explorer" /></p>

<p><a id="markdown-wearehttpsitunesapplecomcnappweareid1304227680platformiphonepreservescrollpositiontrueplatformiphoneplatformiphoneplatformiphone" name="weare"></a></p>

<h3><a href="https://itunes.apple.com/cn/app/weare/id1304227680?platform=iphone&amp;preserveScrollPosition=true&amp;platform=iphone#platform/iphone&amp;platform=iphone">WeAre</a></h3>

<p>è¿™ä¸ªåº”ç”¨å¯ä»¥è®©ä½ é€‰æ‹©ä¸€äº›ç…§ç‰‡ï¼Œä»¥è®¾å¤‡ä¸ºä¸­å¿ƒå›´æˆä¸€åœˆï¼Œå¹¶ç¼“æ…¢ç§»åŠ¨ã€‚è¿˜å¯ä»¥æ’­æ”¾è§†é¢‘ã€èƒŒæ™¯éŸ³ä¹å’Œç¼–è¾‘3Dæ–‡å­—ã€‚ç”¨ä½œè€…çš„è¯è¯´ï¼Œâ€œå¯ä»¥æ‰“é€ ä¸€ä¸ªæˆ–æ¸©é¦¨æµªæ¼«çš„å›å¿†ç›¸å†Œ,æˆ–ç¼¥ç¼ˆé¥è¿œçš„ä¸–ç•Œ.â€</p>

<p>åŒæ—¶è¿˜æ˜¯æºç å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/SherlockQi/HeavenMemoirs">HeavenMemoirs - ARç›¸å†Œ</a></p>

<p><img src="http://hongchaozhang.github.io/images/weare.jpg" alt="WeAre" /></p>

<p><a id="markdown-waazy---magic-ar-video-makerhttpsitunesapplecomusappwaazy-magic-ar-video-makerid1286992749" name="waazy---magic-ar-video-maker"></a></p>

<h3><a href="https://itunes.apple.com/us/app/waazy-magic-ar-video-maker/id1286992749">Waazy - Magic AR Video Maker</a></h3>

<p>æ²¡å¤ªçœ‹æ‡‚è¿™ä¸ªåº”ç”¨ã€‚æ„Ÿè§‰ä¸»è¦åšç¤¾äº¤è§†é¢‘åˆ†äº«ã€‚å½•åˆ¶è§†é¢‘è¿˜éœ€è¦AR Lensã€‚ç›´æ¥çœ‹å®˜æ–¹ä»‹ç»å§ï¼š</p>

<blockquote><p>Waazy is an augmented reality short video clips shooting and sharing social network, making it possible to bring virtual characters and objects to the real world.</p>

<p>Features:
- Record cool moments with AR Lens
- Tons of free and awesome AR effects
- Can add multiple AR characters at the same time
- One tap to make all the characters dance together
- Easily move and rotate a virtual character with control pad
- Themes include fantasy, monster, fun, and landmarks
- Show your original AR videos to the world</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/wazzy.jpg" alt="wazzy" /></p>

<p><a id="markdown-human-anatomy-atlas-2019httpsitunesapplecomappid1117998129" name="human-anatomy-atlas-2019"></a></p>

<h3><a href="https://itunes.apple.com/app/id1117998129">Human Anatomy Atlas 2019</a></h3>

<p>å…¶å®è¿™ä¸ªä¸»è¦æ˜¯å±•ç¤ºäººä½“å†…éƒ¨ç»“æ„çš„3Dç´ æï¼Œå€ŸåŠ©ARæŠ€æœ¯æŠ•å°„åˆ°çœŸå®åœºæ™¯ï¼Œæ²¡æœ‰å¾ˆæ–°é²œçš„ARåº”ç”¨åœºæ™¯ã€‚</p>

<p>è¿™ä¸ªåº”ç”¨éå¸¸ä¸“ä¸šï¼Œä¸‹è½½éœ€è¦é’±ï¼ŒAppå†…è¿˜è¦è´­ä¹°ã€‚</p>

<blockquote><p>Human Anatomy Atlas offers thousands of models to help understand and communicate how the human body looks and works&ndash;and includes textbook-level definitions. Use it as a reference, instead of an anatomy textbook, or to create virtual lab experiences.
Includes over 10,000 anatomical models with descriptions in English, Spanish, French, German, Italian, Japanese, and Simplified Chinese.</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/HumanAnatomyAtlas2019_1.jpg" alt="Human Anatomy Atlas 2019 1" /></p>

<p><img src="http://hongchaozhang.github.io/images/HumanAnatomyAtlas2019_2.jpg" alt="Human Anatomy Atlas 2019 2" /></p>

<p><a id="markdown-githubä¸Šé¢çš„é¡¹ç›®" name="githubä¸Šé¢çš„é¡¹ç›®"></a></p>

<h2>Githubä¸Šé¢çš„é¡¹ç›®</h2>

<p><a id="markdown-arkit-occlusion-demohttpsgithubcombjarnelarkit-occlusion" name="arkit-occlusion-demo"></a></p>

<h3><a href="https://github.com/bjarnel/arkit-occlusion">arkit-occlusion-demo</a></h3>

<p>äº‹å…ˆç”¨ä¸€äº›è™šæ‹Ÿå¹³é¢å°†çœŸå®çš„å¢™é¢ã€æŸœå­é¢ã€é—¨ç­‰æ ‡è®°å‡ºæ¥ï¼Œå°±å¯ä»¥è®©è™šæ‹Ÿçš„å°çƒåœ¨æˆ¿é—´é‡Œé¢æ¥å›åå¼¹ï¼Œå°±åƒæ’åˆ°çœŸå®çš„å¢™ä¸Šè¿”å›æ¥ä¸€æ ·ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/occlusiongame.jpg" width="600" alt="occlusion game" /></p>

<p><a id="markdown-arvideokit" name="arvideokit"></a></p>

<h3><a href="">ARVideoKit</a></h3>

<p>ä¸€ä¸ªç”¨æ¥å½•åˆ¶ARè§†é¢‘çš„æ¡†æ¶ã€‚</p>

<blockquote><p>An iOS Framework that enables developers to capture videos, photos, Live Photos, and GIFs with ARKit content.</p>

<p>In other words, you NO LONGER have to screen record/screenshot to capture videos and photos of your awesome ARKit apps!</p></blockquote>

<p>å…¶å®å½•å±/æˆªå±ä¸æ˜¯ä¹ŸæŒºå¥½çš„å—ï¼Ÿï¼</p>

<blockquote><p>Key Features:</p>

<p>âœ… Capture Photos from <code>ARSCNView</code>, <code>ARSKView</code>, and <code>SCNView</code></p>

<p>âœ… Capture Live Photos &amp; GIFs from <code>ARSCNView</code>, <code>ARSKView</code>, and <code>SCNView</code></p>

<p>âœ… Record Videos from <code>ARSCNView</code>, <code>ARSKView</code>, and <code>SCNView</code></p>

<p>âœ… Pause/Resume video</p>

<p>âœ… Allow device&rsquo;s Music playing in the background while recording a video</p>

<p>âœ… Returns rendered and raw buffers in a protocol method for additional Image &amp; Video processing</p></blockquote>

<p><a id="markdown-arkit-smb-homagehttpsgithubcombjarnelarkit-smb-homage" name="arkit-smb-homage"></a></p>

<h3><a href="https://github.com/bjarnel/arkit-smb-homage">arkit-smb-homage</a></h3>

<p>åœ¨ç°å®åœºæ™¯ä¸­ç©è¶…çº§ç›ä¸½ã€‚éå¸¸ç²—ç³™ï¼Œä½†æ˜¯åˆ›æ„è¿˜ä¸é”™ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/supermario_beginning.jpg" width="600" alt="super mario beginning" /></p>

<p><img src="http://hongchaozhang.github.io/images/supermario_flag.jpg" width="600" alt="super mario flag" /></p>

<p><a id="markdown-arkit-corelocationhttpsgithubcomprojectdentarkit-corelocation" name="arkit-corelocation"></a></p>

<h3><a href="https://github.com/ProjectDent/ARKit-CoreLocation">ARKit-CoreLocation</a></h3>

<p>åŠŸèƒ½ï¼š</p>

<ol>
<li>è¿™ä¸ªåº“æœ€ä¸»è¦çš„å·¥ä½œï¼Œæ˜¯åœ¨è¯•å›¾æ•´åˆARKitå’ŒCoreLocationï¼Œä»¥å¾—åˆ°æ›´åŠ å‡†ç¡®çš„å®šä½ï¼Œä»è€Œæ›´å¥½åœ°åº”ç”¨äºARåœºæ™¯ã€‚</li>
<li>åŸºäºçœŸå®åœ°ç†ä½ç½®ï¼Œæ ‡æ³¨å‡ºæ‘„åƒå¤´ä¸­æŸä¸ªå»ºç­‘ç‰©æˆ–è€…æ™¯ç‚¹çš„æ ‡æ³¨ã€‚è¿™ä¸ªåŠŸèƒ½ç±»ä¼¼äº<a href="https://itunes.apple.com/gb/app/horizon-explorer/id1326860431?platform=ipad&amp;preserveScrollPosition=true#platform/ipad">Horizon Explorer</a>ã€‚</li>
</ol>


<p>TODO: å¯ä»¥ä»”ç»†çœ‹çœ‹æ­¤åº“é™„å¸¦çš„demoï¼š</p>

<blockquote><p>The library and demo come with a bunch of additional features for configuration. Itâ€™s all fully documented to be sure to have a look around.</p></blockquote>

<p><img src="http://hongchaozhang.github.io/images/arkit+corelocation.jpg" width="600" alt="arkit + corelocation" /></p>

<p><a id="markdown-arkitnavigationdemohttpsgithubcomchriswebb09arkitnavigationdemo" name="arkitnavigationdemo"></a></p>

<h3><a href="https://github.com/chriswebb09/ARKitNavigationDemo">ARKitNavigationDemo</a></h3>

<p>åœ¨åœ°å›¾ä¸Šé€‰æ‹©ç›®çš„åœ°ï¼Œç„¶ååœ¨çœŸå®åœºæ™¯ä¸­è¿›è¡ŒARå¯¼èˆªã€‚</p>

<p>ä½†æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿåªæ˜¯Demoä¸€ä¸‹ï¼Œä½œè€…ä¹Ÿå¾ˆè°¦è™šï¼š</p>

<blockquote><p>When it loads to the map, tap a place on the map where you want to navigate to and press okay. The tap can be sluggish, so you might have to try once or twice before you get it. When the navigation screen loads, tap the screen, then give it a few seconds. You should see the nodes render.</p></blockquote>

<p>TODO: è¿™ä¸ªé¡¹ç›®ä¸­æ¨èçš„ä¸€äº›å‚è€ƒæ–‡çŒ®è¿˜æ˜¯å€¼å¾—çœ‹ä¸€çœ‹çš„ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitNavigationDemo.gif" alt="ARKitNavigationDemo" /></p>

<p><a id="markdown-finemehttpsgithubcommmoaayfindme" name="fineme"></a></p>

<h3><a href="https://github.com/mmoaay/Findme">FineMe</a></h3>

<p>å¯ä»¥è®©ä½ çš„æœ‹å‹æ ¹æ®ä½ å½•åˆ¶çš„è·¯çº¿å›¾æ‰¾åˆ°ä½ ï¼š</p>

<ol>
<li>é€šè¿‡å„ç§æ–¹æ³•ï¼Œè®°å½•ä½ çš„èµ·ç‚¹ï¼Œå¹¶è®©å¦ä¸€ä¸ªäººçŸ¥é“ä½ çš„èµ·ç‚¹ã€‚æ¯”å¦‚å¯ä»¥é€šè¿‡åˆ†äº«èµ·ç‚¹ç…§ç‰‡ï¼Œæˆ–è€…åˆ†äº«èµ·ç‚¹ä½ç½®ã€‚</li>
<li>é€šè¿‡ARKitè®°å½•ä½ èµ°è¿‡çš„è·¯çº¿ï¼Œå¹¶å°†è·¯çº¿åˆ†äº«ç»™å¦ä¸€ä¸ªäººã€‚</li>
<li>å¦ä¸€ä¸ªäººå¦‚æœæ‰¾åˆ°äº†ä½ çš„èµ·ç‚¹ï¼Œå°±å¯ä»¥æ ¹æ®ä½ åˆ†äº«çš„è·¯å¾„æ‰¾åˆ°ä½ ã€‚</li>
</ol>


<p>ä½†æ˜¯ï¼Œç”±äºARKitä¸ç¨³å®šï¼Œæ­¤æ–¹æ³•ä¹Ÿä¸ä¸€å®šå¥æ•ˆã€‚</p>

<p>ä½œè€…è¯•å›¾é€šè¿‡å®šä½å’Œè·ç¦»æé«˜è·¯çº¿çš„ç¨³å®šæ€§ï¼Œä½†ä¸çŸ¥æ•ˆæœå¦‚ä½•ï¼Œåˆ†åˆ«è§äºä»¥ä¸‹ä¸¤ä¸ªåˆ†æ”¯ï¼š</p>

<ul>
<li><a href="https://github.com/mmoaay/Findme/tree/feature/location_optimize">According to location</a></li>
<li><a href="https://github.com/mmoaay/Findme/tree/feature/distance_optimize">According to distance</a></li>
</ul>


<p><a id="markdown-arkitspitfirehttpsgithubcomchriswebb09arkitspitfire" name="arkitspitfire"></a></p>

<h3><a href="https://github.com/chriswebb09/ARKitSpitfire">ARKitSpitfire</a></h3>

<p>å¯ä»¥è®©ä¸€æ¶3Dé£æœºæ¨¡å‹ï¼Œæ ¹æ®æä¾›çš„åœ°ç†ä½ç½®ç»çº¬åº¦ï¼Œè°ƒæ•´å§¿æ€ï¼Œå¹¶é£å‘é‚£é‡Œã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitSpitfire.gif" alt="ARKitSpitfire" /></p>

<p><a id="markdown-resources" name="resources"></a></p>

<h2>Resources</h2>

<p><a id="markdown-polyhttpsgithubcompiemontepoly" name="poly"></a></p>

<h3><a href="https://github.com/piemonte/Poly">Poly</a></h3>

<p><a href="https://github.com/piemonte/Poly">Poly</a>æ˜¯ä¸€ä¸ªiOSåº“ï¼Œç”¨æ¥ä»<a href="https://developers.google.com/poly/">Google Poly</a>ä¸Šä¸‹è½½3Dæ¨¡å‹ï¼ŒåŒ…å«æœç´¢ã€ä¸‹è½½ç®¡ç†å’Œç¼“å­˜åŠŸèƒ½ã€‚</p>

<p><a href="https://developers.google.com/poly/develop/ios">iOS Quickstart</a>å±•ç¤ºäº†å¦‚ä½•åœ¨iOSä¸­ä¸‹è½½ä½¿ç”¨<a href="https://developers.google.com/poly/">Google Poly</a>ä¸Šé¢çš„3Dèµ„æºã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å°†ä»£ç æŸ¥é‡å·¥å…·CPDé›†æˆåˆ°Xcode]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/08/02/integrate-copy-and-paste-detector-into-xcode/"/>
    <updated>2018-08-02T18:34:40+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/08/02/integrate-copy-and-paste-detector-into-xcode</id>
    <content type="html"><![CDATA[<!-- more -->


<p><img src="http://hongchaozhang.github.io/images/copy_and_paste_image.jpeg" alt="copy and paster image" /></p>

<h2>DRYå‡†åˆ™</h2>

<p>ç¼–ç¨‹çš„ä¸€ä¸ªåŸºæœ¬å‡†åˆ™å°±æ˜¯DRYï¼ˆDon&rsquo;t Repeat Yourself)ï¼Œä¸å†™é‡å¤ä»£ç ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸è¦å¤åˆ¶é»è´´ã€‚</p>

<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®¨è®ºä¸€ä¸‹ä»€ä¹ˆå«åšâ€œå¤åˆ¶é»è´´â€ï¼Ÿé¦–å…ˆï¼Œå¦‚æœä½ æœ‰ç›¸åŒçš„æ–‡ä»¶ï¼Œè‚¯å®šæ˜¯æå…¶ç³Ÿç³•çš„â€œå¤åˆ¶é»è´´â€ã€‚å¦‚æœä½ æœ‰ä¸¤ä¸ªç±»åªæ˜¯ç±»åä¸åŒï¼Œä½†æ˜¯åšç€ç›¸åŒæˆ–è€…ç±»ä¼¼çš„äº‹æƒ…ï¼Œä¹Ÿæ˜¯å¾ˆä¸¥é‡çš„â€œå¤åˆ¶é»è´´â€ã€‚å³ä½¿åªæœ‰10è¡Œä»£ç çš„é‡å¤ï¼Œä¹Ÿæ˜¯â€å¤åˆ¶é»è´´â€œã€‚æ ¹æ®ä½œè€…ä¸ªäººç»éªŒï¼Œä¸€ä¸ª100000è¡Œçš„å·¥ç¨‹ï¼Œå®Œå…¨ä¸éœ€è¦å¤åˆ¶é»è´´ã€‚</p>

<h3>å¤åˆ¶é»è´´çš„åå¤„</h3>

<p>åœ¨é‡å¤çš„ä»£ç å¤„ä¿®æ”¹bugï¼Œè¿˜éœ€è¦æ‰‹åŠ¨æ‰¾åˆ°å¦å¤–ä¸€å¤„ï¼Œåšç›¸åŒçš„ä¿®æ”¹ã€‚</p>

<h2>å¦‚ä½•é¿å…å¤åˆ¶é»è´´</h2>

<p>é¿å…é‡å¤ä»£ç çš„ä¼ ç»Ÿæ–¹æ³•æ˜¯ä»£ç å®¡æŸ¥ï¼Œä½†æ˜¯å¯¹äºä»£ç å®¡æŸ¥è€…æ¥è¯´ï¼Œæ‰¾åˆ°é‡å¤ä»£ç æ˜¯ä¸€ä»¶å¾ˆå›°éš¾çš„äº‹æƒ…ã€‚</p>

<p>æˆ‘ä»¬èƒ½ä¸èƒ½åœ¨ç¼–è¯‘é˜¶æ®µå°±æŸ¥æ‰¾å‡ºé‡å¤ä»£ç ï¼Œå¹¶è¦æ±‚è¿™äº›é‡å¤ä»£ç ç§»é™¤æ‰ä¹‹åæ‰å¯ä»¥ç»§ç»­è¿›è¡Œç¼–è¯‘ã€‚</p>

<h2>å®‰è£…CPD</h2>

<p>å¯¹äºSwiftä»£ç ï¼Œæœ‰ä¸¤ä¸ªå·¥å…·å¯ä»¥åšä»£ç æŸ¥é‡ï¼š</p>

<ul>
<li><a href="https://github.com/kucherenko/jscpd">jscpd</a></li>
<li><a href="https://pmd.github.io/">pmd</a></li>
</ul>


<h3><a href="https://pmd.github.io/">pmd</a></h3>

<p>å…¶ä¸­ï¼Œpmdå¯å®šåˆ¶ï¼Œå¹¶ä¸”æ¯”è¾ƒç¨³å®šã€‚å¼€å§‹ä¹‹å‰ï¼Œå…ˆé€šè¿‡homebrewè¿›è¡Œå®‰è£…ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install pmd</span></code></pre></td></tr></table></div></figure>


<blockquote><p>æ³¨æ„ï¼šå¯¹äºå…¶ä»–è¯­è¨€ï¼Œpmdéƒ½åŒ…å«ä»£ç é™æ€åˆ†æå·¥å…·ï¼Œä½†æ˜¯å¯¹äºSwiftï¼Œåªæœ‰ä¸€ä¸ªä»£ç æŸ¥é‡å·¥å…·CPDï¼ˆCopy Paste Detectorï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœæƒ³å¯¹Swiftä»£ç è¿›è¡Œé™æ€åˆ†æï¼Œå¯ä»¥é€‰æ‹©<a href="https://github.com/realm/SwiftLint">SwiftLint</a>ã€‚</p></blockquote>

<h2>é›†æˆåˆ°Xcode</h2>

<p>ä¸ºäº†å°†CPDåŠŸèƒ½é›†æˆåˆ°ç¼–è¯‘é˜¶æ®µï¼Œæˆ‘ä»¬åœ¨Build Phaseé‡Œæ–°æ·»åŠ ä¸€ä¸ªè¿è¡Œè„šæœ¬ï¼ˆRun Scriptï¼‰ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹è„šæœ¬ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Running CPD
</span><span class='line'>pmd cpd --files ${EXECUTABLE_NAME} --minimum-tokens 50 --language swift --encoding UTF-8 --format net.sourceforge.pmd.cpd.XMLRenderer &gt; cpd-output.xml --failOnViolation true
</span><span class='line'># Running script
</span><span class='line'>php ./cpd_script.php -cpd-xml cpd-output.xml</span></code></pre></td></tr></table></div></figure>


<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸€æ®µè„šæœ¬åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>

<p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯è¯´æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¯¹æ‰€æœ‰çš„æ–‡ä»¶è¿›è¡Œä»£ç æŸ¥é‡ï¼š</p>

<ul>
<li><code>--minimum-tokens</code>æŒ‡å®šé‡å¤ä»£ç çš„æœ€å°‘tokenæ•°é‡ã€‚è¿™é‡Œçš„tokenæ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µï¼Œä¸æ˜¯å­—ç¬¦ï¼Œä¸æ˜¯å•è¯ï¼Œä¹Ÿä¸æ˜¯çŸ­è¯­çš„æ„æ€ã€‚æ ¹æ®ç»éªŒæ¥è¯´ï¼ŒSwiftè¯­è¨€çš„æœ€ä¼˜å€¼æ˜¯50ï¼šå¤ªå¤§ï¼Œä¼šæ¼æ‰é‡å¤ä»£ç ï¼›å¤ªå°ï¼Œä¼šå°†ä¸€äº›ä»£ç è¯¯åˆ¤ä¸ºé‡å¤ä»£ç ã€‚</li>
<li><code>--formant</code>æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼Œè¿™é‡ŒæŒ‡å®šä¸ºxmlæ–‡ä»¶ã€‚</li>
<li><code>--failOnViolation</code>æ ‡è¯†ä¸ºè®¾ç½®ä¸º<code>true</code>ï¼Œæ„æ€æ˜¯åªè¦æ£€æµ‹åˆ°é‡å¤ä»£ç ï¼Œå°±ä¸ç»§ç»­è¿›è¡Œç¼–è¯‘ã€‚</li>
</ul>


<blockquote><p>ç»æµ‹è¯•ï¼Œæ— è®º<code>--failOnViolation</code>è®¾ç½®æˆ<code>true</code>ï¼Œè¿˜æ˜¯<code>false</code>ï¼Œéƒ½ä¸èƒ½é˜»æ–­ç¼–è¯‘çš„æ­£å¸¸è¿è¡Œã€‚æ‰€æœ‰çš„warningéƒ½èƒ½æ­£å¸¸åœ°è¾“å‡ºã€‚</p></blockquote>

<p>ç¬¬ä¸€éƒ¨åˆ†è„šæœ¬æ‰§è¡Œçš„ç»“æœï¼Œæ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†æ•´ä¸ªå·¥ç¨‹é‡Œé¢çš„é‡å¤ä»£ç åŠå…¶ä½ç½®ã€è¡Œæ•°ç­‰ä¿¡æ¯ã€‚ä¸‹é¢è®©æˆ‘ä»¬çœ‹çœ‹ï¼Œæ€ä¹ˆå°†è¿™ä¸ªéš¾è¯»çš„xmlæ–‡ä»¶ä»¥warningçš„å½¢å¼å±•ç¤ºç»™å¼€å‘è€…ã€‚</p>

<p>ä¸ºäº†å°†xmlæ–‡ä»¶è½¬æ¢æˆæ›´å¥½è¯»çš„warningï¼Œéœ€è¦åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªphpæ–‡ä»¶ï¼Œæˆ‘ä»¬å«åšcpd_script.phpï¼Œæ‹·è´ä¸‹é¢çš„è„šæœ¬åˆ°è¯¥æ–‡ä»¶ä¸­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="nb">simplexml_load_file</span><span class="p">(</span><span class="s1">&#39;cpd-output.xml&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">duplication</span> <span class="k">as</span> <span class="nv">$duplication</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$files</span> <span class="o">=</span> <span class="nv">$duplication</span><span class="o">-&gt;</span><span class="na">xpath</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;:1: warning: &#39;</span><span class="o">.</span><span class="nv">$duplication</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39; copy-pasted lines from: &#39;</span>
</span><span class='line'>            <span class="o">.</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$otherFile</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$otherFile</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="nv">$otherFile</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">];</span> <span class="p">},</span>
</span><span class='line'>            <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$f</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$f</span> <span class="o">!=</span> <span class="nv">$file</span><span class="p">;</span> <span class="p">})))</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬åœ¨Build Phaseä¸­æ·»åŠ çš„è„šæœ¬çš„ç¬¬äºŒéƒ¨åˆ†å°±æ˜¯è¿è¡Œè¿™ä¸€æ®µè„šæœ¬ï¼Œå°†ç”Ÿæˆçš„xmlæ–‡ä»¶ä¸­çš„æ‰€æœ‰é‡å¤ä»£ç ä¿¡æ¯ä»¥warningçš„å½¢å¼å±•ç¤ºåœ¨Xcodeä¸­ã€‚å¦‚æœä½ æƒ³äº†è§£å¦‚ä½•åœ¨Xcodeä¸­ç”Ÿæˆwarningï¼Œå‚è€ƒ<a href="https://krakendev.io/blog/generating-warnings-in-xcode">Generating Warnings in Xcode</a>ã€‚</p>

<blockquote><p>æˆ‘è¯•äº†<a href="https://krakendev.io/blog/generating-warnings-in-xcode">Generating Warnings in Xcode</a>ä¸­è¯´çš„æ–¹æ³•ï¼Œè„šæœ¬æœ‰é”™è¯¯ï¼Œä¸ºäº†å°†commentä¸­æœ‰TODO:å’ŒFIXME:çš„åœ°æ–¹æ ‡è®°ä¸ºwarningï¼Œå°†æœ‰ERROR:çš„åœ°æ–¹æ ‡è®°ä¸ºerrorï¼Œå¯ä»¥å°è¯•å°†ä¸‹é¢çš„è„šæœ¬å†™åˆ°Build Phaseçš„è¿è¡Œè„šæœ¬ï¼ˆRun Scriptï¼‰ä¸­ï¼ˆå‚è€ƒ<a href="https://medium.com/ios-os-x-development/highlight-warnings-in-xcode-521125121a75">Highlight Warnings in Xcode</a>ï¼‰ï¼š</p>

<pre><code>TAGS="TODO:|FIXME:|WARNING:"
ERRORTAG="ERROR:"
find "${SRCROOT}" \( -name "*.h" -or -name "*.m" -or -name "*.swift" \) -print0 | xargs -0 egrep --with-filename --line-number --only-matching "($TAGS).*\$|($ERRORTAG).*\$" | perl -p -e "s/($TAGS)/ warning: \$1/"| perl -p -e "s/($ERRORTAG)/ error: \$1/"
</code></pre>

<p>å…¶å®ä¸ç”¨è¿™ä¹ˆå¤æ‚ï¼šä»¥â€œ#warningâ€å¼€å¤´ï¼Œæ¥ä¸‹æ¥è·Ÿä¸Šwarningä¿¡æ¯å°±å¯ä»¥äº†ï¼ŒXcodeä¼šåœ¨å·¦ä¾§å¯¼èˆªæ é‡Œé¢ç”Ÿæˆä¸€ç§å«åšUser-Defined Issuesçš„warningã€‚</p></blockquote>

<p>ç°åœ¨ç¼–è¯‘å·¥ç¨‹ï¼Œå¯ä»¥åœ¨Xcodeå·¦ä¾§å¯¼èˆªçª—å£çœ‹åˆ°æ‰€æœ‰çš„warningï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/cpd_warnings_in_navigation.jpg" alt="cpd warnings in navigation" /></p>

<p>åœ¨ç›¸åº”çš„æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°è¯¥æ–‡ä»¶æ‰€åŒ…å«çš„é‡å¤ä»£ç çš„warningï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/cpd_warnings_in_file.jpg" alt="cpd warnings in file" /></p>

<p>è¿™ä¸ªwarningçš„æ„æ€æ˜¯è¯´ï¼šä»54è¡Œå¾€ä¸‹çš„41è¡Œä»£ç å’ŒErrorHandleTester.swiftä¸­ä»96è¡Œå¾€ä¸‹çš„41è¡Œä»£ç é‡å¤ã€‚</p>

<blockquote><p>å¦‚æœæ˜¯åˆšå®‰è£…çš„pmdï¼Œå¯èƒ½éœ€è¦é‡å¯Xcodeï¼Œè®©pmdå‘½ä»¤ç”Ÿæ•ˆã€‚</p></blockquote>

<h3><a href="https://github.com/kucherenko/jscpd">jscpd</a></h3>

<p>ç”Ÿæˆçš„ä¸­é—´ç»“æœæ–‡ä»¶æ ¼å¼å’Œpmdæ˜¯ä¸€æ ·çš„ï¼ŒèŠ‚ç‚¹åå­—ä¹Ÿå«åš<code>pmd-cpd</code>ã€‚</p>

<p>ä½†æ˜¯ï¼š<strong>jscpdæ”¯æŒyamlæ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚</strong>è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œæˆ‘åœ¨å·¥ä½œä¸­ä¹Ÿæ˜¯ç”¨jscpdï¼Œè€Œä¸æ˜¯pmdçš„cpdã€‚jscpdçš„å®‰è£…å’Œä½¿ç”¨æ–¹æ³•åŒpmdçš„cpdåŸºæœ¬ä¸€æ ·ï¼Œä¸å†é‡å¤ã€‚</p>

<p>yamlè¯­æ³•å‚è€ƒ<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">YAMLè¯­è¨€æ•™ç¨‹</a>ã€‚</p>

<h2>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨</h2>

<p>Finding clones is typically useful in the following cases:</p>

<ul>
<li><p><strong>When updating existing code</strong>. When you are fixing a bug, or responding to changes in requirements, you usually start by finding the location in the code that you need to change. Before you make the change, search for clones of that code segment. If clones are discovered:</p>

<ul>
<li>Consider whether you need to make the same change to each clone.</li>
<li>Consider also whether this is a good opportunity to refactor the cloned code into a shared method or class.</li>
</ul>
</li>
<li><p><strong>Architectural cleanup</strong>. Towards the end of every iteration, use Analyze Solution for Code Clones on the Analyze menu.</p></li>
<li><p><strong>When you create code</strong>. When you have written new code, use the tool to find similar code that already existed.</p></li>
</ul>


<h2>ç»“è®º</h2>

<p>ä½œè€…ï¼šé‡å¤ä»£ç æ¸…ç†åˆ»ä¸å®¹ç¼“ã€‚è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšè¿™ä»¶äº‹æƒ…ï¼Œè€Œä¸”ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚</p>

<h2>å‚è€ƒ</h2>

<ul>
<li>ç¿»è¯‘éƒ¨åˆ†<a href="https://medium.com/@nvashanin/%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B8%D1%80%D1%83%D0%B5%D0%BC-copy-paste-detector-%D0%B4%D0%BB%D1%8F-swift-%D0%B2-xcode-9ae87c20748">Integrating Copy-Paste-Detector for Swift in Xcode</a>ã€‚</li>
<li>å¦‚ä½•åœ¨Xcodeä¸­ç”Ÿæˆwarningï¼Œå‚è€ƒ<a href="https://krakendev.io/blog/generating-warnings-in-xcode">Generating Warnings in Xcode</a>ã€‚</li>
<li>å¦‚ä½•ç¼–å†™jscpdçš„yamlé…ç½®æ–‡ä»¶ï¼Œå‚è€ƒ<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">YAML è¯­è¨€æ•™ç¨‹</a>ã€‚</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Introducing Create ML]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/06/15/introducing-create-ml/"/>
    <updated>2018-06-15T17:39:30+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/06/15/introducing-create-ml</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#background">Background</a></li>
<li><a href="#create-ml">Create ML</a></li>
<li><a href="#main-advantage-easy-to-use">Main Advantage: Easy to Use</a>

<ul>
<li><a href="#create-ml%E5%92%8Cturi-create">Create MLå’ŒTuri Create</a></li>
</ul>
</li>
<li><a href="#transfer-learning">Transfer Learning</a></li>
<li><a href="#improving-accuracy">Improving Accuracy</a></li>
<li><a href="#references-and-materials">References and Materials</a></li>
</ul>


<p>Apple released Core ML in WWDC2017, and I took a note on <a href="../../../../2017/12/28/coreml-usage/">CoreML Usage</a>, including mlmodel training using Microsoft <a href="https://www.customvision.ai/">Custom Vision</a>.</p>

<p>This post is about the background of Create ML, its advantages, its relations with Turi. There is no code in this post. If you are looking for the usage of Create ML, refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a>.</p>

<p><a id="markdown-background" name="background"></a></p>

<h2>Background</h2>

<p>Before 2018, where can we get the mlmodel file used in iOS and macOS?</p>

<ul>
<li><a href="https://github.com/tf-coreml/tf-coreml">TensorFlow</a>: Train machine learning models and easily convert them to the Core ML Model format.</li>
<li><a href="https://www.customvision.ai/">Custom Vision</a> from Microsoft</li>
<li><a href="https://pypi.org/project/coremltools/">Core ML Tools</a>: Use this python package to convert models from machine learning toolboxes into the Core ML format.</li>
<li><a href="https://github.com/apache/incubator-mxnet/tree/master/tools/coreml">Apache MXNet</a>: Train machine learning models and convert them to the Core ML format.</li>
<li><a href="https://github.com/onnx/onnx-coreml">ONNX</a>: Convert ONNX models you have created to the Core ML Model format.</li>
<li>&hellip;</li>
</ul>


<p>TensorFlow doesn&rsquo;t support GPU on macOS from version 1.2.</p>

<p><img src="http://hongchaozhang.github.io/images/tensorflow_not_support_gpu_on_macos.jpg" alt="tensor flow not support gpu on macos" /></p>

<p><strong>Core ML</strong>: Announced at WWDC 2017, and already supported by every major ML platform to convert existing models. But the existing models tend to be too big and/or too general.</p>

<p><strong>Turi Create</strong>: Acquired by Apple in 2016 ($200M), it lets you customize existing models with your own data. But â€¦ Python :[.</p>

<p><a id="markdown-create-ml" name="create-ml"></a></p>

<h2>Create ML</h2>

<p>Finally in WWDC2018, Apple announced <strong>Create ML</strong>, which can train machine learning models on macOS, able to use the GPU on macOS. The Create ML session and Turi Create session did not mention any word on each other, but obviousely, Create ML is based on Turi Create.</p>

<p>Based on Trui&rsquo;s model training, Create ML can make model training on macOS using GPU (maybe through Metal), and come up with models which can be used by Core ML framework.</p>

<p>With XCode Playground&rsquo;s updates, Apple gives CreateMLUI, a very easy way for model training: just need to drag your training data and test data into Playground.</p>

<p><a id="markdown-main-advantage-easy-to-use" name="main-advantage-easy-to-use"></a></p>

<h2>Main Advantage: Easy to Use</h2>

<p>Do model training using Swift in XCode.</p>

<blockquote><p><strong>Create ML</strong> is proof that Apple is committed to making it easier for you to use machine learning models in your apps. In this Create ML tutorial, youâ€™ll learn how Create ML speeds up the workflow for improving your model by improving your data while also flattening the learning curve by doing it all in the comfort of Xcode and Swift.</p>

<p>&ndash;Refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a></p>

<p><strong>Create ML</strong>: Announced at WWDC 2018. ML in Xcode &amp; Swift! Currently includes only two of Turi Createâ€™s seven task-focused toolkits, plus a generic classifier and regressor, and data tables. I see it as a trail of breadcrumbs leading you to the Turi Create gingerbread house, inhabited by a â€œgood dogâ€ instead of a witch! (Turi Createâ€™s logo is a dog silhouette.)</p>

<p>&ndash;Refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a></p></blockquote>

<p>Refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a> to see how easy it is to use Create ML. There are some code comparasion between Create ML and Turi Create.</p>

<p><a id="markdown-create-mlå’Œturi-create" name="create-mlå’Œturi-create"></a></p>

<h3>Create MLå’ŒTuri Create</h3>

<p>Currently Create ML includes only two of Turi Createâ€™s seven task-focused toolkits, plus a generic classifier and regressor, and data tables. Turi Create has five task-focused toolkits that arenâ€™t (yet?) in Create ML:</p>

<ul>
<li>Recommender systems</li>
<li>Image similarity</li>
<li>Object detection</li>
<li>Style transfer</li>
<li>Activity classification</li>
</ul>


<p><a id="markdown-transfer-learning" name="transfer-learning"></a></p>

<h2>Transfer Learning</h2>

<p>The description of Transfer Learning from Apple Turi:</p>

<blockquote><p>Itâ€™s not uncommon for the task you want to solve to be related to something that has already been solved. Take, for example, the task of distinguishing cats from dogs. The famous ImageNet Challenge, for which CNNâ€™s are the state-of-the-art, asks the trained model to categorize input into one of 1000 classes. Shouldn&rsquo;t features that distinguish between categories like lions and wolves also be useful for discriminating between cats and dogs?</p>

<p>The answer is a definitive yes. It is accomplished by simply removing the output layer of the Deep Neural Network for 1000 categories, and taking the signals that would have been propagating to the output layer and feeding them as features to a classifier for our new cats vs dogs task.</p>

<p>So, when you run the Turi Create image classifier, it breaks things down into something like this:</p>

<p>Stage 1: Create a CNN classifier on a large, general dataset. A good example is ImageNet, with 1000 categories and 1.2 million images. The models are already trained by researchers and are available for us to use.</p>

<p>Stage 2: The outputs of each layer in the CNN can be viewed as a meaningful vector representation of each image. Extract these feature vectors from the layer prior to the output layer on each image of your task.</p>

<p>Stage 3: Create a new classifier with those features as input for your own task.</p>

<p>At first glance, this seems even more complicated than just training the deep learning model. However, Stage 1 is reusable for many different problems, and once done, it doesn&rsquo;t have to be changed often.</p>

<p>In the end, this pipeline results in not needing to adjust hyper-parameters, faster training, and better performance even in cases where you don&rsquo;t have enough data to create a convention deep learning model. What&rsquo;s more, this technique is effective even if your Stage 3 classification task is relatively unrelated to the task Stage 1 is trained on. This idea was first explored by Donahue et al. (2013), and has since become one of the best ways to create image classifier models.</p>

<p>&ndash;Refer to <a href="https://apple.github.io/turicreate/docs/userguide/image_classifier/how-it-works.html#transfer-learning">truicreate transfer learning</a></p></blockquote>

<p>Some comments on transfer learning from web:</p>

<blockquote><p>Whatâ€™s happening here? Itâ€™s called transfer learning, if you want to look it up. The underlying model â€” VisionFeaturePrint_Screen, which backs the Vision framework â€” was pre-trained on a ginormous dataset to recognize an enormous number of classes. It did this by learning what features to look for in an image, and how to combine these features to classify the image. Almost all of the training time for your dataset is the model extracting around 1000 features from your images. These could include low-level shapes and textures and higher-level shape of ears, distance between eyes, shape of snout. Then it spends a relatively tiny amount of time training a logistic regression model to separate your images into two classes. Itâ€™s similar to fitting a straight line to scattered points, but in 1000 dimensions instead of 2. But itâ€™s still very quick to do: my run 1m 15s for feature extraction and 0.177886 seconds to train and apply the logistic regression.</p>

<p>Transfer learning only works successfully when features of your dataset are reasonably similar to features of the dataset that was used to train the model. A model pre-trained on ImageNet â€” a large collection of photos â€” might not transfer well to pencil drawings or microscopy images.</p>

<p>&ndash;Refer to <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a></p></blockquote>

<p><a id="markdown-improving-accuracy" name="improving-accuracy"></a></p>

<h2>Improving Accuracy</h2>

<p>Refer to <a href="https://developer.apple.com/documentation/create_ml/improving_your_model_s_accuracy">Improving Your Modelâ€™s Accuracy</a> from Apple for improving training accuracy.</p>

<p>How to improve the model&rsquo;s training accuracy, validation accuracy and evaluation accuracy. <a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a> describes the three &lsquo;accuracy&rsquo;s.</p>

<p><a id="markdown-references-and-materials" name="references-and-materials"></a></p>

<h2>References and Materials</h2>

<ol>
<li><p>You might like to browse two fascinating articles about features from (mostly) Google Brain/Research:</p>

<ul>
<li><p><a href="https://distill.pub/2018/building-blocks/">The Building Blocks of Interpretability</a>: image feature extracting</p></li>
<li><p><a href="https://distill.pub/2017/feature-visualization/">Feature Visualization</a></p></li>
</ul>
</li>
<li><p><a href="https://www.kaggle.com/">Kaggle</a> is a repository of datasets contributed by members, often supplemented by notebooks that analyze and visualize the data. It runs model prediction competitions, which leads to the next link:</p>

<ul>
<li>Machine Learning Zero-to-Hero: Everything you need in order to compete on Kaggle for the first time, step-by-step!</li>
</ul>
</li>
<li><p><a href="https://www.raywenderlich.com/196233/create-ml-tutorial-getting-started">Create ML Tutorial: Getting Started</a> describes the usage of Create ML and Turi Create, including the history, code, data preparation, improving model accuracy and so on.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What is new in ARKit 2]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/06/13/what-is-new-in-n-arkit-2/"/>
    <updated>2018-06-13T13:24:59+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/06/13/what-is-new-in-n-arkit-2</id>
    <content type="html"><![CDATA[<!-- more -->


<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#new-features-in-arkit-2">New Features in ARKit 2</a>

<ul>
<li><a href="#saving-and-loading-maps">Saving and Loading Maps</a>

<ul>
<li><a href="#world-tracking-recap">World Tracking Recap:</a></li>
<li><a href="#world-tracking-enhancement">World Tracking Enhancement:</a></li>
<li><a href="#saving-and-loading-maps">Saving and loading maps:</a></li>
<li><a href="#how-to-get-a-good-map">How to get a good map</a></li>
</ul>
</li>
<li><a href="#environment-texturing">Environment Texturing</a></li>
<li><a href="#image-tracking">Image Tracking</a></li>
<li><a href="#3d-object-detection">3D Object Detection</a></li>
<li><a href="#face-tracking-enhancements">Face Tracking Enhancements</a></li>
</ul>
</li>
<li><a href="#some-other-wwdc-sessions-related-to-ar">Some other WWDC Sessions Related to AR</a>

<ul>
<li><a href="#integrating-apps-and-content-with-ar-quick-look">Integrating Apps and Content with AR Quick Look</a></li>
<li><a href="#inside-swiftshot-creating-an-ar-game">Inside SwiftShot: Creating an AR Game</a></li>
<li><a href="#creating-great-ar-experiences">Creating Great AR Experiences</a></li>
<li><a href="#understanding-arkit-tracking-and-detection">Understanding ARKit Tracking and Detection</a></li>
</ul>
</li>
<li><a href="#some-other-materials-for-a-better-ar-app">Some other materials for a better AR app:</a>

<ul>
<li><a href="#building-your-first-ar-experience">Building Your First AR Experience</a></li>
<li><a href="#managing-session-lifecycle-and-tracking-quality">Managing Session Lifecycle and Tracking Quality</a></li>
<li><a href="#human-interface-guidelines---augmented-reality">Human Interface Guidelines - Augmented Reality</a></li>
<li><a href="#handling-3d-interaction-and-ui-controls-in-augmented-reality">Handling 3D Interaction and UI Controls in Augmented Reality</a></li>
<li><a href="#creating-a-multiuser-ar-experience">Creating a Multiuser AR Experience</a></li>
<li><a href="#swiftshot-creating-a-game-for-augmented-reality">SwiftShot: Creating a Game for Augmented Reality</a></li>
<li><a href="#recognizing-images-in-an-ar-experience">Recognizing Images in an AR Experience</a></li>
<li><a href="#scanning-and-detecting-3d-objects">Scanning and Detecting 3D Objects</a></li>
</ul>
</li>
</ul>


<p><a id="markdown-overview" name="overview"></a></p>

<h2>Overview</h2>

<p>In ARKit 1, we have:</p>

<ul>
<li>Device positioning from world tracking process</li>
<li>Horizontal and vertical plane detection from world tracking process</li>
<li>Lighting estimation</li>
<li>AR face tracking</li>
</ul>


<p>In ARKit 2, we have:</p>

<ul>
<li>Saving and loading maps</li>
<li>Environment Texturing</li>
<li>Image detection and tracking</li>
<li>3D object tracking</li>
<li>Improved face tracking</li>
</ul>


<p><a id="markdown-new-features-in-arkit-2" name="new-features-in-arkit-2"></a></p>

<h2>New Features in ARKit 2</h2>

<p><a id="markdown-saving-and-loading-maps" name="saving-and-loading-maps"></a></p>

<h3>Saving and Loading Maps</h3>

<p><a id="markdown-world-tracking-recap" name="world-tracking-recap"></a></p>

<h4>World Tracking Recap:</h4>

<ul>
<li>Position and orientation of the device.</li>
<li>Physical scale in the scene.</li>
<li>3D feature points.</li>
<li>Relocalization (iOS 11.3): we can relocalize objects when your AR session is interrupted, like phone coming or going from background. This feature is implemented by storing the mapping <code>ARWorldMap</code> between real world and the coordinate system. However the mapping is not exposed to developers.</li>
</ul>


<p><a id="markdown-world-tracking-enhancement" name="world-tracking-enhancement"></a></p>

<h4>World Tracking Enhancement:</h4>

<ul>
<li><strong>Saving and loading maps</strong>: expose the <code>ARWorldMap</code> to developers.</li>
<li>Faster initialization and plane detection</li>
<li>Robust tracking and plane detection</li>
<li>More accurate extent and boundary Continuous autofocus</li>
<li>New 4:3 video formats (iPad is also 4:3)</li>
</ul>


<p><a id="markdown-saving-and-loading-maps" name="saving-and-loading-maps"></a></p>

<h4>Saving and loading maps:</h4>

<p><code>ARWorldmap</code> contains:</p>

<ul>
<li>Mapping of physical 3D space: for representing 3D feature points in the coordinate system.</li>
<li>Mutable list of named anchors: for restoring previous 3D environment (like lighting node anchor), and relocalizing previously added virtual objects.</li>
<li>Raw feature points and extent: for debugging and visualization.</li>
<li>Serialization: for storing and recovering from an file.</li>
</ul>


<p><img src="http://hongchaozhang.github.io/images/arkit2_arworldmap.jpg" width="500" alt="arkit arworldmap" /></p>

<p>We can use the map in two different ways:</p>

<ul>
<li>Persistent: Restore previous AR scene for a new AR session. For example, you go to another room and come back or close the AR app and open it some time later.</li>
<li>Multiuser experience: We can share the map among devices through WiFi or bluetooth.</li>
</ul>


<p>The SwiftShot is an multiuser experience AR game:</p>

<p><img src="http://hongchaozhang.github.io/images/swiftshot.jpg" alt="arkit2 swiftshot" /></p>

<p>and the following is a small piece of the demo:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_multiuser_experience_demo.gif" alt="swift shot game" /></p>

<p><a id="markdown-how-to-get-a-good-map" name="how-to-get-a-good-map"></a></p>

<h4>How to get a good map</h4>

<p>In order to share or restore the map, we need to get a good one first. A good map should be:</p>

<!-- * Important for relocalization -->


<ul>
<li>Multiple points of view: If we record the mapping from one point of view, and try to restore the coordinate system from another point of view, it will fail.</li>
<li>Static, well-textured environment.</li>
<li>Dense feature points on the map.</li>
</ul>


<p>We can use the <code>WorldMappingStatus</code> status from <code>ARFrame</code> to decide if the current map is good enough for sharing or storing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">public</span> <span class="k">enum</span> <span class="nl">WorldMappingStatus</span> <span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">case</span> <span class="n">notAvailable</span>
</span><span class='line'>   <span class="k">case</span> <span class="n">limited</span>
</span><span class='line'>   <span class="k">case</span> <span class="n">extending</span>
</span><span class='line'>   <span class="k">case</span> <span class="n">mapped</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-environment-texturing" name="environment-texturing"></a></p>

<h3>Environment Texturing</h3>

<p>With the help of Environment Texturing, AR scene objects can reflect the environment texture on the surface of themselves, just like:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_environment_texturing_demo.jpg" alt="arkit2 environment texturing demo" /></p>

<p><a id="markdown-image-tracking" name="image-tracking"></a></p>

<h3>Image Tracking</h3>

<p>Moving objects can not be positioned in ARKit 1. In ARKit 2, specified images can be tracked in AR scene.</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_image_tracking.gif" alt="arkit 2 image tracking" /></p>

<p>The classes in ARKit 2 for image tracking are:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_image_tracking_classes.jpg" alt="arkit 2 image tracking classes" /></p>

<p>The detected <code>ARImageAnchor</code>s have properties like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">open</span> <span class="k">class</span> <span class="nl">ARImageAnchor</span> <span class="p">:</span> <span class="n">ARAnchor</span><span class="p">,</span> <span class="n">ARTrackable</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">public</span> <span class="k">var</span> <span class="nl">isTracked</span><span class="p">:</span> <span class="n">Bool</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">transform</span><span class="p">:</span> <span class="n">simd_float4x4</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">referenceImage</span><span class="p">:</span> <span class="n">ARReferenceImage</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The specified image should:</p>

<ul>
<li>Histogram should be broad</li>
<li>Not have multiple uniform color regions</li>
<li>Not have repeated structures</li>
</ul>


<p>The following is the demo:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_image_tracking_demo.gif" alt="arkit 2 image tracking demo" /></p>

<p>The inputs of the above demo are:</p>

<ul>
<li>an static image of the cat, the same as it is in the picture frame</li>
<li>an video of the cat</li>
</ul>


<p>The video is played at the position of the specified picture frame, with the same orientation of the picture frame.</p>

<p>There are two classes related to image tracking:</p>

<table>
<thead>
<tr>
<th>ARImageTrackingConfiguration </th>
<th> ARWorldTrackingConfiguration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Has No World Origin </td>
<td> Has World Origin</td>
</tr>
<tr>
<td>After detecting the image, only do things inside the place of the image. </td>
<td> After detecting the image, place some virtual objects outside the detected image plane.</td>
</tr>
</tbody>
</table>


<p><a id="markdown-3d-object-detection" name="3d-object-detection"></a></p>

<h3>3D Object Detection</h3>

<p>3D object detection workflow is:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_3D_object_tracking_classes.jpg" alt="arkit2 3D object tracking classes" /></p>

<p>The <code>ARObjectAnchor</code> contains properties like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">open</span> <span class="k">class</span> <span class="nl">ARObjectAnchor</span> <span class="p">:</span> <span class="n">ARAnchor</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">transform</span><span class="p">:</span> <span class="n">simd_float4x4</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">referenceObject</span><span class="p">:</span> <span class="n">ARReferenceObject</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and <code>ARReferenceObject</code> is the scanned 3D object:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">open</span> <span class="k">class</span> <span class="nl">ARReferenceObject</span>
</span><span class='line'>    <span class="p">:</span> <span class="bp">NSObject</span><span class="p">,</span> <span class="bp">NSCopying</span><span class="p">,</span> <span class="bp">NSSecureCoding</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="o">?</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">center</span><span class="p">:</span> <span class="n">simd_float3</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">extent</span><span class="p">:</span> <span class="n">simd_float3</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">open</span> <span class="k">var</span> <span class="nl">rawFeaturePoints</span><span class="p">:</span> <span class="n">ARPointCloud</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>AnÂ <code>ARReferenceObject</code>Â contains only the spatial feature information needed for ARKit to recognize the real-world object, and is not a displayable 3D reconstruction of that object.</p></blockquote>

<p>In order to get the <code>ARReferenceObject</code>, we should scan the real object, and store the result as an file (.arobject) or an xcode asset catalog for ARKit to use. Fortunately, Apple supplies a demo for scanning 3D object to get the <code>ARReferenceObject</code>. Refer to: <a href="https://developer.apple.com/documentation/arkit/scanning_and_detecting_3d_objects">Scanning and Detecting 3D Objects</a> for detail and the rough steps of object scanning are:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_3D_object_scan.jpg" alt="arkit2 3D object scan" /></p>

<p>For scanned object in the real world, we can dynamically add some info around it (Museum is a good use case.), like the demo does:</p>

<p><img src="http://hongchaozhang.github.io/images/arkit2_3D_object_tracking_demo.gif" alt="arkit2 object tracking demo" /></p>

<p><a id="markdown-face-tracking-enhancements" name="face-tracking-enhancements"></a></p>

<h3>Face Tracking Enhancements</h3>

<p>With face tracking, we can place something on it or around it.</p>

<p>Enhancements in ARKit 2:</p>

<ul>
<li>Gaze tracking</li>
<li>Tongue support</li>
</ul>


<blockquote><p>Gaze and Tongue can be input of the AR app.</p></blockquote>

<p>New changes in one screenshot:</p>

<p><img src="http://hongchaozhang.github.io/images/what-is-new-in-arkit-2.jpg" alt="what-is-new-in-arkit-2" /></p>

<p><a id="markdown-some-other-wwdc-sessions-related-to-ar" name="some-other-wwdc-sessions-related-to-ar"></a></p>

<h2>Some other WWDC Sessions Related to AR</h2>

<p><a id="markdown-integrating-apps-and-content-with-ar-quick-lookhttpsdeveloperapplecomvideosplaywwdc2018603" name="integrating-apps-and-content-with-ar-quick-lookhttpsdeveloperapplecomvideosplaywwdc2018603"></a></p>

<h3><a href="https://developer.apple.com/videos/play/wwdc2018/603/">Integrating Apps and Content with AR Quick Look</a></h3>

<p>A deeper dive into a new feature in iOS that provides a way to preview any AR object from a USDZ file.</p>

<p><img src="http://hongchaozhang.github.io/images/QLPreviewController.png" alt="QLPreviewController" /></p>

<ul>
<li>Thereâ€™s a great sequence diagram presented (see above) (I wish more sessions would have these!) for previewing USDZ objects, of which the <code>QLPreviewController</code> plays a central role.</li>
<li>For web developers, it covers HTML samples for how to preview USDZ objects in Safari.</li>
<li>Then it goes into a deep dive on how to create the actual USDZ objects, with more examples on new AR texturing capabilities.</li>
<li>Thereâ€™s also a quick overview on how to optimize the files, to keep the size down, and thereâ€™s a breakdown of the files that make up the USDZ format.</li>
</ul>


<p><a id="markdown-inside-swiftshot-creating-an-ar-gamehttpsdeveloperapplecomvideosplaywwdc2018605" name="inside-swiftshot-creating-an-ar-gamehttpsdeveloperapplecomvideosplaywwdc2018605"></a></p>

<h3><a href="https://developer.apple.com/videos/play/wwdc2018/605/">Inside SwiftShot: Creating an AR Game</a></h3>

<p>Covers world map sharing, networking, and the physics of how to build an AR game, as well as some design insight (I have limited game dev experience so Iâ€™ll do the best I can below).</p>

<ul>
<li>Pointers to remember with designing an AR game, such as â€œencouragingâ€ the user to slowly move the device for world mapping!</li>
<li>It demonstrates the usage of image &amp; object detection, world map sharing, and iBeacons for the game.</li>
<li>Integrating <code>ARKit</code> with <code>SceneKit</code> and <code>Metal</code>, including the translation of physics data between eachâ€Šâ€”â€Šposition, velocity, and orientation.</li>
<li>Performance enhancement with the <code>BitStreamCodable</code> protocol.</li>
<li>A small look at how audio was integrated into the game.</li>
</ul>


<p><a id="markdown-creating-great-ar-experienceshttpsdeveloperapplecomvideosplaywwdc2018805" name="creating-great-ar-experienceshttpsdeveloperapplecomvideosplaywwdc2018805"></a></p>

<h3><a href="https://developer.apple.com/videos/play/wwdc2018/805/">Creating Great AR Experiences</a></h3>

<p>Best practises mainly from a UX &amp; design perspective (there are no code samples in this session).</p>

<ul>
<li>Logical dos and donâ€™ts that may be useful, if you need help with thought towards product and empathy towards the user.</li>
<li>They emphasize the importance of using transitions between AR scapes.</li>
<li>Why AR is a special combination of touch and movement.</li>
<li>They advise that minimal battery impact should be a huge focus! This is a challenge, given that they recommend to render the FPS at 60 to avoid latency.</li>
<li>Thereâ€™s a lengthy demonstration of creating an AR fireplace, with complex texturing, etc. It looks great, but unfortunately there were no coding samples accompanying the demo.</li>
</ul>


<p><a id="markdown-understanding-arkit-tracking-and-detectionhttpsdeveloperapplecomvideosplaywwdc2018610" name="understanding-arkit-tracking-and-detectionhttpsdeveloperapplecomvideosplaywwdc2018610"></a></p>

<h3><a href="https://developer.apple.com/videos/play/wwdc2018/610/">Understanding ARKit Tracking and Detection</a></h3>

<p>A good broad overview of all of the main AR concepts.</p>

<ul>
<li>This is such a good intro into not only AR on iOS, but AR in general, that it should have been part of 2017â€™s sessions when ARKit was first introduced. Better late than never. If youâ€™re only going to watch one session, watch this one!</li>
<li>It recaps the main features of ARKitâ€Šâ€”â€Š<strong>orientation</strong>, <strong>world tracking</strong>, and <strong>plane detection</strong>, and demos all of these in depth with coding samples.</li>
<li>It then demos the new features of ARKit 2â€Šâ€”â€Š<strong>shared world mapping</strong>, <strong>image tracking</strong>, and <strong>object detection</strong> (which has been available in the Vision framework recapped above, but is now also accessible in ARKit).</li>
<li>A good explanation on a core AR principle, <strong>Visual Inertial Odometry</strong>, is given. Short of going into the actual physics equations behind it, this should give you a great understanding of VIO.</li>
</ul>


<p><a id="markdown-some-other-materials-for-a-better-ar-app" name="some-other-materials-for-a-better-ar-app"></a></p>

<h2>Some other materials for a better AR app:</h2>

<p><a id="markdown-building-your-first-ar-experiencehttpsdeveloperapplecomdocumentationarkitbuilding_your_first_ar_experience" name="building-your-first-ar-experiencehttpsdeveloperapplecomdocumentationarkitbuilding_your_first_ar_experience"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/building_your_first_ar_experience">Building Your First AR Experience</a></h3>

<p>This document demos an app for basic usage of ARKit.</p>

<p><a id="markdown-managing-session-lifecycle-and-tracking-qualityhttpsdeveloperapplecomdocumentationarkitmanaging_session_lifecycle_and_tracking_quality" name="managing-session-lifecycle-and-tracking-qualityhttpsdeveloperapplecomdocumentationarkitmanaging_session_lifecycle_and_tracking_quality"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/managing_session_lifecycle_and_tracking_quality">Managing Session Lifecycle and Tracking Quality</a></h3>

<p>Make your AR experience more robust by</p>

<ul>
<li>providing clear feedback, using <code>ARCamera.TrackingState</code>.</li>
<li>recovering from interruptions, using <code>ARCamera.TrackingState.Reason.relocalizing</code>.</li>
<li>resuming previous sessions, using <code>ARWorldMap</code>.</li>
</ul>


<p><a id="markdown-human-interface-guidelines---augmented-realityhttpsdeveloperapplecomdesignhuman-interface-guidelinesiossystem-capabilitiesaugmented-reality" name="human-interface-guidelines---augmented-realityhttpsdeveloperapplecomdesignhuman-interface-guidelinesiossystem-capabilitiesaugmented-reality"></a></p>

<h3><a href="https://developer.apple.com/design/human-interface-guidelines/ios/system-capabilities/augmented-reality/">Human Interface Guidelines - Augmented Reality</a></h3>

<p>This post describes how to rendering virtual objects, how to interact with virtual objects, how to handling interruptions. It is for UX.</p>

<p><a id="markdown-handling-3d-interaction-and-ui-controls-in-augmented-realityhttpsdeveloperapplecomdocumentationarkithandling_3d_interaction_and_ui_controls_in_augmented_reality" name="handling-3d-interaction-and-ui-controls-in-augmented-realityhttpsdeveloperapplecomdocumentationarkithandling_3d_interaction_and_ui_controls_in_augmented_reality"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/handling_3d_interaction_and_ui_controls_in_augmented_reality">Handling 3D Interaction and UI Controls in Augmented Reality</a></h3>

<p>This document describes the best practices for visual feedback, gesture interactions, and realistic rendering in AR experiences. And a demo app is supplied.</p>

<p><img src="http://hongchaozhang.github.io/images/arkit_demo_screenshot.jpg" alt="arkit demo" /></p>

<p><a id="markdown-creating-a-multiuser-ar-experiencehttpsdeveloperapplecomdocumentationarkitcreating_a_multiuser_ar_experience" name="creating-a-multiuser-ar-experiencehttpsdeveloperapplecomdocumentationarkitcreating_a_multiuser_ar_experience"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/creating_a_multiuser_ar_experience">Creating a Multiuser AR Experience</a></h3>

<p>This document demos an app (with source code) on how to transmit ARKit world-mapping data between nearby devices with the <a href="https://developer.apple.com/documentation/multipeerconnectivity">MultipeerConnectivity</a> framework (introduced in iOS 7.0) to create a shared basis for AR experiences. MultipeerConnectivity supports peer-to-peer connectivity and the discovery of nearby devices. With MultipeerConnectivity, you can not only share <code>ARWorldMap</code>, but also some actions. This makes multiuser AR game possible.</p>

<p>However:</p>

<ul>
<li>Recording and transmitting a world map and relocalizing to a world map are time-consuming, bandwidth-intensive operations. A good design is needed for better performance.</li>
<li>The persons received the world map data need to move their device so they see a similar perspective (also sent by the host) helps ARKit process the received map and establish a shared frame of reference for the multiuser experience.</li>
</ul>


<p><a id="markdown-swiftshot-creating-a-game-for-augmented-realityhttpsdeveloperapplecomdocumentationarkitswiftshot_creating_a_game_for_augmented_reality" name="swiftshot-creating-a-game-for-augmented-realityhttpsdeveloperapplecomdocumentationarkitswiftshot_creating_a_game_for_augmented_reality"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/swiftshot_creating_a_game_for_augmented_reality">SwiftShot: Creating a Game for Augmented Reality</a></h3>

<p>This document demos the SwiftShot game shown on WWDC 2018, including:</p>

<ul>
<li>Designing Gameplay for AR</li>
<li>Using Local Multipeer Networking and Sharing World Maps</li>
<li>Synchronizing Gameplay Actions</li>
<li>Solving Multiplayer Physics</li>
</ul>


<p><a id="markdown-recognizing-images-in-an-ar-experiencehttpsdeveloperapplecomdocumentationarkitrecognizing_images_in_an_ar_experience" name="recognizing-images-in-an-ar-experiencehttpsdeveloperapplecomdocumentationarkitrecognizing_images_in_an_ar_experience"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/recognizing_images_in_an_ar_experience">Recognizing Images in an AR Experience</a></h3>

<p>Detect known 2D images in the userâ€™s environment, and use their positions to place AR content.</p>

<p><a id="markdown-scanning-and-detecting-3d-objectshttpsdeveloperapplecomdocumentationarkitscanning_and_detecting_3d_objects" name="scanning-and-detecting-3d-objectshttpsdeveloperapplecomdocumentationarkitscanning_and_detecting_3d_objects"></a></p>

<h3><a href="https://developer.apple.com/documentation/arkit/scanning_and_detecting_3d_objects">Scanning and Detecting 3D Objects</a></h3>

<p>Record spatial features of real-world objects, then use the results to find those objects in the userâ€™s environment and trigger AR content.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CNNä¸å›¾åƒè¯†åˆ«]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/05/02/cnn-and-image-classification/"/>
    <updated>2018-05-02T18:55:44+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/05/02/cnn-and-image-classification</id>
    <content type="html"><![CDATA[<ol>
<li>å·ç§¯ç¥ç»ç½‘ç»œç”¨äºå›¾åƒè¯†åˆ«çš„ç°çŠ¶ã€‚</li>
<li>å·ç§¯ä¸å›¾åƒå¤„ç†åŸºç¡€çŸ¥è¯†ã€‚</li>
<li>å·ç§¯ç¥ç»ç½‘ç»œæ¯ä¸€å±‚çš„å¯è§†åŒ–ï¼Œäº†è§£ç¥ç»ç½‘ç»œå†…éƒ¨çš„ç‰©ç†æ„ä¹‰ã€‚</li>
<li>å›¾åƒå·ç§¯æ»¤æ³¢å™¨ä¸ç¥ç»å…ƒå’Œæƒé‡çš„å…³ç³»ã€‚</li>
</ol>


<!-- more -->


<p><br></p>

<!-- TOC -->


<ul>
<li><a href="#%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E8%83%8C%E6%99%AF">å·ç§¯ç¥ç»ç½‘ç»œä¸å›¾åƒè¯†åˆ«èƒŒæ™¯</a>

<ul>
<li><a href="#lenet%E6%A6%82%E8%BF%B0">LeNetæ¦‚è¿°</a></li>
<li><a href="#imagenet%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E6%8C%91%E6%88%98%E8%B5%9B">ImageNetå¤§è§„æ¨¡å›¾åƒè¯†åˆ«æŒ‘æˆ˜èµ›</a></li>
</ul>
</li>
<li><a href="#%E5%8D%B7%E7%A7%AF%E4%B8%8E%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86">å·ç§¯ä¸å›¾åƒå¤„ç†</a>

<ul>
<li><a href="#%E5%8D%B7%E7%A7%AF%E7%9A%84%E5%AE%9A%E4%B9%89">å·ç§¯çš„å®šä¹‰</a></li>
<li><a href="#%E5%9B%BE%E5%83%8F%E5%8D%B7%E7%A7%AF%E7%9A%84%E7%89%A9%E7%90%86%E6%84%8F%E4%B9%89">å›¾åƒå·ç§¯çš„ç‰©ç†æ„ä¹‰</a></li>
</ul>
</li>
<li><a href="#lenet%E8%AF%A6%E8%A7%A3">LeNetè¯¦è§£</a></li>
<li><a href="#%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB%E8%BF%87%E7%A8%8B%E5%8F%AF%E8%A7%86%E5%8C%96">æ‰‹å†™æ•°å­—è¯†åˆ«è¿‡ç¨‹å¯è§†åŒ–</a></li>
<li><a href="#%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E7%A5%9E%E7%BB%8F%E5%85%83%E5%92%8C%E6%9D%83%E9%87%8D%E5%9C%A8%E5%93%AA%E9%87%8C">ç¥ç»ç½‘ç»œä¸­çš„â€œç¥ç»å…ƒâ€å’Œâ€œæƒé‡â€åœ¨å“ªé‡Œï¼Ÿ</a></li>
</ul>


<!-- /TOC -->


<p><a id="markdown-å·ç§¯ç¥ç»ç½‘ç»œä¸å›¾åƒè¯†åˆ«èƒŒæ™¯" name="å·ç§¯ç¥ç»ç½‘ç»œä¸å›¾åƒè¯†åˆ«èƒŒæ™¯"></a></p>

<h2>å·ç§¯ç¥ç»ç½‘ç»œä¸å›¾åƒè¯†åˆ«èƒŒæ™¯</h2>

<p><a id="markdown-lenetæ¦‚è¿°" name="lenetæ¦‚è¿°"></a></p>

<h3>LeNetæ¦‚è¿°</h3>

<p>LeNetæ˜¯æœ€æ—©ç”¨äºæ·±åº¦å­¦ä¹ äº†é¢†åŸŸçš„å·ç§¯ç¥ç»ç½‘ç»œä¹‹ä¸€ã€‚Yann LeCunçš„è¿™ä¸€æ°ä½œå¾—åäºä»–è‡ª1988å¹´ä»¥æ¥çš„ç³»åˆ—æˆåŠŸè¿­ä»£ã€‚å½¼æ—¶LeNetæ¶æ„è¿˜ä¸»è¦è¢«ç”¨äºè¯†åˆ«é‚®æ”¿ç¼–ç ç­‰ä»»åŠ¡ã€‚LeNetçš„åŸºæœ¬æ¶æ„å¦‚ä¸‹ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/201805lenet.jpg" alt="lenet" /></p>

<p>è¿‘å‡ å¹´å·²ç»å‡ºç°äº†å¾ˆå¤šå»ºç«‹åœ¨LeNetä¹‹ä¸Šçš„æ–°æ¶æ„ï¼Œä½†æ˜¯åŸºæœ¬æ¦‚å¿µè¿˜æ˜¯æ¥è‡ªäºLeNetã€‚</p>

<p>å·ç§¯ç¥ç»ç½‘ç»œå§‹è‡ª1990å¹´ä»£èµ·ï¼Œæˆ‘ä»¬å·²ç»è®¤è¯†äº†æœ€æ—©çš„LeNetï¼Œå…¶ä»–ä¸€äº›å¾ˆæœ‰å½±å“åŠ›çš„æ¶æ„åˆ—ä¸¾å¦‚ä¸‹ï¼š</p>

<ul>
<li>1990sè‡³2012ï¼šä»90å¹´ä»£åˆ°2010å¹´ä»£æ—©æœŸï¼Œå·ç§¯ç¥ç»ç½‘ç»œéƒ½å¤„äºå­µåŒ–é˜¶æ®µã€‚éšç€æ•°æ®é‡å¢å¤§å’Œè®¡ç®—èƒ½åŠ›æé«˜ï¼Œå·ç§¯ç¥ç»ç½‘ç»œèƒ½æå®šçš„é—®é¢˜ä¹Ÿè¶Šæ¥è¶Šæœ‰æ„æ€äº†ã€‚</li>
<li>AlexNet(2012)ï¼š2012å¹´ï¼ŒAlex Krizhevskyå‘å¸ƒäº†AlexNetï¼Œæ˜¯LeNetçš„æ›´æ·±ã€æ›´å®½ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¤§æ¯”åˆ†èµ¢å¾—äº†å½“å¹´çš„ImageNetå¤§è§„æ¨¡å›¾åƒè¯†åˆ«æŒ‘æˆ˜èµ›(ILSVRC)ã€‚è¿™æ˜¯ä¸€æ¬¡éå¸¸é‡è¦çš„å¤§çªç ´ï¼Œç°åœ¨æ™®åŠçš„å·ç§¯ç¥ç»ç½‘ç»œåº”ç”¨éƒ½è¦æ„Ÿè°¢è¿™ä¸€å£®ä¸¾ã€‚</li>
<li>ZF Net(2013)ï¼š2013å¹´çš„ILSVRCèµ¢å®¶æ˜¯Matthew Zeilerå’ŒRob Fergusçš„å·ç§¯ç½‘ç»œï¼Œè¢«ç§°ä½œZF Netï¼Œè¿™æ˜¯è°ƒæ•´è¿‡æ¶æ„è¶…å‚æ•°çš„AlexNetæ”¹è¿›å‹ã€‚</li>
<li>GoogleNet(2014)ï¼š2014çš„ILSVRCèƒœè€…æ˜¯æ¥è‡ªGoogleçš„Szegedy et al.ã€‚å…¶ä¸»è¦è´¡çŒ®æ˜¯ç ”å‘äº†Inception Moduleï¼Œå®ƒ<strong>å¤§å¹…å‡å°‘äº†ç½‘ç»œä¸­çš„å‚æ•°æ•°é‡ï¼ˆå››ç™¾ä¸‡ï¼Œç›¸æ¯”AlexNetçš„å…­åƒä¸‡ï¼‰</strong>ã€‚</li>
<li>VGGNet(2014)ï¼šå½“å¹´çš„ILSVRCäºšå†›æ˜¯VGGNetï¼Œçªå‡ºè´¡çŒ®æ˜¯å±•ç¤ºäº†ç½‘ç»œçš„æ·±åº¦ï¼ˆå±‚æ¬¡æ•°é‡ï¼‰æ˜¯è‰¯å¥½è¡¨ç°çš„å…³é”®å› ç´ ã€‚</li>
<li>ResNet(2015)ï¼š Kaiming Heç ”å‘çš„Residual Networkæ˜¯2015å¹´çš„ILSVRCå† å†›ï¼Œä¹Ÿä»£è¡¨äº†å·ç§¯ç¥ç»ç½‘ç»œçš„æœ€é«˜æ°´å¹³ï¼ŒåŒæ—¶è¿˜æ˜¯å®è·µçš„é»˜è®¤é€‰æ‹©ï¼ˆ2016å¹´5æœˆï¼‰ã€‚</li>
<li>DenseNetï¼ˆ2016å¹´8æœˆï¼‰ï¼š ç”±Gao Huangå‘è¡¨ï¼ŒDensely Connected Convolutional Networkçš„æ¯ä¸€å±‚éƒ½ç›´æ¥ä¸å…¶ä»–å„å±‚å‰å‘è¿æ¥ã€‚DenseNetå·²ç»åœ¨äº”ä¸ªé«˜éš¾åº¦çš„ç‰©ä½“è¯†åˆ«åŸºç¡€é›†ä¸Šï¼Œæ˜¾å¼å‡ºéå‡¡çš„è¿›æ­¥ã€‚</li>
</ul>


<p><a id="markdown-imagenetå¤§è§„æ¨¡å›¾åƒè¯†åˆ«æŒ‘æˆ˜èµ›" name="imagenetå¤§è§„æ¨¡å›¾åƒè¯†åˆ«æŒ‘æˆ˜èµ›"></a></p>

<h3>ImageNetå¤§è§„æ¨¡å›¾åƒè¯†åˆ«æŒ‘æˆ˜èµ›</h3>

<p>å‚è€ƒ<a href="http://www.sohu.com/a/143751643_473283">ä¸€ä¸ªæ—¶ä»£çš„ç»ˆç»“ï¼šImageNetç«èµ›2017æ˜¯æœ€åä¸€å±Šï¼ŒWebVision ç«èµ›æˆ–æ¥</a>ã€‚</p>

<p>ä¸Šé¢çš„å˜ç§å·ç§¯ç¥ç»ç½‘ç»œåŸºæœ¬ä¸Šéƒ½æ¥è‡ªä¸€é¡¹æ¯”èµ›ï¼ˆDenseNeté™¤å¤–ï¼‰ï¼š<strong>ImageNetå¤§è§„æ¨¡å›¾åƒè¯†åˆ«æŒ‘æˆ˜èµ›</strong>(ImageNet Large Scale Visual Recognition Competitionï¼ŒILSVRC)ã€‚</p>

<p>ILSVRCæ˜¯åŸºäºImageNetå›¾åƒåº“çš„ä¸€ä¸ªå›¾åƒè¯†åˆ«æ¯”èµ›ã€‚ImageNetå¯ä»¥è¯´æ˜¯è®¡ç®—æœºè§†è§‰ç ”ç©¶äººå‘˜è¿›è¡Œå¤§è§„æ¨¡ç‰©ä½“è¯†åˆ«å’Œæ£€æµ‹æ—¶ï¼Œæœ€å…ˆæƒ³åˆ°çš„è§†è§‰å¤§æ•°æ®æ¥æºã€‚ImageNet æ•°æ®é›†æœ€åˆç”±æ–¯å¦ç¦å¤§å­¦æé£é£ç­‰äººåœ¨CVPR 2009çš„ä¸€ç¯‡è®ºæ–‡ä¸­æ¨å‡ºï¼Œå¹¶è¢«ç”¨äºæ›¿ä»£ PASCALæ•°æ®é›†ï¼ˆåè€…åœ¨æ•°æ®è§„æ¨¡å’Œå¤šæ ·æ€§ä¸Šéƒ½ä¸å¦‚ ImageNetï¼‰å’ŒLabelMeæ•°æ®é›†ï¼ˆåœ¨æ ‡å‡†åŒ–ä¸Šä¸å¦‚ImageNetï¼‰ã€‚</p>

<p>ImageNetä¸ä½†æ˜¯è®¡ç®—æœºè§†è§‰å‘å±•çš„é‡è¦æ¨åŠ¨è€…ï¼Œä¹Ÿæ˜¯è¿™ä¸€æ³¢æ·±åº¦å­¦ä¹ çƒ­æ½®çš„å…³é”®é©±åŠ¨åŠ›ä¹‹ä¸€ã€‚æˆªè‡³2016å¹´ï¼ŒImageNetä¸­å«æœ‰è¶…è¿‡1500ä¸‡ç”±äººæ‰‹å·¥æ³¨é‡Šçš„å›¾ç‰‡ç½‘å€ï¼Œä¹Ÿå°±æ˜¯å¸¦æ ‡ç­¾çš„å›¾ç‰‡ï¼Œæ ‡ç­¾è¯´æ˜äº†å›¾ç‰‡ä¸­çš„å†…å®¹ï¼Œè¶…è¿‡2.2ä¸‡ä¸ªç±»åˆ«ã€‚</p>

<p>CVPR2017ç ”è®¨ä¼šâ€œè¶…è¶ŠILSVRCâ€å°†å®£å¸ƒä»Šå¹´æ˜¯ ImageNet ç«èµ›æ­£å¼ç»„ç»‡çš„æœ€åä¸€å¹´ï¼Œ2016å¹´ILSVRC çš„å›¾åƒè¯†åˆ«é”™è¯¯ç‡å·²ç»è¾¾åˆ°çº¦2.9%ï¼Œä¸ä»…è¿œè¿œè¶…è¶Šäººç±»ï¼ˆ5.1%ï¼‰ï¼Œä»Šåå†è¿›è¡Œè¿™ç±»ç«èµ›æ„ä¹‰ä¹Ÿä¸å¤§äº†ã€‚è¿™æ— ç–‘æ ‡å¿—ç€ä¸€ä¸ªæ—¶ä»£çš„ç»“æŸï¼Œä½†ä¹Ÿæ˜¯æ–°å¾ç¨‹çš„å¼€å§‹ï¼šæœªæ¥ï¼Œè®¡ç®—æœºè§†è§‰çš„é‡ç‚¹åœ¨å›¾åƒç†è§£ï¼Œè€Œä½œä¸ºILSVRCæ›¿ä»£è€…çš„å€™é€‰äººä¹‹ä¸€æ˜¯è‹é»ä¸–ç†å·¥å¤§å­¦å’Œè°·æ­Œç­‰è”åˆæå‡ºçš„ WebVision Challengeï¼Œä¹Ÿå°†äºCVPR2017åŒæœŸä¸¾åŠï¼Œå†…å®¹ä¾§é‡äºå­¦ä¹ å’Œç†è§£ç½‘ç»œæ•°æ®ã€‚</p>

<p>å†å±ŠILSVRCçš„ä½œå“ï¼Œå¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/kangroger/article/details/56522132">ILSVRCå†å±Šå† å†›è®ºæ–‡ç¬”è®°</a>ï¼ŒåŒ…å«æ¨¡å‹æ¡†æ¶å’Œè¯†åˆ«ç‡ç­‰ã€‚</p>

<p><a id="markdown-å·ç§¯ä¸å›¾åƒå¤„ç†" name="å·ç§¯ä¸å›¾åƒå¤„ç†"></a></p>

<h2>å·ç§¯ä¸å›¾åƒå¤„ç†</h2>

<p><a id="markdown-å·ç§¯çš„å®šä¹‰" name="å·ç§¯çš„å®šä¹‰"></a></p>

<h3>å·ç§¯çš„å®šä¹‰</h3>

<p><img src="http://hongchaozhang.github.io/images/201805convolution_definition.gif" alt="convolution definition demo" /></p>

<p>å‚è€ƒ<a href="https://en.wikipedia.org/wiki/Convolution">Convolution</a>ã€‚</p>

<p><a id="markdown-å›¾åƒå·ç§¯çš„ç‰©ç†æ„ä¹‰" name="å›¾åƒå·ç§¯çš„ç‰©ç†æ„ä¹‰"></a></p>

<h3>å›¾åƒå·ç§¯çš„ç‰©ç†æ„ä¹‰</h3>

<p>å·ç§¯çŸ©é˜µä¹Ÿå«â€œæ»¤æ³¢å™¨â€ã€â€œæ ¸â€æˆ–â€œç‰¹å¾æ¢æµ‹å™¨â€ã€‚</p>

<p><img src="http://hongchaozhang.github.io/images/201805kernel_convolution.jpg" alt="image convolution" /></p>

<p><img src="http://hongchaozhang.github.io/images/201805image_convolution.jpg" alt="image convolutioon" /></p>

<p>å‚è€ƒ<a href="https://en.wikipedia.org/wiki/Kernel_(image_processing">Kernel (image processing)</a>)ã€‚
ï¿¼</p>

<p><a id="markdown-lenetè¯¦è§£" name="lenetè¯¦è§£"></a></p>

<h2>LeNetè¯¦è§£</h2>

<p>å‚è€ƒ<a href="http://cv-tricks.com/tensorflow-tutorial/training-convolutional-neural-network-for-image-classification/">Basics of Convolutional Neural network (CNN)</a>ã€‚</p>

<ol>
<li>Convolutional Layer</li>
<li>Pooling Layer</li>
<li>Fully Connected Layer</li>
<li>Understanding Training Process</li>
</ol>


<p><a href="https://ujjwalkarn.me/2016/08/11/intuitive-explanation-convnets/">An Intuitive Explanation of Convolutional NeuralÂ Networks</a>çš„è®²è§£ä¹Ÿä¸é”™ï¼Œä¸­æ–‡ç‰ˆåœ¨<a href="https://blog.csdn.net/lcy7289786/article/details/68958111">è¿™é‡Œ</a>ã€‚</p>

<p><a id="markdown-æ‰‹å†™æ•°å­—è¯†åˆ«è¿‡ç¨‹å¯è§†åŒ–" name="æ‰‹å†™æ•°å­—è¯†åˆ«è¿‡ç¨‹å¯è§†åŒ–"></a></p>

<h2>æ‰‹å†™æ•°å­—è¯†åˆ«è¿‡ç¨‹å¯è§†åŒ–</h2>

<p><img src="http://hongchaozhang.github.io/images/201805cnn_visualization.jpg" alt="cnn visualization" /></p>

<p>å®˜æ–¹ç½‘ç«™ï¼š
<a href="http://scs.ryerson.ca/~aharley/vis/">http://scs.ryerson.ca/~aharley/vis/</a></p>

<p>3Då¯è§†åŒ–ï¼š
<a href="http://scs.ryerson.ca/~aharley/vis/conv/">http://scs.ryerson.ca/~aharley/vis/conv/</a></p>

<p>2Då¯è§†åŒ–ï¼š
<a href="http://scs.ryerson.ca/~aharley/vis/conv/flat.html">http://scs.ryerson.ca/~aharley/vis/conv/flat.html</a></p>

<p>ç›¸å…³è®ºæ–‡ï¼š
<a href="http://scs.ryerson.ca/~aharley/vis/harley_vis_isvc15.pdf">http://scs.ryerson.ca/~aharley/vis/harley_vis_isvc15.pdf</a></p>

<p><a id="markdown-ç¥ç»ç½‘ç»œä¸­çš„ç¥ç»å…ƒå’Œæƒé‡åœ¨å“ªé‡Œ" name="ç¥ç»ç½‘ç»œä¸­çš„ç¥ç»å…ƒå’Œæƒé‡åœ¨å“ªé‡Œ"></a></p>

<h2>ç¥ç»ç½‘ç»œä¸­çš„â€œç¥ç»å…ƒâ€å’Œâ€œæƒé‡â€åœ¨å“ªé‡Œï¼Ÿ</h2>

<p><img src="http://hongchaozhang.github.io/images/201805convolution_weights.jpg" alt="convolution and weights" /></p>

<p>å„ä¸ªå·æœºæ»¤æ³¢å™¨çš„é‡Œé¢çš„æ¯ä¸ªä½ç½®çš„å€¼ï¼Œå³æ˜¯æˆ‘ä»¬éœ€è¦è®­ç»ƒçš„æƒé‡ï¼ˆå·ç§¯æ»¤æ³¢å™¨çš„å°ºå¯¸æ˜¯éœ€è¦æˆ‘ä»¬æå‰æŒ‡å®šå¥½çš„ï¼‰ï¼Œæ¯ä¸ªåƒç´ å¯¹åº”äºä¸€ä¸ªç¥ç»å…ƒã€‚</p>

<p>å…¶ä¸­ç¥ç»ç½‘ç»œçš„åŸºæœ¬æ¦‚å¿µå¯ä»¥å‚è€ƒ<a href="http://playground.tensorflow.org/">TensorFlow Playground</a>ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift Coding Conventions]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/01/26/swift-coding-convention/"/>
    <updated>2018-01-26T11:37:05+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/01/26/swift-coding-convention</id>
    <content type="html"><![CDATA[<p>Collection of some Swift coding conventions, which will make Swift code more maintainable, more readable.</p>

<!-- more -->


<p>The following is conventions I like or I will likely misuse. For a complete version, go to:</p>

<ol>
<li><a href="https://github.com/raywenderlich/swift-style-guide/">The Official raywenderlich.com Swift Style Guide.</a></li>
<li>Swift <a href="https://swift.org/documentation/api-design-guidelines/">API Design Guidelines</a></li>
</ol>


<!-- TOC -->


<ul>
<li><a href="#naming">Naming</a>

<ul>
<li><a href="#try-to-form-grammatical-english-phrases">Try to Form Grammatical English Phrases</a></li>
<li><a href="#mutatingnonmutating-methods-naming">Mutating/Nonmutating Methods Naming</a></li>
<li><a href="#boolean-methods-naming">Boolean Methods Naming</a></li>
<li><a href="#protocol-naming">Protocol Naming</a></li>
<li><a href="#avoid-abbreviations">Avoid Abbreviations</a></li>
<li><a href="#delegates">Delegates</a></li>
</ul>
</li>
<li><a href="#code-organization">Code Organization</a>

<ul>
<li><a href="#protocol-conformance">Protocol Conformance</a></li>
</ul>
</li>
<li><a href="#classes-and-structures">Classes and Structures</a>

<ul>
<li><a href="#use-of-self">Use of Self</a></li>
<li><a href="#constants">Constants</a></li>
</ul>
</li>
<li><a href="#control-flow">Control Flow</a>

<ul>
<li><a href="#golden-path">Golden Path</a>

<ul>
<li><a href="#failing-guards">Failing Guards</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#argument-labels">Argument Labels</a></li>
</ul>


<!-- /TOC -->


<p><a id="markdown-naming" name="naming"></a></p>

<h2>Naming</h2>

<p>Descriptive and consistent naming makes software easier to read and understand. Use the Swift naming conventions described in the <a href="https://swift.org/documentation/api-design-guidelines/">API Design Guidelines</a>. Some key principles include:</p>

<ol>
<li>prioritizing clarity over brevity</li>
<li>striving for fluent usage</li>
<li>using uppercase for types (and protocols), lowercase for everything else</li>
<li>boolean types should read like assertions</li>
<li>choosing good parameter names that serve as documentation</li>
<li>generally avoiding abbreviations</li>
<li>taking advantage of default parameters</li>
<li>labeling closure and tuple parameters</li>
<li>verb methods follow the -ed, -ing rule for the non-mutating version</li>
<li>noun methods follow the formX rule for the mutating version</li>
<li>protocols that describe what something is should read as nouns</li>
<li>protocols that describe a capability should end in -able or -ible</li>
<li>striving for clarity at the call site</li>
</ol>


<p><a id="markdown-try-to-form-grammatical-english-phrases" name="try-to-form-grammatical-english-phrases"></a></p>

<h3>Try to Form Grammatical English Phrases</h3>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nl">at</span><span class="p">:</span> <span class="n">z</span><span class="p">)</span>          <span class="c1">// â€œx, insert y at zâ€</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">subViews</span><span class="p">(</span><span class="nl">havingColor</span><span class="p">:</span> <span class="n">y</span><span class="p">)</span>  <span class="c1">// â€œx&#39;s subviews having color yâ€</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">capitalizingNouns</span><span class="p">()</span>       <span class="c1">// â€œx, capitalizing nounsâ€</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nl">position</span><span class="p">:</span> <span class="n">z</span><span class="p">)</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">subViews</span><span class="p">(</span><span class="nl">color</span><span class="p">:</span> <span class="n">y</span><span class="p">)</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">nounCapitalize</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-mutatingnonmutating-methods-naming" name="mutatingnonmutating-methods-naming"></a></p>

<h3>Mutating/Nonmutating Methods Naming</h3>

<p>When the operation is naturally described by a verb, use the verbâ€™s imperative for the mutating method and apply the â€œedâ€ or â€œingâ€ suffix to name its nonmutating counterpart.</p>

<table>
<thead>
<tr>
<th> Mutating  </th>
<th> Nonmutating </th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>x.sort()</code>    </td>
<td> <code>z = x.sorted()</code> </td>
</tr>
<tr>
<td> <code>x.append(y)</code> </td>
<td> <code>z = x.appending(y)</code> </td>
</tr>
</tbody>
</table>


<p><br>
When the operation is naturally described by a noun, use the noun for the nonmutating method and apply the â€œformâ€ prefix to name its mutating counterpart.</p>

<table>
<thead>
<tr>
<th> Nonmutating   </th>
<th> Mutating </th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>x = y.union(z)</code>  </td>
<td> <code>y.formUnion(z)</code> </td>
</tr>
<tr>
<td> <code>j = c.successor(i)</code>  </td>
<td> <code>c.formSuccessor(&amp;i)</code> </td>
</tr>
</tbody>
</table>


<p><a id="markdown-boolean-methods-naming" name="boolean-methods-naming"></a></p>

<h3>Boolean Methods Naming</h3>

<p>Uses of Boolean methods and properties should read as assertions about the receiver when the use is nonmutating, e.g. <code>x.isEmpty</code>, <code>line1.intersects(line2)</code>.</p>

<p><a id="markdown-protocol-naming" name="protocol-naming"></a></p>

<h3>Protocol Naming</h3>

<p>Protocols that describe what something is should read as nouns (e.g. <code>Collection</code>).</p>

<p>Protocols that describe a capability should be named using the suffixes -able, -ible, or -ing (e.g. <code>Equatable</code>, <code>ProgressReporting</code>).</p>

<p><a id="markdown-avoid-abbreviations" name="avoid-abbreviations"></a></p>

<h3>Avoid Abbreviations</h3>

<blockquote><p>The intended meaning for any abbreviation you use should be easily found by a <strong>web search</strong>.</p></blockquote>

<p><a id="markdown-delegates" name="delegates"></a></p>

<h3>Delegates</h3>

<p>When creating custom delegate methods, an unnamed first parameter should be the delegate source. (UIKit contains numerous examples of this.)</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">namePickerView</span><span class="p">(</span><span class="n">_</span> <span class="nl">namePickerView</span><span class="p">:</span> <span class="n">NamePickerView</span><span class="p">,</span> <span class="n">didSelectName</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
</span><span class='line'><span class="k">func</span> <span class="n">namePickerViewShouldReload</span><span class="p">(</span><span class="n">_</span> <span class="nl">namePickerView</span><span class="p">:</span> <span class="n">NamePickerView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">didSelectName</span><span class="p">(</span><span class="nl">namePicker</span><span class="p">:</span> <span class="n">NamePickerViewController</span><span class="p">,</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
</span><span class='line'><span class="k">func</span> <span class="n">namePickerShouldReload</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Bool</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-code-organization" name="code-organization"></a></p>

<h2>Code Organization</h2>

<p>Use extensions to organize your code into logical blocks of functionality. Each extension should be set off with a <code>// MARK: - comment</code> to keep things well-organized.</p>

<p><a id="markdown-protocol-conformance" name="protocol-conformance"></a></p>

<h3>Protocol Conformance</h3>

<p>In particular, when adding protocol conformance to a model, prefer adding a separate extension for the protocol methods. This keeps the related methods grouped together with the protocol and can simplify instructions to add a protocol to a class with its associated methods.</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">MyViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// class stuff here</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// MARK: - UITableViewDataSource</span>
</span><span class='line'><span class="k">extension</span> <span class="nl">MyViewController</span><span class="p">:</span> <span class="bp">UITableViewDataSource</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// table view data source methods</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// MARK: - UIScrollViewDelegate</span>
</span><span class='line'><span class="k">extension</span> <span class="nl">MyViewController</span><span class="p">:</span> <span class="bp">UIScrollViewDelegate</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// scroll view delegate methods</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">MyViewController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">,</span> <span class="bp">UITableViewDataSource</span><span class="p">,</span> <span class="bp">UIScrollViewDelegate</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// all methods</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For UIKit view controllers, consider grouping lifecycle, custom accessors, and IBAction in separate class extensions.</p>

<p><a id="markdown-classes-and-structures" name="classes-and-structures"></a></p>

<h2>Classes and Structures</h2>

<p><a id="markdown-use-of-self" name="use-of-self"></a></p>

<h3>Use of Self</h3>

<p>For conciseness, avoid using <code>self</code> since Swift does not require it to access an object&rsquo;s properties or invoke its methods.</p>

<p>Use <code>self</code> only when required by the compiler (in <code>@escaping</code> closures, or in initializers to disambiguate properties from arguments). In other words, if it compiles without <code>self</code> then omit it.</p>

<p><a id="markdown-constants" name="constants"></a></p>

<h3>Constants</h3>

<p>Constants are defined using the <code>let</code> keyword, and variables with the <code>var</code> keyword. Always use <code>let</code> instead of <code>var</code> if the value of the variable will not change.</p>

<blockquote><p>Tip: A good technique is to define everything using <code>let</code> and only change it to <code>var</code> if the compiler complains!</p></blockquote>

<p>You can define constants on a type rather than on an instance of that type using type properties. To declare a type property as a constant simply use <code>static let</code>. Type properties declared in this way are generally preferred over global constants because they are easier to distinguish from instance properties.</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">enum</span> <span class="n">Math</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">static</span> <span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">2.718281828459045235360287</span>
</span><span class='line'>  <span class="k">static</span> <span class="k">let</span> <span class="n">root2</span> <span class="o">=</span> <span class="mf">1.41421356237309504880168872</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">hypotenuse</span> <span class="o">=</span> <span class="n">side</span> <span class="o">*</span> <span class="n">Math</span><span class="p">.</span><span class="n">root2</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">2.718281828459045235360287</span>  <span class="c1">// pollutes global namespace</span>
</span><span class='line'><span class="k">let</span> <span class="n">root2</span> <span class="o">=</span> <span class="mf">1.41421356237309504880168872</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">hypotenuse</span> <span class="o">=</span> <span class="n">side</span> <span class="o">*</span> <span class="n">root2</span> <span class="c1">// what is root2?</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-control-flow" name="control-flow"></a></p>

<h2>Control Flow</h2>

<p><a id="markdown-golden-path" name="golden-path"></a></p>

<h3>Golden Path</h3>

<p>When coding with conditionals, the left-hand margin of the code should be the &ldquo;golden&rdquo; or &ldquo;happy&rdquo; path. That is, don&rsquo;t nest <code>if</code> statements. Multiple return statements are OK. The <code>guard</code> statement is built for this.</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">computeFFT</span><span class="p">(</span><span class="nl">context</span><span class="p">:</span> <span class="n">Context</span><span class="o">?</span><span class="p">,</span> <span class="nl">inputData</span><span class="p">:</span> <span class="n">InputData</span><span class="o">?</span><span class="p">)</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Frequencies</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">guard</span> <span class="k">let</span> <span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">throw</span> <span class="n">FFTError</span><span class="p">.</span><span class="n">noContext</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">guard</span> <span class="k">let</span> <span class="n">inputData</span> <span class="o">=</span> <span class="n">inputData</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">throw</span> <span class="n">FFTError</span><span class="p">.</span><span class="n">noInputData</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// use context and input to compute the frequencies</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">frequencies</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">computeFFT</span><span class="p">(</span><span class="nl">context</span><span class="p">:</span> <span class="n">Context</span><span class="o">?</span><span class="p">,</span> <span class="nl">inputData</span><span class="p">:</span> <span class="n">InputData</span><span class="o">?</span><span class="p">)</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Frequencies</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="k">let</span> <span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">inputData</span> <span class="o">=</span> <span class="n">inputData</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// use context and input to compute the frequencies</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="n">frequencies</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">throw</span> <span class="n">FFTError</span><span class="p">.</span><span class="n">noInputData</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">throw</span> <span class="n">FFTError</span><span class="p">.</span><span class="n">noContext</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When multiple optionals are unwrapped either with <code>guard</code> or <code>if let</code>, minimize nesting by using the compound version when possible. Example:</p>

<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">guard</span> <span class="k">let</span> <span class="n">number1</span> <span class="o">=</span> <span class="n">number1</span><span class="p">,</span>
</span><span class='line'>      <span class="k">let</span> <span class="n">number2</span> <span class="o">=</span> <span class="n">number2</span><span class="p">,</span>
</span><span class='line'>      <span class="k">let</span> <span class="n">number3</span> <span class="o">=</span> <span class="n">number3</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;impossible&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// do something with numbers</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">if</span> <span class="k">let</span> <span class="n">number1</span> <span class="o">=</span> <span class="n">number1</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="k">let</span> <span class="n">number2</span> <span class="o">=</span> <span class="n">number2</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">number3</span> <span class="o">=</span> <span class="n">number3</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// do something with numbers</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;impossible&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;impossible&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;impossible&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-failing-guards" name="failing-guards"></a></p>

<h4>Failing Guards</h4>

<p><code>guard</code> statements are required to exit in some way. Generally, this should be simple one line statement such as <code>return</code>, <code>throw</code>, <code>break</code>, <code>continue</code>, and <code>fatalError()</code>. Large code blocks should be avoided. If cleanup code is required for multiple exit points, consider using a <code>defer</code> block to avoid cleanup code duplication.</p>

<p><a id="markdown-argument-labels" name="argument-labels"></a></p>

<h2>Argument Labels</h2>

<ol>
<li>Good practice</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">move</span><span class="p">(</span><span class="n">from</span> <span class="nl">start</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">to</span> <span class="nl">end</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span>
</span><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nl">to</span><span class="p">:</span> <span class="n">y</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><p>Omit all labels when arguments canâ€™t be usefully distinguished, e.g. <code>min(number1, number2)</code>, <code>zip(sequence1, sequence2)</code>.</p></li>
<li><p>When the first argument forms part of a prepositional phrase, give it an argument label. The argument label should normally begin at the preposition, e.g. <code>x.removeBoxes(havingLength: 12)</code>.</p>

<ul>
<li>An exception for the principle above arises when the first two arguments represent parts of a single abstraction. In such cases, begin the argument label after the preposition, to keep the abstraction clear.</li>
</ul>
</li>
</ol>


<p><strong>Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">a</span><span class="p">.</span><span class="n">moveTo</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="n">c</span><span class="p">)</span>
</span><span class='line'><span class="n">a</span><span class="p">.</span><span class="n">fadeFrom</span><span class="p">(</span><span class="nl">red</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nl">green</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="nl">blue</span><span class="p">:</span> <span class="n">d</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Not Preferred:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">a</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="nl">toX</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="n">c</span><span class="p">)</span>
</span><span class='line'><span class="n">a</span><span class="p">.</span><span class="n">fade</span><span class="p">(</span><span class="nl">fromRed</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nl">green</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="nl">blue</span><span class="p">:</span> <span class="n">d</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DR Project]]></title>
    <link href="http://hongchaozhang.github.io/blog/2018/01/02/dr-project/"/>
    <updated>2018-01-02T13:39:28+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2018/01/02/dr-project</id>
    <content type="html"><![CDATA[<p>Key words: ARKit, CoreML, SceneKit</p>

<!-- more -->


<p><a href="https://github.com/hongchaozhang/ProjectDataToReality">DR (Data to Reality)</a> is a demo for projecting data into reality: Using <strong>CoreML</strong> for object recognition, and then get the recognized object data and project the data to reality, just above the recognized object. In this process, <strong>ARKit</strong> helps us to get the real world object coordinate to put the data at, and <strong>SceneKit</strong> helps us to render the data in reality.</p>

<p>This is a screenshot in demo:</p>

<p><img src="http://hongchaozhang.github.io/images/DR-Screenshot-1.jpg" alt="project chart to reality" /></p>

<p>Refer to github <a href="https://github.com/hongchaozhang/ProjectDataToReality">Project Data to Reality</a> for demo project. In the github page, the following are told:</p>

<ol>
<li>Requirement</li>
<li>How to Run the Project</li>
<li>How to Use the Demo

<ol>
<li>Project Chart to Reality</li>
<li>Face Detection</li>
<li>Face Recognition</li>
</ol>
</li>
</ol>


<h2>Related techniques used</h2>

<ol>
<li><a href="../../../../2017/12/28/arkit-usage/">ARKit</a></li>
<li><a href="../../../../2017/12/28/coreml-usage/">CoreML</a></li>
<li><a href="../../../../2018/01/02/scenekit-usage/">SceneKit</a></li>
</ol>


<h2>Notes on the Demo</h2>

<p>As this is a rough demo, it need some enhancements:</p>

<ol>
<li>Only four kinds of fruits are supported: banana, orange, cucumber and strawberry. But for anything recognized by Inceptionv3.mlmodel, we can add a sphere and the name just at the world position of the object. (Set <code>showRecognizedResultNearby</code> to <code>true</code>.)</li>
<li>The chart data of the four kinds of fruits are images exported from other apps.</li>
<li>For face detection on iphone, rotate the device to left by 90 degrees to make it work on landscape. This is an issue need to be fixed.</li>
<li>Face recognition needs a trained face recognition model, called FaceRecognition.mlmodel.</li>
<li>Face recognition request doesn&rsquo;t crop the image from camera according to the face detection result. This should be done to make face recognition more robust.</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CoreML Usage]]></title>
    <link href="http://hongchaozhang.github.io/blog/2017/12/28/coreml-usage/"/>
    <updated>2017-12-28T17:25:39+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2017/12/28/coreml-usage</id>
    <content type="html"><![CDATA[<!-- more -->




<!-- TOC -->


<ul>
<li><a href="#about-coreml">About CoreML</a></li>
<li><a href="#coreml-and-vision">CoreML and Vision</a></li>
<li><a href="#model-usage">Model Usage</a></li>
<li><a href="#model-training">Model Training</a>

<ul>
<li><a href="#basic">Basic</a></li>
<li><a href="#advanced">Advanced</a></li>
</ul>
</li>
<li><a href="#coreml-pros-and-cons">CoreML Pros and Cons</a>

<ul>
<li><a href="#pros">Pros</a></li>
<li><a href="#cons">Cons</a></li>
</ul>
</li>
</ul>


<!-- /TOC -->


<p><a id="markdown-about-coreml" name="about-coreml"></a></p>

<h2>About CoreML</h2>

<ol>
<li>Support image processing for <em>Vision</em>.</li>
<li>Support NPL (natural language processing) for <em>Foundation</em>.</li>
<li>Support learned decision tree analyzing for <em>GameplayKit</em>.</li>
</ol>


<p><a id="markdown-coreml-and-vision" name="coreml-and-vision"></a></p>

<h2>CoreML and Vision</h2>

<ol>
<li>CoreML makes it even easier to use trained models in your apps.</li>
<li>Vision gives you easy access to Appleâ€™s models for detecting faces, face landmarks, text, rectangles, barcodes, and objects.</li>
</ol>


<p>Because these two frameworks are built on Metal, they run efficiently on the device, so you donâ€™t need to send your usersâ€™ data to a server.</p>

<p><a id="markdown-model-usage" name="model-usage"></a></p>

<h2>Model Usage</h2>

<p>When you load a trained machine learning model (.mlmodel) into xcode, the screenshot is like (take inceptionv3.mlmodel as an example):</p>

<p><img src="http://hongchaozhang.github.io/images/mlmodel_in_xcode.png" alt="machine learning model imported to xcode" /></p>

<p>From <em>Model Class</em> (section A), we can see that xcode has <em>Automatically generated Swift model calss</em>. Click the right arrow to view the generated model class.</p>

<p>If the model class is not generated successfully, double check <em>Target Membership</em> (section B) to make sure the mlmodel file is added into the correct target.</p>

<p>From <em>Model Evaluation Parameters</em>(section C), we can see the input and output of the trained model.</p>

<p>The following is a sample usage of image classification model:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// create request</span>
</span><span class='line'><span class="n">guard</span> <span class="k">let</span> <span class="n">selectedModel</span> <span class="o">=</span> <span class="n">try</span><span class="o">?</span> <span class="n">VNCoreMLModel</span><span class="p">(</span><span class="k">for</span><span class="o">:</span> <span class="n">Inceptionv3</span><span class="p">().</span><span class="n">model</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;Could not load model. Ensure model has been drag and dropped (copied) to XCode Project. Also ensure the model is part of a target.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">classificationRequest</span> <span class="o">=</span> <span class="n">VNCoreMLRequest</span><span class="p">(</span><span class="nl">model</span><span class="p">:</span> <span class="n">selectedModel</span><span class="p">,</span> <span class="nl">completionHandler</span><span class="p">:</span> <span class="n">classificationCompleteHandler</span><span class="p">)</span>
</span><span class='line'><span class="n">classificationRequest</span><span class="p">.</span><span class="n">imageCropAndScaleOption</span> <span class="o">=</span> <span class="n">VNImageCropAndScaleOption</span><span class="p">.</span><span class="n">centerCrop</span> <span class="c1">// Crop from centre of images and scale to appropriate size.</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// run request against an image</span>
</span><span class='line'><span class="n">guard</span> <span class="k">let</span> <span class="n">pixbuff</span> <span class="o">=</span> <span class="p">(</span><span class="n">sceneView</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">currentFrame</span><span class="o">?</span><span class="p">.</span><span class="n">capturedImage</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
</span><span class='line'><span class="k">let</span> <span class="n">ciImage</span> <span class="o">=</span> <span class="bp">CIImage</span><span class="p">(</span><span class="nl">cvPixelBuffer</span><span class="p">:</span> <span class="n">pixbuff</span><span class="p">)</span>
</span><span class='line'><span class="c1">// Note1: Not entirely sure if the ciImage is being interpreted as RGB, but for now it works with the Inception model.</span>
</span><span class='line'><span class="c1">// Note2: Also uncertain if the pixelBuffer should be rotated before handing off to Vision (VNImageRequestHandler) - regardless, for now, it still works well with the Inception model.</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">imageRequestHandler</span> <span class="o">=</span> <span class="n">VNImageRequestHandler</span><span class="p">(</span><span class="nl">ciImage</span><span class="p">:</span> <span class="n">ciImage</span><span class="p">,</span> <span class="nl">options</span><span class="p">:</span> <span class="p">[</span><span class="o">:</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="k">do</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">try</span> <span class="n">imageRequestHandler</span><span class="p">.</span><span class="n">perform</span><span class="p">([</span><span class="n">classificationRequest</span><span class="p">])</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// completion handler for coping with image classification results.</span>
</span><span class='line'><span class="k">func</span> <span class="n">classificationCompleteHandler</span><span class="p">(</span><span class="nl">request</span><span class="p">:</span> <span class="n">VNRequest</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="n">Error</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Error: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">error</span><span class="o">?</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">guard</span> <span class="k">let</span> <span class="n">observations</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">results</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;No results&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Get Classifications</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">classifications</span> <span class="o">=</span> <span class="n">observations</span><span class="p">[</span><span class="mf">0.</span><span class="p">.</span><span class="mf">.1</span><span class="p">]</span> <span class="c1">// top 2 results</span>
</span><span class='line'>        <span class="p">.</span><span class="n">flatMap</span><span class="p">({</span> <span class="err">$</span><span class="mi">0</span> <span class="kt">as</span><span class="o">?</span> <span class="n">VNClassificationObservation</span> <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="n">filter</span><span class="p">({</span> <span class="err">$</span><span class="mf">0.</span><span class="n">confidence</span> <span class="o">&gt;</span> <span class="mf">0.2</span> <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="n">map</span><span class="p">({</span> <span class="s">&quot;\($0.identifier) \(String(format:&quot;</span><span class="o">-</span> <span class="o">%</span><span class="mf">.2f</span><span class="s">&quot;, $0.confidence))&quot;</span> <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="n">joined</span><span class="p">(</span><span class="nl">separator</span><span class="p">:</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;image recognition: &quot;</span> <span class="o">+</span> <span class="n">classifications</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Refer to <a href="https://developer.apple.com/machine-learning/">Build more intelligent apps with machine learning</a> for some official materials.</p>

<p>For some detailed usage step by step, refer to <a href="https://www.raywenderlich.com/164213/coreml-and-vision-machine-learning-in-ios-11-tutorial">Core ML and Vision: Machine Learning in iOS 11 Tutorial</a>.</p>

<p><a id="markdown-model-training" name="model-training"></a></p>

<h2>Model Training</h2>

<p><a id="markdown-basic" name="basic"></a></p>

<h3>Basic</h3>

<p><img src="http://hongchaozhang.github.io/images/CustomVisionFromMicroSoft.png" alt="Custom Vision From MicroSoft" /></p>

<p>Microsoft <a href="https://www.customvision.ai/">Custom Vision</a> supplies a very friendly UI interface. You can upload you images and label them very easily. After training is done, you can export the model for mobile devices, including: mlmodel file for iOS platform, and TensorFlow model on Android platform.</p>

<p>Friendly UI Interface:</p>

<p><img src="http://hongchaozhang.github.io/images/InterfaceOfCustomVision.png" alt="interface of microsoft custom vision" /></p>

<p>But there are some limitations, as <a href="https://www.customvision.ai/">Custom Vision</a> is still in preview process.</p>

<p><img src="http://hongchaozhang.github.io/images/MicroSoftCustomVisionLimitation.png" alt="limitation of microsoft custom vision" /></p>

<p><a id="markdown-advanced" name="advanced"></a></p>

<h3>Advanced</h3>

<p><a href="https://github.com/apple/turicreate/tree/master/userguide/image_classifier">apple turicreate image classification</a> supplies more configurations for model training, like the partition of trainning data and verification data. But some Python experience is needed.</p>

<p><a id="markdown-coreml-pros-and-cons" name="coreml-pros-and-cons"></a></p>

<h2>CoreML Pros and Cons</h2>

<p><a id="markdown-pros" name="pros"></a></p>

<h3>Pros</h3>

<ol>
<li><p><strong>Easy to use.</strong> As described at the beginning of the post.</p></li>
<li><p><strong>High performance.</strong> As is said:</p>

<blockquote><p>â€œIt was amazing to see the prediction results immediately without any time interval.â€</p></blockquote></li>
</ol>


<p><a id="markdown-cons" name="cons"></a></p>

<h3>Cons</h3>

<p><strong>Lack of federated learning.</strong> As is said:</p>

<blockquote><p>There are no provisions within Core ML for model retraining or federated learning, where data collected from the field is used to improve the accuracy of the model. Thatâ€™s something you would have to implement by hand, most likely by asking app users to opt in for data collection and using that data to retrain the model for a future edition of the app.</p></blockquote>

<p>Refer to <a href="https://www.infoworld.com/article/3200885/machine-learning/apples-core-ml-the-pros-and-cons.html">Appleâ€™s Core ML: The pros and cons</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ARKit Usage]]></title>
    <link href="http://hongchaozhang.github.io/blog/2017/12/28/arkit-usage/"/>
    <updated>2017-12-28T17:25:27+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2017/12/28/arkit-usage</id>
    <content type="html"><![CDATA[<!-- more -->




<p><!-- TOC -->autoauto- <a href="#cool-ar-apps-in-app-store">Cool AR Apps in App Store</a>auto    - <a href="#world-brush">World Brush</a>auto    - <a href="#ikea-place">IKEA Place</a>auto    - <a href="#ar-measurekit">AR MeasureKit</a>auto- <a href="#requirement">Requirement</a>auto- <a href="#arkit-usage">ARKit Usage</a>auto    - <a href="#arkit-related-techniques">ARKit Related Techniques</a>auto    - <a href="#arkit-in-ios-system">ARKit in iOS System</a>auto    - <a href="#arkit-key-classes">ARKit Key Classes</a>auto    - <a href="#arsession"><code>ARSession</code></a>auto    - <a href="#arconfiguration"><code>ARConfiguration</code></a>auto    - <a href="#more-on-arworldtrackingconfiguration">More on <code>ARWorldTrackingConfiguration</code></a>auto        - <a href="#tracking-quality">Tracking Quality</a>auto    - <a href="#arframe"><code>ARFrame</code></a>auto    - <a href="#hittest-for-real-world-position">HitTest for Real World Position</a>auto        - <a href="#existingplane"><code>existingPlane</code></a>auto        - <a href="#existingplaneusingextent"><code>existingPlaneUsingExtent</code></a>auto        - <a href="#estimatedhorizontalplane"><code>estimatedHorizontalPlane</code></a>auto        - <a href="#featurepoint"><code>featurePoint</code></a>auto    - <a href="#display-virtual-object-in-real-world">Display Virtual Object in Real World</a>auto        - <a href="#standard-view">Standard View</a>auto        - <a href="#custom-view">Custom View</a>auto- <a href="#best-practices-and-limitations">Best Practices and Limitations</a>auto    - <a href="#best-practices">Best Practices</a>auto    - <a href="#limitations">Limitations</a>auto- <a href="#ar-from-google">AR from Google</a>autoauto<!-- /TOC --></p>

<p><a id="markdown-cool-ar-apps-in-app-store" name="cool-ar-apps-in-app-store"></a></p>

<h2>Cool AR Apps in App Store</h2>

<p><a id="markdown-world-brush" name="world-brush"></a></p>

<h3>World Brush</h3>

<p><a href="https://itunes.apple.com/us/app/world-brush/id1277410449?mt=8">World Brush</a> is an AR experience where users can paint with brushes on the world around them. Every painting is saved at the approximate GPS location where it was created, and will be recommended to the user around.</p>

<p><img src="http://hongchaozhang.github.io/images/ARKit_WorldBrush.png" width="300" alt="world brush" /></p>

<p><a id="markdown-ikea-place" name="ikea-place"></a></p>

<h3>IKEA Place</h3>

<p><a href="https://itunes.apple.com/us/app/ikea-place/id1279244498?mt=8">IKEA Place</a> lets you virtually &lsquo;place&rsquo; IKEA products in your space.</p>

<p><img src="http://hongchaozhang.github.io/images/ARKit_IkeaPlace.png" width="300" alt="ikea place" /></p>

<p><a id="markdown-ar-measurekit" name="ar-measurekit"></a></p>

<h3>AR MeasureKit</h3>

<p><a href="https://itunes.apple.com/us/app/ar-measurekit/id1258270451?mt=8">AR MeasureKit</a> makes it really easy to measure different things in the world using your iPhoneâ€™s or iPadâ€™s camera.</p>

<p><img src="http://hongchaozhang.github.io/images/ARKit_MeasureKit.png" width="300" alt="ar measure kit" /></p>

<p><a id="markdown-requirement" name="requirement"></a></p>

<h2>Requirement</h2>

<ul>
<li>iOS 11 and above system.</li>
<li>iOS device with an A9 or later processor.</li>
</ul>


<p>To make your app available only on devices supporting ARKit, use the arkit key in the <code>UIRequiredDeviceCapabilities</code> section of your app&rsquo;s Info.plist. If augmented reality is a secondary feature of your app, use the <code>ARWorldTrackingSessionConfiguration.isSupported</code> property to determine whether the current device supports the session configuration you want to use.</p>

<p><a id="markdown-arkit-usage" name="arkit-usage"></a></p>

<h2>ARKit Usage</h2>

<p><a id="markdown-arkit-related-techniques" name="arkit-related-techniques"></a></p>

<h3>ARKit Related Techniques</h3>

<p><img src="http://hongchaozhang.github.io/images/ARKitRelatedTechs.png" alt="arkit related techs" /></p>

<p><a id="markdown-arkit-in-ios-system" name="arkit-in-ios-system"></a></p>

<h3>ARKit in iOS System</h3>

<p><img src="http://hongchaozhang.github.io/images/ARKitFramework.png" alt="arkit in ios system" /></p>

<p><a id="markdown-arkit-key-classes" name="arkit-key-classes"></a></p>

<h3>ARKit Key Classes</h3>

<p><img src="http://hongchaozhang.github.io/images/ARKitUsage.png" alt="arkit usage" /></p>

<p><a id="markdown-arsession" name="arsession"></a></p>

<h3><code>ARSession</code></h3>

<p>An <a href="https://developer.apple.com/documentation/arkit/arsession"><code>ARSession</code></a> object coordinates the major processes that ARKit performs on your behalf to create an augmented reality experience. These processes include reading data from the device&rsquo;s motion sensing hardware, controlling the device&rsquo;s built-in camera, and performing image analysis on captured camera images. The session synthesizes all of these results to establish a correspondence between the real-world space the device inhabits and a virtual space where you model AR content.</p>

<p>Every AR experience built with ARKit requires a single <code>ARSession</code>object. If you use an <code>ARSCNView</code> or <code>ARSKView</code> object to easily build the visual part of your AR experience, the view object includes an <code>ARSession</code> instance. If you build your own renderer for AR content, you&rsquo;ll need to instantiate and maintain an ARSession object yourself.</p>

<p>Running a session requires a session configuration: an instance of the <code>ARConfiguration</code> class, or its subclass <code>ARWorldTrackingConfiguration</code>. These classes determine how ARKit tracks a device&rsquo;s position and motion relative to the real world, and thus affect the kinds of AR experiences you can create.</p>

<p><a id="markdown-arconfiguration" name="arconfiguration"></a></p>

<h3><code>ARConfiguration</code></h3>

<p><a href="https://developer.apple.com/documentation/arkit/arconfiguration"><code>ARConfiguration</code></a> is an abstract class; you do not create or work with instances of this class.</p>

<p>To run an AR session, create an instance of the concrete <code>ARConfiguration</code> subclass that provides the kind of augmented reality experience you want to use in your app or game. Then, set up the configuration object&rsquo;s properties and pass the configuration to your session&rsquo;s <code>run(_:options:)</code> method. ARKit includes the following concrete configuration classes:</p>

<ul>
<li><p><a href="https://developer.apple.com/documentation/arkit/arworldtrackingconfiguration"><code>ARWorldTrackingConfiguration</code></a>
Provides high-quality AR experiences that use the rear-facing camera precisely track a device&rsquo;s position and orientation and allow plane detection and hit testing. Creating and maintaining this correspondence between spaces requires tracking the device&rsquo;s motion. The <code>ARWorldTrackingConfiguration</code> class tracks the device&rsquo;s movement with six degrees of freedom (6DOF): specifically, the three rotation axes (roll, pitch, and yaw), and three translation axes (movement in x, y, and z).</p></li>
<li><p><a href="https://developer.apple.com/documentation/arkit/arorientationtrackingconfiguration"><code>AROrientationTrackingConfiguration</code></a>
Provides basic AR experiences that use the rear-facing camera and track only a device&rsquo;s orientation. Creating and maintaining this correspondence between spaces requires tracking the device&rsquo;s motion. The <code>AROrientationTrackingConfiguration</code> class tracks the device&rsquo;s movement with three degrees of freedom (3DOF): specifically, the three rotation axes (roll, pitch, and yaw).</p>

<p>  <code>AROrientationTrackingConfiguration</code> cannot track movement of the device, and 3DOF tracking does not support plane detection or hit testing.</p>

<p>  Use 3DOF tracking only as a fallback in situations where 6DOF tracking is temporarily unavailable.</p></li>
<li><p><a href="https://developer.apple.com/documentation/arkit/arfacetrackingconfiguration"><code>ARFaceTrackingConfiguration</code></a>
Provides AR experiences that use the front-facing camera and track the movement and expressions of the user&rsquo;s face.</p></li>
</ul>


<p>Face tracking is available only on iOS devices with a front-facing TrueDepth camera.</p>

<p>An official example <a href="https://developer.apple.com/documentation/arkit/creating_face_based_ar_experiences">Creating Face-Based AR Experiences</a> demonstrates that you can place and animate 3D content that follows the userâ€™s face and matches facial expressions, using the TrueDepth camera on iPhone X.</p>

<p><a id="markdown-more-on-arworldtrackingconfiguration" name="more-on-arworldtrackingconfiguration"></a></p>

<h3>More on <code>ARWorldTrackingConfiguration</code></h3>

<p>Refer to <a href="https://developer.apple.com/documentation/arkit/about_augmented_reality_and_arkit">About Augmented Reality and ARKit</a> for an official explanation of the world tracking things.</p>

<p>World tracking process can be illustrated as:</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitTracking.gif" alt="arkit world tracking" /></p>

<blockquote><p>One question here: <em>How does ARKit know how long is 1 meter in the real world?</em> <a href="https://www.quora.com/How-can-Apple%E2%80%99s-ARKit-Augmented-Reality-do-precise-measurement-with-just-one-camera">How can Appleâ€™s ARKit (Augmented Reality) do precise measurement with just one camera?</a> is trying to figure this out:</p>

<p>&ldquo;When an iPhone camera is turned on, it doesnâ€™t have two different images with which to calculate distances. However, a moment after the first image is taken it does have a second image. <strong>Thanks to data from the iPhone accelerometer sensors, it can also estimate the difference - from the first image to the second - of the iPhone cameraâ€™s 3D position and aim.</strong> Now we go back to those â€œknown featuresâ€ being tracked. For each image the iPhone doesnâ€™t just do this for a single feature, it maps as many features as it can. Aside from doing the triangulation on each of the features in the images, it also does a comparison between the differences in each featureâ€™s relationship to other features in the image. So now, like your brain, the iPhone has two different views of something, knows the approximate angles of focus, knows the distance between the lens position, is tracking known features and their relationship to each other. From this, the iPhone can get a very good approximation of how each feature is positioned in space with relation to the other features, essentially producing a 3D mapping of the space.&rdquo;</p></blockquote>

<p><a id="markdown-tracking-quality" name="tracking-quality"></a></p>

<h4>Tracking Quality</h4>

<p>To get better tracking quality:</p>

<ol>
<li>Uninterrupted sensor data</li>
<li>Textured environments</li>
<li>Static scenes</li>
</ol>


<p>If tracking quality changes, the tracking state will also change:</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitTrackingState.png" alt="arkit tracing state transition" /></p>

<p>And the tracking state changes will be notified by:</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">session</span><span class="p">(</span><span class="n">_</span> <span class="nl">session</span><span class="p">:</span> <span class="n">ARSession</span><span class="p">,</span> <span class="n">cameraDidChangeTrackingState</span> <span class="nl">camera</span><span class="p">:</span> <span class="n">ARCamera</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">case</span> <span class="p">.</span><span class="n">limited</span><span class="p">(</span><span class="k">let</span> <span class="n">reason</span><span class="p">)</span> <span class="o">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">trackingState</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Notify user of limited tracking state</span>
</span><span class='line'>        <span class="p">&hellip;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><a id="markdown-arframe" name="arframe"></a></p>

<h3><code>ARFrame</code></h3>

<p>After world tracking, we can get the 6 DOF of the camera, used for the upcoming rendering. These infos are stored in each <code>ARFrame</code>.</p>

<p><code>ARFrame</code> owns video image and position tracking information captured as part of an AR session. There are two ways to access <code>ARFrame</code> objects produced by an AR session, depending on whether your app favors a pull or a push design pattern.</p>

<ul>
<li><em>Pull Pattern</em>: get <code>currentFrame</code> from <code>ARSession</code>.</li>
<li><em>Push Pattern</em>: implement the <code>session(_:didUpdate:)</code> delegate method, and the session will call it once for each video frame it captures (at 60 frames per second by default).</li>
</ul>


<p>Key infos in <code>ARFrame</code>:</p>

<ol>
<li><p><strong><code>ARCamera</code></strong>: Information about the camera position and imaging characteristics for a captured video frame in an AR session. Get <code>camera</code> from <code>ARFrame</code>.</p></li>
<li><p><strong><code>ARLightEstimate</code></strong>: Estimated scene lighting information associated with a captured video frame in an AR session. Get <code>lightEstimate</code> from <code>ARFrame</code>.</p>

<p> Refer to <a href="https://blog.markdaws.net/arkit-by-example-part-4-realism-lighting-pbr-b9a0bedb013e">ARKit by Exampleâ€Šâ€”â€ŠPart 4: Realism - Lighting &amp; PBR</a> for mimicing the environment light.</p></li>
</ol>


<p><a id="markdown-hittest-for-real-world-position" name="hittest-for-real-world-position"></a></p>

<h3>HitTest for Real World Position</h3>

<p>By calling the following method on <code>ARSCNView</code>,</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">open</span> <span class="k">func</span> <span class="n">hitTest</span><span class="p">(</span><span class="n">_</span> <span class="nl">point</span><span class="p">:</span> <span class="bp">CGPoint</span><span class="p">,</span> <span class="nl">types</span><span class="p">:</span> <span class="n">ARHitTestResult</span><span class="p">.</span><span class="n">ResultType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">ARHitTestResult</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>we can get an array of <code>ARHitTestResult</code>, which stay at the very position point indicates. The <code>ARHitTestResult</code>s are sorted by distance. To call the method, you need to specify the <code>ARHitTestResult.ResultType</code>. There are four kinds of hitTest types:</p>

<p><a id="markdown-existingplane" name="existingplane"></a></p>

<h4><code>existingPlane</code></h4>

<p>Return the result type from intersecting with an existing plane anchor.</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitHitTestExistingPlane.gif" alt="arkit hittest existing plane" /></p>

<p><a id="markdown-existingplaneusingextent" name="existingplaneusingextent"></a></p>

<h4><code>existingPlaneUsingExtent</code></h4>

<p>Return the result type from intersecting with an existing plane anchor, taking into account the planeâ€™s extent.</p>

<p><a id="markdown-estimatedhorizontalplane" name="estimatedhorizontalplane"></a></p>

<h4><code>estimatedHorizontalPlane</code></h4>

<p>Return the result type from intersecting a horizontal plane estimate, determined for the current frame.</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitHitTestEstimatedPlane.gif" alt="arkit hittest estimated plane" /></p>

<p><a id="markdown-featurepoint" name="featurepoint"></a></p>

<h4><code>featurePoint</code></h4>

<p>Return the result type from intersecting the nearest feature point.</p>

<p><img src="http://hongchaozhang.github.io/images/ARKitHitTestFeaturePoints.gif" alt="" /></p>

<p><a id="markdown-display-virtual-object-in-real-world" name="display-virtual-object-in-real-world"></a></p>

<h3>Display Virtual Object in Real World</h3>

<p><a id="markdown-standard-view" name="standard-view"></a></p>

<h4>Standard View</h4>

<ul>
<li><strong><code>ARSCNView</code></strong>: A view for displaying AR experiences that augment the camera view with 3D SceneKit content.</li>
<li><strong><code>ARSKView</code></strong>: A view for displaying AR experiences that augment the camera view with 2D SpriteKit content.</li>
</ul>


<p><a id="markdown-custom-view" name="custom-view"></a></p>

<h4>Custom View</h4>

<p>To display your AR experience in a custom view, youâ€™ll need to:</p>

<ol>
<li>Retrieve video frames and tracking information from the session.</li>
<li>Render those frame images as the backdrop for your view.</li>
<li>Use the tracking information to position and draw AR content atop the camera image.</li>
</ol>


<p>Refer to <a href="https://developer.apple.com/documentation/arkit/displaying_an_ar_experience_with_metal">Displaying an AR Experience with Metal</a>.</p>

<p><a id="markdown-best-practices-and-limitations" name="best-practices-and-limitations"></a></p>

<h2>Best Practices and Limitations</h2>

<p><a id="markdown-best-practices" name="best-practices"></a></p>

<h3>Best Practices</h3>

<p>World tracking is an inexact science. This process can often produce impressive accuracy, leading to realistic AR experiences. However, it relies on details of the deviceâ€™s physical environment that are not always consistent or are difficult to measure in real time without some degree of error. To build high-quality AR experiences, be aware of these caveats and tips.</p>

<p>Refer to <a href="https://developer.apple.com/documentation/arkit/about_augmented_reality_and_arkit">About Augmented Reality and ARKit</a>.</p>

<p><strong>Design AR experiences for predictable lighting conditions.</strong></p>

<p> World tracking involves image analysis, which requires a clear image. Tracking quality is reduced when the camera canâ€™t see details, such as when the camera is pointed at a blank wall or the scene is too dark.</p>

<p><strong>Use tracking quality information to provide user feedback.</strong></p>

<p> World tracking correlates image analysis with device motion. ARKit develops a better understanding of the scene if the device is moving, even if the device moves only subtly. Excessive motionâ€”too far, too fast, or shaking too vigorouslyâ€”results in a blurred image or too much distance for tracking features between video frames, reducing tracking quality. The ARCamera class provides tracking state reason information, which you can use to develop UI that tells a user how to resolve low-quality tracking situations.</p>

<p><strong>Allow time for plane detection to produce clear results, and disable plane detection when you have the results you need.</strong></p>

<p> Plane detection results vary over timeâ€”when a plane is first detected, its position and extent may be inaccurate. As the plane remains in the scene over time, ARKit refines its estimate of position and extent. When a large flat surface is in the scene, ARKit may continue changing the plane anchorâ€™s position, extent, and transform after youâ€™ve already used the plane to place content.</p>

<p><a id="markdown-limitations" name="limitations"></a></p>

<h3>Limitations</h3>

<ol>
<li>For a moving object, ARKit can not give an usable world position of it.</li>
<li>You can not put a virtual object behind a real object. This leads to some problems, like:

<ol>
<li>When an real object move in front of an virtual object, the virtual object will still be displayed in front of the real object.</li>
<li>You can not hold a virtual object coolly, as the virtual object you are trying to hold can not be behind your fingers.</li>
</ol>
</li>
</ol>


<p>Two thoughts that may be help on the second limitation:</p>

<ul>
<li>Segment the camera image based on the feature point with world position. Draw further real object, and then virtual object, and at last, the nearest real object. However, as the feature point is sparse (performance consideration), some edge detection algorithms are needed for accurate edges of objects.</li>
<li>Based on the dual camera, we can get depth of each pixel of the camera image. This will help on image segmentation.</li>
</ul>


<p><a id="markdown-ar-from-google" name="ar-from-google"></a></p>

<h2>AR from Google</h2>

<p><a href="https://developers.google.com/tango/?hl=zh-cn">Tango</a> is a platform that uses computer vision to give devices the ability to understand their position relative to the world around them. But Tango requires very special hardware to run on. So <a href="https://developers.google.com/ar/">ARCore</a> comes.</p>

<blockquote><p>The Tango project will be deprecated on March 1st, 2018. Google is continuing AR development with ARCore, a new platform designed for building augmented reality apps for a broad range of devices without the requirement for specialized hardware.</p></blockquote>

<p>ARCore is a platform for building augmented reality apps on Android. ARCore is designed to work on a wide variety of qualified Android phones running N and later. During the developer <strong>preview</strong>, ARCore supports the following devices:</p>

<ul>
<li>Google Pixel, Pixel XL, Pixel 2, Pixel 2 XL</li>
<li>Samsung Galaxy S8 (SM-G950U, SM-G950N, SM-G950F, SM-G950FD, SM-G950W, SM-G950U1)</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[some tips on markdown usage]]></title>
    <link href="http://hongchaozhang.github.io/blog/2017/11/21/some-tips-on-markdown-usage/"/>
    <updated>2017-11-21T10:13:28+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2017/11/21/some-tips-on-markdown-usage</id>
    <content type="html"><![CDATA[<p>Collect some markdown usage tips.</p>

<!-- more -->


<h2>insert an image</h2>

<p>To insert the image, just use the path under the base url, for me, it is <em>/GitBlogs/images/<image_name>.png</em>, for example</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>![image annotation](/images/001_ios_frameworks.png)</span></code></pre></td></tr></table></div></figure>


<p>To define the size of the image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>![image annotation](/images/001_ios_frameworks.png =200x300)</span></code></pre></td></tr></table></div></figure>


<p>Or you can omit the <code>height</code> of the image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>![image annotation](/images/001_ios_frameworks.png =200x)</span></code></pre></td></tr></table></div></figure>


<p>If the aspect ratio you define is not consistent with the original image, the height will be omitted automatically. That is to say, just define the <code>width</code> you want, and the system will calculate the <code>height</code> for it.</p>

<h2>show content while click</h2>

<p>Using the following block of code for hiding some content and show the content while click.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;details&gt;</span>
</span><span class='line'>  <span class="nt">&lt;summary&gt;</span>Q1: What is the best Language in the World? <span class="nt">&lt;/summary&gt;</span>
</span><span class='line'>   A1: Swift
</span><span class='line'><span class="nt">&lt;/details&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You will get:</p>

<p><details>
  <summary><em>Question: What is the best Language in the World?</em></summary>
   Answer: Swift
</details></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swiftä¸­çš„Error]]></title>
    <link href="http://hongchaozhang.github.io/blog/2017/10/20/errors-in-swift/"/>
    <updated>2017-10-20T16:24:35+08:00</updated>
    <id>http://hongchaozhang.github.io/blog/2017/10/20/errors-in-swift</id>
    <content type="html"><![CDATA[<!-- more -->




<!-- TOC depthFrom:1 depthTo:3 insertAnchor:true -->


<ul>
<li><a href="#swift-error%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">Swift ErroråŸºæœ¬ä½¿ç”¨</a>

<ul>
<li><a href="#throws-in-swift-1x"><code>throws</code> in Swift 1.x</a></li>
<li><a href="#throws-in-swift-2"><code>throws</code> in Swift 2</a></li>
<li><a href="#throws%E7%9A%84%E4%BD%BF%E7%94%A8"><code>throws</code>çš„ä½¿ç”¨</a></li>
<li><a href="#throws%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%E7%9A%84%E5%A4%84%E7%90%86"><code>throws</code>æŠ›å‡ºé”™è¯¯çš„å¤„ç†</a></li>
</ul>
</li>
<li><a href="#throws%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%9E%E8%B7%B5"><code>throws</code>çš„ä¸€äº›å®è·µ</a>

<ul>
<li><a href="#throws%E7%9A%84%E8%B0%83%E8%AF%95%E5%92%8C%E6%96%AD%E7%82%B9"><code>throws</code>çš„è°ƒè¯•å’Œæ–­ç‚¹</a></li>
<li><a href="#throws%E4%BB%8D%E7%84%B6%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><code>throws</code>ä»ç„¶å­˜åœ¨çš„é—®é¢˜</a></li>
</ul>
</li>
<li><a href="#swift-%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%A7%8D%E7%B1%BB">Swift é”™è¯¯ç±»å‹çš„ç§ç±»</a>

<ul>
<li><a href="#simple-domain-error">Simple domain error</a></li>
<li><a href="#recoverable-error">Recoverable error</a></li>
<li><a href="#universal-error">Universal error</a></li>
<li><a href="#logic-failure">Logic failure</a></li>
</ul>
</li>
<li><a href="#%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">å‡ ç§å¸¸è§åœºæ™¯ä¸‹çš„é”™è¯¯å¤„ç†</a>

<ul>
<li><a href="#app%E5%86%85%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD">appå†…èµ„æºåŠ è½½</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%97%B6%E5%8F%91%E7%94%9F%E9%94%99%E8%AF%AF">åŠ è½½å½“å‰ç”¨æˆ·ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯</a></li>
<li><a href="#%E8%BF%98%E6%B2%A1%E6%9C%89%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%BB%A3%E7%A0%81">è¿˜æ²¡æœ‰å®ç°çš„ä»£ç </a></li>
<li><a href="#%E8%B0%83%E7%94%A8%E8%AE%BE%E5%A4%87%E4%B8%8A%E7%9A%84%E4%BC%A0%E6%84%9F%E5%99%A8%E6%94%B6%E9%9B%86%E6%95%B0%E6%8D%AE">è°ƒç”¨è®¾å¤‡ä¸Šçš„ä¼ æ„Ÿå™¨æ”¶é›†æ•°æ®</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ul>
</li>
<li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%9B%B8%E5%85%B3%E7%9A%84%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95">é”™è¯¯å¤„ç†ç›¸å…³çš„è¾…åŠ©æ–¹æ³•</a>

<ul>
<li><a href="#use-custom-errors">Use Custom Errors</a></li>
<li><a href="#do-cleanup-work-using-defer">Do Cleanup Work Using <code>defer</code></a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83">å‚è€ƒ</a></li>
</ul>


<!-- /TOC -->


<p><a id="markdown-swift-erroråŸºæœ¬ä½¿ç”¨" name="swift-erroråŸºæœ¬ä½¿ç”¨"></a></p>

<h2>Swift ErroråŸºæœ¬ä½¿ç”¨</h2>

<p><a id="markdown-throws-in-swift-1x" name="throws-in-swift-1x"></a></p>

<h3><code>throws</code> in Swift 1.x</h3>

<p>åœ¨Objective-Cä¸­ï¼Œ<code>FileManager</code>çš„copyæ¥å£å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">copyItemAtPath:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">srcPath</span> <span class="nf">toPath:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">dstPath</span> <span class="nf">error:</span><span class="p">(</span><span class="bp">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span>
</span></code></pre></td></tr></table></div></figure>


<p>è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå†™æ³•å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="bp">NSFileManager</span> <span class="o">*</span><span class="n">fileManager</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSFileManager</span> <span class="n">defaultManager</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="n">fileManager</span> <span class="nl">copyItemAtPath</span><span class="p">:</span><span class="n">srcPath</span> <span class="nl">toPath</span><span class="p">:</span><span class="n">toPath</span> <span class="nl">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// å‘ç”Ÿäº†é”™è¯¯</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// å¤åˆ¶æˆåŠŸ</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨Swift 1.xä¸­ï¼Œä¸Objective-Cç±»ä¼¼ã€‚æ–¹æ³•æ¥å£å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">copyItemAtPath</span><span class="p">(</span><span class="n">_</span> <span class="nl">srcPath</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">toPath</span> <span class="nl">dstPath</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="n">NSErrorPointer</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">fileManager</span> <span class="o">=</span> <span class="bp">NSFileManager</span><span class="p">.</span><span class="n">defaultManager</span><span class="p">()</span>
</span><span class='line'><span class="k">var</span> <span class="nl">error</span><span class="p">:</span> <span class="bp">NSError</span><span class="o">?</span>
</span><span class='line'><span class="n">fileManager</span><span class="p">.</span><span class="n">copyItemAtPath</span><span class="p">(</span><span class="n">srcPath</span><span class="p">,</span> <span class="nl">toPath</span><span class="p">:</span> <span class="n">dstPath</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// å‘ç”Ÿäº†é”™è¯¯</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// å¤åˆ¶æˆåŠŸ</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå› ä¸ºè¿™ä¸ª API ä»…ä¼šåœ¨æå…¶ç‰¹å®šçš„æ¡ä»¶ä¸‹ (æ¯”å¦‚ç£ç›˜ç©ºé—´ä¸è¶³) ä¼šå‡ºé”™ï¼Œæ‰€ä»¥å¼€å‘è€…ä¸ºäº†æ–¹ä¾¿ï¼Œæœ‰æ—¶ä¼šç›´æ¥ä¼ å…¥ nil æ¥å¿½è§†æ‰è¿™ä¸ªé”™è¯¯ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">fileManager</span> <span class="o">=</span> <span class="bp">NSFileManager</span><span class="p">.</span><span class="n">defaultManager</span><span class="p">()</span>
</span><span class='line'><span class="c1">// ä¸å…³å¿ƒæ˜¯å¦å‘ç”Ÿé”™è¯¯</span>
</span><span class='line'><span class="n">fileManager</span><span class="p">.</span><span class="n">copyItemAtPath</span><span class="p">(</span><span class="n">srcPath</span><span class="p">,</span> <span class="nl">toPath</span><span class="p">:</span> <span class="n">dstPath</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-throws-in-swift-2" name="throws-in-swift-2"></a></p>

<h3><code>throws</code> in Swift 2</h3>

<p>è¿™ç§åšæ³•æ— å½¢ä¸­é™ä½äº†åº”ç”¨çš„å¯é æ€§ä»¥åŠä»é”™è¯¯ä¸­æ¢å¤çš„èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSwift 2 ä¸­åœ¨ç¼–è¯‘å™¨å±‚çº§å°±å¯¹<code>throws</code>è¿›è¡Œäº†é™å®šã€‚ä¸Šé¢æåˆ°çš„copyæ¥å£åœ¨Swift 2ä¸­çš„å½¢å¼ä¸ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">copyItem</span><span class="p">(</span><span class="n">atPath</span> <span class="nl">srcPath</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">toPath</span> <span class="nl">dstPath</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="n">throws</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¢«æ ‡è®°ä¸º<code>throws</code>çš„APIï¼Œå¿…é¡»è¢«å¤„ç†ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚è¿™å°±åœ¨ç¼–è¯‘å™¨å±‚é¢å¯¹é”™è¯¯çš„å¤„ç†è¿›è¡Œäº†å¼ºåˆ¶æ‰§è¡Œï¼Œä¿è¯äº†ä»£ç çš„å¯é æ€§ã€‚</p>

<p><a id="markdown-throwsçš„ä½¿ç”¨" name="throwsçš„ä½¿ç”¨"></a></p>

<h3><code>throws</code>çš„ä½¿ç”¨</h3>

<p>ä¸‹é¢æ˜¯åŒ…å«<code>throws</code>çš„ä¸€ä¸ªè‡ªåŠ¨å”®è´§æœºå®ç°ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">enum</span> <span class="nl">VendingMachineError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">invalidSelection</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">insufficientFunds</span><span class="p">(</span><span class="nl">coinsNeeded</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">outOfStock</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">Item</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">price</span><span class="p">:</span> <span class="n">Int</span>
</span><span class='line'>    <span class="k">var</span> <span class="nl">count</span><span class="p">:</span> <span class="n">Int</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="n">VendingMachine</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">inventory</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>        <span class="s">&quot;Candy Bar&quot;</span><span class="o">:</span> <span class="n">Item</span><span class="p">(</span><span class="nl">price</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="mi">7</span><span class="p">),</span>
</span><span class='line'>        <span class="s">&quot;Chips&quot;</span><span class="o">:</span> <span class="n">Item</span><span class="p">(</span><span class="nl">price</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="mi">4</span><span class="p">),</span>
</span><span class='line'>        <span class="s">&quot;Pretzels&quot;</span><span class="o">:</span> <span class="n">Item</span><span class="p">(</span><span class="nl">price</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="mi">11</span><span class="p">)</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">coinsDeposited</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">func</span> <span class="n">vend</span><span class="p">(</span><span class="n">itemNamed</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="n">throws</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">guard</span> <span class="k">let</span> <span class="n">item</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">throw</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">invalidSelection</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">guard</span> <span class="n">item</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">throw</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">outOfStock</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">guard</span> <span class="n">item</span><span class="p">.</span><span class="n">price</span> <span class="o">&lt;=</span> <span class="n">coinsDeposited</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">throw</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">insufficientFunds</span><span class="p">(</span><span class="nl">coinsNeeded</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">price</span> <span class="o">-</span> <span class="n">coinsDeposited</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">coinsDeposited</span> <span class="o">-=</span> <span class="n">item</span><span class="p">.</span><span class="n">price</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">var</span> <span class="n">newItem</span> <span class="o">=</span> <span class="n">item</span>
</span><span class='line'>        <span class="n">newItem</span><span class="p">.</span><span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">inventory</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">newItem</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Dispensing \(name)&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>vend(itemNamed:)</code>æ–¹æ³•çš„å®ç°é€šè¿‡<code>guard</code>æŠ›å‡ºè´­ä¹°è¿‡ç¨‹ä¸­ç›¸åº”çš„é”™è¯¯ã€‚</p>

<p><a id="markdown-throwsæŠ›å‡ºé”™è¯¯çš„å¤„ç†" name="throwsæŠ›å‡ºé”™è¯¯çš„å¤„ç†"></a></p>

<h3><code>throws</code>æŠ›å‡ºé”™è¯¯çš„å¤„ç†</h3>

<p>è¢«æ ‡è®°ä¸º<code>throws</code>çš„APIï¼Œæˆ‘ä»¬å¿…é¡»é‡‡ç”¨ä¸‹é¢å‡ ç§å¤„ç†æ–¹å¼ä¸­çš„ä¸€ç§æ¥å¤„ç†ï¼Œå¦åˆ™ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>

<h4><code>do catch</code></h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">var</span> <span class="n">vendingMachine</span> <span class="o">=</span> <span class="n">VendingMachine</span><span class="p">()</span>
</span><span class='line'><span class="n">vendingMachine</span><span class="p">.</span><span class="n">coinsDeposited</span> <span class="o">=</span> <span class="mi">8</span>
</span><span class='line'><span class="k">do</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">try</span> <span class="n">buyFavoriteSnack</span><span class="p">(</span><span class="nl">person</span><span class="p">:</span> <span class="s">&quot;Alice&quot;</span><span class="p">,</span> <span class="nl">vendingMachine</span><span class="p">:</span> <span class="n">vendingMachine</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">invalidSelection</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;Invalid Selection.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">outOfStock</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;Out of Stock.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">insufficientFunds</span><span class="p">(</span><span class="k">let</span> <span class="n">coinsNeeded</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;Insufficient funds. Please insert an additional \(coinsNeeded) coins.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4><code>try?</code></h4>

<p>ä½¿ç”¨<code>try?</code>æ¥å¤„ç†é”™è¯¯ï¼Œå°†å…¶è¿”å›å€¼å˜ä¸ºOptionalï¼šå¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œæ¥å£è¿”å›<code>nil</code>ï¼ŒåŒæ—¶é”™è¯¯åœæ­¢ç»§ç»­ä¼ æ’­ã€‚æ¯”å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">fetchDataFromDisk</span><span class="p">()</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Data</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="n">fetchDataFromServer</span><span class="p">()</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Data</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="n">fetchData</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">try</span><span class="o">?</span> <span class="n">fetchDataFromDisk</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">data</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">try</span><span class="o">?</span> <span class="n">fetchDataFromServer</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">data</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4><code>try!</code></h4>

<p>å¦‚æœä½ éå¸¸ç¡®ä¿¡ä¸€ä¸ªè¢«æ ‡è®°ä¸º<code>throws</code>çš„æ¥å£ï¼Œåœ¨ä½ çš„ç¯å¢ƒä¸­ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå¯ä»¥é€šè¿‡<code>try!</code>æ¥å¼ºåˆ¶ç»ˆæ­¢é”™è¯¯çš„ç»§ç»­ä¼ æ’­ã€‚å¦‚æœåœ¨æ‰§è¡Œçš„æ—¶å€™å‡ºç°äº†é”™è¯¯ï¼Œé‚£ä¹ˆæŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>

<p>æ¯”å¦‚ï¼Œ<code>loadImage(atPath:)</code>æ–¹æ³•åŠ è½½æŒ‡å®šç›®å½•ä¸‹é¢çš„ä¸€å¼ å›¾ç‰‡åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœåŠ è½½å¼‚å¸¸ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚åœ¨ä¸‹é¢çš„ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åŠ è½½ä¸€å¼ åº”ç”¨ä¸­åŒ…å«çš„å›¾ç‰‡ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡<code>try!</code>æ¥ç»ˆæ­¢é”™è¯¯çš„ç»§ç»­ä¼ æ’­ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">photo</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">loadImage</span><span class="p">(</span><span class="nl">atPath</span><span class="p">:</span> <span class="s">&quot;./Resources/John Appleseed.jpg&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4><code>try</code></h4>

<p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨<code>try</code>æ¥è°ƒç”¨è¢«æ ‡è®°ä¸º<code>throws</code>çš„æ¥å£ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µä¸‹ï¼Œé”™è¯¯ä¼šç»§ç»­ä¼ æ’­ï¼ŒåŒ…å«è¯¥è°ƒç”¨çš„æ–¹æ³•ä¹Ÿå¿…é¡»è¢«æ ‡è®°ä¸º<code>throws</code>æ‰è¡Œï¼Œå¦åˆ™ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">favoriteSnacks</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="s">&quot;Alice&quot;</span><span class="o">:</span> <span class="s">&quot;Chips&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;Bob&quot;</span><span class="o">:</span> <span class="s">&quot;Licorice&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;Eve&quot;</span><span class="o">:</span> <span class="s">&quot;Pretzels&quot;</span><span class="p">,</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'><span class="k">func</span> <span class="n">buyFavoriteSnack</span><span class="p">(</span><span class="nl">person</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="nl">vendingMachine</span><span class="p">:</span> <span class="n">VendingMachine</span><span class="p">)</span> <span class="n">throws</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">snackName</span> <span class="o">=</span> <span class="n">favoriteSnacks</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">??</span> <span class="s">&quot;Candy Bar&quot;</span>
</span><span class='line'>    <span class="n">try</span> <span class="n">vendingMachine</span><span class="p">.</span><span class="n">vend</span><span class="p">(</span><span class="nl">itemNamed</span><span class="p">:</span> <span class="n">snackName</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸º<code>buyFavoriteSnack(person: vendingMachine:)</code>ä½¿ç”¨<code>try</code>è°ƒç”¨äº†ä¸€ä¸ªè¢«æ ‡è®°ä¸ºthrowsçš„æ¥å£<code>vend(itemNamed:)</code>ï¼Œé”™è¯¯ä¼šç»§ç»­ä¼ æ’­ï¼Œå› æ­¤ï¼Œè¯¥æ–¹æ³•ä¹Ÿéœ€è¦æ ‡è®°ä¸ºthorwsã€‚</p>

<p><a id="markdown-throwsçš„ä¸€äº›å®è·µ" name="throwsçš„ä¸€äº›å®è·µ"></a></p>

<h2><code>throws</code>çš„ä¸€äº›å®è·µ</h2>

<p><a id="markdown-throwsçš„è°ƒè¯•å’Œæ–­ç‚¹" name="throwsçš„è°ƒè¯•å’Œæ–­ç‚¹"></a></p>

<h3><code>throws</code>çš„è°ƒè¯•å’Œæ–­ç‚¹</h3>

<p>Swiftçš„é”™è¯¯æŠ›å‡ºå¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰çš„exceptionï¼Œåœ¨è°ƒè¯•æ—¶æŠ›å‡ºé”™è¯¯å¹¶ä¸ä¼šè§¦å‘Exceptionæ–­ç‚¹ã€‚å¦å¤–ï¼Œthrowæœ¬èº«æ˜¯è¯­è¨€çš„å…³é”®å­—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªsymbolï¼Œå®ƒä¹Ÿä¸èƒ½è§¦å‘Symbolicç±»å‹çš„æ–­ç‚¹ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨æ‰€æœ‰throwè¯­å¥æ‰§è¡Œçš„æ—¶å€™è®©ç¨‹åºåœä½çš„è¯ï¼Œéœ€è¦ä¸€äº›é¢å¤–çš„æŠ€å·§ã€‚åœ¨ä¹‹å‰ throw çš„æ±‡ç¼–å®ç°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰throwè¯­å¥åœ¨è¿”å›å‰éƒ½ä¼šè¿›è¡Œä¸€æ¬¡<code>swift_willThrow</code>çš„è°ƒç”¨ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ Symbolicè¯­å¥ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ª<code>swift_willThrow</code>çš„Symbolicæ–­ç‚¹ï¼Œå°±å¯ä»¥è®©ç¨‹åºåœ¨throwçš„æ—¶å€™åœä½ï¼Œå¹¶ä½¿ç”¨è°ƒç”¨æ ˆä¿¡æ¯æ¥è·çŸ¥ç¨‹åºåœ¨å“ªé‡ŒæŠ›å‡ºäº†é”™è¯¯ã€‚</p>

<p>è¡¥å……ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„Xcodeä¸­ï¼ŒAppleç›´æ¥ä¸ºæˆ‘ä»¬åœ¨æ–­ç‚¹ç±»å‹ä¸­åŠ ä¸Šäº† â€œSwift Error Breakpointâ€çš„é€‰é¡¹ï¼Œå®ƒèƒŒååšçš„å°±æ˜¯åœ¨<code>swift_willThrow</code>ä¸Šæ·»åŠ ä¸€ä¸ªæ–­ç‚¹ã€‚ä¸è¿‡å› ä¸ºæœ‰äº†æ›´ç›´æ¥çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ç°åœ¨ä¸å†éœ€è¦æ‰‹åŠ¨å»æ·»åŠ è¿™ä¸ªç¬¦å·æ–­ç‚¹äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®â€œSwift Error Breakpointâ€å¯¹throwsè¿›è¡Œæ–­ç‚¹è®¾ç½®å’Œè°ƒè¯•ã€‚è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<p><img src="http://hongchaozhang.github.io/images/Swift-Error-Breakpoint.png" alt="swift error breakpoint" /></p>

<p><a id="markdown-throwsä»ç„¶å­˜åœ¨çš„é—®é¢˜" name="throwsä»ç„¶å­˜åœ¨çš„é—®é¢˜"></a></p>

<h3><code>throws</code>ä»ç„¶å­˜åœ¨çš„é—®é¢˜</h3>

<p>ä¸èƒ½ä»æ¥å£ç›´æ¥çœ‹å‡ºæœ‰å“ªäº›å¯èƒ½æŠ›å‡ºçš„Errorï¼Œå¿…é¡»çœ‹Documentæ‰è¡Œï¼Œå¸¦æ¥äº†ä¸€äº›ä¸ä¾¿ã€‚æ¯”å¦‚ï¼Œåªé€šè¿‡æ¥å£ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">vend</span><span class="p">(</span><span class="n">itemNamed</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="n">throws</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬æ²¡æœ‰åŠæ³•çŸ¥é“è¿™ä¸ªæ¥å£å¯èƒ½è¿”å›å“ªäº›é”™è¯¯ã€‚æ­¤æ—¶ï¼Œè¦ä¹ˆé˜…è¯»æ–‡æ¡£ï¼Œè·å¾—ç¡®åˆ‡çš„æŠ›å‡ºé”™è¯¯ï¼Œåˆ†åˆ«è¿›è¡Œå¤„ç†ï¼›æˆ–è€…å°†æ‰€æœ‰çš„é”™è¯¯ç»Ÿä¸€å¤„ç†å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">do</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">snackName</span> <span class="o">=</span> <span class="n">favoriteSnacks</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">??</span> <span class="s">&quot;Candy Bar&quot;</span>
</span><span class='line'>    <span class="n">try</span> <span class="n">vendingMachine</span><span class="p">.</span><span class="n">vend</span><span class="p">(</span><span class="nl">itemNamed</span><span class="p">:</span> <span class="n">snackName</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// é”™è¯¯æŠ›å‡º</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-swift-é”™è¯¯ç±»å‹çš„ç§ç±»" name="swift-é”™è¯¯ç±»å‹çš„ç§ç±»"></a></p>

<h2>Swift é”™è¯¯ç±»å‹çš„ç§ç±»</h2>

<p>å‚è€ƒSwiftå®˜æ–¹æ–‡æ¡£<a href="https://github.com/apple/swift/blob/master/docs/ErrorHandling.rst">Error Handling in Swift<!-- 2.0--></a>ï¼ŒSwiftä¸­çš„é”™è¯¯æœ‰ä¸‹é¢å››ç§ï¼š</p>

<ol>
<li>Simple domain error</li>
<li>Recoverable error</li>
<li>Universal error</li>
<li>Logic failure</li>
</ol>


<p><a id="markdown-simple-domain-error" name="simple-domain-error"></a></p>

<h3>Simple domain error</h3>

<p>ç®€å•çš„ï¼Œæ˜¾è€Œæ˜“è§çš„é”™è¯¯ã€‚è¿™ç±»é”™è¯¯çš„æœ€å¤§ç‰¹ç‚¹æ˜¯æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“åŸå› ï¼Œåªéœ€è¦çŸ¥é“é”™è¯¯å‘ç”Ÿï¼Œå¹¶ä¸”æƒ³è¦è¿›è¡Œå¤„ç†ã€‚ç”¨æ¥è¡¨ç¤ºè¿™ç§é”™è¯¯å‘ç”Ÿçš„æ–¹æ³•ä¸€èˆ¬å°±æ˜¯è¿”å›ä¸€ä¸ª<code>nil</code>å€¼ã€‚åœ¨Swiftä¸­ï¼Œè¿™ç±»é”™è¯¯æœ€å¸¸è§çš„æƒ…å†µå°±æ˜¯å°†æŸä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼Œæˆ–è€…åœ¨å­—å…¸å°è¯•ç”¨æŸä¸ªä¸å­˜åœ¨çš„ key è·å–å…ƒç´ ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// Simple Domain Error çš„ä¾‹å­</span>
</span><span class='line'><span class="k">let</span> <span class="n">num</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">)</span> <span class="c1">// nil</span>
</span><span class='line'><span class="k">let</span> <span class="n">element</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s">&quot;key_not_exist&quot;</span><span class="p">]</span> <span class="c1">// nil</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>å¯èƒ½å‡ºç°è¿™ç§é”™è¯¯çš„æ¥å£ï¼Œä¸éœ€è¦ä½¿ç”¨<code>throws</code>æ¥æ ‡è®°ï¼Œåªéœ€è¦å°†æ¥å£çš„è¿”å›ç±»å‹è®¾ç½®ä¸ºOptionalå³å¯ã€‚</strong>åœ¨ä½¿ç”¨å±‚é¢ (æˆ–è€…è¯´åº”ç”¨é€»è¾‘) ä¸Šï¼Œè¿™ç±»é”™è¯¯ä¸€èˆ¬ç”¨<code>if let</code>çš„å¯é€‰å€¼ç»‘å®šæˆ–è€…æ˜¯<code>guard let</code>æå‰è¿›è¡Œè¿”å›å¤„ç†å³å¯ã€‚</p>

<p><a id="markdown-recoverable-error" name="recoverable-error"></a></p>

<h3>Recoverable error</h3>

<p>æ­£å¦‚å…¶åï¼Œè¿™ç±»é”™è¯¯åº”è¯¥æ˜¯è¢«å®¹è®¸ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥æ¢å¤çš„ã€‚å¯æ¢å¤é”™è¯¯çš„å‘ç”Ÿæ˜¯æ­£å¸¸çš„ç¨‹åºè·¯å¾„ä¹‹ä¸€ï¼Œè€Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬åº”å½“å»æ£€å‡ºè¿™ç±»é”™è¯¯å‘ç”Ÿçš„æƒ…å†µï¼Œå¹¶è¿›ä¸€æ­¥å¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ï¼Œè®©å®ƒä»¬æ¢å¤åˆ°æˆ‘ä»¬æœŸæœ›çš„ç¨‹åºè·¯å¾„ä¸Šã€‚</p>

<p><strong>è¿™ç±»é”™è¯¯åœ¨Objective-Cçš„æ—¶ä»£é€šå¸¸ç”¨NSErrorç±»å‹æ¥è¡¨ç¤ºï¼Œè€Œåœ¨Swifté‡Œåˆ™æ˜¯é€šè¿‡throwsæ¥å®ç°ã€‚</strong>ä¸€èˆ¬æˆ‘ä»¬éœ€è¦æ£€æŸ¥é”™è¯¯çš„ç±»å‹ï¼Œå¹¶ä½œå‡ºåˆç†çš„å“åº”ã€‚è€Œé€‰æ‹©å¿½è§†è¿™ç±»é”™è¯¯å¾€å¾€æ˜¯ä¸æ˜æ™ºçš„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”¨æˆ·æ­£å¸¸ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°çš„æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥å°è¯•å¯¹å…¶æ¢å¤ï¼Œæˆ–è€…è‡³å°‘å‘ç”¨æˆ·ç»™å‡ºåˆç†çš„æç¤ºï¼Œè®©ä»–ä»¬çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆã€‚åƒæ˜¯ç½‘ç»œè¯·æ±‚è¶…æ—¶ï¼Œæˆ–è€…å†™å…¥æ–‡ä»¶æ—¶ç£ç›˜ç©ºé—´ä¸è¶³ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// ç½‘ç»œè¯·æ±‚</span>
</span><span class='line'><span class="k">let</span> <span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span><span class="nl">string</span><span class="p">:</span> <span class="s">&quot;https://www.example.com/&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'><span class="k">let</span> <span class="n">task</span> <span class="o">=</span> <span class="n">URLSession</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">dataTask</span><span class="p">(</span><span class="nl">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// æç¤ºç”¨æˆ·</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">showErrorAlert</span><span class="p">(</span><span class="s">&quot;Error: \(error.localizedDescription)&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">!</span>
</span><span class='line'>    <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// å†™å…¥æ–‡ä»¶</span>
</span><span class='line'><span class="k">func</span> <span class="n">write</span><span class="p">(</span><span class="nl">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">,</span> <span class="n">to</span> <span class="nl">url</span><span class="p">:</span> <span class="n">URL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">try</span> <span class="n">data</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span> <span class="n">catch</span> <span class="k">let</span> <span class="n">error</span> <span class="kt">as</span> <span class="bp">NSError</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">error</span><span class="p">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">NSFileWriteOutOfSpaceError</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// å°è¯•é€šè¿‡é‡Šæ”¾ç©ºé—´è‡ªåŠ¨æ¢å¤</span>
</span><span class='line'>            <span class="n">removeUnusedFiles</span><span class="p">()</span>
</span><span class='line'>            <span class="n">write</span><span class="p">(</span><span class="nl">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nl">to</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// å…¶ä»–é”™è¯¯ï¼Œæç¤ºç”¨æˆ·</span>
</span><span class='line'>            <span class="n">showErrorAlert</span><span class="p">(</span><span class="s">&quot;Error: \(error.localizedDescription)&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">showErrorAlert</span><span class="p">(</span><span class="s">&quot;Error: \(error.localizedDescription)&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-universal-error" name="universal-error"></a></p>

<h3>Universal error</h3>

<p>è¿™ç±»é”™è¯¯ç†è®ºä¸Šå¯ä»¥æ¢å¤ï¼Œä½†æ˜¯ç”±äºè¯­è¨€æœ¬èº«çš„ç‰¹æ€§æ‰€å†³å®šï¼Œæˆ‘ä»¬éš¾ä»¥å¾—çŸ¥è¿™ç±»é”™è¯¯çš„æ¥æºï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ä¹Ÿä¸ä¼šå»å¤„ç†è¿™ç§é”™è¯¯ã€‚è¿™ç±»é”™è¯¯åŒ…æ‹¬ç±»ä¼¼ä¸‹é¢è¿™äº›æƒ…å½¢ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// å†…å­˜ä¸è¶³</span>
</span><span class='line'><span class="p">[</span><span class="n">Int</span><span class="p">](</span><span class="nl">repeating</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="p">.</span><span class="n">max</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è°ƒç”¨æ ˆæº¢å‡º</span>
</span><span class='line'><span class="k">func</span> <span class="n">foo</span><span class="p">()</span> <span class="p">{</span> <span class="n">foo</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'><span class="n">foo</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾è®¡ä¸€äº›æ‰‹æ®µæ¥å¯¹è¿™äº›é”™è¯¯è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ï¼šæ£€æµ‹å½“å‰çš„å†…å­˜å ç”¨å¹¶åœ¨è¶…è¿‡ä¸€å®šå€¼åè­¦å‘Šï¼Œæˆ–è€…ç›‘è§†æ ˆframeæ•°è¿›è¡Œé™åˆ¶ç­‰ã€‚ä½†æ˜¯ä¸€èˆ¬æ¥è¯´è¿™æ˜¯ä¸å¿…è¦çš„ï¼Œä¹Ÿä¸å¯èƒ½æ¶µç›–å…¨éƒ¨çš„é”™è¯¯æƒ…å†µã€‚æ›´å¤šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯ç”±äºä»£ç è§¦ç¢°åˆ°äº†è®¾å¤‡çš„ç‰©ç†é™åˆ¶å’Œè¾¹ç•Œæƒ…å†µæ‰€é€ æˆçš„ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¹Ÿä¸å»è¿›è¡Œå¤„ç†ï¼ˆé™¤éæ˜¯äººä¸ºé€ æˆçš„bugï¼‰ã€‚</p>

<p>åœ¨ Swift ä¸­ï¼Œå„ç§è¢«ä½¿ç”¨<code>fatalError</code>è¿›è¡Œå¼ºåˆ¶ç»ˆæ­¢çš„é”™è¯¯ä¸€èˆ¬éƒ½å¯ä»¥å½’ç±»åˆ° Universal errorã€‚</p>

<p><a id="markdown-logic-failure" name="logic-failure"></a></p>

<h3>Logic failure</h3>

<p>é€»è¾‘é”™è¯¯æ˜¯ç¨‹åºå‘˜çš„å¤±è¯¯æ‰€é€ æˆçš„é”™è¯¯ï¼Œå®ƒä»¬åº”è¯¥åœ¨å¼€å‘æ—¶é€šè¿‡ä»£ç è¿›è¡Œä¿®æ­£å¹¶å®Œå…¨é¿å…ï¼Œè€Œä¸æ˜¯ç­‰åˆ°è¿è¡Œæ—¶å†è¿›è¡Œæ¢å¤å’Œå¤„ç†ã€‚</p>

<p>å¸¸è§çš„ Logic failure åŒ…æ‹¬æœ‰ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// å¼ºåˆ¶è§£åŒ…ä¸€ä¸ª `nil` å¯é€‰å€¼</span>
</span><span class='line'><span class="k">var</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="o">?</span> <span class="o">=</span> <span class="nb">nil</span>
</span><span class='line'><span class="n">name</span><span class="o">!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// æ•°ç»„è¶Šç•Œè®¿é—®</span>
</span><span class='line'><span class="k">let</span> <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
</span><span class='line'><span class="k">let</span> <span class="n">num</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è®¡ç®—æº¢å‡º</span>
</span><span class='line'><span class="k">var</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Int</span><span class="p">.</span><span class="n">max</span>
</span><span class='line'><span class="n">a</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// å¼ºåˆ¶ try ä½†æ˜¯å‡ºç°é”™è¯¯</span>
</span><span class='line'><span class="n">try</span><span class="o">!</span> <span class="n">JSONDecoder</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="nb">self</span><span class="p">,</span> <span class="nl">from</span><span class="p">:</span> <span class="n">Data</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ç±»é”™è¯¯åœ¨å®ç°ä¸­è§¦å‘çš„ä¸€èˆ¬æ˜¯<code>assert</code>æˆ–è€…<code>precondition</code>ã€‚</p>

<p>å’Œ<code>fatalError</code>ä¸åŒï¼Œ<code>assert</code>åªåœ¨è¿›è¡Œç¼–è¯‘ä¼˜åŒ–çš„<code>-O</code>é…ç½®ä¸‹æ˜¯ä¸è§¦å‘çš„ï¼Œè€Œå¦‚æœæ›´è¿›ä¸€æ­¥ï¼Œå°†ç¼–è¯‘ä¼˜åŒ–é€‰é¡¹é…ç½®ä¸º<code>-Ounchecked</code>çš„è¯ï¼Œ<code>precondition</code>ä¹Ÿå°†ä¸è§¦å‘ã€‚æ­¤æ—¶ï¼Œå„æ–¹æ³•ä¸­çš„<code>precondition</code>å°†è¢«è·³è¿‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°æœ€å¿«çš„è¿è¡Œé€Ÿåº¦ã€‚ä½†æ˜¯ç›¸å¯¹åœ°ä»£ç çš„å®‰å…¨æ€§ä¹Ÿå°†é™ä½ï¼Œå› ä¸ºå¯¹äºè¶Šç•Œè®¿é—®æˆ–è€…è®¡ç®—æº¢å‡ºç­‰é”™è¯¯ï¼Œæˆ‘ä»¬å¾—åˆ°çš„å°†æ˜¯ä¸ç¡®å®šçš„è¡Œä¸ºã€‚</p>

<table>
<thead>
<tr>
<th>å‡½æ•° </th>
<th> fatalError </th>
<th> precondition </th>
<th> assert</th>
</tr>
</thead>
<tbody>
<tr>
<td>-Onone </td>
<td> è§¦å‘ </td>
<td> è§¦å‘ </td>
<td> è§¦å‘</td>
</tr>
<tr>
<td>-O </td>
<td> è§¦å‘ </td>
<td> è§¦å‘ </td>
<td> -</td>
</tr>
<tr>
<td>-Ounchecked </td>
<td> è§¦å‘ </td>
<td> - </td>
<td> -</td>
</tr>
</tbody>
</table>


<p>å¯¹äºUniversal errorä¸€èˆ¬ä½¿ç”¨<code>fatalError</code>ï¼Œè€Œå¯¹äº<code>Logic failure</code>ä¸€èˆ¬ä½¿ç”¨<code>assert</code>æˆ–è€…<code>precondition</code>ã€‚éµå®ˆè¿™ä¸ªè§„åˆ™ä¼šæœ‰åŠ©äºæˆ‘ä»¬åœ¨ç¼–ç æ—¶å¯¹é”™è¯¯è¿›è¡Œç•Œå®šã€‚è€Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿå¸Œæœ›èƒ½å°½å¯èƒ½å¤šåœ°åœ¨å¼€å‘çš„æ—¶å€™æ•è·Logic failureï¼Œè€Œåœ¨äº§å“å‘å¸ƒåå°½é‡å‡å°‘crashæ¯”ä¾‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç›¸æ¯”äºç›´æ¥å°†Logic failureè½¬æ¢ä¸ºå¯æ¢å¤çš„é”™è¯¯ï¼Œæˆ‘ä»¬æœ€å¥½æ˜¯ä½¿ç”¨<code>assert</code>åœ¨å†…éƒ¨è¿›è¡Œæ£€æŸ¥ï¼Œæ¥è®©ç¨‹åºåœ¨å¼€å‘æ—¶å´©æºƒã€‚</p>

<p><a id="markdown-å‡ ç§å¸¸è§åœºæ™¯ä¸‹çš„é”™è¯¯å¤„ç†" name="å‡ ç§å¸¸è§åœºæ™¯ä¸‹çš„é”™è¯¯å¤„ç†"></a></p>

<h2>å‡ ç§å¸¸è§åœºæ™¯ä¸‹çš„é”™è¯¯å¤„ç†</h2>

<p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ã€‚è®©æˆ‘ä»¬æ¥å®é™…åˆ¤æ–­ä¸€ä¸‹ä¸‹é¢è¿™äº›æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åº”è¯¥é€‰æ‹©ç”¨å“ªç§é”™è¯¯å¤„ç†æ–¹å¼å§~</p>

<p><a id="markdown-appå†…èµ„æºåŠ è½½" name="appå†…èµ„æºåŠ è½½"></a></p>

<h3>appå†…èµ„æºåŠ è½½</h3>

<p>å‡è®¾æˆ‘ä»¬åœ¨å¤„ç†ä¸€ä¸ªæœºå™¨å­¦ä¹ çš„æ¨¡å‹ï¼Œéœ€è¦ä»ç£ç›˜è¯»å–ä¸€ä»½é¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹ã€‚è¯¥æ¨¡å‹ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨åœ¨ app bundle ä¸­ï¼Œå¦‚æœè¯»å–æ—¶æ²¡æœ‰æ‰¾åˆ°è¯¥æ¨¡å‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å¤„ç†è¿™ä¸ªé”™è¯¯ï¼Ÿ</p>

<h4>æ–¹æ¡ˆ 1 Simple domain error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadModel</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">guard</span> <span class="k">let</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;my_pre_trained_model&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;mdl&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
</span><span class='line'>    <span class="n">guard</span> <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">try</span><span class="o">?</span> <span class="n">Data</span><span class="p">(</span><span class="nl">contentOf</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">try</span><span class="o">?</span> <span class="n">ModelLoader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 2 Recoverable error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadModel</span><span class="p">()</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Model</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">guard</span> <span class="k">let</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;my_pre_trained_model&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;mdl&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">throw</span> <span class="n">AppError</span><span class="p">.</span><span class="n">FileNotExisting</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">try</span> <span class="n">Data</span><span class="p">(</span><span class="nl">contentOf</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">try</span> <span class="n">ModelLoader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 3 Universal error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadModel</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Model</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">guard</span> <span class="k">let</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;my_pre_trained_model&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;mdl&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;Model file not existing&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">try</span> <span class="n">Data</span><span class="p">(</span><span class="nl">contentOf</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">try</span> <span class="n">ModelLoader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;Model corrupted.&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 4 Logic failure</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadModel</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Model</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource</span><span class="p">:</span> <span class="s">&quot;my_pre_trained_model&quot;</span><span class="p">,</span> <span class="nl">ofType</span><span class="p">:</span> <span class="s">&quot;mdl&quot;</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span> <span class="n">Data</span><span class="p">(</span><span class="nl">contentOf</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">try</span><span class="o">!</span> <span class="n">ModelLoader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><details>
  <summary><em>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</em></summary></p>

<p>æ­£ç¡®ç­”æ¡ˆåº”è¯¥æ˜¯æ–¹æ¡ˆ 4ï¼Œä½¿ç”¨Logic failureè®©ä»£ç ç›´æ¥å´©æºƒã€‚</p>

<p>ä½œä¸ºå†…å»ºçš„å­˜åœ¨äºapp bundleä¸­æ¨¡å‹æˆ–è€…é…ç½®æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨æˆ–è€…æ— æ³•åˆå§‹åŒ–ï¼Œåœ¨ä¸è€ƒè™‘æç«¯å› ç´ çš„å‰æä¸‹ï¼Œä¸€å®šæ˜¯å¼€å‘æ–¹é¢å‡ºç°äº†é—®é¢˜ï¼Œè¿™ä¸åº”è¯¥æ˜¯ä¸€ä¸ªå¯æ¢å¤çš„é”™è¯¯ï¼Œæ— è®ºé‡è¯•å¤šå°‘æ¬¡ç»“æœè‚¯å®šæ˜¯ä¸€æ ·çš„ã€‚ä¹Ÿè®¸æ˜¯å¼€å‘è€…å¿˜äº†å°†æ–‡ä»¶æ”¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œä¹Ÿè®¸æ˜¯æ–‡ä»¶æœ¬èº«å‡ºç°äº†é—®é¢˜ã€‚ä¸è®ºæ˜¯å“ªç§æƒ…å†µï¼Œæˆ‘ä»¬éƒ½ä¼šå¸Œæœ›å°½æ—©å‘ç°å¹¶å¼ºåˆ¶æˆ‘ä»¬ä¿®æ­£é”™è¯¯ï¼Œè€Œè®©ä»£ç å´©æºƒå¯ä»¥å¾ˆå¥½åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>

<p>ä½¿ç”¨Universal erroråŒæ ·å¯ä»¥è®©ä»£ç å´©æºƒï¼Œä½†æ˜¯Universal erroræ›´å¤šæ˜¯ç”¨åœ¨è¯­è¨€çš„è¾¹ç•Œæƒ…å†µä¸‹ã€‚è€Œè¿™é‡Œå¹¶éè¿™ç§æƒ…å†µã€‚
</details></p>

<p><a id="markdown-åŠ è½½å½“å‰ç”¨æˆ·ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯" name="åŠ è½½å½“å‰ç”¨æˆ·ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯"></a></p>

<h3>åŠ è½½å½“å‰ç”¨æˆ·ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯</h3>

<p>æˆ‘ä»¬åœ¨ç”¨æˆ·ç™»å½•åä¼šå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡é‡æ–°æ‰“å¼€appæ—¶æˆ‘ä»¬æ£€æµ‹å¹¶ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯ã€‚å½“ç”¨æˆ·ä¿¡æ¯ä¸å­˜åœ¨æ—¶ï¼Œåº”è¯¥è¿›è¡Œçš„å¤„ç†ï¼š</p>

<h4>æ–¹æ¡ˆ 1 Simple domain error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadUser</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">username</span> <span class="o">=</span> <span class="n">UserDefaults</span><span class="p">.</span><span class="n">standard</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="nl">forKey</span><span class="p">:</span> <span class="s">&quot;com.onevcat.app.defaults.username&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">username</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">User</span><span class="p">(</span><span class="nl">name</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 2 Recoverable error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadUser</span><span class="p">()</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">User</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">username</span> <span class="o">=</span> <span class="n">UserDefaults</span><span class="p">.</span><span class="n">standard</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="nl">forKey</span><span class="p">:</span> <span class="s">&quot;com.onevcat.app.defaults.username&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">username</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">User</span><span class="p">(</span><span class="nl">name</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">throws</span> <span class="n">AppError</span><span class="p">.</span><span class="n">UsernameNotExisting</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 3 Universal error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadUser</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">User</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">username</span> <span class="o">=</span> <span class="n">UserDefaults</span><span class="p">.</span><span class="n">standard</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="nl">forKey</span><span class="p">:</span> <span class="s">&quot;com.onevcat.app.defaults.username&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">username</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">User</span><span class="p">(</span><span class="nl">name</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;User name not existing&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 4 Logic failure</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadUser</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">User</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">username</span> <span class="o">=</span> <span class="n">UserDefaults</span><span class="p">.</span><span class="n">standard</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="nl">forKey</span><span class="p">:</span> <span class="s">&quot;com.onevcat.app.defaults.username&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">User</span><span class="p">(</span><span class="nl">name</span><span class="p">:</span> <span class="n">username</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><details>
  <summary><em>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</em></summary></p>

<p>é¦–å…ˆè‚¯å®šæ’é™¤æ–¹æ¡ˆ3å’Œ4ã€‚â€œç”¨æˆ·åä¸å­˜åœ¨â€æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç°è±¡ï¼Œè‚¯å®šä¸èƒ½ç›´æ¥crashã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨æ–¹æ¡ˆ1å’Œæ–¹æ¡ˆ2ä¸­é€‰æ‹©ã€‚</p>

<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œé€‰æ‹©æ–¹æ¡ˆ1 Simple domain errorä¼šæ›´å¥½ã€‚å› ä¸ºç”¨æˆ·ä¿¡æ¯ä¸å­˜åœ¨æ˜¯å¾ˆç®€å•çš„ä¸€ä¸ªçŠ¶å†µï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è®©ç”¨æˆ·ç™»å½•å³å¯ï¼Œè¿™å¹¶ä¸éœ€è¦çŸ¥é“é¢å¤–çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›<code>nil</code>å°±èƒ½å¤Ÿå¾ˆå¥½åœ°è¡¨è¾¾æ„å›¾äº†ã€‚</p>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¸æ’é™¤ä»Šåéšç€æƒ…å†µè¶Šæ¥è¶Šå¤æ‚ï¼Œä¼šéœ€è¦åŒºåˆ†ç”¨æˆ·ä¿¡æ¯ç¼ºå¤±çš„åŸå›  (æ¯”å¦‚æ˜¯å¦æ˜¯æ–°ç”¨æˆ·è¿˜æ²¡æœ‰æ³¨å†Œï¼Œè¿˜æ˜¯ç”±äºåŸç”¨æˆ·æ³¨é”€ç­‰)ã€‚ä½†æ˜¯åœ¨å½“å‰çš„æƒ…å†µä¸‹æ¥çœ‹ï¼Œè¿™å±äºè¿‡åº¦è®¾è®¡ï¼Œæš‚æ—¶å¹¶ä¸éœ€è¦è€ƒè™‘ã€‚å¦‚æœä¹‹åä¸šåŠ¡å¤æ‚åˆ°è¿™ä¸ªç¨‹åº¦ï¼Œåœ¨ç¼–è¯‘å™¨çš„å¸®åŠ©ä¸‹å°†Simple domain errorä¿®æ”¹ä¸ºRecoverable errorä¹Ÿä¸æ˜¯ä»€ä¹ˆéš¾äº‹å„¿ã€‚
</details></p>

<p><a id="markdown-è¿˜æ²¡æœ‰å®ç°çš„ä»£ç " name="è¿˜æ²¡æœ‰å®ç°çš„ä»£ç "></a></p>

<h3>è¿˜æ²¡æœ‰å®ç°çš„ä»£ç </h3>

<p>å‡è®¾ä½ åœ¨ä¸ºä½ çš„æœåŠ¡å¼€å‘ä¸€ä¸ªiOSæ¡†æ¶ï¼Œä½†æ˜¯ç”±äºå·¥æœŸæœ‰é™ï¼Œæœ‰ä¸€äº›åŠŸèƒ½åªå®šä¹‰äº†æ¥å£ï¼Œæ²¡æœ‰è¿›è¡Œå…·ä½“å®ç°ã€‚è¿™äº›æ¥å£ä¼šåœ¨æ­£å¼ç‰ˆä¸­å®Œæˆï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦é¢„å…ˆå‘å¸ƒç»™å‹å•†å†…æµ‹ã€‚æ‰€ä»¥é™¤äº†åœ¨æ–‡æ¡£ä¸­æ˜ç¡®æ ‡æ˜è¿™äº›å†…å®¹ï¼Œè¿™äº›æ–¹æ³•å†…éƒ¨åº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p>

<h4>æ–¹æ¡ˆ 1 Simple domain error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Bar</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 2 Recoverable error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">foo</span><span class="p">()</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Bar</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">throw</span> <span class="n">FrameworkError</span><span class="p">.</span><span class="n">NotImplemented</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 3 Universal error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Bar</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;Not implemented yet.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 4 Logic failure</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Bar</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">assertionFailure</span><span class="p">(</span><span class="s">&quot;Not implemented yet.&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><details>
  <summary><em>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</em></summary></p>

<p>æ­£ç¡®ç­”æ¡ˆæ˜¯æ–¹æ¡ˆ3 Universal errorã€‚å¯¹äºæ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼Œè¿”å›<code>nil</code>æˆ–è€…æŠ›å‡ºé”™è¯¯æœŸå¾…ç”¨æˆ·æ¢å¤éƒ½æ˜¯æ²¡æœ‰é“ç†çš„ï¼Œè¿™ä¼šè¿›ä¸€æ­¥å¢åŠ æ¡†æ¶ç”¨æˆ·çš„è¿·æƒ‘ã€‚è¿™é‡Œçš„é—®é¢˜æ˜¯è¯­è¨€å±‚é¢çš„è¾¹ç•Œæƒ…å†µï¼Œç”±äºæ²¡æœ‰å®ç°ï¼Œæˆ‘ä»¬éœ€è¦ç»™å‡ºå¼ºåŠ›çš„æé†’ã€‚åœ¨ä»»æ„buildè®¾å®šä¸‹ï¼Œéƒ½ä¸åº”è¯¥æœŸå¾…ç”¨æˆ·å¯ä»¥æˆåŠŸè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥<code>fatalError</code>æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>

<p>å…¶å®åœ¨swiftç»§æ‰¿çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„æœªå®ç°çš„æ¥å£ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">required</span> <span class="k">init</span><span class="o">?</span><span class="p">(</span><span class="n">coder</span> <span class="nl">aDecoder</span><span class="p">:</span> <span class="bp">NSCoder</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;init(coder:) has not been implemented&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></details></p>

<p><a id="markdown-è°ƒç”¨è®¾å¤‡ä¸Šçš„ä¼ æ„Ÿå™¨æ”¶é›†æ•°æ®" name="è°ƒç”¨è®¾å¤‡ä¸Šçš„ä¼ æ„Ÿå™¨æ”¶é›†æ•°æ®"></a></p>

<h3>è°ƒç”¨è®¾å¤‡ä¸Šçš„ä¼ æ„Ÿå™¨æ”¶é›†æ•°æ®</h3>

<p>è°ƒç”¨ä¼ æ„Ÿå™¨çš„appæœ€æœ‰æ„æ€äº†ï¼ä¸ç®¡æ˜¯ç›¸æœºè¿˜æ˜¯é™€èºä»ªï¼Œä¼ æ„Ÿå™¨ç›¸å…³çš„appæ€»æ˜¯èƒ½å¸¦ç»™æˆ‘ä»¬å¾ˆå¤šä¹è¶£ã€‚é‚£ä¹ˆï¼Œå¦‚æœæƒ³è¦è°ƒç”¨ä¼ æ„Ÿå™¨è·å–æ•°æ®æ—¶ï¼Œå‘ç”Ÿäº†é”™è¯¯ï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>

<h4>æ–¹æ¡ˆ 1 Simple domain error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">getDataFromSensor</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">sensorState</span> <span class="o">=</span> <span class="n">sensor</span><span class="p">.</span><span class="n">getState</span><span class="p">()</span>
</span><span class='line'>    <span class="n">guard</span> <span class="n">sensorState</span> <span class="o">==</span> <span class="p">.</span><span class="n">normal</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">try</span><span class="o">?</span> <span class="n">sensor</span><span class="p">.</span><span class="n">getData</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 2 Recoverable error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">getDataFromSensor</span><span class="p">()</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">Data</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">sensorState</span> <span class="o">=</span> <span class="n">sensor</span><span class="p">.</span><span class="n">getState</span><span class="p">()</span>
</span><span class='line'>    <span class="n">guard</span> <span class="n">sensorState</span> <span class="o">==</span> <span class="p">.</span><span class="n">normal</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">throws</span> <span class="n">SensorError</span><span class="p">.</span><span class="n">stateError</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">try</span> <span class="n">sensor</span><span class="p">.</span><span class="n">getData</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 3 Universal error</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadUser</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Data</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">sensorState</span> <span class="o">=</span> <span class="n">sensor</span><span class="p">.</span><span class="n">getState</span><span class="p">()</span>
</span><span class='line'>    <span class="n">guard</span> <span class="n">sensorState</span> <span class="o">==</span> <span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">try</span><span class="o">?</span> <span class="n">sensor</span><span class="p">.</span><span class="n">getData</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">fatalError</span><span class="p">(</span><span class="s">&quot;Sensor get data failed!&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">data</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>æ–¹æ¡ˆ 4 Logic failure</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">loadUser</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Data</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">sensorState</span> <span class="o">=</span> <span class="n">sensor</span><span class="p">.</span><span class="n">getState</span><span class="p">()</span>
</span><span class='line'>    <span class="n">assert</span><span class="p">(</span><span class="n">sensorState</span> <span class="o">==</span> <span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="s">&quot;The sensor state is not normal&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">try</span><span class="o">!</span> <span class="n">sensor</span><span class="p">.</span><span class="n">getData</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><details>
  <summary><em>ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</em></summary></p>

<p>ä¼ æ„Ÿå™¨ç”±äºç§ç§åŸå› æš‚æ—¶ä¸èƒ½ä½¿ç”¨ (æ¯”å¦‚æ­£åœ¨è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œæˆ–è€…ç”šè‡³è®¾å¤‡ä¸Šä¸å­˜åœ¨å¯¹åº”çš„ä¼ æ„Ÿå™¨)ï¼Œæ˜¯å¾ˆæœ‰å¯èƒ½å‘ç”Ÿçš„æƒ…å†µã€‚å³ä½¿è¿™ä¸ªä¼ æ„Ÿå™¨çš„æ•°æ®å¯¹åº”ç”¨æ˜¯è‡³å…³é‡è¦ï¼Œä¸å¯æˆ–ç¼ºçš„ï¼Œæˆ‘ä»¬å¯èƒ½ä¹Ÿä¼šå¸Œæœ›è‡³å°‘èƒ½ç»™ç”¨æˆ·ä¸€äº›æç¤ºã€‚åŸºäºè¿™ç§è€ƒè™‘ï¼Œä½¿ç”¨æ–¹æ¡ˆ2 Recoverable erroræ˜¯æ¯”è¾ƒåˆç†çš„é€‰æ‹©ã€‚</p>

<p>æ–¹æ¡ˆ1åœ¨ä¼ æ„Ÿå™¨æ•°æ®æ— å…³ç´§è¦çš„æ—¶å€™å¯èƒ½ä¹Ÿä¼šæ˜¯ä¸€ä¸ªæ›´ç®€å•çš„é€‰é¡¹ã€‚ä½†æ˜¯æ–¹æ¡ˆ3å’Œ4ä¼šç›´æ¥è®©ç¨‹åºå´©æºƒï¼Œè€Œä¸”è¿™å®é™…ä¸Šä¹Ÿå¹¶ä¸æ˜¯ä»£ç è¾¹ç•Œæˆ–è€…å¼€å‘è€…çš„é”™è¯¯ï¼Œæ‰€ä»¥ä¸åº”è¯¥è¢«è€ƒè™‘ã€‚
</details></p>

<p><a id="markdown-æ€»ç»“" name="æ€»ç»“"></a></p>

<h3>æ€»ç»“</h3>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®åœ¨é”™è¯¯å¤„ç†çš„æ—¶å€™ï¼Œé€‰ç”¨å“ªç§é”™è¯¯æ˜¯æ ¹æ®æƒ…æ™¯å’Œå¤„ç†éœ€æ±‚è€Œå®šçš„ï¼Œæˆ‘åœ¨å‚è€ƒç­”æ¡ˆä¹Ÿä½¿ç”¨äº†å¾ˆå¤šè¯¸å¦‚â€œå¯èƒ½â€ï¼Œâ€œç›¸è¾ƒè€Œè¨€â€ç­‰è¯­å¥ã€‚è™½ç„¶å¯¹äºç‰¹å®šçš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œç›´è§‚çš„è€ƒè™‘å’Œå†³ç­–ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ•™æ¡ä¸»ä¹‰èˆ¬çš„ä¸€æˆä¸å˜ã€‚é”™è¯¯ç±»å‹ä¹‹é—´å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡ä»£ç äº’ç›¸è½¬æ¢ï¼Œè¿™è®©æˆ‘ä»¬åœ¨å¤„ç†é”™è¯¯çš„æ—¶å€™å¯ä»¥è‡ªç”±é€‰æ‹©ä½¿ç”¨çš„ç­–ç•¥ï¼šæ¯”å¦‚APIå³ä½¿æä¾›ç»™æˆ‘ä»¬çš„æ˜¯Recoverableçš„throwså½¢å¼ï¼Œæˆ‘ä»¬ä¹Ÿè¿˜æ˜¯å¯ä»¥æŒ‰ç…§éœ€è¦ï¼Œé€šè¿‡<code>try?</code>å°†å…¶è½¬ä¸ºSimple domain errorï¼Œæˆ–è€…ç”¨<code>try!</code>å°†å…¶è½¬ä¸ºLogic failureã€‚</p>

<p>èƒ½åˆ‡å®ç†è§£ä½¿ç”¨æƒ…æ™¯ï¼Œåˆ©ç”¨è¿™äº›é”™è¯¯ç±»å‹è½¬æ¢çš„æ–¹å¼ï¼Œçµæ´»é€‰å–ä½¿ç”¨åœºæ™¯ä¸‹æœ€åˆé€‚çš„é”™è¯¯ç±»å‹ï¼Œæ‰èƒ½è¯´æ˜¯çœŸæ­£ç†è§£äº†è¿™å››ç§é”™è¯¯çš„åˆ†ç±»ä¾æ®ã€‚</p>

<p><a id="markdown-é”™è¯¯å¤„ç†ç›¸å…³çš„è¾…åŠ©æ–¹æ³•" name="é”™è¯¯å¤„ç†ç›¸å…³çš„è¾…åŠ©æ–¹æ³•"></a></p>

<h2>é”™è¯¯å¤„ç†ç›¸å…³çš„è¾…åŠ©æ–¹æ³•</h2>

<p>For custom errors in swift, refer to <a href="https://developer.apple.com/documentation/swift/error">Error</a> official document.</p>

<p><a id="markdown-use-custom-errors" name="use-custom-errors"></a></p>

<h3>Use Custom Errors</h3>

<h4>Using Enumerations as Errors</h4>

<p>Swiftâ€™s enumerations are well suited to represent simple errors. Create an enumeration that conforms to the Error protocol with a case for each possible error. If there are additional details about the error that could be helpful for recovery, use associated values to include that information.</p>

<p>The following example shows an IntParsingError enumeration that captures two different kinds of errors that can occur when parsing an integer from a string: overflow, where the value represented by the string is too large for the integer data type, and invalid input, where nonnumeric characters are found within the input.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">enum</span> <span class="nl">IntParsingError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">overflow</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">invalidInput</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Including More Data in Errors</h4>

<p>The following XMLParsingError conforms to Error and supply line and column position of the error.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">struct</span> <span class="nl">XMLParsingError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">enum</span> <span class="n">ErrorKind</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="n">invalidCharacter</span>
</span><span class='line'>        <span class="k">case</span> <span class="n">mismatchedTag</span>
</span><span class='line'>        <span class="k">case</span> <span class="n">internalError</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="nl">line</span><span class="p">:</span> <span class="n">Int</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">column</span><span class="p">:</span> <span class="n">Int</span>
</span><span class='line'>    <span class="k">let</span> <span class="nl">kind</span><span class="p">:</span> <span class="n">ErrorKind</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="n">parse</span><span class="p">(</span><span class="n">_</span> <span class="nl">source</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="n">throws</span> <span class="o">-&gt;</span> <span class="n">XMLDoc</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// ...</span>
</span><span class='line'>    <span class="n">throw</span> <span class="n">XMLParsingError</span><span class="p">(</span><span class="nl">line</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="nl">column</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nl">kind</span><span class="p">:</span> <span class="p">.</span><span class="n">mismatchedTag</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hereâ€™s how you can catch any XMLParsingError errors thrown by the parse(_:) function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">do</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">xmlDoc</span> <span class="o">=</span> <span class="n">try</span> <span class="n">parse</span><span class="p">(</span><span class="n">myXMLData</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="k">let</span> <span class="n">e</span> <span class="kt">as</span> <span class="n">XMLParsingError</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;Parsing error: \(e.kind) [\(e.line):\(e.column)]&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;Other error: \(error)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Prints &quot;Parsing error: mismatchedTag [19:5]&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="markdown-do-cleanup-work-using-defer" name="do-cleanup-work-using-defer"></a></p>

<h3>Do Cleanup Work Using <code>defer</code></h3>

<p>You use a <code>defer</code> statement to execute a set of statements just before code execution leaves the current block of code. This statement lets you do any necessary cleanup that should be performed regardless of how execution leaves the current block of codeâ€”whether it leaves because an error was thrown or because of a statement such as <code>return</code> or <code>break</code>. For example, you can use a <code>defer</code> statement to ensure that file descriptors are closed and manually allocated memory is freed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">processFile</span><span class="p">(</span><span class="nl">filename</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="n">throws</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">file</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>        <span class="n">defer</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">close</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">while</span> <span class="k">let</span> <span class="n">line</span> <span class="o">=</span> <span class="n">try</span> <span class="n">file</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Work with the file.</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// close(file) is called here, at the end of the scope.</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="n">vend</span><span class="p">(</span><span class="n">itemNamed</span> <span class="nl">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="n">throws</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">defer</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// do some clean work</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">guard</span> <span class="k">let</span> <span class="n">item</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">throw</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">invalidSelection</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">guard</span> <span class="n">item</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">throw</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">outOfStock</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">guard</span> <span class="n">item</span><span class="p">.</span><span class="n">price</span> <span class="o">&lt;=</span> <span class="n">coinsDeposited</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">throw</span> <span class="n">VendingMachineError</span><span class="p">.</span><span class="n">insufficientFunds</span><span class="p">(</span><span class="nl">coinsNeeded</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">price</span> <span class="o">-</span> <span class="n">coinsDeposited</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">coinsDeposited</span> <span class="o">-=</span> <span class="n">item</span><span class="p">.</span><span class="n">price</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">newItem</span> <span class="o">=</span> <span class="n">item</span>
</span><span class='line'>    <span class="n">newItem</span><span class="p">.</span><span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="n">inventory</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">newItem</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;Dispensing \(name)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above example uses a <code>defer</code> statement to ensure that the <code>open(_:)</code> function has a corresponding call to <code>close(_:)</code>.</p>

<p><a id="markdown-å‚è€ƒ" name="å‚è€ƒ"></a></p>

<h2>å‚è€ƒ</h2>

<ol>
<li><a href="https://onevcat.com/2017/10/swift-error-category/">å…³äº Swift Error çš„åˆ†ç±»</a></li>
<li><a href="https://onevcat.com/2016/03/swift-throws/">Swift 2 throws å…¨è§£æ - ä»åŸç†åˆ°å®è·µ</a></li>
<li><a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/ErrorHandling.html#//apple_ref/doc/uid/TP40014097-CH42-ID508">Error Handling Official Site</a></li>
<li><a href="https://developer.apple.com/documentation/swift/error">Error from Apple Document</a></li>
</ol>

]]></content>
  </entry>
  
</feed>
